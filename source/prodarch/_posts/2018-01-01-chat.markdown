---
layout:     source 
title:      "2018-01-01-WeChat"
date:       2018-01-01 12:00:00
author:     梁媛
lines:      138 
tag:		  [chat]
---
> 00:08:05  聚合支付_程昱  
   
新年快乐！  
   
> 00:12:24  肖良光  
   
??。?。??。??   。?? 。??。??   ?。＼｜／。??         元旦快樂！             Happy new year   ??。／｜＼。??   。?。 ??。??。     ??。 ??。   
   
> 00:16:07  ??刘莎  
   
新年快乐????  
   
> 00:25:09  医美消金-pm-上海  
   
新年快乐????  
   
> 00:53:28  Tom-澳门通-PMD  
   
新年快乐????  
   
> 06:21:26  王月卿～华胜～产品经理～北京  
   
新年快乐  
   
> 06:32:54  风-钱内助-产品-杭州  
   
新年快乐  
   
> 06:34:36  潘啟金-找钢网-产品TL-上海  
   
新年快乐, Happy New Year. ??????  
   
> 07:51:16  我  
   
微信红包  
   
> 07:51:23  我  
   
老熊和服务管理团队感谢大家一年来的大力支持，祝大家新年快乐，万事如意！[玫瑰][玫瑰]??????  
   
> 07:51:42  何阳-天阳科技-开发-长春  
   
群主新年快乐  
   
> 07:51:59  潘啟金-找钢网-产品TL-上海  
   
老大，新年快乐???????  
   
> 07:53:05  何阳-天阳科技-开发-长春  
   
老大的包真够大的  
   
> 07:53:39  取名字头疼  
   
老大，新年快乐???????  
   
> 07:55:36  张卫青  
   
大家新年快乐  
   
> 07:58:54  聪明付-林鹏云  
   
新年快乐  
   
> 08:02:06  何阳-天阳科技-开发-长春  
   
新年快乐  
   
> 08:34:34  Codefor-YMT-TechLead-BJ  
   
新年快乐  
   
> 08:48:59  畅捷通支付|劉峰  
   
新年快乐??????????  
   
> 08:49:43  李宝-智慧生活(北京)-支付架构  
   
@畅捷通支付|劉峰?峰总发红包[耶]  
   
> 09:05:48  畅捷通支付|劉峰  
   
可以吗？  
   
> 09:14:49  陆训-51信用卡-开发  
   
可以  
   
> 09:18:41  李雄峰  
   
可以的  
   
> 09:20:27  畅捷通支付|劉峰  
   
微信红包  
   
> 09:20:43  田伟 David ????  
   
新年快乐  
   
> 09:21:13  何阳-天阳科技-开发-长春  
   
新年快乐  
   
> 09:21:15  丁爱民  
   
新年快乐  
   
> 09:21:32  黄灿-捷付睿通-开发-北京  
   
新年快乐  
   
> 09:21:39  王新-笑脸金融-架构-北京  
   
新年快乐  
   
> 09:21:50  Cathy  
   
新年快乐  
   
> 09:23:20  松松  
   
新年快乐  
   
> 09:25:04  肖良光  
   
新年快乐  
   
> 09:25:49  李宝-智慧生活(北京)-支付架构  
   
  
   
> 09:26:06  蔡少杏  
   
新年快乐  
   
> 09:26:31  胥刚  
   
新年快乐  
   
> 09:27:08  勤奋-联通支付-产品-北京  
   
新年快乐??????  
   
> 09:27:14  Victor-JDJR-研发-北京  
   
新年快乐  
   
> 09:27:48  洪宇明_平安科技_开发经理_深圳  
   
微信红包  
   
> 09:28:15  刘卓_一网通支付_产品  
   
新年快乐  
   
> 09:28:25  周峰（Edison Zhou）  
   
新年快乐  
   
> 09:29:06  夏凯-51信用卡-支付产品-杭州  
   
新年快乐??????  
   
> 09:29:42  MyCity  
   
谢谢各位大佬！新年快乐！  
   
> 09:31:41  wseric  
   
大家新年快乐，2018大展宏图[耶]  
   
> 09:32:00  陈宏  
   
新年快乐[啤酒][啤酒]  
   
> 09:34:16  周雅雯-途虎养车-支付PM-上海  
   
各位新年快乐！  
   
> 09:38:47  思奇-杉德-需求-上海  
   
谢谢大家的红包。祝大家新一年百尺竿头，更进一步[憨笑]  
   
> 09:39:29  舒俊～产品  
   
谢谢大神红包，2018大家都更上一层楼。  
   
> 09:42:40  何阳-天阳科技-开发-长春  
   
新年快乐  
   
> 09:45:28  王振兴-银盛-技术-青岛  
   
新年快乐  
   
> 09:49:39  聚合支付_程昱  
   
新年快乐??  
   
> 09:50:05  张超-信雅达-支付-杭州  
   
新年快乐??  
   
> 09:50:16  贾春亮  
   
新年快乐??  
   
> 09:51:36  何阳-天阳科技-开发-长春  
   
亿联，长春也有个亿联  
   
> 09:57:24  一缕烟缪  
   
新年快乐??  
   
> 10:04:44  季康  
   
新年快乐  
   
> 10:06:25  Dewin  
   
新年快乐  
   
> 10:13:13  小沈-悠融-开发-上海  
   
新年快乐  
   
> 12:55:13  小马-海尔消金-开发-青岛  
   
新年快乐??????  
   
> 13:01:40  马智升-华为Mobile Money SA  
   
新年快乐  
   
> 19:01:31  程琳Wa-杉德支付-产品-上海  
   
今天请到一位朋友，@梁媛-便利蜂-产品-北京 给大家做分享，主题是“支付渠道对账及差异处理”开始时间为【19:30】；欢迎欢迎[鼓掌][鼓掌][鼓掌]！（注： 1.嘉宾分享期间其他人不要发言打断嘉宾分享。2.分享完成后请大家积极补充和提问；3.烦请领取红包签到，谢谢  
   
> 19:02:08  程琳Wa-杉德支付-产品-上海  
   
微信红包  
   
> 19:02:18  蔡少杏  
   
签到  
   
> 19:02:26  周峰（Edison Zhou）  
   
签到  
   
> 19:02:33  MyCity  
   
签到。  
   
> 19:03:04  程琳Wa-杉德支付-产品-上海  
   
感谢妹子过节还给大伙儿做分享??????????[鼓掌][鼓掌]  
   
> 19:03:16  ???? 心  
   
感谢各位  
   
> 19:03:19  ???? 心  
   
感恩  
   
> 19:03:39  何阳-天阳科技-开发-长春  
   
签到  
   
> 19:03:42  何阳-天阳科技-开发-长春  
   
好东西  
   
> 19:03:53  heping  
   
洗耳恭听  
   
> 19:04:04  聚合支付_程昱  
   
签到  
   
> 19:04:30  潘啟金-找钢网-产品TL-上海  
   
2018第一讲，非常期待。  
   
> 19:04:37  黄灿-捷付睿通-开发-北京  
   
签到  
   
> 19:05:57  洋芋  
   
签到，超级实用  
   
> 19:06:54  何阳-天阳科技-开发-长春  
   
非常实用  
   
> 19:09:38  青椒-众之金服-产品-成都  
   
签到，元旦快乐  
   
> 19:09:48  唐午阳-汇聚支付-产品-广州  
   
签到，超级实用  
   
> 19:11:42  刘俭民-中科江南-开发运维  
   
签到  
   
> 19:11:46  周文豪-环球易购-PM深圳  
   
签到  
   
> 19:14:55  Ferry  
   
签到  
   
> 19:15:47  周雅雯-途虎养车-支付PM-上海  
   
签到  
   
> 19:18:57  小沈-悠融-开发-上海  
   
签到  
   
> 19:19:03  松松  
   
签到，对账知识很重要[坏笑]  
   
> 19:23:22  李东衡-关天数据-产品-上海  
   
签到  
   
> 19:24:08  医美消金-pm-上海  
   
签到  
   
> 19:26:33  M.cc  
   
签到  
   
> 19:28:34  陈健-人人聚财-产品经理-深圳  
   
签到  
   
> 19:30:23  梁媛  
   
Hi，大家好，新年快乐；  
   
> 19:31:31  梁媛  
   
我是便利蜂的支付产品经理，在校大学生，故见识浅薄；近两个月主要负责支付渠道对账体系的搭建，只能把这些事情与大家分享一下，希望能达到抛砖引玉的效果；  
   
> 19:31:52  梁媛  
   
支付渠道对账有两大块，信息流和资金流，主要分享一下信息流； 一般流程可以分为四个部分：渠道对账单下载、本地交易记录准备、轧帐、平账（对差异的处理）；  
   
> 19:32:21  梁媛  
   
然后我们现在来一一看一下具体内容：  
   
> 19:32:30  梁媛  
   
一、渠道对账单下载： 当前的渠道主要有支付宝、微信、京东支付、银联等； 有几个需要注意的点： 1、渠道对账单的格式不一致； 2、下载的时间不一致； 3、有可能会出现少文件的情况； 基于这几点，需要做的主要事情有对账单的处理，统一格式，方便后续轧帐； 记录不同渠道读取账单的时间，如果在特定时间点没有拿到渠道文件或文件数量缺失，采用重试机制；  
   
> 19:33:03  梁媛  
   
二、本地交易记录准备： 对账一定是双方以上，在渠道对账单准备好之后，我们也要把本地的交易记录准备好； 主要需要注意的点有： 1、本地交易记录主要包括消费、退款、充值、体现等； 2、在面对大数据量时，如何能降低对账时间（需要考虑使用者对界面刷新时间的接受度和系统存储的合理性）；  
   
> 19:33:43  梁媛  
   
三、轧帐： 主要分为两个部分：自身系统、本地与渠道之间； 1、解释为什么要自身系统对账：自身系统的轧帐主要为系统业务订单与支付单之间的对账，取对平的单据进行下一步对账，主要是为了保证内部数据的一致性； 2、主要的一个大坑：对账时间窗； 众所周知，支付是需要时间的，这就会遇到跨对账周期的情况； 对于此，我们可以根据自己公司的情况，合理设置时间窗； 比如微信每日对账区间为第一天0点到第二天0点，面对小金额支付多的情况，可设置10-30min的时间窗，如差异的账单的成单时间 在23:30-0:00间，则默认为跨日交易产生的差异，不在当天对账差异文件中显示；  
   
> 19:35:31  梁媛  
   
四、平账： 平账主要分为两大类，系统平账及人工参与平账； 差异主要分为三大类——长款、短款、金额不等，我们一一看一下； 1、长款：本地无支付，支付渠道已支付； 这种情况一般发生在，未能及时获取渠道异步回写状态通知 或 支付未成功回写业务系统状态的情况；出现此问题，需系统往上查询业务单，重新回写状态并通知各业务线； 2、短款：主要为跨日交易，对于跨日交易处理方式有两种：第一种是在当天差异文件中显示出来并系统默认标出跨日交易；第二种是不再当天的差异文件中显示；但是在第二天的时候，要将有差异的单据再次对账，如此时仍未对平，应将标红并进行人工处理； 3、金额不一致：极少，一般均为系统问题，需人工核查； 最好的差异处理，是依据自己公司的情况，从庞大的历史数据库中进行汇总、分析，总结出对应的差异原因，以做到系统化平账；  
   
> 19:36:32  梁媛  
   
资金对账，目前只接触了一点，不足以分享给大家，所以就到这里了；大家有什么指点的地方，请多指教??  
   
> 19:38:20  Codefor-YMT-TechLead-BJ  
   
一般三方只提供生产环境的账户，比如支付宝，商户在开发、测试、生产环境配置的商户号都是一样的，对支付宝来说，都是生产环境。那么如何处理非生产环境的长款问题？  
   
> 19:39:18  M.cc  
   
归收入了  
   
> 19:39:20  Codefor-YMT-TechLead-BJ  
   
我们目前固定1分的交易（业务正常情况下不会有1分的交易）为非生产环境的单子。但是这样不精确  
   
> 19:39:32  M.cc  
   
我们是这样处理的[呲牙]  
   
> 19:39:47  梁媛  
   
自己的系统可以在订单上做特殊标记处理，在普通订单号上加一个b（代表beta），即可明确区分出来  
   
> 19:40:12  陈志华-新生支付-运营-北京  
   
支付时间窗的问题，设置十到三十分钟的时间窗，请问你们是按订单请求支付时间还是订单支付完成时间去对账单  
   
> 19:40:37  Codefor-YMT-TechLead-BJ  
   
thx，这也是一种办法。我们目前的流水号没考虑环境信息  
   
> 19:41:13  陈志华-新生支付-运营-北京  
   
对其实测试归收入即可，或者直接退款  
   
> 19:41:44  梁媛  
   
我们当前是按照本地系统记录上的支付完成时间去对账的@羽琪-新生支付-北京  
   
> 19:41:57  Codefor-YMT-TechLead-BJ  
   
我们大额的才原路退，1分的都算一个测试费科目了  
   
> 19:43:37  梁媛  
   
可以归收入，但考虑到beta环境与线上环境的订单，有可能会有很多不同的地方，比如订单部分字段缺失或更换支付方式等，在交易流水上，比较好的处理方式还是打上标记  
   
> 19:44:23  Codefor-YMT-TechLead-BJ  
   
部分三方里的账单里，金额单位是元，实际对账都算以分为单位的整数。元转分有遇到什么坑没有？好像是个偏技术的问题  
   
> 19:45:30  Codefor-YMT-TechLead-BJ  
   
打上非生产环境的标记，这部分钱还是会归到一个科目啊。这俩不冲突  
   
> 19:47:20  梁媛  
   
金额单位一般都是元，只不过会保留两位两位小数；?这个问题主要是对账单的标准化处理，进行单位转换后再存入本地形成标准文件即可，目前我司并没有遇到此类问题。。。  
   
> 19:47:51  梁媛  
   
是的  
   
> 19:49:33  MyCity  
   
楼主可以透露一下对账大概用了什么技术架构吗？  
   
> 19:50:13  Codefor-YMT-TechLead-BJ  
   
商户侧的交易流水要单独抽出来以后要再入库吗？我们目前只是从业务库取出来没单独存数据库  
   
> 19:50:20  MyCity  
   
因为我们也在做对账，目前用的是spring batch。  
   
> 19:50:22  M.cc  
   
现在java都用BigDecimal来定义金额单位，没有人还用 double 或者 float 吧？  
   
> 19:51:24  Codefor-YMT-TechLead-BJ  
   
decimal是一种方案。不过我们是转整型分了  
   
> 19:52:00  梁媛  
   
@范小亮-兴业数金-产品研发-上海 这个问题，我现在不太清楚，如果你想知道的话，我可以抽时间向开发学习一下再交流  
   
> 19:53:22  Codefor-YMT-TechLead-BJ  
   
资金对账要做影子账户吗？能简单说一下吗？@梁媛-便利蜂-产品-北京?  
   
> 19:53:46  MyCity  
   
好的，我也是新手，非常欢迎相互交流。[握手]  
   
> 19:54:02  梁媛  
   
? Codefor-一亩田-TechLead-BJ: 商户侧的交易流水要单独抽出来以后要再入库吗？我们目前只是从业务库取出来没单独存数据库 ? - - - - - - - - - - - - - - - 目前我们是标准化入库后再进行轧帐的  
   
> 19:55:54  梁媛  
   
? Codefor-一亩田-TechLead-BJ: 资金对账要做影子账户吗？能简单说一下吗？@梁媛-便利蜂-产品-北京  ? - - - - - - - - - - - - - - - 我要是说我不知道影子账户是什么，会不会被打啊。。。  
   
> 19:56:12  梁媛  
   
能不能科普一下??@Codefor-一亩田-TechLead-BJ  
   
> 19:58:39  东方-合农网络-产品经理-上海  
   
@梁媛-便利蜂-产品-北京?便利蜂所有支付都是统一账户吗     你这边的对账都是和第三方支付渠道的    
   
> 19:59:29  梁媛  
   
是的，前段时间刚刚把账户统一  
   
> 20:00:03  Codefor-YMT-TechLead-BJ  
   
统一账户是个什么概念？  
   
> 20:00:07  梁媛  
   
资金对账，刚刚接触，还没有到行业的平均水准  
   
> 20:02:04  梁媛  
   
一个集团下会经营不同的业务，考虑到经济、社会等风险，可能会成立不同的子公司，不同子公司下挂有不同的业务；这样的话，不同的业务的收款账户可以是不同的；  
   
> 20:03:43  梁媛  
   
展现给用户的就是，我在A地点买了一件商品，付款给了A公司；在B地点卖了一件商品，付款给了B公司；虽然A地点和B地点同属于一个集团，但付款给了不同公司，收款进了不同账户；  
   
> 20:05:13  梁媛  
   
所以，我们做了一件事情是，统一收款至一个公司，再由此公司进行内部分账；这样对于顾客来说，我不管在哪里购物，付款给了同一个公司，收款进了同一个账户@Codefor-一亩田-TechLead-BJ  
   
> 20:10:37  Codefor-YMT-TechLead-BJ  
   
那集团内部不同的对公账户怎么分账啊？技术服务费？  
   
> 20:11:04  达文西-欣业邦-产品-重庆  
   
这二清乐吧  
   
> 20:11:09  梁媛  
   
嗯  
   
> 20:11:16  周雅雯-途虎养车-支付PM-上海  
   
我也想问这个问题，我们就是因为公司下有很多分公司，所以不得不分开  
   
> 20:12:29  周雅雯-途虎养车-支付PM-上海  
   
@梁媛-便利蜂-产品-北京?你们是因为用户对收款账户特别敏感，才统一账户的吗？  
   
> 20:12:33  Codefor-YMT-TechLead-BJ  
   
那不得缴税啊，流水上去了多贵啊[偷笑]  
   
> 20:14:25  梁媛  
   
是其中一个原因，线下场景比较多，我在A公司买的商品，一会儿账单是B公司，一会儿账单是C公司，对于用户来说会造成困惑；  
   
> 20:16:56  周雅雯-途虎养车-支付PM-上海  
   
冒昧问一下，便利蜂的业务，哪里需要寄送账单呢？  
   
> 20:18:13  梁媛  
   
我的表述不明确，是指在微信／支付宝侧即可看到的支付账单  
   
> 20:19:52  周雅雯-途虎养车-支付PM-上海  
   
哦哦，可能是我们的三个平台对外都是独立经营，名字都不一样，所以没有这个问题  
   
> 20:20:49  梁媛  
   
嗯～  
   
> 20:21:58  孔晓光-丰瑞祥-技术  
   
一般会单独成立一个全资财务子公司或者运营子公司来解决这个问题  
   
> 20:24:03  梁媛  
   
嗯，目前我们是这么解决的；但是如果对外是完全独立运营的话，如果没有其他原因，其实不用专门加这一层关系  
   
> 23:30:39  于江宁  
   
匿名爆料:阿里巴巴得病数据3547人，逝世42人 腾讯...  
   
