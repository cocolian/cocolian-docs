---
layout:     source 
title:      "2017-12-29-WeChat"
date:       2017-12-29 12:00:00
author:     胥刚
lines:      203 
tag:       [chat]
---
> 09:52:37  夏凯  
   
各位有遇到过这种情况么，借记卡过期了在支付宝微信还能支付成功[衰]  
   
> 10:17:13  管静????  
   
@夏凯-51信用卡-支付产品-杭州?借记卡一般没有有效期  
   
> 10:32:35  夏凯  
   
哦，好的~~  
   
> 10:36:08  蔡少杏  
   
借记卡有有效期  
   
> 10:37:02  蔡少杏  
   
贵宾卡一般5年左右，看是银联，万事达还是visa，不太一样  
   
> 10:38:09  蔡少杏  
   
如果是普通卡，每家银行不一样！比如今天开的卡，有些银行默认有效期是2049或者2099  
   
> 10:38:31  夏凯  
   
soga  
   
> 10:39:06  夏凯  
   
今天我们有个员工借记卡到期了，在支付宝微信还能扣款成功.....请问下这种情况是怎么发生的  
   
> 10:39:37  夏凯  
   
在我们自己接的通道上面就是失败，提示卡已过有效期。。。。  
   
> 10:40:11  蔡少杏  
   
我们前两天理财pos刷建行卡来我们行买理财，客户卡有效期过了，资金过来来  
   
> 10:40:16  蔡少杏  
   
过不来  
   
> 10:40:50  蔡少杏  
   
连建行柜台都不让转，直接提现拿过来的  
   
> 10:41:42  蔡少杏  
   
正常是不行，支付宝挺牛逼的  
   
> 10:41:59  夏凯  
   
??他们怎么做到的  
   
> 10:45:23  李宝  
   
银行账户和卡管理的系统是分离的  
   
> 10:46:30  Cathy  
   
@夏凯-51信用卡-支付产品-杭州  借记卡也有到期的概念嘛？  
   
> 10:47:10  夏凯  
   
渤海银行的蔡少杏同学说有的  
   
> 10:48:20  夏凯  
   
那意思是说支付宝微信绕开了卡管理系统 @李宝-智慧生活(北京)-支付架构  
   
> 10:52:23  管静????  
   
借记卡卡片正面下方是由有效期的年月的  但是这个不影响账户本身的状态 即使过期  卡内账户也可以不受影响  工行卡就是这样 这个有效期可以理解为形式化的标注  
   
> 10:54:23  Cathy  
   
原来是这样  
   
> 10:54:38  东方  
   
我的建行 貌似早过期了   但是作为我股票账户  貌似不受影响  
   
> 10:55:02  夏凯  
   
那扣款功能是怎么实现的，直接账户间划转资金？  
   
> 10:56:42  管静????  
   
账户正常  就能扣款  
   
> 10:56:53  管静????  
   
卡号  和账户  是分开的  
   
> 10:57:47  李宝  
   
快捷支付是根据银行卡签约协议号直接操作账户，而atm是通过银行卡操作银行账户，肯定先验证卡状态  
   
> 11:00:22  夏凯  
   
我们走的是第三方的代扣通道  
   
> 11:00:32  管静????  
   
建行的理财卡是由有效期的  ，所以这个还真得区分卡种  可能每个银行不一样。  
   
> 11:00:45  夏凯  
   
也是验卡状态的喽？  
   
> 11:00:53  夏凯  
   
@李宝-智慧生活(北京)-支付架构  
   
> 13:10:56  上协  
   
今天才知道 交行和建行是亲戚啊  
   
> 13:37:07  季康  
   
@陆训-51信用卡-开发-北京?啥亲戚  
   
> 14:20:23  上协  
   
建行的祖宗是交行的人  
   
> 14:22:42  M.cc  
   
请教下各位，互金行业，快捷支付不允许贷记卡支付，这个是人行哪个文规定的？  
   
> 18:02:14  我  
   
 有使用docker来跑支付核心、账户核心的公司吗？   
   
> 18:10:32  舒俊～产品  
   
@M.cc-随行付-互联网跨境PM-北京?这个应该规定，主要是空手套白狼行为  
   
> 18:16:11  M.cc  
   
具体哪个文？  
   
> 18:17:42  韩涛-快捷通渠道经理  
   
你签快捷支付协议，协议里面也不允许啊[捂脸]  
   
> 18:36:33  冰镇、西瓜  
   
@李雄峰-今日头条-支付PL-北京?有  
   
> 18:36:58  冰镇、西瓜  
   
我们公司所有服务都是docker  
   
> 18:37:12  我  
   
稳定性如何？  
   
> 18:37:23  我  
   
能满足监管需求吗？   
   
> 18:37:25  冰镇、西瓜  
   
很多公司也是吧 平安也是  
   
> 18:37:49  冰镇、西瓜  
   
性能还可以的  
   
> 18:38:23  冰镇、西瓜  
   
你指的监管要求是什么[囧]没有去看  
   
> 18:43:17  舒俊～产品  
   
安全性要求？  
   
> 18:43:27  舒俊～产品  
   
哪个文件哦？  
   
> 18:52:16  我  
   
平安能搞定将支付核心跑到docker上的运维？  
   
> 18:59:40  程琳-杉德支付-PM  
   
发个通告[呲牙]  
   
> 18:59:45  程琳-杉德支付-PM  
   
今天请到一位朋友，@胥刚 给大家做分享，主题是“智能pos”开始时间为【19:30】；欢迎欢迎[鼓掌][鼓掌][鼓掌]！（注： 1.嘉宾分享期间其他人不要发言打断嘉宾分享。2.分享完成后请大家积极补充和提问；3.烦请领取红包签到，谢谢！  
   
> 19:00:12  程琳-杉德支付-PM  
   
[微信红包](https://wxapp.tenpay.com/mmpayhb/wxhb_personalreceive?showwxpaytitle=1&amp;amp;msgtype=1&amp;amp;channelid=1&amp;amp;sendid=1000039501201712297025023914249&amp;amp;ver=6&amp;amp;sign=25a5d691ae117bcdfa45d84bd276d014be1d7a3dd693844d6fc07e735dfad3b8b565a1ee5edeeb0b23f48fded8004aeae555de685d85381c5602313c1f530762ad6e82010c5e5b9a1e62f3e8f553a197)  
   
> 19:00:13  陈宏  
   
?? ?? ??   
   
> 19:00:28  Chaos  
   
签到  
   
> 19:00:40  郝维甲  
   
签到  
   
> 19:00:43  陈宏  
   
签到  
   
> 19:00:44  范双  
   
[OK]  
   
> 19:01:19  balance  
   
签到  
   
> 19:01:43  松松  
   
签到  
   
> 19:01:50  Merry（黄燕）  
   
[鼓掌][鼓掌][鼓掌]  
   
> 19:02:39  槑旭旭 ?微信超級會員  
   
签到  
   
> 19:03:56  林鹏云  
   
签到  
   
> 19:04:08  刘卓_Loui  
   
签到  
   
> 19:04:37  谢理律师  
   
先签到  
   
> 19:04:39  李先华  
   
签到  
   
> 19:05:13  MyCity  
   
签到  
   
> 19:05:20  冰镇、西瓜  
   
签到  
   
> 19:05:27  只是个昵称  
   
签到  
   
> 19:05:50  王振兴  
   
签到  
   
> 19:06:17  冰镇、西瓜  
   
@洪宇明_平安_开发_深圳?问下你们多数服务是在docker上的吧  
   
> 19:06:33  冰镇、西瓜  
   
上次去听你们的会议有说过  
   
> 19:07:27  只是个昵称  
   
也有放到上面的，还有其它方式的  
   
> 19:08:05  冰镇、西瓜  
   
k8s？  
   
> 19:09:02  冰镇、西瓜  
   
我们准备把docker上项目移植到k8s  
   
> 19:09:34  Ferry  
   
签到  
   
> 19:10:08  Chaos  
   
docker k8s不是组合用的么  
   
> 19:11:13  冰镇、西瓜  
   
是可以  
   
> 19:13:12  w  
   
签到  
   
> 19:14:55  Chaos  
   
群里有用apache camel的朋友吗  
   
> 19:31:08  胥刚  
   
时间到了，那我现在开始吧。  
   
> 19:31:34  胥刚  
   
大家好，我是华夏银行间联POS收单系统的系统负责人，主要负责POSP系统和POSC端系统的程序开发和运维工作。  
   
> 19:31:43  上协  
   
签到  
   
> 19:32:13  胥刚  
   
从事的是比较纯粹的线下收单业务系统，也不涉及太高深的技术，相信大家也非常了解和熟悉。  
   
> 19:33:34  蔡少杏  
   
签到  
   
> 19:33:57  胥刚  
   
我们打造的产品除了传统POS，主要还有MPOS、智能POS、二维码收银台等。支持的功能除了传统的银行卡交易，还有微信、支付宝、银联三种渠道的各种扫码交易，此外，还有转账、便民缴费、进销存等功能。  
   
> 19:35:16  胥刚  
   
经常看咱们老熊的公众号，最近终于有机会加群了，找到组织了。  
   
> 19:36:20  胥刚  
   
我先说说我们后台的架构，再聊聊终端方面的一些经验。  
   
> 19:36:22  勤奋(sir)  
   
签到  
   
> 19:37:07  胥刚  
   
架构这儿我就不画架构图了，文字简单描述。  
   
> 19:37:31  胥刚  
   
我们POSP系统后面对接的是BEAI总线系统和外联网关系统。  
   
> 19:38:10  胥刚  
   
传统银行卡交易都发到BEAI总线系统，它负责路由，比如他行卡消费发到我行的银联前置系统，本行卡消费就直接发到我行的核心卡系统，转账交易发到我行的二代支付系统等。  
   
> 19:38:58  胥刚  
   
二维码等互联网交易都发到外联网关系统，外联网关系统再对接微信、支付宝、银联二维码系统等。  
   
> 19:40:13  胥刚  
   
我们POSP系统内部也划为几个模块，核心的就是处理POS联机交易的应用集群，处理socket通讯8583报文格式。  
   
> 19:41:07  胥刚  
   
但是智能POS肯定是HTTPS的通讯方式，那么需要先经过SSL加速器转换为HTTP通讯，再通过互联网前置模块转换成socket通讯，最后发到POSP应用集群。  
   
> 19:41:47  胥刚  
   
此外，还有二维码收银台的H5 web模块，进销存模块，应用市场模块等。内管系统单独成另一系统。  
   
> 19:42:27  胥刚  
   
再说回智能POS终端部分。智能POS已经不是个新鲜的事物了，相关概念已经出来好多年了，现在已经是非常成熟和常见了。  
   
> 19:43:32  胥刚  
   
智能POS终端和传统POS及MPOS有较大区别，其最重要的区别我认为是它能提供丰富多样的行业应用，它能比较方便和安全的集成其他的功能和产品。  
   
> 19:44:19  胥刚  
   
但为了实现这些目标，智能POS必须要有一个统一的基础，因为一个收单机构肯定不止一个POS厂商，不止一种型号  
   
> 19:44:41  胥刚  
   
这个基础主要如下：  
   
> 19:45:03  胥刚  
   
1、统一操作系统要求。需要对操作系统的版本、安全控制、预装程序等制定统一要求。此外，对于按键和硬件模块的要求也需统一。  
   
> 19:45:45  胥刚  
   
2、统一签名验签。实现对所有程序的管理，未签名的程序一律不允许安装。  
   
> 19:46:25  胥刚  
   
3、统一硬件驱动层SDK接口。这个是为了实现统一收单应用，也为其他第三方应用提供统一的硬件支持。  
   
> 19:47:06  胥刚  
   
4、统一收单应用，并提供统一的支付接口。对第三方应用提供消费、预授权、二维码扫码等支付接口。  
   
> 19:48:04  胥刚  
   
5、对第三方制定统一的接口文档。此外，还有统一的launcher，统一的应用市场，统一的审核上架流程等等。  
   
> 19:49:27  胥刚  
   
在打造了一个统一的基础之后，再积极培育第三方开发合作者，第三方业务合作者，打造一个丰富多元的支付生态系统。  
   
> 19:50:44  胥刚  
   
好了，我就先讲这么多，可能也都是比较老的概念了，大家也别见笑。  
   
> 19:50:59  槑旭旭 ?微信超級會員  
   
[抱拳]不错  
   
> 19:51:03  槑旭旭 ?微信超級會員  
   
很新颖  
   
> 19:51:57  胥刚  
   
大家看有啥问题  
   
> 19:52:11  槑旭旭 ?微信超級會員  
   
@胥刚-华夏银行-项目经理-北京?想请问下，对于第三方合作伙伴，业务APP调用收银是跳转到贵行的收银台APP/插件？还是可以直接在业务APP里调用？谢谢  
   
> 19:52:42  槑旭旭 ?微信超級會員  
   
还有就是业务伙伴拿对账单是否线上线下都能拿到？  
   
> 19:52:43  胥刚  
   
需要跳转到统一的收单应用，支付完再回来   
   
> 19:53:09  胥刚  
   
打印的话可以自己打印，也可以让收单应用打印，参数控制  
   
> 19:53:29  槑旭旭 ?微信超級會員  
   
统一收单应用还需要操作吗？跳转过去直接扫码/刷卡？还是说需要选择支付方式？  
   
> 19:53:53  槑旭旭 ?微信超級會員  
   
嗯，打印相当于直接调POS的打印接口哈？  
   
> 19:54:01  胥刚  
   
现在是参数里面告诉支付方式  
   
> 19:54:15  胥刚  
   
是的  
   
> 19:54:31  胥刚  
   
对账方面系统现在没有提供  
   
> 19:54:38  槑旭旭 ?微信超級會員  
   
[捂脸]  
   
> 19:54:53  槑旭旭 ?微信超級會員  
   
这是我最苦恼的，好多都不提供  
   
> 19:55:02  胥刚  
   
系统还在完善中，这块下步准备建设  
   
> 20:00:32  舒俊～产品  
   
二维码收单和银行卡收单，现在是一次性结算还是分批结算？在智能POS上  
   
> 20:01:03  舒俊～产品  
   
对账单是否统一一个出呢？  
   
> 20:03:38  胥刚  
   
如果你是说的终端的结算单，那是一个。  
   
> 20:03:59  胥刚  
   
如果是说的入账，那是分批入账的   
   
> 20:05:16  胥刚  
   
入账是由入账的系统拿到清算文件之后进行入账，不归POSP系统  
   
> 20:05:47  胥刚  
   
入账的流水在手机银行、网银、POS后台管理端能够看到  
   
> 20:07:56  舒俊～产品  
   
入账是由入账的系统拿到清算文件之后进行入账，不归POSP系统？清算文件？比如银联的账单？支付宝的入账通知？吗  
   
> 20:11:26  胥刚  
   
对于T+1商户，都是第二天银联清算文件，微信支付宝清算文件过来了对其入账，但由于时间不一致，是分别入账的。入账之后会有动账的短信通知。入账的流水明细可以在上述系统查到  
   
> 20:12:05  胥刚  
   
但是确实需要筛选渠道  
   
> 20:16:28  舒俊～产品  
   
资金是怎么个到商户呢？由银行统一结算给商户？还是线上由银行，线下由银联  
   
> 20:17:06  槑旭旭 ?微信超級會員  
   
@胥刚-华夏银行-项目经理-北京?想问下，线下收单的商户结算资金和微信支付宝银联二维码的资金不能聚合？是因为线下银联直清商户+银行在微信支付宝是大商户模式？  
   
> 20:18:40  胥刚  
   
@舒俊-互金-产品-成都?这边都是线下商户，我们就是银行，由银行清算入账。  
   
> 20:19:56  胥刚  
   
@聚合支付_程昱?这儿说的都是间联pos商户。直联商户跟这个系统没有关系  
   
> 20:20:36  胥刚  
   
分批入账说的是一个商户一天有三笔入账，银联微信支付宝  
   
> 20:21:31  胥刚  
   
因为我们是根据清算文件进行入账，但是每个渠道清算文件到的时间不一致。  
   
> 20:22:22  槑旭旭 ?微信超級會員  
   
哦  
   
> 20:22:29  槑旭旭 ?微信超級會員  
   
[抱拳]明白了  
   
> 20:24:00  胥刚  
   
如果我们等到最后一个到再一块入账，就比较墨迹了。并且银联是自然日，微信支付宝是工作日，很难一笔入账。  
   
> 20:35:52  范双  
   
@胥刚-华夏银行-项目经理-北京?    支付宝微信的商户资金清算是以银行还是支付宝为准清算？  
   
> 20:41:04  胥刚  
   
我们比较奇葩，以支付宝微信的清算文件为准。  
   
> 20:41:18  胥刚  
   
但这个机制每个银行不一样  
   
> 20:41:32  胥刚  
   
一般都会和自己的流水核对。  
   
> 20:43:47  范双  
   
，银联商户清算是以银联提供的商户资金清算文件为准吗  
   
> 20:44:28  胥刚  
   
@范双-奇付通-开发-北京?我们的是，其他的不一定。  
   
> 20:45:20  范双  
   
现在网联影响支付宝清算这块吗  
   
> 20:45:27  胥刚  
   
银行都是以银行服务商接入微信支付宝，需要给每个POS商户建立子商户。  
   
> 20:46:25  胥刚  
   
网联现在只是让付款的这边接入它，收单这边没有要求。  
   
> 20:46:46  胥刚  
   
收单这边没有影响  
   
> 20:48:45  范双  
   
付款主要是那些业务场景  
   
> 20:48:57  舒俊～产品  
   
POS银行卡收单是不是在终端上存储了刷卡消费结果？然后每天签退就会清除记录并同步上传到收单机构的POSP@胥刚-华夏银行-项目经理-北京?  
   
> 20:52:48  范双  
   
刷卡消费结果是指的什么  
   
> 20:55:33  舒俊～产品  
   
就是银联或者银行卡收单机构反馈的交易报文类，比如支付成功，预授权成功等  
   
> 20:56:14  胥刚  
   
@范双-奇付通-开发-北京 付款就是商户的收款，行业应用可以对其场景丰富  
   
> 20:57:13  胥刚  
   
终端本地是有本批次的消费结果记录的，每次结算交易之后对流水进行清除。但不会同步给POSP  
   
> 20:57:55  舒俊～产品  
   
所噶～谢谢  
   
> 21:00:19  范双  
   
@胥刚-华夏银行-项目经理-北京?        支付宝在收单业务，承担类似银联跨行清算的作用吗？可以这样理解吗  
   
> 21:01:20  隔壁老王  
   
@胥刚-华夏银行-项目经理-北京?[强][强][强]  
   
> 21:01:21  胥刚  
   
其实可以这样理解，支付宝相当于银联了  
   
> 21:02:03  胥刚  
   
所以微信支付宝二维码支付的崛起威胁最大的就是银联，而不是银行  
   
> 21:02:36  范双  
   
网联是要把支付宝跨行清算的功能取代吧  
   
> 21:02:41  舒俊～产品  
   
处理跨行支付？  
   
> 21:02:48  隔壁老王  
   
我觉得扫码的交易，不需要上送批节  
   
> 21:02:49  胥刚  
   
所以现在银联搞云闪付，搞二维码，搞统一APP都是为了对付第三方支付  
   
> 21:03:47  隔壁老王  
   
那现在推银联的标准码，你们的记账模式要调整吗？@胥刚-华夏银行-项目经理-北京?  
   
> 21:03:58  胥刚  
   
是不需要批结，批结本身都可以不需要。  
   
> 21:04:41  隔壁老王  
   
其实现在银行卡的一些交易功能，可以去掉了。  
   
> 21:05:19  胥刚  
   
记账模式没有变化  
   
> 21:05:31  隔壁老王  
   
因为通信稳定多了，查账方式多样了  
   
> 21:06:11  胥刚  
   
银联现在给的聚合方式分为银联标准码和银联非标码  
   
> 21:06:48  胥刚  
   
银联标准码就是域名是银联，微信支付宝扫的话银联再重定向到各个银行  
   
> 21:07:00  隔壁老王  
   
非标那套，银联要淘汰了  
   
> 21:07:31  隔壁老王  
   
和各个接入的第三方  
   
> 21:07:36  胥刚  
   
银联非常想银行走标准码  
   
> 21:08:11  胥刚  
   
非标码银联没说要淘汰吧  
   
> 21:08:23  隔壁老王  
   
为什么这么说  
   
> 21:08:56  胥刚  
   
非标码就是各个收单机构的自己域名的码  
   
> 21:09:05  隔壁老王  
   
以前的非标后台基于银联钱包的  
   
> 21:09:32  胥刚  
   
其实其他APP也能支持非标  
   
> 21:10:01  胥刚  
   
非标就是主扫的时候订单信息不在银联，而在发码机构  
   
> 21:10:15  胥刚  
   
需要银联去银行查询订单信息  
   
> 21:10:16  隔壁老王  
   
早期接的，不支持微信和支付宝聚合  
   
> 21:11:20  胥刚  
   
我跟你理解的不一样。银联把不符合他们命名规范的码都叫非标码  
   
> 21:11:45  胥刚  
   
非标码应该是支持微信和支付宝聚合的  
   
> 21:14:29  隔壁老王  
   
那非标定义的不一样  
   
> 21:14:32  隔壁老王  
   
[皱眉]  
   
> 21:17:06  胥刚  
   
因为我们现在就在做三码合一，对这块还算了解，跟大家讨论讨论。  
   
> 21:18:06  胥刚  
   
我们现在收银台有两个码，一个聚合了微信支付宝，为自己的域名地址，一个用于银联二维码静态主扫，为银联地址  
   
> 21:18:17  胥刚  
   
现在需要把这两个合一。  
   
> 21:18:26  胥刚  
   
银联提供两种方案  
   
> 21:19:18  胥刚  
   
银联标准码方案，统一成银联地址的码，当微信支付宝扫的时候，银联给重定向到我们银行的地址。  
   
> 21:19:37  胥刚  
   
之后银行自己处理。  
   
> 21:19:49  胥刚  
   
银联主扫没有变化。  
   
> 21:20:28  胥刚  
   
非标码方案，统一成我行地址的码。但需要把地址报备给银联  
   
> 21:21:31  胥刚  
   
当支持银联二维码的app扫的时候，还是将交易发到银联，银联没有订单信息，需要去银行做订单查询再回给支付APP  
   
> 21:22:20  胥刚  
   
但这个有个问题，有好多银联支付的APP主扫时对于扫到的地址做了校验  
   
> 21:22:44  胥刚  
   
如果不是银联地址就报错，所以需要他们做白名单配置  
   
> 21:22:50  舒俊～产品  
   
银联扫码好像要签到？  
   
> 21:23:11  胥刚  
   
银联扫码不需要签到。  
   
> 21:23:35  胥刚  
   
终端签到主要是更新pin key和mac key  
   
> 21:26:11  舒俊～产品  
   
嗯嗯  
   
> 21:26:52  胥刚  
   
如果用银联标准码方案，对于收单银行来说，微信支付宝的交易也得去趟银联，路由就长了，并且自己的控制力就弱了，但是受制于白名单。让众多银联付款APP改是很难的  
   
> 21:28:04  胥刚  
   
现在大部分银行还是会采用银联标准码方案。  
   
> 21:38:39  隔壁老王  
   
抱团嘛，不然搞得过微信和支付宝的各种补贴活动  
   
> 21:40:20  胥刚  
   
现在支付宝太猛了，银联这方很悬啊  
   
> 22:19:43  劉峰  
   
请问银联清算也是工作日+1吧？前边说是自然日？  
   
