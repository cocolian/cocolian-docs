---
layout:     source 
title:      "2018-01-14-WeChat"
date:       2018-01-14 12:00:00
author:     周雅雯-途虎养车-支付PM-上海
lines:      93 
tag:		  [chat]
---
> 18:01:12  程琳Wa-杉德支付-产品-上海  
   
今天请到一位朋友，@周雅雯-途虎养车-支付PM-上海 给大家做分享，主题是“电商统一支付平台改造” 开始时间为【19:00】；欢迎欢迎[鼓掌][鼓掌][鼓掌]！（注： 1.嘉宾分享期间其他人不要发言打断嘉宾分享。2.分享完成后请大家积极补充和提问；3.烦请领取红包签到，谢谢！  
   
> 18:01:27  程琳Wa-杉德支付-产品-上海  
   
微信红包  
   
> 18:01:56  程琳Wa-杉德支付-产品-上海  
   
又是一波儿干货儿，欢迎欢迎[鼓掌][鼓掌][鼓掌]  
   
> 18:02:09  MyCity  
   
签到。  
   
> 18:02:10  Ferry  
   
签到  
   
> 18:02:23  舒俊～产品  
   
签到  
   
> 18:02:37  谢理-深圳-合规  
   
签到  
   
> 18:03:02  韩涛  
   
到  
   
> 18:03:13  李洪军-拉乌网络-研发经理-深圳  
   
签到[强]  
   
> 18:03:37  青椒-众之金服-产品-成都  
   
签到  
   
> 18:04:15  wseric  
   
签到  
   
> 18:05:22  吕文伟_兴业银行总行  
   
签到  
   
> 18:05:23  王向东  
   
签到  
   
> 18:06:46  周峰（Edison Zhou）  
   
签到  
   
> 18:06:50  达文西-欣业邦-产品-重庆  
   
签到  
   
> 18:09:01  黄灿-捷付睿通-开发-北京  
   
签到  
   
> 18:09:12  聚合支付_程昱  
   
签到  
   
> 18:10:01  勤奋-联通支付-产品-北京  
   
签到  
   
> 18:11:06  七夜  
   
签到  
   
> 18:13:06  刘俭民-中科江南-开发运维  
   
签到  
   
> 18:14:15  洪宇明_平安科技_开发经理_深圳  
   
签到  
   
> 18:15:24  史亭凯-消金-开发-北京  
   
签到  
   
> 18:17:03  周雅雯-途虎养车-支付PM-上海  
   
签到  
   
> 18:17:05  电网～产品～时伯寅  
   
签到  
   
> 18:17:32  小马-海尔消金-开发-青岛  
   
签到  
   
> 18:22:36  周文豪-环球易购-PM深圳  
   
签到  
   
> 18:23:47  马智升-华为Mobile Money SA  
   
签到  
   
> 18:29:12  M.cc  
   
签到  
   
> 18:29:43  松松  
   
签到  
   
> 18:30:06  潘啟金-找钢网-产品TL-上海  
   
[玫瑰][强]  
   
> 18:55:48  周雅雯-途虎养车-支付PM-上海  
   
时间差不多了，我们就开始吧。  
   
> 18:56:46  周雅雯-途虎养车-支付PM-上海  
   
感谢各位参加这次分享，我是途虎养车的金融支付产品经理。公司从2017年初开始筹备支付系统的改造，至今历时一年。  
   
> 18:57:19  周雅雯-途虎养车-支付PM-上海  
   
首先，简单介绍一下我们公司的整体业务情况，以便于大家更好的了解统一支付平台建设的原因和意义。同时，也希望可以对同类或者业务相似的平台，起到一定的借鉴作用。  
   
> 18:57:52  周雅雯-途虎养车-支付PM-上海  
   
作为一个汽车后市场的垂类电商，途虎主要通过线上销售、线下服务的形式为个人车主提供服务。下线门店分为自营门店、加盟门店、合作门店3种。此外，我们还有2类to B的业务。  
   
> 18:58:43  周雅雯-途虎养车-支付PM-上海  
   
这3条主营业务线有自己独立的品牌，以不同的公司主体开展业务。因此，研发部门也设立了对应的项目组，分别对应C端购买产品、服务的用户（途虎养车）、B端购买产品的用户（汽配龙）、B端购买服务的用户（快修云）开发系统。  
   
> 18:59:28  周雅雯-途虎养车-支付PM-上海  
   
公司整体的业务前端展现基本如下：  
   
> 18:59:36  周雅雯-途虎养车-支付PM-上海  
   
![2018-01-14 18:59:36](http://static.cocolian.cn/img/201801/20180114_185936.png) 
   
> 19:00:26  周雅雯-途虎养车-支付PM-上海  
   
简单来说，这3大前端系统分为：1）面向个人用户的轮胎、保养、车品购买及安装；2）面向汽车维修、保养门店、汽配城等商户的轮胎、保养品、车品进货；3）面向淘宝、天猫保养品、车品卖家销售的线下门店安装服务。  
   
> 19:01:46  周雅雯-途虎养车-支付PM-上海  
   
其中，途虎养车虽然针对C端用户，但是用户存在两种消费场景，一种是线上下单并支付，另一种是线上下单、到店支付。所以，C端APP使用线上支付产品，B端APP使用的是当面付（条码、扫码）、POS机、智能POS等线下方式收款。  
   
> 19:02:50  周雅雯-途虎养车-支付PM-上海  
   
大家可能注意到了图中的不同颜色，这些颜色代表不同团队接入的支付功能。基本上来说，就哪个应用需要支付了就自己申请账号、自己签约、自己开发。  
   
> 19:04:58  周雅雯-途虎养车-支付PM-上海  
   
途虎在各个业务线都有自营的商品，除了美容服务和部分车品代发，距离大仓近的地点也都使用自建物流配送。  
   
> 19:05:22  周雅雯-途虎养车-支付PM-上海  
   
所以，在各个业务端的后面，有一个大型的业务系统，包含：订单、采购、仓储、物流等等子系统。所以，前端业务进来的订单，都会统一在订单系统内创建订单，分别更新订单付款状态以及支付信息。  
   
> 19:06:31  周雅雯-途虎养车-支付PM-上海  
   
其中，途虎养车C端由于是一个相对成熟的团队，所以自建了一套回调网关，APP、H5、PC、小程序收到的支付回调都由统一的服务处理，然后对接订单服务接口。其他，基本就是各个团队独立搞一套。  
   
> 19:07:43  周雅雯-途虎养车-支付PM-上海  
   
此外，还有两个公司早期系统设计遗漏的地方，一是外部对账系统缺失。公司的业务系统内，有财务子系统。但是财务系统主要承担的是业务订单的金额汇总、分类，以及线下门店安装费、服务费的清结算，不包含渠道对账。二是各个业务端都没有对接退款渠道，导致每天数百笔退款，都是由财务人员在各个第三支付的商户后台，通过批量导入的方式人工退款。  
   
> 19:09:48  周雅雯-途虎养车-支付PM-上海  
   
---------- 上为改造前，下为改造后 ----------  
   
> 19:10:12  周雅雯-途虎养车-支付PM-上海  
   
通过分析和梳理支付业务的实现方式，经过多轮调研，理清支付平台跟各业务端以及业务订单的关系。首先确认了，需要将资金相关逻辑从订单系统中剥离。  
   
> 19:10:53  周雅雯-途虎养车-支付PM-上海  
   
同时，向各终端提供统一调用的收银台，整合前端支付受理，支持按业务类型、订单渠道等多维度定制支付方式。定义统一的支付渠道接入规范，提供可插拔的渠道接入方式。  
   
> 19:11:42  周雅雯-途虎养车-支付PM-上海  
   
新建支付核心平台，统一维护支付指令，抽象出公共的支付服务，满足出款、入款、内部账户转账、余额支付等业务需求。  
   
> 19:12:12  周雅雯-途虎养车-支付PM-上海  
   
由支付平台完成与金融机构（含第三方支付、银行等）所有的外部对接，实现与基于会计原则设计的结算中心和金蝶账务软件的系统集成。  
   
> 19:12:25  周雅雯-途虎养车-支付PM-上海  
   
![2018-01-14 19:12:25](http://static.cocolian.cn/img/201801/20180114_191225.png) 
   
> 19:13:44  周雅雯-途虎养车-支付PM-上海  
   
下面讲一下统一支付平台的整体架构：  
   
> 19:13:58  周雅雯-途虎养车-支付PM-上海  
   
1）支付受理平台  
   
> 19:14:17  周雅雯-途虎养车-支付PM-上海  
   
收拢各业务端收银台，解决收银台的统一问题。不同终端的收银台，提供不同终端的收银台目的是为了统一收银逻辑，但此处收银台只包含视图逻辑，业务逻辑封装在支付受理核心中。  
   
> 19:15:04  周雅雯-途虎养车-支付PM-上海  
   
支付受理核心维护了收银台的模型：包含支付方式、风控策略、支付前置校验等逻辑，并调用支付引擎的支付接口完成支付。  
   
> 19:15:43  周雅雯-途虎养车-支付PM-上海  
   
收银台方面，举个简单的例子。下面是我们的途虎养车C端APP收银台和PC收银台。  
   
> 19:16:04  周雅雯-途虎养车-支付PM-上海  
   
![2018-01-14 19:16:04](http://static.cocolian.cn/img/201801/20180114_191604.png) 
   
> 19:16:15  周雅雯-途虎养车-支付PM-上海  
   
![2018-01-14 19:16:15](http://static.cocolian.cn/img/201801/20180114_191615.png) 
   
> 19:17:31  周雅雯-途虎养车-支付PM-上海  
   
收银台配置通过支付产品编码来控制，每一套编码在表示了收银台来源平台所属的业务端、支付类型、应用终端类型外，也规定了收银台内付款方式实际对接的支付产品。比如，途虎养车官网的收银台的参数分配是这样的：  
   
> 19:17:46  周雅雯-途虎养车-支付PM-上海  
   
![2018-01-14 19:17:46](http://static.cocolian.cn/img/201801/20180114_191746.png) 
   
> 19:18:23  周雅雯-途虎养车-支付PM-上海  
   
2）支付核心平台  
   
> 19:18:48  周雅雯-途虎养车-支付PM-上海  
   
![2018-01-14 19:18:48](http://static.cocolian.cn/img/201801/20180114_191848.png) 
   
> 19:19:44  周雅雯-途虎养车-支付PM-上海  
   
支付引擎，向上层系统提供公共的支付出、入、转、退服务，维护支付指令，定义渠道接入规范接口、渠道等完成支付流程的执行，支付的执行机构。  
   
> 19:20:48  周雅雯-途虎养车-支付PM-上海  
   
支付决策，定义支付流程、渠道路由，具备按照业务动态配置的能力，是支付的决策机构。  
   
> 19:21:09  周雅雯-途虎养车-支付PM-上海  
   
内部渠道，内部账户（主要为余额账户）将在内部渠道作为一种支付渠道进行处理。  
   
> 19:21:42  周雅雯-途虎养车-支付PM-上海  
   
入款渠道，包含所有业务端已经独立接入的第三方支付渠道和银行渠道：微信、支付宝、翼支付、拉卡拉等，这些渠道实现了支付引擎的统一渠道接口。渠道回调网关，三方渠道系统主动请求途虎系统的入口，统一接收各三方渠道的回调。  
   
> 19:23:10  周雅雯-途虎养车-支付PM-上海  
   
出款渠道，公司出款分为两类，订单退款采用第三方支付接口完成，遵循原路返回的原则，大于原支付金额的部分，经由专用的第三方支付、银行转账账户完成。支付指令，账务记账等逻辑相同，需要在支付平台内做统一管控。通过企业网银完成的手工打款暂未纳入体系。  
   
> 19:24:58  周雅雯-途虎养车-支付PM-上海  
   
3）运营支撑平台  
   
> 19:25:16  周雅雯-途虎养车-支付PM-上海  
   
资金对账，从支付引擎同步渠道入账流水，从渠道获取三方清算流水，完成支付订单与外部金融机构（含第三方支付）的外部对账。同时，将对账结果推送至财务系统的结算中心，由外部系统完成业务订单的内部对账。  
   
> 19:25:24  周雅雯-途虎养车-支付PM-上海  
   
![2018-01-14 19:25:24](http://static.cocolian.cn/img/201801/20180114_192524.png) 
   
> 19:26:26  周雅雯-途虎养车-支付PM-上海  
   
支付管理后台，给产品、研发、运营等公司内部人员的后台支撑功能，主要包含收银台配置、支付订单相关的配置以及查询功能。  
   
> 19:27:20  周雅雯-途虎养车-支付PM-上海  
   
![2018-01-14 19:27:20](http://static.cocolian.cn/img/201801/20180114_192720.png) 
   
> 19:28:44  周雅雯-途虎养车-支付PM-上海  
   
以上就是我的分享，主要是我所在的金融支付平台中，支付相关的部分。考虑到是周末，内容也实在过多，这次分享没有涉及金融平台的项目。单单就支付系统的整个改造过程，感觉已经有很多可以跟大家探讨的地方了。希望大家指正哈。  
   
> 19:29:18  周雅雯-途虎养车-支付PM-上海  
   
由于上述内容涉及一些公司方面的敏感信息，所以，相关文档我会稍作处理后提供给群管理员。群内分享的内容，仅供大家内部交流和参考。  
   
> 19:29:52  周雅雯-途虎养车-支付PM-上海  
   
不好意思，刚刚看了下手机的图片，才知道截图贴到word，再复制出来马赛克成这样。。。图片我会再之后补上高清大图的。  
   
> 19:32:56  balance  
   
??  
   
> 19:34:56  思奇-杉德-需求-上海  
   
干货满满，需要消化[强]  
   
> 19:35:23  Melody??  
   
群里上海小伙伴多吗  
   
> 19:36:19  洋芋  
   
最后一张支付订单详情能再解释下嘛~ 看还分第一阶段第二阶段  
   
> 19:38:02  周雅雯-途虎养车-支付PM-上海  
   
支付阶段的模型是这样的  
   
> 19:38:04  周雅雯-途虎养车-支付PM-上海  
   
![2018-01-14 19:38:04](http://static.cocolian.cn/img/201801/20180114_193804.png) 
   
> 19:40:02  周雅雯-途虎养车-支付PM-上海  
   
比如收款，是先调用三方机构，再调用账务系统入账。付款（如门店的提现）先调用账务系统入账，再调用三方机构付款。转帐则只有一个账务入账阶段。  
   
> 19:40:53  周雅雯-途虎养车-支付PM-上海  
   
我们还设计支持了组合支付的场景，比如用户使用预付卡支付，预付卡余额不足，需要使用第三方支付一并付款。也会按照阶段执行。  
   
> 19:41:45  balance  
   
问几个问题：1、三方支付异步通知给支付平台，支付平台通知内部调用方，掉单支付平台会主动查询三方支付然后再异步通知给内部吗？2、支付方式里面有快捷支付吗，还是只有账号支付 3、支付理由主要做什么，我看收银台支付渠道是用户自己选择的。4、支付平台承接和三方的通信，差错处理也是支付平台在做吗？5、退款有一部分是非原路退回，使用其它大额通道，支付是为什么不考虑大额通道，费用问题。谢谢  
   
> 19:41:54  balance  
   
问题比较多[微笑]  
   
> 19:52:49  周雅雯-途虎养车-支付PM-上海  
   
1. 掉单类型不一样，处理方式不一样。1）如果支付单状态是成功，而业务单没有更新成功，支付平台重试一定次数后会报警。2）如果支付单是待处理或者失败，之后拿到新的回调结果是成功，支付平台只会更新支付单，业务单不做处理，等T+1内部对账结果。3）重复支付，目前业务单只会记录一笔支付单记录，但这笔操作在支付平台内有两笔支付单。系统会每日归结重复支付的订单，财务确认后，原路返回。  
   
> 19:53:14  周雅雯-途虎养车-支付PM-上海  
   
2. 目前没有快捷支付。3. 支付理由是哪里看到的？  
   
> 19:55:10  周雅雯-途虎养车-支付PM-上海  
   
4. 差错处理在支付平台处理，但是具体实现我没有仔细了解过。  
   
> 19:56:27  周文豪-环球易购-PM深圳  
   
[呲牙]回来爬墙  
   
> 19:57:00  周雅雯-途虎养车-支付PM-上海  
   
5. 我们的退款，非原路的部分其实多数是理赔，金额不会太大，一般走支付宝转账到支付宝接口。如果涉及到大的金额，就是财务线下打款了，因为公司网银没有手续费，所以没有考虑通道问题。  
   
> 19:57:17  周雅雯-途虎养车-支付PM-上海  
   
@茆云飞-互金-产品-上海   
   
> 19:59:25  周雅雯-途虎养车-支付PM-上海  
   
3. 的问题，如果是支付路由的话，作用是支付通道的路由，比如门店当面付，我们除了直连微信、支付宝的通道外，条码付还连了上海银行、微众银行的通道。  
   
> 20:04:02  balance  
   
谢谢了，上面写的是渠道理由。  
   
> 20:15:14  周雅雯-途虎养车-支付PM-上海  
   
如果大家还有啥问题，欢迎后续交流哈，我去吃烤鸭了~   
   
> 20:37:40  胡俊-融通-研发-温州  
   
@周雅雯-途虎养车-支付PM-上海?请问一下 提到的内部账户余额，是支付系统里面关于某一类型账户的余额，还是商户或者客户的账户余额  
   
> 20:41:54  周雅雯-途虎养车-支付PM-上海  
   
是商户和用户的余额账户  
   
> 20:46:45  胡俊-融通-研发-温州  
   
谢谢  
   
> 20:52:13  周雅雯-途虎养车-支付PM-上海  
   
不客气哈  
   
> 20:52:53  Codefor-YMT-TechLead-BJ  
   
5. 我们的退款，非原路的部分其实多数是理赔，金额不会太大，一般走支付宝转账到支付宝接口。如果涉及到大的金额，就是财务线下打款了，因为公司网银没有手续费，所以没有考虑通道问题。———————这个地方，转账到支付宝账户，如何关联平台的用户和支付宝账号？A身份证号为ID1，绑了身份证号ID2的支付宝，怎么处理？我了解绑定支付宝时拿不到身份证信息的@周雅雯-途虎养车-支付PM-上海?  
   
> 20:54:11  周雅雯-途虎养车-支付PM-上海  
   
其实，我们是让用户提供需要转账的支付宝账号的。众安的门诊险理赔，也是这个方式。  
   
> 20:54:35  Codefor-YMT-TechLead-BJ  
   
另外，你们有商户余额或用户余额，还可以做内部转账，你们有支付牌照还是做了银行的账户存管，涉嫌违规么？  
   
> 20:54:55  Codefor-YMT-TechLead-BJ  
   
是在线提供还是线下提供啊？  
   
> 21:25:16  周雅雯-途虎养车-支付PM-上海  
   
对于C端的余额账户，现在只是系统设计支持，并没有实际业务使用。门店的B端余额账户，现在对接的是微众银行的微众钱包。B端的余额账户，系统帮助门店自助进件开通We钱包。主要用途是门店自有用户，非途虎平台下单的到店用户，通过微众收单产品归集的自有资金。  
   
> 21:36:08  Codefor-YMT-TechLead-BJ  
   
????  
   
