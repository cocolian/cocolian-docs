---
layout:     source 
title:      "2018-05-05-WeChat"
date:       2018-05-05 12:00:00
author:     屁亮
lines:      80 
tag:		  [chat]
---
> 12:23:33  程琳Wa-杉德支付-产品-上海  
   
今天请到一位朋友，@安全公司—-安全测试—屁亮 给大家做分享，主题是 “三方四方支付系统常见漏洞” 开始时间为【14:00】；欢迎欢迎[鼓掌][鼓掌][鼓掌]！（注： 1.嘉宾分享期间其他人不要发言打断嘉宾分享。2.分享完成后请大家积极补充和提问；3.烦请领取红包签到，谢谢！)  
   
> 12:23:40  程琳Wa-杉德支付-产品-上海  
   
微信红包  
   
> 12:23:42  胡凯-鑫圣-PM-深圳  
   
[鼓掌][鼓掌]  
   
> 12:23:48  程琳Wa-杉德支付-产品-上海  
   
欢迎欢迎[鼓掌][鼓掌][鼓掌]  
   
> 12:24:00  Jin He 何瑾  
   
这个好  
   
> 12:24:03  支付产品-ellery-上海  
   
签到  
   
> 12:24:39  聚合支付_程昱  
   
签到  
   
> 12:25:18  只是一个号  
   
签到  
   
> 12:25:34  杨磊  
   
签到  
   
> 12:25:55  徐希尊-大搜车  
   
签到  
   
> 12:25:58  MyCity  
   
签到  
   
> 12:26:41  唐思良  
   
签到  
   
> 12:28:37  黄灿-捷付睿通-开发-北京  
   
签到  
   
> 12:28:43  何阳-天阳科技-开发-长春  
   
签到  
   
> 12:29:01  Jeffrey  
   
签到  
   
> 12:29:14  沐  
   
签到  
   
> 12:29:41  Alan  
   
签到  
   
> 12:30:02  haier 金控 -支付 -张其州  
   
签订[玫瑰]  
   
> 12:30:27  李洪军-拉乌网络-研发经理-深圳  
   
这个还是不错de  
   
> 12:30:48  M.cc  
   
签到  
   
> 12:31:44  宁学潮-供销宝-产品  
   
签到  
   
> 12:34:19  风里雨里  
   
签到  
   
> 12:34:40  hibo??  
   
签到  
   
> 12:35:41  地平线-文思-产品  
   
签到  
   
> 12:37:36  唐帆  
   
签到  
   
> 12:38:10  mousycoder  
   
签到  
   
> 12:38:40  张于刚  
   
签到  
   
> 12:38:56  思奇-杉德-需求-上海  
   
签到  
   
> 12:39:57  Kun-汇元银通-产品-北京  
   
签到  
   
> 12:41:11  ???wendy?????  
   
签到  
   
> 12:42:31  冯玉康-青岛银行-需求管理-青岛  
   
签到  
   
> 12:47:06  王振兴-银盛-技术-青岛  
   
签到  
   
> 12:47:31  袁梓涵  
   
签到  
   
> 12:51:15  梁新华-北京-金融支付产品  
   
签到  
   
> 12:55:05  gone with the wind  
   
签到  
   
> 12:58:29  WeChat  
   
签到  
   
> 13:02:29  Yezhiwei-融汇金信-技术-北京  
   
签到  
   
> 13:06:09  肖若团-商盟商务-技术  
   
签到  
   
> 13:06:46  Divi  
   
签到  
   
> 13:12:23  司徒言午-深圳-支付PM  
   
签到  
   
> 13:22:03  瑞瑾、东软、程序猿、武汉  
   
签到  
   
> 14:00:25  屁亮  
   
大家好 我要分享的主题是 三方、四方支付系统常见的漏洞  
   
> 14:01:24  屁亮  
   
由于之前好多朋友分享主题之后。其他群友在回看的时候会反应看不到 这个问题我也遇到过 我怀疑是内容太过敏感 让微信屏蔽了  
   
> 14:01:42  屁亮  
   
所以这次我用图片截图的方法给大家分享  
   
> 14:02:19  屁亮  
   
![2018-05-05 14:02:19](http://static.cocolian.cn/img/201805/20180505_140219.png) 
   
> 14:02:37  屁亮  
   
![2018-05-05 14:02:37](http://static.cocolian.cn/img/201805/20180505_140237.png) 
   
> 14:03:01  屁亮  
   
![2018-05-05 14:03:01](http://static.cocolian.cn/img/201805/20180505_140301.png) 
   
> 14:04:03  屁亮  
   
![2018-05-05 14:04:03](http://static.cocolian.cn/img/201805/20180505_140403.png) 
   
> 14:04:33  屁亮  
   
![2018-05-05 14:04:33](http://static.cocolian.cn/img/201805/20180505_140433.png) 
   
> 14:04:50  屁亮  
   
这里第五点可能有点抽象 ，给大家举个例子  
   
> 14:05:19  屁亮  
   
![2018-05-05 14:05:19](http://static.cocolian.cn/img/201805/20180505_140519.png) 
   
> 14:05:41  屁亮  
   
![2018-05-05 14:05:41](http://static.cocolian.cn/img/201805/20180505_140541.png) 
   
> 14:07:03  屁亮  
   
这套系统就是 有用户的登录密码可以查看安全码，有安全码就可以查看商户密钥 这样就直接导致了有用户登录密码直接可以查看到密钥  
   
> 14:07:28  屁亮  
   
![2018-05-05 14:07:28](http://static.cocolian.cn/img/201805/20180505_140728.png) 
   
> 14:08:43  屁亮  
   
本次先分享到这里，以后有时间再和大家交流下这些漏洞具体的呈现方式和修补方式以及支付系统如果被黑了，如何去通过痕迹进行取证追踪。  
   
> 14:08:49  屁亮  
   
谢谢大家  
   
> 14:10:33  周伟毅-快乐通宝-技术-长沙  
   
[强]  
   
> 14:10:42  聚合支付_程昱  
   
[强]  
   
> 14:11:16  唐帆  
   
[强]  
   
> 14:15:56  闫闯-乾元-支付-北京  
   
平衡跨权 这个很常见，属于业务逻辑范围，一疏忽就出现  
   
> 14:16:09  屁亮  
   
另外我在审计的时候发现好多支付程序的接口都是采用md5加密的方式进行验签操作的，大家觉得md5方式的验签安全么是否会存在泄露支付密钥key的风险  
   
> 14:18:37  孔晓光-丰瑞祥-技术  
   
Md5是比较老得做法了  
   
> 14:20:13  屁亮  
   
是，但是现在好多接口还都在采用这种方法  
   
> 14:20:42  闫闯-乾元-支付-北京  
   
肯定是不好的 现在彩虹表 那么多  
   
> 14:21:16  屁亮  
   
现在如果基于云计算前提下，有生成的sign基本就可以暴力出 支付key 只是时间长短的问题  
   
> 14:22:26  屁亮  
   
尤其是那些有api代付的支付公司，这个应该需要注意  
   
> 14:22:53  付云-农业-开发-成都  
   
安全没有绝对的，如果要求严格的话成本开销很高，只是增加一定时间内的破解复杂度吧  
   
> 14:23:24  闫闯-乾元-支付-北京  
   
效果还是可以起到，如果不是暴露在外部的，内部某个字段 做一个签名验签 还是可以的  
   
> 14:24:00  屁亮  
   
[呲牙]我说的只是从安全考虑 没有考虑到各位的维护成本，不好意思  
   
> 14:24:04  闫闯-乾元-支付-北京  
   
用来做数据摘要 用  
   
> 14:29:41  闫闯-乾元-支付-北京  
   
总比不做签名好 [呲牙] 有条件在上ras，一些安全测评公司只建议，要做什么防范措施，但 人家也算签名了 用的MD5 ，好像这样也算整改通过了  
   
> 14:36:21  付云-农业-开发-成都  
   
对接第三方一般是服务端对服务端，配合白名单和签名还好点。开发角度来说客户端都视为不安全，这一块手法很多  
   
> 14:48:48  mousycoder  
   
支付成功回调的时候，有没人被给过，你要被泄露等  
   
> 14:48:58  mousycoder  
   
密钥  
   
> 14:49:15  付云-农业-开发-成都  
   
比如通信安全（重放攻击，身份认证等等），业务安全（权限控制，数据有效性），数据安全（反编译，本地数据存储等），运行环境安全（root，代理等），登录操作安全（弱口令，暴力破解等），如果是PC上还有更多像组件安全远程代码执行，WEB的常规XSS,CSRF跨站攻击。。。。  
   
> 14:49:35  mousycoder  
   
相当于，支付结果，我方成功，查询第三方，第三方是不成功的  
   
> 14:50:44  mousycoder  
   
或者由于被信任的第三方被攻击，不断向我方发起支付成功的回调通知  
   
> 14:51:30  付云-农业-开发-成都  
   
一般就是类微信的白名单+签名，不过第三方可能存在此问题，上次看银联就有这个问题样  
   
> 14:59:48  屁亮  
   
[呲牙]都有经验  
   
> 15:00:40  付云-农业-开发-成都  
   
![2018-05-05 15:00:40](http://static.cocolian.cn/img/201805/20180505_150040.png) 
   
> 15:00:49  付云-农业-开发-成都  
   
这个银联问题就有点类似你说的  
   
> 15:10:13  付云-农业-开发-成都  
   
你们有没有接兼职活儿做的呢？你们觉得是选择打包付款外包模式还是选择发工资形势好？  
   
> 15:37:43  mousycoder  
   
打包付款比较好  
   
> 17:10:33  gone with the wind  
   
@安全公司—-安全测试—屁亮?咨询下，第一个获取客户端IP的问题，建议使用什么方法获取？  
   
> 17:17:14  gone with the wind  
   
如果是https协议，x-forward-for也容许被修改么？  
   
> 17:25:27  屁亮  
   
对的.因为是本地就可以伪造，还没到数据传输那一步  
   
> 17:25:58  屁亮  
   
不同的编程语言有不同的获取方法  
   
> 17:56:01  gone with the wind  
   
@安全公司—-安全测试—屁亮?[抱拳] 以一个常见的场景为例：服务器后端是java和go，前后端之间有层node.js，反向代理使用ng，有推荐的方法么[呲牙]  
   
> 17:59:27  闫闯-乾元-支付-北京  
   
https 也不能算绝对安全 有https就万事大吉，现在监管已经要求必须https协议了  
   
> 18:05:01  闫闯-乾元-支付-北京  
   
@pnfee-平台-清洁算 付云 同学说那一堆 基本就差不多了，都是安全方案  
   
