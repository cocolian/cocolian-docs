---
layout:     source 
title:      "2018-03-18-WeChat"
date:       2018-03-18 12:00:00
author:     链尚网产品部负责人徐晓光
lines:      116 
tag:		  [chat]
---
> 07:33:30  李建刚  
   
汇缴户不是将资金同行上交给合作户么？应该不受大额工作时间的限制吧  
   
> 07:47:54  赵卿  
   
汇缴是汇集给主备付金户吧？  
   
> 07:58:30  李建刚  
   
　　第十四条 备付金汇缴账户是支付机构在备付金银行开立的可以以现金形式接收或以本银行资金内部划转方式接收客户备付金的专用存款账户。 　　备付金银行应当于每日营业终了前，将备付金汇缴账户内的资金全额划转至支付机构的备付金存管账户或在同一备付金合作银行开立的备付金收付账户。 　　支付机构可以通过备付金汇缴账户将客户备付金直接退回至原资金转出账户。  
   
> 19:05:44  程琳Wa-杉德支付-产品-上海  
   
今天请到一位朋友，@Eric徐-链尚-产品-上海 给大家做分享，主题是 “百度超级网关从0到1” 开始时间为【19:30】；欢迎欢迎[鼓掌][鼓掌][鼓掌]！（注： 1.嘉宾分享期间其他人不要发言打断嘉宾分享。2.分享完成后请大家积极补充和提问；3.烦请领取红包签到，谢谢！)  
   
> 19:05:59  程琳Wa-杉德支付-产品-上海  
   
微信红包  
   
> 19:06:13  范昌彬 平安金科 支付 上海  
   
签到  
   
> 19:06:14  程琳Wa-杉德支付-产品-上海  
   
欢迎欢迎[鼓掌][鼓掌][鼓掌]  
   
> 19:06:25  王振兴-银盛-技术-青岛  
   
签到  
   
> 19:06:29  夏凯-51信用卡-支付产品-杭州  
   
签到  
   
> 19:06:30  Ferry  
   
??  
   
> 19:06:31  杨浩-支付研发-北京  
   
签到  
   
> 19:06:40  聂某人  
   
签到  
   
> 19:06:49  达文西-欣业邦-产品-重庆  
   
签到  
   
> 19:06:56  董华唯-盛付通-研发-上海  
   
签到  
   
> 19:06:57  Starman  
   
??签到  
   
> 19:07:57  Jeffrey  
   
签到  
   
> 19:08:19  一缕烟缪  
   
签到  
   
> 19:08:24  胡俊-融通-研发-温州  
   
签到  
   
> 19:08:59  梁新华-北京-金融支付产品  
   
签到  
   
> 19:09:42  肖若团-商盟商务-技术  
   
签到  
   
> 19:10:07  刘俭民-中科江南-开发运维  
   
签到  
   
> 19:10:34  聚合支付_程昱  
   
签到  
   
> 19:10:37  刘刚  
   
签到  
   
> 19:10:44  东方-合农网络-产品经理-上海  
   
签到  
   
> 19:15:32  王文  
   
签到  
   
> 19:15:33  刘易坤  
   
签到  
   
> 19:16:01  张卫青  
   
签到  
   
> 19:16:02  黄灿-捷付睿通-开发-北京  
   
签到  
   
> 19:17:03  苏枭睿-银商厦门  
   
签到  
   
> 19:17:25  潘啟金-找钢网-产品TL-上海  
   
签到[玫瑰]  
   
> 19:17:28  李东衡-关天数据-产品-上海  
   
签到  
   
> 19:18:19  叫警长  
   
签到  
   
> 19:19:48  彭前进  
   
签到  
   
> 19:20:50  Kun-汇元银通-产品-北京  
   
签到  
   
> 19:23:53  贾春亮  
   
签到  
   
> 19:25:47  鄢志明-聚和付-副总-深圳  
   
签到  
   
> 19:26:00  何阳-天阳科技-开发-长春  
   
签到  
   
> 19:26:29  Mr. 万  
   
签到  
   
> 19:28:42  胡萍萍_魔谐_产品_上海  
   
签到  
   
> 19:30:52  王豆豆  
   
签到  
   
> 19:31:27  链尚网产品部负责人徐晓光  
   
各位同学好，我是Eric徐晓光，13年11月份从Oracle离职加入百度钱包团队（现隶属百度金融），后来与16年2月份离开百度，目前是链尚网产品团队的负责人。 群里有以前百度的同事，也有在有赞认识的伙伴~很开心可以在这里共同学习  
   
> 19:32:18  链尚网产品部负责人徐晓光  
   
这次主分享的是百度钱包超级网关从0到1的过程。 因为已经很久没做支付相关的内容，这次没神马干货，主要是讲故事哈哈。  
   
> 19:32:47  链尚网产品部负责人徐晓光  
   
##背景 先说下当时的团队成员，百度钱包上海的核心人员绝对是支付业内的黄金战队，大老板是里志仁（支付宝的高经），架构师是丁雪丰（业内知名技术著作译者，来自支付宝），网关团队的负责人是熊总（支付宝网关团队核心成员），以及其他两个团队的teamleader 也统统是支付宝过来的。  不夸张的说，因为这些大牛，百度的网关体系从一穷二白直接飞跃至业内超一流的水准。  
   
> 19:33:12  链尚网产品部负责人徐晓光  
   
举个栗子： 14年、15年双11活动的时候，我们发现根本没有加班的必要，因为整个百度体系以及外部商户（聚美等等）加起来的交易量根本无法对我们网关造成任何冲击，哪怕是一点点涟漪都没有。 btw.不过出现过银行自己hold不住的情况。没做支付之前，我以为银行的系统应该是中国最安全的系统，做了支付之后觉得银行系统真是够稀烂的。  我先是作为RD参与前期支付渠道的接入工作，后来作为渠道接入总负责人（其实就是个干杂活的项目经理哈哈），负责银行渠道、第三方支付渠道接入工作；协调公司内外部资源，推进北京上海超过10个团队跨地域紧密合作，1年左右的时间完成了国内TOP15银行的接入及老网关迁移工作。  
   
> 19:33:53  链尚网产品部负责人徐晓光  
   
##Rework 关于老网关 1. 【维护成本】 现在的网关工程结构相对比较乱，每新建一个渠道都会写一个工程， 这样管理起来相当的麻烦，维护成本相当的高，不易人工管理和定位问题。 2. 【运营部署】部署上基本上是一个渠道打一个包，发布到应用容器中，这个需要知道熟悉的人对这个部署结构了解才知道哪个渠道在哪里，人力上解决起来有相当大的困难。 3. 【统一化】工程不同导致渠道提供给上层的访问地址什么的都是不同的，这样上层php维护这套地址池的时候不够统一，并不能形成一套抽象平台化的服务，服务量级出来后 4. 【代码质量】基本是没有写单元测试的，代码质量上不能保证。 5. 【扩展性】 主要是从渠道扩展方面来讲，没有通用的模式，基本上是来一家开发一家，业务模式无法复用，导致大量的人力成本。  
   
> 19:36:16  链尚网产品部负责人徐晓光  
   
虽然已经是13年，但当时百度的支付网关还处于“有啊”时代~后来太子李明远回归执掌MSG，百度钱包又归在他名下~  
   
> 19:36:48  链尚网产品部负责人徐晓光  
   
关于新网关（也就是超级网关）  
   
> 19:37:01  链尚网产品部负责人徐晓光  
   
发下以前组里的PPT  
   
> 19:38:33  链尚网产品部负责人徐晓光  
   
![2018-03-18 19:38:33](http://static.cocolian.cn/img/201803/20180318_193833.png) 
   
> 19:38:51  链尚网产品部负责人徐晓光  
   
![2018-03-18 19:38:51](http://static.cocolian.cn/img/201803/20180318_193851.png) 
   
> 19:39:09  链尚网产品部负责人徐晓光  
   
![2018-03-18 19:39:09](http://static.cocolian.cn/img/201803/20180318_193909.png) 
   
> 19:39:45  链尚网产品部负责人徐晓光  
   
![2018-03-18 19:39:45](http://static.cocolian.cn/img/201803/20180318_193945.png) 
   
> 19:40:26  链尚网产品部负责人徐晓光  
   
##关于路由  
   
> 19:40:44  链尚网产品部负责人徐晓光  
   
![2018-03-18 19:40:44](http://static.cocolian.cn/img/201803/20180318_194044.png) 
   
> 19:40:59  链尚网产品部负责人徐晓光  
   
![2018-03-18 19:40:59](http://static.cocolian.cn/img/201803/20180318_194059.png) 
   
> 19:41:10  链尚网产品部负责人徐晓光  
   
![2018-03-18 19:41:10](http://static.cocolian.cn/img/201803/20180318_194110.png) 
   
> 19:41:42  链尚网产品部负责人徐晓光  
   
##关于通讯  
   
> 19:41:44  链尚网产品部负责人徐晓光  
   
![2018-03-18 19:41:44](http://static.cocolian.cn/img/201803/20180318_194144.png) 
   
> 19:42:02  链尚网产品部负责人徐晓光  
   
##关于报文  
   
> 19:42:12  链尚网产品部负责人徐晓光  
   
![2018-03-18 19:42:12](http://static.cocolian.cn/img/201803/20180318_194212.png) 
   
> 19:43:12  链尚网产品部负责人徐晓光  
   
##推进路线 重0搭建新的网关体系==&amp;gt;基于业务需要扩充支付渠道==&amp;gt;见缝插针的进行老网关渠道的迁移工作  ##血泪史 1.在接入支付渠道的过程中踩了无数的坑，后来也因此要求PM必须提供产品/清算的checklist。（顺便推荐下《清单革命》这本书，内核很不错，但老外书的毛病就是废话炒鸡多）  
   
> 19:44:06  链尚网产品部负责人徐晓光  
   
![2018-03-18 19:44:06](http://static.cocolian.cn/img/201803/20180318_194406.png) 
   
> 19:48:58  链尚网产品部负责人徐晓光  
   
2.因为对接银行，国企的效率实在低下，有的银行的测试账号竟然要配制一个月才能给出，最惨的一次是开测试环境被银行拖了2个月。 而我们的项目往往是倒排项目。因此，我们搭建了自己的AnyMock系统，用于模仿银行or支付公司的返回报文，提前通过anymock开发测试，紧急情况下用预发环境对接银行测试环境回归。 另外前置，通过checklist保障资源全部到位后（文档、专线、测试卡号、对接研发等等），再启动开发。  
   
> 19:51:31  链尚网产品部负责人徐晓光  
   
这次准备比较匆忙，~时隔多年，很多细节已经不是很清楚了，如有谬误，请多谅解。[坏笑]这次分享就这些湿货了~~  
   
> 19:55:05  x69342  
   
[强]  
   
> 19:55:40  胡俊-融通-研发-温州  
   
感谢  
   
> 19:56:18  何阳-天阳科技-开发-长春  
   
非常感谢  
   
> 19:57:24  聚合支付_程昱  
   
[抱拳]很棒  
   
> 19:57:41  杨浩-支付研发-北京  
   
感谢分享！  
   
> 19:59:10  何阳-天阳科技-开发-长春  
   
问个比较低级的问题，你们新增一个接口服务和渠道需要多久，新增接口需要进行重启吗  
   
> 20:00:59  胡俊-融通-研发-温州  
   
请问一下，统一门面之后，前台传进来的字段是按业务的必要要素，还是将所有渠道的所需要的字段做一个并集，比如鉴权有些是四要素，有些是六要素，有些是三要素  
   
> 20:03:09  链尚网产品部负责人徐晓光  
   
@何阳-天阳-开发-长春 百度的超级网关其实就是支付宝那套体系，如果报文加解密不复杂，一般一个渠道（鉴权、支付、退款、接绑卡的4、5个接口）快的话一周就能做完，主要是百度的测试还是蛮细致的，所以一个项目是两周左右，如果银行不掉链子的情况下哈，很少有单独接一个接口的  
   
> 20:03:56  何阳-天阳科技-开发-长春  
   
@胡俊-互金-研发-温州?我们这边做的是在需要验证的字段加验证注解  
   
> 20:04:55  链尚网产品部负责人徐晓光  
   
@何阳-天阳-开发-长春 不需要重启，用的是groovy动态加载spring容器，我们后期上一个项目，只要写一些SQL就可以支持一家渠道了，可以在线刷新缓存，不需要重启服务  
   
> 20:05:27  何阳-天阳科技-开发-长春  
   
@Eric徐-链尚-产品-上海?[强]  
   
> 20:06:44  链尚网产品部负责人徐晓光  
   
类似这样，把代码写在SQL里，上线只需要数据库跑下脚本，刷新下缓存就可以了~  
   
> 20:06:45  链尚网产品部负责人徐晓光  
   
![2018-03-18 20:06:45](http://static.cocolian.cn/img/201803/20180318_200645.png) 
   
> 20:07:36  何阳-天阳科技-开发-长春  
   
学习了  
   
> 20:07:59  胡俊-融通-研发-温州  
   
哦哦，是报文带过来加一个验证标识，还是类里面字段加注解呢  
   
> 20:08:22  何阳-天阳科技-开发-长春  
   
我们后来是计划用storm去做服务，新增接口和回退版本可以做到不重启  
   
> 20:08:50  何阳-天阳科技-开发-长春  
   
@胡俊-互金-研发-温州?我们在类里的相关字段加的注解  
   
> 20:09:15  胡俊-融通-研发-温州  
   
了解了 谢谢  
   
> 20:12:04  链尚网产品部负责人徐晓光  
   
@胡俊-互金-研发-温州 网关前置会有另一套系统，可以根据后端的支付渠道，动态显示前端需要用户填写的要素，要素的个数，具体要看银行端的要求哈。 网关这边是对收银台时统一的接口，有些字段非必填  
   
> 20:14:19  何阳-天阳科技-开发-长春  
   
@Eric徐-链尚-产品-上海?内部你们怎么做到的吞吐，我们每个渠道会分配一个mq  
   
> 20:14:32  胡俊-融通-研发-温州  
   
@Eric徐-链尚-产品-上海? 明白了 谢谢  
   
> 20:18:26  链尚网产品部负责人徐晓光  
   
[坏笑]@何阳-天阳-开发-长春 实在抱歉~我当时主要负责项目管理和资源统筹，这部分的代码没有细看~下次我找同事确认下哈  
   
> 20:18:48  何阳-天阳科技-开发-长春  
   
[握手]  
   
> 20:24:10  Jeffrey  
   
anymock是开源的吗  
   
> 20:24:44  何阳-天阳科技-开发-长春  
   
没搜到  
   
> 20:24:54  何阳-天阳科技-开发-长春  
   
是不是就是模拟器这东西  
   
> 20:25:19  rocer  
   
签到  
   
> 20:28:09  链尚网产品部负责人徐晓光  
   
模拟银行服务，可以配置各类报文（XML/JSON等等）、同步/异步，功能比较强大。 应该是没有开源，后来被钱包的测试团队拿过去改进，作为内部的重点项目了哈哈~  
   
> 20:29:55  链尚网产品部负责人徐晓光  
   
anymock后来也被用在金融理财、生活应用（话费充值、水电煤等等）好多场景下，不仅仅是给支付用了哈  
   
> 20:32:50  链尚网产品部负责人徐晓光  
   
所有第三方的服务都可以进行模拟，不过话说回来，当时听熊总说，支付宝的网关就是所有对接外部的业务都是要走网关的，网关对内提供统一的标准化接口服务，对外全部消化掉非一致性和复杂度  
   
> 20:33:35  何阳-天阳科技-开发-长春  
   
为什么你们封装和解析用的两套实现  
   
> 20:34:19  苏枭睿-银商厦门  
   
文中提及的流量令牌主要作用？  
   
> 20:34:43  何阳-天阳科技-开发-长春  
   
是不是流量控制功能  
   
> 20:36:22  苏枭睿-银商厦门  
   
估计是吧，网控器？  
   
> 20:37:37  何阳-天阳科技-开发-长春  
   
还是这个地方是用来控制交易限额的  
   
> 20:40:07  链尚网产品部负责人徐晓光  
   
确实是用作流量控制的哈~  
   
> 20:47:45  何阳-天阳科技-开发-长春  
   
开篇老师你说每个渠道是一个系统，后来改成什么模式了，怎么做到的水平扩展  
   
> 20:56:31  链尚网产品部负责人徐晓光  
   
之前就是每个渠道，要写一个独立的工程，比如citic就是给中信的，icbc就是给工行的。这样导致我们如果有N个渠道，就得在一台服务器上部署N个工程，难以维护。每个工程对外提供的地址也是不统一的。  如果是4台服务器，就是需要部署4*N  ，我们后来接了几十个渠道，可想复杂度。   
   
> 20:57:38  何阳-天阳科技-开发-长春  
   
现在改成什么模式了  
   
> 21:01:18  链尚网产品部负责人徐晓光  
   
supergw的做法就是每台服务器上只部署一个supergw工程，4台服务器也只有4个工程。  每个渠道只需要对supergw进行配置处理，比如新上一个中信银行，就在sql里配置下对应中信银行的相关代码，直接动态加载进去。  
   
> 21:01:40  何阳-天阳科技-开发-长春  
   
Ok，我明白了  
   
> 21:01:57  何阳-天阳科技-开发-长春  
   
[抱拳]  
   
> 21:02:54  何阳-天阳科技-开发-长春  
   
多谢老师今天的分享  
   
> 21:05:17  链尚网产品部负责人徐晓光  
   
[呲牙]客气了，我其实很久很久没写过代码了~现在每天研究产品和创业方法论，这块大家有兴趣的可以私下加我交流  
   
> 21:06:12  一木  
   
多谢分享、辛苦了～  
   
> 21:06:56  Jeffrey  
   
@何阳-天阳-开发-长春?这个需要对业务进行抽象，大量运用设计模式  
   
> 21:07:06  Jeffrey  
   
我们也在做类似的事情  
   
> 21:13:28  何阳-天阳科技-开发-长春  
   
@Jeffrey－Pingpong金融－架构师－?我也在做这方面  
   
> 21:14:09  MyCity  
   
感谢分享，都是干货！  
   
> 21:14:23  何阳-天阳科技-开发-长春  
   
现在正在往代码零开发上努力  
   
> 21:14:34  Jeffrey  
   
系统分分合合是常态  
   
> 21:17:51  链尚网产品部负责人徐晓光  
   
@Jeffrey－Pingpong金融－架构师－?[强]是，业务的需求不断变化，系统也在不断迭代  
   
> 21:18:20  链尚网产品部负责人徐晓光  
   
@范小亮-兴业数金-产品研发-上海 [握手]  
   
> 21:26:10  何阳-天阳科技-开发-长春  
   
@Eric徐-链尚-产品-上海?[握手]，今天学到不少  
   
> 21:59:50  薛成龙-联动优势-支付产品运营  
   
|@Eric徐-链尚-产品-上海?认识章政华吗？  
   
> 22:07:35  链尚网产品部负责人徐晓光  
   
认识，我们百度钱包之前的老大，现在出去创业做国际聚合支付了  
   
> 22:15:22  胖民工-成都-金信服-打杂  
   
哪个国家？  
   
> 22:16:30  流荒  
   
@所有人群里有没有招java实习生的  
   
> 22:32:14  Kun-汇元银通-产品-北京  
   
这个貌似偏渠道管理，支付网关不是应该前端支付入口那块嘛[微笑]  
   
> 22:34:18  Kun-汇元银通-产品-北京  
   
我们目前也还是独立工程一个对接的渠道（单位），主要是团队协作便于协作，维护。渠道工程上面是微服务，主要是服务器又集群更新比较麻烦些。大版本更新时间开销较大。  
   
> 22:44:34  链尚网产品部负责人徐晓光  
   
网关其实就是英文gateway，是指连接两个不同的路径的关卡，并不是特指某一个东西。 不同的场景下的gateway不同，如果站在公司内部业务角度，那支付前端可以认为是gateway,因为所有交易都走这里。  如果角度更宏大些，从公司外部看，公司的所有业务都会走一个统一【出口】与外部第三方对接，这个就是是百度 or 支付宝的超级网关。 @Kun-汇元银通-产品-北京    
   
> 22:44:35  链尚网产品部负责人徐晓光  
   
![2018-03-18 22:44:35](http://static.cocolian.cn/img/201803/20180318_224435.png) 
   
> 22:48:06  李建刚  
   
请问下链尚是做什么业务的？  
   
> 22:49:12  薛成龙-联动优势-支付产品运营  
   
区块链吧  
   
> 22:50:38  链尚网产品部负责人徐晓光  
   
[憨笑]不是，是一个B2B电商，做面料交易平台的  
   
