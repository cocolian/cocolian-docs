---
layout:     source 
title:      "2017-06-08-WeChat"
date:       2017-06-08 12:00:00
author:     "PaymentGroup"
tag:		  [chat]
header-img: "img/post-bg-wechat.jpg"
---
> 07:05:48  韩财光  
   
张兄弟是期货玩家  
   
> 07:36:36  张泽雄-民生金服 项目总监  
   
瞎玩  
   
> 08:06:14  徐春好  
   
【独家】移动互联网大数据助力金融风控（课程精华笔记 PPT）  
   
> 08:38:47  韩财光  
   
干货  
   
> 09:12:37  阿兵-美利金融-PL  
   
看完了，在地铁上  
   
> 09:13:59  张泽雄-民生金服 项目总监  
   
我已经在看第二遍了  
   
> 09:19:23  Yang  
   
??  
   
> 09:21:00  张泽雄-民生金服 项目总监  
   
我这人比较笨，别人看一遍能记住的东西，我至少得看三遍  [流汗]  
   
> 09:21:49  潘儒刚-连连支付PM  
   
太谦虚了啊  
   
> 09:24:24  李征烈-钱通支付PM  
   
[惊讶]  
   
> 09:28:18  我  
   
@所有人， 近期分享安排   
   
> 09:28:42  happycoral  
   
[OK]  
   
> 09:28:54  我  
   
![2017-06-08 09:28:54](http://static.cocolian.cn/img/20170608_092854.png) 
   
> 09:28:55  刘毅  
   
[OK]  
   
> 09:29:34  我  
   
下周三目前还没有排期，期待大牛分享。   
   
> 09:38:58  李楚华-嘉联支付-资金平台  
   
不是大牛，也可以分享吗？[可怜]  
   
> 09:40:25  李楚华-嘉联支付-资金平台  
   
我可以讲讲POS收单的清结算，看看大家有没有感兴趣的  
   
> 09:40:41  韩财光  
   
菜鸟分享之后就变成大牛了[呲牙]  
   
> 09:40:59  李楚华-嘉联支付-资金平台  
   
POS收单的渠道对账或者差错处理，也可以试着分享一下，看大家有没有兴趣呃  
   
> 09:41:26  李楚华-嘉联支付-资金平台  
   
受群里面大牛的恩惠太多啦，还是要有点贡献 [糗大了]  
   
> 09:41:48  郑丽娟-通联-产品经理  
   
有有有  
   
> 09:41:49  韩财光  
   
@木林化-嘉联支付-资金平台PM?约个时间  
   
> 09:41:55  郑丽娟-通联-产品经理  
   
这个太赞  
   
> 09:42:15  韩倩～  
   
[强]有兴趣+1  
   
> 09:42:23  李楚华-嘉联支付-资金平台  
   
[呲牙]  
   
> 09:43:13  紫紫-随手记支付产品经理  
   
有兴趣+2  
   
> 09:43:21  紫紫-随手记支付产品经理  
   
[呲牙]  
   
> 09:46:41  韩财光  
   
已约@木林化-嘉联支付-资金平台PM? 下周三 pos机的清洁算  
   
> 09:47:12  李楚华-嘉联支付-资金平台  
   
[害羞]  
   
> 09:52:26  Tim-魔线科技-产品总监  
   
@木林化-嘉联支付-资金平台PM [强]  
   
> 09:52:40  Tim-魔线科技-产品总监  
   
亮瞎眼  
   
> 09:52:41  Tim-魔线科技-产品总监  
   
![2017-06-08 09:52:41](http://static.cocolian.cn/img/20170608_095241.png) 
   
> 09:58:54  蔡云龙 开联通支付  
   
你这是用美图相机拍出来的吧[呲牙]太亮了  
   
> 09:59:35  韩财光  
   
这是产品差异化成邪门化的范例 诱导犯罪  
   
> 10:34:40  孟??  
   
期待pos收单的对账及差错处理  
   
> 10:36:37  FLD-卡说技术总监  
   
期待，现在被对账搞得很艰难。  
   
> 10:38:23  孔晓光 丰瑞祥CTO  
   
POS对账全是眼泪  
   
> 10:40:56  WillYang-嘉联支付-架构师  
   
你们都遇到哪些困难？  
   
> 10:50:23  李楚华-嘉联支付-资金平台  
   
对账有什么问题呢  
   
> 10:52:21  刘毅  
   
请问一下oracle到mysql数据准实时同步有什么好的工具推荐吗？  
   
> 11:05:10  崔莹峰-恒昌利通-架构  
   
试下https://www.oschina.net/p/yugong  
   
> 11:05:27  崔莹峰-恒昌利通-架构  
   
我们用得这个，准实时  
   
> 11:06:59  jacky-讯联数据-研发总监  
   
goldengate 也可以做...  
   
> 11:09:37  郑丽娟-通联-产品经理  
   
请教一个各位大神，银行会根据交易类型做限额吗？例如会针对线下收单、快捷、代收付有不同的限额列表？  
   
> 11:22:44  FLD-卡说技术总监  
   
@木林化-嘉联支付-资金平台PM? 最主要的是每个平台账单格式不统一，逻辑也不统一，尝试做通用的对账系统，效果不太好。  
   
> 11:25:30  紫紫-随手记支付产品经理  
   
期待，现在被对账搞得很艰难。  
   
> 11:26:57  刘毅  
   
好的，谢谢@崔莹峰-恒昌利通-架构-北京   
   
> 11:33:22  李楚华-嘉联支付-资金平台  
   
我们现在对账没那么复杂呢，如果是对账单格式不统一，是需要有一个统一的处理模块，把不同格式的对账单，处理成统一的格式，统一对账的。  
   
> 11:33:30  李楚华-嘉联支付-资金平台  
   
逻辑不统一，大概有哪些问题呢？  
   
> 11:34:08  李楚华-嘉联支付-资金平台  
   
有一个对账单的接收处理模块，把对账单做标准化处理的，之前老熊的文章中也有提到  
   
> 11:35:19  蔡云龙 开联通支付  
   
对账不就是分有查询接口和账单文件2种形式，设计一个独立的模块定时查询，或者像楼上说的格式化文件数据入库，  
   
> 11:37:37  李楚华-嘉联支付-资金平台  
   
我们现在对账，基本都是有给对账单的，还没遇到要发查询的 [憨笑]，但理论上，如果有的话，也应该是要自己组一个对账单，再入库。  
   
> 11:41:17  张泽雄-民生金服 项目总监  
   
广义上的对账，功能是比较多的，不仅有交易对账，还有资金对账，交易对账又分商户对账、机构对账，资金对账要对本金、手续费、结算款、备付金等。 从系统角度来说，还有内部对账，比如会计系统的账证、账账、账实等核对也是对账。  
   
> 11:42:55  张泽雄-民生金服 项目总监  
   
大家讨论的基本上属于外部对账\机构对账\交易对账  
   
> 11:43:59  张泽雄-民生金服 项目总监  
   
此外，对账的差错处理、挂账、销账也是对账的内容  
   
> 11:45:20  活动小丑-PPTV-产品  
   
内部账，系统之间的对账   
   
> 11:46:43  张泽雄-民生金服 项目总监  
   
是的，内部的还好说点，外部的对账，涉及到结算资金的，还需要先自行清算  
   
> 11:46:45  活动小丑-PPTV-产品  
   
啥时候大佬们来讲讲对账当中的差错处理阿  
   
> 11:47:04  活动小丑-PPTV-产品  
   
这块系统的系统设计  
   
> 11:47:27  张泽雄-民生金服 项目总监  
   
这块内容太大了，范围再小点  
   
> 11:47:42  张泽雄-民生金服 项目总监  
   
你说的是哪块的对账，再说差错  
   
> 11:48:46  活动小丑-PPTV-产品  
   
外部渠道，多账少账处理，业务上没什么问题，关于处理这块时 挂消账的逻辑该如何设计  
   
> 11:53:58  张泽雄-民生金服 项目总监  
   
首先要明白，为什么要挂账，不挂账，会计系统账平不了，所以挂账只是让会计系统临时账面平衡。   不平是怎么产生的？ 主要是因为外部渠道是自主清算，而第三方支付机构属于非自主清算，两边的清算由于多种原因，会产生结果不一致，为了保证与渠道一致，把不一致的地方形成差错，差错体现在会计系统上，就是挂账  
   
> 11:54:18  蔡云龙 开联通支付  
   
@张泽雄-民生金服-研发-北京 [强]   
   
> 11:55:08  活动小丑-PPTV-产品  
   
业务上 会计上的逻辑我明白  
   
> 11:57:42  张泽雄-民生金服 项目总监  
   
差错找到原因了，消除了，就要将挂账解掉，也叫销账。至于挂哪个科目，这个要看会计制度，有的是应收、应付  
   
> 11:58:05  活动小丑-PPTV-产品  
   
是的  
   
> 11:58:31  张泽雄-民生金服 项目总监  
   
所以，前期在会计系统设计的时候，科目、账户的设置要考虑这些因素  
   
> 11:59:06  活动小丑-PPTV-产品  
   
其实本质还是科目 账户的问题，然后以会计业务逻辑来进行挂账 消账  
   
> 11:59:15  张泽雄-民生金服 项目总监  
   
![2017-06-08 11:59:15](http://static.cocolian.cn/img/20170608_115915.png) 
   
> 12:00:11  张泽雄-民生金服 项目总监  
   
是的，会计系统就是专门干这个事的。  
   
> 12:00:30  活动小丑-PPTV-产品  
   
和我们以前科目稍微不一样，不过业务意义应该是相同的  
   
> 12:01:26  活动小丑-PPTV-产品  
   
吃饭了。。  
   
> 12:01:31  张泽雄-民生金服 项目总监  
   
科目肯定是各自定义了，大家总账都是一样的  
   
> 12:01:36  张泽雄-民生金服 项目总监  
   
是的  
   
> 12:03:38  lisp 财付通结算财务  
   
总账是什么啊？  
   
> 12:04:12  刘毅  
   
@北京一张泽雄 有没有会计系统和账务系统设计文档，参考一下  
   
> 12:04:32  活动小丑-PPTV-产品  
   
。。。这个有点核心了  
   
> 12:04:44  活动小丑-PPTV-产品  
   
涉及机密，一般不会共享的  
   
> 12:06:04  韩财光  
   
内容肯定涉密 目录可以吗？  
   
> 12:08:48  活动小丑-PPTV-产品  
   
理解会计业务后，自然就会有感觉了  
   
> 12:11:10  我  
   
@lisp  从财务同学的角度，没有总账的概念吗？  
   
> 12:12:51  lisp 财付通结算财务  
   
会有，只是我想了解一下总账是一样的是一个什么概念？  
   
> 12:16:15  Tank  
   
@刘毅_证大财富_上海 这种建议直接去网上买  
   
> 12:16:32  Tank  
   
然后找你们财务分析  
   
> 12:17:33  Tank  
   
一般不会有人免费分享，而且真实应用的都是不能拿出来了  
   
> 12:17:38  张泽雄-民生金服 项目总监  
   
这个也没什么秘密了，账务和会计比较简单，大家被术语吓怕了。 账务，也叫会计前罝，主要是处理凭证和一些业务账，主要是分户账。 会计主要是处理分录，主要科目账还有报表  
   
> 12:21:17  张泽雄-民生金服 项目总监  
   
这块內容比较多，找个周末给大家分享一下吧，只聊体系，不做针对性应用  
   
> 12:21:40  扫地僧  
   
[鼓掌]  
   
> 12:23:45  我  
   
大家好，还有部分同学没有修改群昵称。 本群所有人员必须将昵称修改为 姓名-公司-岗位。对不合规人员，经2次提醒后，仍未修改者， 群主有权将该账号移出本群。  
   
> 12:23:50  我  
   
感谢大家支持。   
   
> 12:23:53  张泽雄-民生金服 项目总监  
   
要了解总账，先明白什么是科目，总账就是一级科目  
   
> 12:25:45  张泽雄-民生金服 项目总监  
   
要了解科目，得看什么是会计要素。科目是会计要素的分类。  
   
> 12:26:02  韩财光  
   
@张泽雄-民生金服-研发-北京?[强][强][强]期待  
   
> 12:53:43  刘毅  
   
[强][强]  
   
> 13:04:20  人保金服乔阳  
   
微信红包  
   
> 13:04:40  王彪-平安证券  
   
[坏笑]  
   
> 13:04:55  蒋蕾-唯品会 支付业务 架构师   
   
谢谢老板  
   
> 13:04:59  阿兵-美利金融-PL  
   
[微笑]  
   
> 13:05:06  冯硕-理房通  
   
[强]  
   
> 13:06:16  人保金服乔阳  
   
请各位多多指点  
   
> 13:12:38  MEET  
   
微信红包  
   
> 13:13:35  潘儒刚-连连支付PM  
   
谢谢大神  
   
> 13:14:00  黄文浩-天音通信-产品-北京  
   
[强]  
   
> 13:16:34  张泽雄-民生金服 项目总监  
   
这个是我整理的，大家可以参考一下。   
   
> 13:16:35  张泽雄-民生金服 项目总监  
   
![2017-06-08 13:16:35](http://static.cocolian.cn/img/20170608_131635.png) 
   
> 13:16:36  雷大进-快捷通技术主管  
   
[强]  
   
> 13:18:49  韩倩～  
   
[可怜]厉害了~   
   
> 13:23:08  张泽雄-民生金服 项目总监  
   
上次我给大家讲过了三户关系，里面没有怎么讲账户，因为账户属于会计范畴的，在会计系统中讲。   
   
> 13:23:09  张泽雄-民生金服 项目总监  
   
![2017-06-08 13:23:09](http://static.cocolian.cn/img/20170608_132309.png) 
   
> 13:24:13  张泽雄-民生金服 项目总监  
   
![2017-06-08 13:24:13](http://static.cocolian.cn/img/20170608_132413.png) 
   
> 13:24:40  胡圣 支付产品经理 猪八戒网  
   
[强]  
   
> 13:24:51  活动小丑-PPTV-产品  
   
http://blog.csdn.net/tenfyguo/article/details/41660281  
   
> 13:25:00  uniker  
   
@张泽雄-民生金服-研发-北京?[强]  
   
> 13:25:05  活动小丑-PPTV-产品  
   
这也有一篇讲解账户账务的  
   
> 13:26:55  胡圣 支付产品经理 猪八戒网  
   
@小丑-PPTV-PM-上海 [强]  
   
> 13:28:00  张泽雄-民生金服 项目总监  
   
这篇文章我看过了，和我这几图差不多  
   
> 13:28:03  张泽雄-民生金服 项目总监  
   
![2017-06-08 13:28:03](http://static.cocolian.cn/img/20170608_132803.png) 
   
> 13:29:52  dio  
   
张兄弟  你这些东西是哪里学的   还是说之前联通支付的这套架构是你搭建的  
   
> 13:31:15  韩财光  
   
会计内容就是科目 一种账户下记录的科目是不是都固定的？ 按账户性质划分？  
   
> 13:31:41  张泽雄-民生金服 项目总监  
   
联通的时候我没有负责账务和会计这块，但这一块我在联通的时候就了解了  
   
> 13:32:05  刘毅  
   
@北京一张泽雄 大神，找个时间给大家分享一下，对我们很有帮助  
   
> 13:32:27  张泽雄-民生金服 项目总监  
   
好的，找个周末吧，估计得两小时  
   
> 13:32:46  韩财光  
   
这张图需要三维结构图才能表示清楚  
   
> 13:32:47  Jacky-Bluepay支付部门技术PL  
   
[强]  
   
> 13:33:07  刘毅  
   
时间长的没有关系，辛苦@北京一张泽雄 ，非常感谢！  
   
> 13:33:13  张泽雄-民生金服 项目总监  
   
@韩财光-东软(前)-开发-广州  更准确的说，账户是由科目定的  
   
> 13:33:27  dio  
   
我之前在支付公司 也很想知道这块  但是这块是支付公司的基础功能  在一开始的时候就搭建好了    我问过很多人都说不清楚到底是怎么设计的   所以特别想知道这玩意到底怎么学  
   
> 13:34:47  张泽雄-民生金服 项目总监  
   
会计需要先把术语弄明白了，找本基础会计书看看就行了  
   
> 13:34:51  张泽雄-民生金服 项目总监  
   
很简单的  
   
> 13:35:30  韩财光  
   
哦 就是按科目性质划分 再归类为账户 统计分析这些以帐号为基本单位？ 这样好操作些  
   
> 13:36:20  韩财光  
   
嗯 是得从基础的东西开始了解  
   
> 13:36:24  张泽雄-民生金服 项目总监  
   
@韩财光-东软(前)-开发-广州   账户由科目定的，所以一个账户只能归一个科目下，当然，一个账户有不同维度，还可以从产品上去分，设定产品账。  
   
> 13:37:07  张泽雄-民生金服 项目总监  
   
是的，会计学其实也是统计学  
   
> 13:38:16  韩财光  
   
这样的话 操作以科目为单位了 账户跟业务联系  
   
> 13:38:26  张泽雄-民生金服 项目总监  
   
要做好统计，得分维，科目就是维度，为了好分析，又要降维，所以才出了总账  
   
> 13:38:58  紫紫-随手记支付产品经理  
   
记账是以叶子科目计算的，可以设置多级科目。  
   
> 13:39:03  韩财光  
   
好像明白了些  多谢[握手]  
   
> 13:39:08  张泽雄-民生金服 项目总监  
   
一个账户有很多维度，科目只是会计维度  
   
> 13:41:13  张泽雄-民生金服 项目总监  
   
你们几个说的都对，是这意思  
   
> 13:42:30  张泽雄-民生金服 项目总监  
   
![2017-06-08 13:42:30](http://static.cocolian.cn/img/20170608_134230.png) 
   
> 13:42:37  韩财光  
   
一个账户肯定要属于某个科目 而且只能一个科目是吗 但是账户还有其他属性（非会计的）？  
   
> 13:42:53  张泽雄-民生金服 项目总监  
   
对  
   
> 13:43:28  韩财光  
   
多谢！  
   
> 13:44:31  张泽雄-民生金服 项目总监  
   
根据科目账户原理，账户必须隶属于某个科目 账户只能隶属于叶子科目，而不能隶属于非叶子科目。  
   
> 13:47:15  汪皎洁-广发银行技术PL  
   
一个账户做结算交易，例如存入支取结息。存款可能入到存款本金科目，透支可能入到透支本金科目，结息可能入到利息科目。  
   
> 13:47:37  韩财光  
   
账户上记着具体数额了 必须细化到叶子科目 而非叶子科目实际上只是一个归类罢了 ？  
   
> 13:47:55  张泽雄-民生金服 项目总监  
   
对  
   
> 13:48:57  汪皎洁-广发银行技术PL  
   
一个账户可能对应一个产品，一个产品对应一个科目组。科目组里可能有一系列科目。  
   
> 13:49:05  张泽雄-民生金服 项目总监  
   
可以理解为一个组名，组名是不能记账的  
   
> 13:49:14  李伟锋  
   
![2017-06-08 13:49:14](http://static.cocolian.cn/img/20170608_134914.png) 
   
> 13:50:11  韩财光  
   
了解 帐户才是业务核心 属于哪个会计的分类 （科目/统计算账用）  
   
> 13:51:34  横烟秋-支付宝PM  
   
![2017-06-08 13:51:34](http://static.cocolian.cn/img/20170608_135134.png) 
   
> 13:51:35  横烟秋-支付宝PM  
   
![2017-06-08 13:51:35](http://static.cocolian.cn/img/20170608_135135.png) 
   
> 13:52:05  横烟秋-支付宝PM  
   
![2017-06-08 13:52:05](http://static.cocolian.cn/img/20170608_135205.png) 
   
> 13:52:20  张泽雄-民生金服 项目总监  
   
秋秋，你们支付宝的这块有没有最新的？  
   
> 13:52:47  横烟秋-支付宝PM  
   
没有呢   
   
> 13:53:03  横烟秋-支付宝PM  
   
我已经不在那边了  
   
> 13:53:04  张泽雄-民生金服 项目总监  
   
这大总管PPT都2010年的了  
   
> 13:53:27  横烟秋-支付宝PM  
   
是的  
   
> 13:54:01  张泽雄-民生金服 项目总监  
   
阿里的会计科目编码是独立设计的一套？没有走企业会计准则里的编码？  
   
> 13:54:23  横烟秋-支付宝PM  
   
有的啊  
   
> 13:55:00  横烟秋-支付宝PM  
   
和财务的会计科目是有映射的  
   
> 13:55:13  李伟锋  
   
大总管的系统还在，但是在科目体系有一定的变动  
   
> 13:55:33  横烟秋-支付宝PM  
   
回头我整理一下给大家分享  
   
> 13:55:42  横烟秋-支付宝PM  
   
大总管系统还在啊  
   
> 13:55:43  张泽雄-民生金服 项目总监  
   
明白了，谢谢秋秋  
   
> 13:55:44  余铭  
   
张兄，有没有相应的会计书推荐一本？  
   
> 13:56:14  横烟秋-支付宝PM  
   
我就是会计专业的  
   
> 13:56:37  李伟锋  
   
是啊，里面客资的操作功能都在，只不过会计系统是单独独立的出来  
   
> 13:57:00  横烟秋-支付宝PM  
   
我就是客资的  
   
> 13:57:11  横烟秋-支付宝PM  
   
你也支付宝的？  
   
> 13:57:30  李伟锋  
   
啊 哈哈 ，账务清算的  
   
> 13:57:34  余铭  
   
现在支付宝在上海也有产品了？  
   
> 13:57:37  李伟锋  
   
跟客资打交道多点  
   
> 13:58:35  张泽雄-民生金服 项目总监  
   
@YM-国泰君安-产品  基础会计可以看一下，还有一本估计现在都没有了，我都是从淘宝上影印的叫《会计核算模式与账务系统设计》  
   
> 13:59:18  韩财光  
   
上面一图 跟银行对账是从会计系统拿数据吗？  
   
> 13:59:51  李伟锋  
   
![2017-06-08 13:59:51](http://static.cocolian.cn/img/20170608_135951.png) 
   
> 14:00:07  横烟秋-支付宝PM  
   
![2017-06-08 14:00:07](http://static.cocolian.cn/img/20170608_140007.png) 
   
> 14:00:17  余铭  
   
[强] 谢谢  
   
> 14:00:24  李伟锋  
   
大家有没有说核算方面的书哦  
   
> 14:00:42  张泽雄-民生金服 项目总监  
   
这本书我也有  
   
> 14:00:43  张泽雄-民生金服 项目总监  
   
![2017-06-08 14:00:43](http://static.cocolian.cn/img/20170608_140043.png) 
   
> 14:01:07  李伟锋  
   
这本书我好找才找到 哈哈  
   
> 14:01:14  李伟锋  
   
![2017-06-08 14:01:14](http://static.cocolian.cn/img/20170608_140114.png) 
   
> 14:01:48  横烟秋-支付宝PM  
   
（一）缓冲记账配置和管理 缓冲记账是指针对频繁需要进行账务操作的部分帐户提供一种缓冲记账模式（含汇总记账），可以将该账户在一段时间内的账务操作请求放在一次性账务操作中进行处理，避免系统性能瓶颈。 用缓冲记账处理的帐户统一登记在如下表结构的数据表中：（会计分录的记帐其实也可以参考缓冲记帐）  
   
> 14:02:02  张泽雄-民生金服 项目总监  
   
你认识刘士峰？我那本书在联通离职的时候被人拿走了  
   
> 14:03:08  横烟秋-支付宝PM  
   
@张泽雄 认识卢学强 王巍成吗  
   
> 14:03:23  李伟锋  
   
网上认识的 问他过些问题  
   
> 14:03:29  张泽雄-民生金服 项目总监  
   
秋秋，不认识，他们也是联通的?  
   
> 14:04:00  横烟秋-支付宝PM  
   
以前通联的 来去了民生电商  
   
> 14:05:28  张泽雄-民生金服 项目总监  
   
可能不是一个公司的，联通部门挺多的，民生电商？那是民生旗下了，我们是中泛旗下  
   
> 14:07:22  张泽雄-民生金服 项目总监  
   
好羡慕你们学会计的，我这不学会计的，玩起会计来胆怯  
   
> 14:07:53  活动小丑-PPTV-产品  
   
我一个朋友通联网络支付部出来的  
   
> 14:08:11  横烟秋-支付宝PM  
   
![2017-06-08 14:08:11](http://static.cocolian.cn/img/20170608_140811.png) 
   
> 14:08:13  李伟锋  
   
我编码出身，也是自己学的  
   
> 14:08:29  横烟秋-支付宝PM  
   
账务核心系统在系统启动时自动加载该表的配置内容，并在每日首次被使用时刷新加载数据。也就是说，任何一项的修改，都将在次日生效。不选择实时生效的原因是缓冲记账必须在完整的账务日内实现，如果中途随时加载，会造成当日一部分数据是实时记账，一部分数据是缓冲记账，从而导致日终时无法统一处理。 对缓冲记账业务的配置与管理过程，实质就是对这样一个表进行数据增加、删除、修改、查询的操作，应允许设置各个参数项即可。  
   
> 14:09:18  横烟秋-支付宝PM  
   
字段说明： 1、? 某付宝账号：需要使用缓冲记账处理的20位某付宝账号；Account_ID 2、? 业务代码：需要使用缓冲记账处理的6位业务代码； 3、? 补账间隔：缓冲记账处理的时间间隔，以秒为单位，如60秒，则每60秒进行一次缓冲记账； 4、? 记账模式：具体缓冲记账的模式，缓冲记账则根据补账间隔执行记账操作，汇总记账则在日终时汇总执行记账操作； 5、? 其他：其他除了创建时间、最后修改时间为必选，其他字段均为业务预留字段，暂时没有直接的业务应用； 业务限制：不允许同一个账号、同一个业务代码配置两条记录，比如某账号的某业务即做收款缓冲，又做付款缓冲，这样的配置业务上是不存在的，系统也应是不允许的。  
   
> 14:09:57  沈一点-恒生电子-工程师  
   
刘仕峰 我买过他的书 加过群  
   
> 14:11:12  横烟秋-支付宝PM  
   
在新增和修改时应满足下面的规则： 1.????? 某付宝账号：需要使用缓冲记账处理的20位某付宝账号，必须在某付宝系统内存在； 2.????? 业务代码：需要使用缓冲记账处理的6位业务代码，必须是存在的业务代码，1，7，8开头的业务代码不可以配置为缓冲记账 3.????? 补账间隔：缓冲记账处理的时间间隔，以秒为单位，如60秒，则每60秒进行一次缓冲记账，本字段目前不允许修改，默认为300秒； 4.????? 记账模式：具体缓冲记账的模式，缓冲记账则根据补账间隔执行记账操作，汇总记账则在日终时汇总执行记账操作，汇总记账模式目前并不支持， 5.????? 补账最大记录数,页面限制2000，系统只做数据库字段长度限制 6.????? 其他：其他除了创建时间、最后修改时间为必选，其他字段均为业务预留字段，暂时没有直接的业务应用，创建时间和最后修改时间由数据库产生，不允许操作员修改； 7.????? 不允许同一个账号、同一个业务代码配置两条启用状态的记录，比如某账号的某业务即做收款缓冲，又做付款缓冲，这样的配置业务上是不存在的，系统也应是不允许的。 8.????? 增加废止日期字段，插入当前操作日期 9.????? 缓冲记账在记账和补账时都应使用满足这样规则的记录?  10.?? 无废止日期或废止日期等于今日的 11.?? 不允许重新启用废止日期等于今日的记录  
   
> 14:12:02  Roger丙-翼支付  
   
真是好多干货啊，我们架构师也是阿里过来的，账务系统基本就是完全照搬这个设计  
   
> 14:12:23  横烟秋-支付宝PM  
   
（二）会计结算业务参数的配置与管理 会计系统作为核心中重点负责清算、结算会计平衡的系统，在每增加一家银行时，都需要配置相关的会计结算关系。 会计系统的日间记帐处理包含两种模式：即时模式和缓冲模式，具体采用何种模式由账务系统触发时决定。即时模式需要会计系统严格按照账务系统发送的指令进行会计记帐处理，缓冲模式需要会计系统根据相关的参数配置进行会计记帐处理，一般日间都是单边的会计记账处理，如充值与提现业务，日间会计系统根据参数配置仅记录客户帐的变化部分，不记录内部账的变化部分，内部账的变化部分在日终时根据相关参数和日间的单边账务记录，进行分类汇总后再分别记帐处理。  
   
> 14:13:01  横烟秋-支付宝PM  
   
今天就算我来分享了吧  
   
> 14:13:25  紫紫-随手记支付产品经理  
   
秋秋，你这干货满满  
   
> 14:13:40  张泽雄-民生金服 项目总监  
   
继续，我们不打扰  
   
> 14:14:55  横烟秋-支付宝PM  
   
会计业务相关参数包括以下4部分内容  
   
> 14:15:56  活动小丑-PPTV-产品  
   
棒棒的  
   
> 14:16:02  活动小丑-PPTV-产品  
   
给你点赞  
   
> 14:16:12  横烟秋-支付宝PM  
   
第一、针对日间所有的充值类交易代码、提现类交易代码操作，其下每一个子交易码sub_trans_code对应的每一个涉及该业务的title_code科目代码都需要配置一条对应的参数记录，来确定日间该科目下的该交易代码进行怎样的单边会计记帐处理；参数重点说明该科目该交易记帐的方向、是否需要汇总记帐、是否需要发送对帐中心处理、是否需要cache  
   
> 14:16:54  韩财光  
   
如果有个对象关系图就好理解了 业务可以不了解 程序只要知道数据关系就可以工作了[微笑]  
   
> 14:17:13  横烟秋-支付宝PM  
   
每增加一种涉及充值或者提现业务的科目都需要增加对应一整套参数记录； 每增加一种涉及充值或者提现业务子交易代码都需要增加对应一整套参数记录；  
   
> 14:17:27  韩财光  
   
秋秋发力了[呲牙]  
   
> 14:17:28  横烟秋-支付宝PM  
   
对象关系图你们应该都看过的啊  
   
> 14:17:39  横烟秋-支付宝PM  
   
还用我告诉你们吗  
   
> 14:18:13  韩财光  
   
没有 我外星球来的  
   
> 14:18:30  横烟秋-支付宝PM  
   
某付宝对外的那个图 熊老大的文章中有所体现的啊  
   
> 14:18:56  活动小丑-PPTV-产品  
   
嗯，各家的图其实网上都能找到  
   
> 14:19:20  横烟秋-支付宝PM  
   
看图没用  
   
> 14:19:32  横烟秋-支付宝PM  
   
要看背后的设计逻辑  
   
> 14:19:39  韩财光  
   
我找找看  
   
> 14:20:32  横烟秋-支付宝PM  
   
第二、日终批量处理时，有一步是专门针对缓冲记账的处理，会计系统会根据参数表中充值、提现相关的每一个子交易码sub_trans_code对应的银行代码bank_type不同，分类统计日间的单边会计记账数据，按照汇总后的数据会计系统单边记账处理；完成缓冲记账的剩余部分；  
   
> 14:23:04  横烟秋-支付宝PM  
   
第三、日终批量处理时，有一步是专门针对银行存款结转的，即将经过对帐的资金从待清算账户结转到银行存款账户，以保持与银行真实资金变化的一致。会计系统会根据与银行的对账结果数据进行结转记账处理，参数表中记录了每家银行从待清算户到银行存款户进行结转的具体记账参数中充值  
   
> 14:24:41  横烟秋-支付宝PM  
   
这里面会存在两种结算方式（某付宝开立结算户头的银行可直接从待清算户结转到银行存款户；对于某付宝未开立结算户头的银行，是通过XX银行调拨结转的，需要从待清算户结转到调拨户，再从调拨户结转到银行存款户，需要两步处理），所以存在两套记账参数：  
   
> 14:25:02  左晨  
   
关于缓冲记账的功能，支付宝是可以动态加载的，例如针对突然出现的商户交易秒级笔数上升，可以在达到一定的阈值之后会出发监控，从报警日志中拿到实时的账号从而动态修改标准记账模型到缓冲记账模型。同一时间记账模型只能是一个。然后针对切换期间的兼容性问题，主要保证账务流水在资金的变化连续性。一方面是查询做排序，一方面是缓冲补账按照业务顺序来执行  
   
> 14:26:18  横烟秋-支付宝PM  
   
是的  
   
> 14:27:06  李伟锋  
   
晖晖，秋秋分享的这个应该是2代系统[愉快]  
   
> 14:27:12  横烟秋-支付宝PM  
   
上面讲了缓冲记账配置和管理和会计结算业务参数的配置与管理两个部分   
   
> 14:27:18  左晨  
   
不好意思打断你的分享哈，还请继续，对会计的很感兴趣  
   
> 14:27:41  横烟秋-支付宝PM  
   
接下来讲会计流转规则参数配置  
   
> 14:28:34  横烟秋-支付宝PM  
   
我也不知道现在支付宝发展到几代系统了 希望对你们有所帮助吧  
   
> 14:29:07  李伟锋  
   
恩恩 有帮助，不好意思打断您了， 嘿嘿  
   
> 14:29:20  横烟秋-支付宝PM  
   
会计流转规则主要讲的是从客户账最终变成银存各个环节分录的生成规则。  
   
> 14:29:31  横烟秋-支付宝PM  
   
包括以下几个几个环节  
   
> 14:30:35  横烟秋-支付宝PM  
   
1、客户侧分录汇总成一笔待清算分录 2、待清算结转到银存 3、待清算结转到调拨4、调拨结转到银存   
   
> 14:31:14  横烟秋-支付宝PM  
   
以上这生成规则把整个资金如何流转展示出来了。所以配置会计流转规则也是按照这个思路来操作。  
   
> 14:32:18  横烟秋-支付宝PM  
   
那么业务侧一般由于以下两种情况需要添加这个规则。一个是新增银行。需要把相关的交易代码都配一套资金流转规则。一个是新增交易代码。需要把相关的银行也都配一套资金流转规则。  
   
> 14:32:56  横烟秋-支付宝PM  
   
在以上整个资金流转过程中，每个环节需要配置如下的要素  
   
> 14:33:28  横烟秋-支付宝PM  
   
[微笑]汇总入账：需要配置一方的借贷方向，账户和科目。  
   
> 14:34:33  横烟秋-支付宝PM  
   
[微笑]待清算结转给银存：需要配置双方的借贷方向，账户和科目。待清算方的账户和科目在汇总入账中清楚，借贷方向跟汇总入账一方科目的方向相反。   
   
> 14:35:44  张长工-上海银行互金部-PM  
   
@老熊-爱奇艺-技术经理-北京?新推荐一位互金产品经理入群，请群主批准[微笑]  
   
> 14:35:56  横烟秋-支付宝PM  
   
[微笑]待清算结转到调拨和挑拨结转银存的配置和上面待清算结转给银存类似  
   
> 14:36:28  张泽雄-民生金服 项目总监  
   
秋秋妹子，能加点业务解释或这样做的原因么？很多人都没有用过支付宝的管理系统。  
   
> 14:36:55  lisp 财付通结算财务  
   
妹子？...  
   
> 14:37:18  横烟秋-支付宝PM  
   
原因下次我在说吧  
   
> 14:37:32  张泽雄-民生金服 项目总监  
   
好的  
   
> 14:37:45  张泽雄-民生金服 项目总监  
   
不是妹子么？难道是汉子？？？？  
   
> 14:37:58  lisp 财付通结算财务  
   
我看是蓝色头像啊...  
   
> 14:38:31  横烟秋-支付宝PM  
   
下面我就一些名词术语和大家也做一分享吧   
   
> 14:39:28  横烟秋-支付宝PM  
   
下次再分享吧  
   
> 14:39:30  横烟秋-支付宝PM  
   
现在没有时间了  
   
> 14:39:34  横烟秋-支付宝PM  
   
不好意思啊  
   
> 14:39:37  横烟秋-支付宝PM  
   
大伙  
   
> 14:39:52  lisp 财付通结算财务  
   
感谢  
   
> 14:40:16  张泽雄-民生金服 项目总监  
   
非常感谢妹子的分享  
   
> 14:40:23  我  
   
期待， @横烟秋 ，稍准备下，给大家做个分享吧。   
   
> 14:40:28  韩财光  
   
[呲牙]感谢友情嘉宾秋秋妹子的客串分享   
   
> 14:40:43  横烟秋-支付宝PM  
   
献丑了 后期我在和大家分享其他更多的干活  
   
> 14:40:56  横烟秋-支付宝PM  
   
干货  
   
> 14:41:21  冯威  
   
[强][强]  
   
> 14:41:32  横烟秋-支付宝PM  
   
下次和大家分享对账吧  
   
> 14:41:50  横烟秋-支付宝PM  
   
看到到家提到对账的需求也很多  
   
> 14:41:57  我  
   
[鼓掌]  
   
> 14:41:58  黄朋英-易联支付PM  
   
[鼓掌]  
   
> 14:42:01  横烟秋-支付宝PM  
   
看到大家提到对账的需求也很多  
   
> 14:42:04  龚正-滴滴-支付金融  
   
赞  
   
> 14:42:28  乔俊翔-爱又米-支付开发  
   
[鼓掌]  
   
> 14:43:06  沈一点-恒生电子-工程师  
   
赞。干货多多  
   
> 14:43:24  蔡云龙 开联通支付  
   
[强]感谢分享  
   
> 14:44:38  张泽雄-民生金服 项目总监  
   
说的确实是，要抄抄的是思想、理念  
   
> 14:44:39  张泽雄-民生金服 项目总监  
   
![2017-06-08 14:44:39](http://static.cocolian.cn/img/20170608_144439.png) 
   
> 14:45:40  李伟锋  
   
很多做法真的搬不走，还是要结合自己的系统  
   
> 14:47:33  扫地僧  
   
[鼓掌]  
   
> 14:48:12  横烟秋-支付宝PM  
   
要结合自己的企业需求  
   
> 14:48:37  刘毅  
   
![2017-06-08 14:48:37](http://static.cocolian.cn/img/20170608_144837.png) 
   
> 14:48:39  横烟秋-支付宝PM  
   
就像我现在给一家公司设计清结算系统和支付路由 搬用别人的那一套行不通  
   
> 14:48:47  横烟秋-支付宝PM  
   
只能说借鉴  
   
> 14:48:50  刘毅  
   
请问一下公司账户存款怎么是负债类  
   
> 14:49:08  dio  
   
难得有财务出身的产品经理呀，大赞  
   
> 14:49:10  横烟秋-支付宝PM  
   
客户备付金啊  
   
> 14:49:23  横烟秋-支付宝PM  
   
又不是支付宝的自有资金  
   
> 14:49:29  刘毅  
   
这不是公司自己的钱吗？  
   
> 14:49:36  横烟秋-支付宝PM  
   
当然负债啦  
   
> 14:49:50  横烟秋-支付宝PM  
   
这部分资金是要待清算给客户的  
   
> 14:50:07  沈一点-恒生电子-工程师  
   
这个钱只是暂存在支付公司 的，客户随时可以提  
   
> 14:50:12  韩财光  
   
细节好多 亲自弄过才能真正了解 跟写代码一样  
   
> 14:50:14  李伟锋  
   
第三方，是用户放在你这边的钱，你欠用户的  
   
> 14:50:18  沈一点-恒生电子-工程师  
   
从支付公司角度，就是负债  
   
> 14:50:54  刘毅  
   
个人账户资金可以理解，这是客户资产，对支付公司来说是负债  
   
> 14:51:14  刘毅  
   
但是公司账户存款，应该是公司自己的钱吧  
   
> 14:51:49  横烟秋-支付宝PM  
   
建议大家想了解支付怎么回事  先看看央行的关于第三方支付哪些文件  
   
> 14:52:22  横烟秋-支付宝PM  
   
了解了政策后 就知道为什么要设置这些备付金账户   
   
> 14:52:30  沈一点-恒生电子-工程师  
   
跟自有营运资金是分开的。自有营运资金是资产类科目吧  
   
> 14:52:42  横烟秋-支付宝PM  
   
然后通过哪些方式管理核算这些备付金账户  
   
> 14:52:47  lisp 财付通结算财务  
   
上面图的科目具体会有什么作用呢？ 每日输出核算报表？和进一步生成财务报表？  
   
> 14:52:49  横烟秋-支付宝PM  
   
是的  
   
> 14:53:03  横烟秋-支付宝PM  
   
科目是为了核算用的啊  
   
> 14:53:21  横烟秋-支付宝PM  
   
每一个科目对应一个账户啊  
   
> 14:53:56  lisp 财付通结算财务  
   
一对一的关系么？  
   
> 14:53:57  横烟秋-支付宝PM  
   
通过设置会计科目 一般设置三级  
   
> 14:54:12  横烟秋-支付宝PM  
   
一级就是总账  
   
> 14:54:41  横烟秋-支付宝PM  
   
通过会计科目可以试算平衡啊  
   
> 14:54:49  横烟秋-支付宝PM  
   
可以总分账啊  
   
> 14:54:53  横烟秋-支付宝PM  
   
可以分户账啊  
   
> 14:54:57  活动小丑-PPTV-产品  
   
试算平衡表  
   
> 14:55:10  李行-途牛支付中心研发总监  
   
好多内容啊，都来不及消化了[坏笑]  
   
> 14:55:32  横烟秋-支付宝PM  
   
单边账要是有流水没有入账的  
   
> 14:55:47  横烟秋-支付宝PM  
   
你们对账对死也查不出  
   
> 14:56:00  横烟秋-支付宝PM  
   
引入会计体系 就不一样了啊  
   
> 14:56:01  刘毅  
   
[憨笑]  
   
> 14:56:12  横烟秋-支付宝PM  
   
复式记账  
   
> 14:56:41  横烟秋-支付宝PM  
   
只要不平衡就能定位哪条入账流水 哪些清算流水有问题  
   
> 14:56:51  沈一点-恒生电子-工程师  
   
有借必有贷，借贷必相等  
   
> 14:56:53  横烟秋-支付宝PM  
   
不是单边账不好  
   
> 14:57:06  横烟秋-支付宝PM  
   
每家企业需求不一样  
   
> 14:57:24  lisp 财付通结算财务  
   
这个会和会计科目有关系么？应该是在账户层面就能查出来吧？如果是单边账的话  
   
> 14:57:30  横烟秋-支付宝PM  
   
适合自己企业管理需要的就是最好的清结算系统  
   
> 14:57:31  余铭  
   
应该说既是资产也是负债，在宝付的招股说明书里，流动资产有专门一栏是结算备付金。  
   
> 14:57:32  pangning-安邦集团收付团队研发  
   
差不多都是复式记账  
   
> 14:57:37  横烟秋-支付宝PM  
   
我是这样认为的  
   
> 14:58:17  横烟秋-支付宝PM  
   
只要公司觉得他们的账务能清楚明细 就可以  
   
> 15:00:59  刘毅  
   
这里公司账户存款设置成负债科目，公司账户存款是不是支付公司企业客户？  
   
> 15:01:00  刘毅  
   
![2017-06-08 15:01:00](http://static.cocolian.cn/img/20170608_150100.png) 
   
> 15:02:12  横烟秋-支付宝PM  
   
这些都是内部户  
   
> 15:02:38  横烟秋-支付宝PM  
   
客户分为T B TC  
   
> 15:02:46  横烟秋-支付宝PM  
   
shi de   
   
> 15:05:04  lisp 财付通结算财务  
   
支付公司所有的收款都会先挂到共同类么？  
   
> 15:06:08  横烟秋-支付宝PM  
   
是的  
   
> 15:06:15  郭芬-中央结算公司  
   
TB TC分别什么意思[尴尬]  
   
> 15:06:17  横烟秋-支付宝PM  
   
共同类就是一个过渡科目  
   
> 15:06:28  横烟秋-支付宝PM  
   
这个是比较简单的账务了   
   
> 15:06:47  韩财光  
   
to b to c 我猜的  
   
> 15:06:56  横烟秋-支付宝PM  
   
等你看到一堆的会计分录估计你要晕了  
   
> 15:07:02  横烟秋-支付宝PM  
   
是的  
   
> 15:07:06  郭芬-中央结算公司  
   
清结算之后到具体的科目么  
   
> 15:07:24  活动小丑-PPTV-产品  
   
金的流转都需要走到过渡户吧  
   
> 15:07:39  横烟秋-支付宝PM  
   
每一笔入行流水就是一条会计会计分录  
   
> 15:07:41  郭芬-中央结算公司  
   
求看会计分录。。  
   
> 15:07:42  横烟秋-支付宝PM  
   
是的  
   
> 15:07:47  活动小丑-PPTV-产品  
   
然后走到某个科目 某可账户下  
   
> 15:07:49  活动小丑-PPTV-产品  
   
个  
   
> 15:07:51  李伟锋  
   
一般的待清算会挂到共同类，但是有时候 ，待清算中的  应收 和应付 是可以更清晰的划分开的  
   
> 15:08:43  dio  
   
找个时间   让这个财务朋友  系统说一下吧     我看大家这样问好像没有尽头     
   
> 15:09:17  我  
   
预定了6月19日，期待。   
   
> 15:10:09  刘毅  
   
[OK]  
   
> 15:10:26  刘毅  
   
网上这方面的资料很少的  
   
> 15:10:32  dio  
   
希望能彻底说一下   这块很多不是财务出身的朋友其实很难理解   特别是一些专有名词含义  以及在支付系统内的作用  
   
> 15:10:44  活动小丑-PPTV-产品  
   
以前给别人对外培训也写过类似的东西，不过没太深入  
   
> 15:11:01  刘毅  
   
最好能以业务和开发的角度来讲  
   
> 15:11:14  刘毅  
   
这样子更容易理解和接受  
   
> 15:12:40  活动小丑-PPTV-产品  
   
带着业务来讲，肯定好理解一点  
   
> 15:12:45  lisp 财付通结算财务  
   
这个要求好高  
   
> 15:12:55  横烟秋-支付宝PM  
   
还有一点 我是男的  
   
> 15:13:31  我  
   
[偷笑]  
   
> 15:13:32  刘毅  
   
了解，其实男的我们更喜欢  
   
> 15:13:33  活动小丑-PPTV-产品  
   
啊哈哈哈哈哈哈  
   
> 15:13:49  刘毅  
   
么么哒  
   
> 15:14:19  刘毅  
   
![2017-06-08 15:14:19](http://static.cocolian.cn/img/20170608_151419.png) 
   
> 15:14:33  刘毅  
   
刚才群里推荐的三本书立马下单呀  
   
> 15:14:43  范文敏-农业银行高级产品经理  
   
[强]  
   
> 15:14:49  刘毅  
   
[坏笑]  
   
> 15:15:17  pangning-安邦集团收付团队研发  
   
这个东西实践一遍就好理解了  
   
> 15:15:25  lisp 财付通结算财务  
   
@秋秋-Alipay-产品-上海 备付金的存管报表也会按上面科目基础来生成么？  
   
> 15:15:58  紫紫-随手记支付产品经理  
   
[强]  
   
> 15:16:00  刘毅  
   
这个不是人人都有实践机会的，在公司都是赶鸭子上架  
   
> 15:16:02  横烟秋-支付宝PM  
   
备付金的存管报表你指的是企业内部还是对央行监管的报表  
   
> 15:16:41  lisp 财付通结算财务  
   
央行的  
   
> 15:17:11  横烟秋-支付宝PM  
   
不一样的  
   
> 15:17:24  横烟秋-支付宝PM  
   
央行的报表和第三方支付的口径不一样  
   
> 15:18:00  横烟秋-支付宝PM  
   
一般好多第三方支付公司会按照央行的报表开发一套对接企业的清结算系统  
   
> 15:18:39  lisp 财付通结算财务  
   
那会直接从账户层面取数，而不是会计科目层面取数？  
   
> 15:18:54  横烟秋-支付宝PM  
   
会做从现有的会计体系或者说账户体系中做一个映射到央行里面  
   
> 15:19:10  横烟秋-支付宝PM  
   
因为有些敏感数据是不需要上报的  
   
> 15:19:14  横烟秋-支付宝PM  
   
也不能上报的  
   
> 15:19:27  横烟秋-支付宝PM  
   
每一家做法不一样吧  
   
> 15:20:24  吕耀辉-维金-PM  
   
@老熊-爱奇艺-技术经理-北京 今天@秋秋-Alipay-产品-上海 的分享感觉挺不错的，后面会有人整理一下吗？  
   
> 15:20:29  lisp 财付通结算财务  
   
听说支付宝当时做了一套实时的系统，当时惊呆了...  
   
> 15:21:38  lisp 财付通结算财务  
   
我存了一下秋秋的分享  
   
> 15:21:39  lisp 财付通结算财务  
   
wxid_mkpq4gs16a9k51:  
   
> 15:22:16  韩财光  
   
有人整理的 而且也是友情客串  
   
> 15:23:47  韩财光  
   
.py python脚本文件？  
   
> 15:24:56  吕耀辉-维金-PM  
   
[强]  
   
> 15:24:57  范文敏-农业银行高级产品经理  
   
打不开啊？  
   
> 15:25:08  lisp 财付通结算财务  
   
忘改文件后缀了...  
   
> 15:25:09  WillYang-嘉联支付-架构师  
   
mystory110:  
   
> 15:25:14  lisp 财付通结算财务  
   
用记事本打开就好了  
   
> 15:26:45  范文敏-农业银行高级产品经理  
   
感谢[玫瑰]  
   
> 15:40:52  黄冈-北京敦煌网高级产品经理  
   
[玫瑰]  
   
> 15:41:26  韩财光  
   
@涛-分期乐-产品-深圳?你整理时用到什么工具吗 还是手工的？  
   
> 15:43:38  lisp 财付通结算财务  
   
手工额，不是用python跑的  
   
> 15:44:02  蔡云龙 开联通支付  
   
感谢分享，感谢整理  
   
> 15:44:22  黄朋英-易联支付PM  
   
还以为你用脚本可以爬到聊天记录  
   
> 15:44:35  黄朋英-易联支付PM  
   
管理员整理聊天记录就方便多了  
   
> 15:45:16  韩财光  
   
以为有什么独门绝技呢 我们也是手工 挺麻烦的  
   
> 15:45:33  黄朋英-易联支付PM  
   
雄哥说的是这本书？@张泽雄-民生金服-研发-北京   
   
> 15:45:34  黄朋英-易联支付PM  
   
![2017-06-08 15:45:34](http://static.cocolian.cn/img/20170608_154534.png) 
   
> 15:45:35  lisp 财付通结算财务  
   
http://www.jb51.net/article/106815.htm  
   
> 15:46:27  lisp 财付通结算财务  
   
@韩财光-东软(前)-开发-广州 不知道上面那个可以不，没试过  
   
> 15:46:44  张泽雄-民生金服 项目总监  
   
对，这本书非常好  
   
> 15:49:42  张泽雄-民生金服 项目总监  
   
央行的备付金报表要看央行意图，你的账户体系要能覆盖  
   
> 15:49:44  黄朋英-易联支付PM  
   
多谢  
   
> 15:49:47  Alive-借贷宝-PL  
   
什么书   
   
> 15:49:50  Alive-借贷宝-PL  
   
推荐下  
   
> 15:49:53  韩财光  
   
他那个itchat不知道搞什么 听说可以破解微信本地sqlite 理论上应该可以的 参考一下 多谢[握手]  
   
> 15:50:23  Alive-借贷宝-PL  
   
@张泽雄-民生金服-研发-北京  求书名  
   
> 15:52:02  张泽雄-民生金服 项目总监  
   
![2017-06-08 15:52:02](http://static.cocolian.cn/img/20170608_155202.png) 
   
> 15:52:13  张泽雄-民生金服 项目总监  
   
就这个  
   
> 15:52:39  张泽雄-民生金服 项目总监  
   
都绝版了，影印的  
   
> 15:53:13  张泽雄-民生金服 项目总监  
   
上淘宝上找家影印的  
   
> 16:05:41  Alive-借贷宝-PL  
   
是这三本书吗？[抱拳][抱拳]  
   
> 16:14:15  阚建国_工行支付架构师  
   
计算机上的银行，我们同事写的，推荐[强]  
   
> 16:16:59  黄朋英-易联支付PM  
   
如果看到不懂的话，送答疑服务？哈哈  
   
> 16:17:02  Alive-借贷宝-PL  
   
@Will-嘉联支付-研发-深圳?谢谢分享  
   
> 16:17:28  黄朋英-易联支付PM  
   
get  
   
> 16:17:29  黄朋英-易联支付PM  
   
![2017-06-08 16:17:29](http://static.cocolian.cn/img/20170608_161729.png) 
   
> 16:17:54  Alive-借贷宝-PL  
   
@秋秋-Alipay-产品-上海?谢谢分享  
   
> 16:23:08  余铭  
   
已下单，谢谢分享  
   
> 16:28:33  黄朋英-易联支付PM  
   
看来很快可以做书友会交流下拉  
   
> 16:28:46  阚建国_工行支付架构师  
   
@英—易联（前）—产品?没问题  
   
> 16:33:49  ??Ray??  
   
[强]  
   
> 16:34:07  李伟锋  
   
还有那本核算实务全书  说了一些银行核算的分录方案  
   
> 16:34:53  李伟锋  
   
当初找核算方面的书  好费劲  
   
> 17:17:23  徐春好  
   
哪位身边有国内带有支付牌照的企业考虑出售的?帮忙牵个线  
   
> 17:20:02  dio  
   
这玩意牵个线都是要找中介的   中介的费用都是几百万的  别想了哥们  
   
> 17:21:45  李楚华-嘉联支付-资金平台  
   
不同的支付牌照，售价估计也大不相同  
   
> 17:32:53  维森陌-拉莫帅-帅德-布耀布耀德  
   
国美收购互联网支付，7.2亿  
   
> 17:35:01  韩财光  
   
根据羊毛定律 按他的用户量分摊花费实际不多  
   
> 18:03:59  左晨  
   
现在一个个支付拍照都天价，问题是线上支付大都还是走支付宝或者微信，这收购下来，怎么回本呀  
   
> 18:05:59  余铭  
   
这种牌照只会越来越贵啊 买了放哪也不吃亏吧  
   
> 18:06:25  韩财光  
   
当固定资产投资？ 后面还有数据不外泄 商业机密级别  
   
> 18:06:45  钟文帅-移付宝科技-产品经理  
   
有牌照就有资质摸钱了，，我觉得怎么都能盈利啊  
   
> 18:07:44  左晨  
   
问题是摸谁的钱呀，用户的钱感觉很难摸呀，毕竟是用户自行选择  
   
> 18:08:04  左晨  
   
等于说没有市场份额就摸不到用户的钱呢  
   
> 18:08:08  钟文帅-移付宝科技-产品经理  
   
做B端  
   
> 18:08:35  左晨  
   
是有这样的思路，有还挺多  
   
> 18:09:01  钟文帅-移付宝科技-产品经理  
   
现在那么多的支付公司都在做呢  
   
> 18:09:21  余铭  
   
像国美这种大集团，自己用，也能节约不少成本啊  
   
> 18:09:29  钟文帅-移付宝科技-产品经理  
   
是的  
   
> 18:09:46  钟文帅-移付宝科技-产品经理  
   
自己集团的流水全部都走自己的支付公司，省到就是赚到  
   
> 18:09:54  左晨  
   
但一个是只有用户选择了这个支付方式，才能收取b端的说续费吧  
   
> 18:11:09  左晨  
   
再说内部的流水，还是这个问题，并且对外部的资金渠道除非是大企业，不然手续费方面是不是也差不多，成本一样？这个我不太了解  
   
> 18:13:08  左晨  
   
没有流量的情况下，还要组件支付账务的团队，我感觉应该有这么个目标，但就是想不到  
   
> 18:13:13  韩财光  
   
稀缺资源以后会升值  
   
> 18:13:29  lisp 财付通结算财务  
   
除非要监管要求，普通企业真觉得没必要买牌照，代价太大，收益未知  
   
> 18:16:26  何鹏飞-猪八戒网支付产品经理  
   
做估值 要么忽悠投资人 要么忽悠二级市场的故名呗  
   
> 18:16:50  何鹏飞-猪八戒网支付产品经理  
   
管他到底能起多大的价值 管他什么ROI  
   
> 18:17:06  一wan白水-pingpong跨境金融PM  
   
收单  
   
> 18:20:05  左晨  
   
想到可能有一个，商户保证金  
   
> 18:20:27  韩财光  
   
或许以后会出现新的支付方式 不必带着各式各样的app到处跑到处扫  
   
> 18:20:30  左晨  
   
还有要么就是放贷给商户  
   
> 18:21:25  一wan白水-pingpong跨境金融PM  
   
放贷有保理牌照就行  
   
> 18:21:54  lisp 财付通结算财务  
   
做支付根本不怎么赚钱，不是大企业根本搞不了什么数据积累，有几亿还不如搞AI[捂脸]  
   
> 18:25:05  韩财光  
   
支付的影响结果最终只是得到了个凭证 这个凭证的生产获取可以有更便捷的方式  
   
> 18:37:03  韩财光  
   
今晚上的分享嘉宾是手气最佳第一人 @李兴-有赞-研发?分享主题是有赞支付架构 先发个预告   
   
> 18:40:27  胡圣 支付产品经理 猪八戒网  
   
[强]  
   
> 18:40:43  扫地僧  
   
[鼓掌]  
   
> 18:41:13  潘儒刚-连连支付PM  
   
[强]  
   
> 18:41:41  Alive-借贷宝-PL  
   
[微笑]  
   
> 18:43:04  杨大兴央金所的资深产品经理  
   
[强]  
   
> 18:49:47  WillYang-嘉联支付-架构师  
   
[鼓掌]  
   
> 18:50:11  人生几何-农行软开 快捷支付开发  
   
[强]  
   
> 18:50:50  文奇  
   
[强]  
   
> 18:51:16  泽~  
   
[强]  
   
> 18:51:26  yinch-滴滴金融-研发  
   
[鼓掌]  
   
> 18:52:01  superjj-微众银行PM  
   
??  
   
> 18:52:29  yuesheng.yin  
   
[强]  
   
> 18:52:49  Tank  
   
[强]  
   
> 18:53:43  李征烈-钱通支付PM  
   
[强]  
   
> 18:53:44  李行-途牛支付中心研发总监  
   
[强]  
   
> 18:54:02  华-南京亚软-IT总监  
   
[强]  
   
> 18:54:06  吴浩  
   
[强]  
   
> 18:54:17  少帅-快捷通支付产品  
   
[强]  
   
> 18:54:19  build-去哪儿-QA  
   
[强]  
   
> 18:54:26  落雪飞花-农信互联-开发经理  
   
[强]  
   
> 18:54:33  吕耀辉-维金-PM  
   
[强]  
   
> 18:54:43  王qz-玖富支付  
   
[强]  
   
> 18:55:12  东  
   
[强]  
   
> 18:55:13  Ping++徐志涛  
   
[强]  
   
> 18:55:14  刘朝晨-中行软件中心PM  
   
[强]  
   
> 18:55:18  尹琎-深圳优融PM  
   
[强]  
   
> 18:55:29  龚正-滴滴-支付金融  
   
[强]  
   
> 18:56:07  WillYang-嘉联支付-架构师  
   
[强]  
   
> 18:56:18  Richard-裕维金服技术负责  
   
[强]  
   
> 18:56:24  昕小姐-1号店产品  
   
[强]  
   
> 18:56:25  华-南京亚软-IT总监  
   
@涛-分期乐-产品-深圳 做聚合收单，没多少收益；主要还是想找个入口，做切入吧；收单的收益基本被三方支付拿走了；  
   
> 18:56:33  Aaron-携程金融支付PL  
   
[强]  
   
> 18:57:05  泽然  
   
[强]  
   
> 18:57:08  陈琳 中移动PM  
   
[强]  
   
> 18:57:44  蔡云龙 开联通支付  
   
[强]  
   
> 18:57:46  左晨  
   
[强]  
   
> 18:58:00  黄冈-北京敦煌网高级产品经理  
   
[强]  
   
> 19:01:32  Chess-技术总监 首付游   
   
[强]  
   
> 19:01:41  武伟会-国家电网新能源-PM  
   
[强]  
   
> 19:04:52  程文东-拉卡拉PL  
   
[强]  
   
> 19:05:23  劉皇叔  
   
[强]  
   
> 19:05:25  吕剑辉-杉德-PL  
   
[强]  
   
> 19:06:47  徐萍 途牛产品总监  
   
[强]  
   
> 19:06:51  何鹏飞-猪八戒网支付产品经理  
   
[强]  
   
> 19:06:55  海哥人保金服合规  
   
[强]  
   
> 19:07:35  刘毅  
   
[强]  
   
> 19:12:54  韩财光  
   
现在的方式 银行账户手机号码这种本身自我保护能力很弱的东西（功能设计上不支持高级安全防护机制）在多种使用场合中需要加验身份 这是很多风险产生的根源  
   
> 19:17:01  韩财光  
   
各位同学 今天有幸请到@李兴-有赞-研发?给我们做分享 主题是有赞支付架构 大家欢迎 分享期间请不要发言打断 分享完成后请大家积极补充和提问  
   
> 19:17:35  韩财光  
   
微信红包  
   
> 19:23:48  张泽雄-民生金服 项目总监  
   
@木刀-中天智慧-北京?  收购这事你能谈么，我这有  
   
> 19:30:44  韩财光  
   
@李兴-有赞-研发?请嘉宾开始分享吧 红包还有 可以继续抢  
   
> 19:32:54  李兴-有赞技术专家  
   
好的，那我现在开始了  
   
> 19:33:12  李兴-有赞技术专家  
   
先做个自我介绍哈[呲牙]  
   
> 19:33:38  李兴-有赞技术专家  
   
李兴 东北人 11年工作加入支付宝，开始做前端，后来逐步对服务端感兴趣就转了行。后来加入有赞从事支付平台建设相关工作。  
   
> 19:34:46  李兴-有赞技术专家  
   
本次主要分享有赞支付的整体概况，部分东东不方便展开，请大家见谅  
   
> 19:35:17  李兴-有赞技术专家  
   
今天分享的主要内容有：  
   
> 19:35:49  李兴-有赞技术专家  
   
![2017-06-08 19:35:49](http://static.cocolian.cn/img/20170608_193549.png) 
   
> 19:36:26  李兴-有赞技术专家  
   
首先简单介绍一下有赞 [呲牙]  
   
> 19:36:47  李兴-有赞技术专家  
   
有赞是一个商家服务公司，我们通过产品和服务，帮助互联网时代的生意人管店、管货、管客、管钱，让生意更好做。我们致力于成为商家服务领域里最被信任的引领者，希望持续作为一个"开心"（enjoy）的组织。https://www.youzan.com/  
   
> 19:37:26  李兴-有赞技术专家  
   
有赞支付是有赞众多产品中的一种。  
   
> 19:37:36  李兴-有赞技术专家  
   
![2017-06-08 19:37:36](http://static.cocolian.cn/img/20170608_193736.png) 
   
> 19:38:14  李兴-有赞技术专家  
   
下面介绍一下有赞支付的发展历程  
   
> 19:38:15  李兴-有赞技术专家  
   
![2017-06-08 19:38:15](http://static.cocolian.cn/img/20170608_193815.png) 
   
> 19:38:33  李兴-有赞技术专家  
   
![2017-06-08 19:38:33](http://static.cocolian.cn/img/20170608_193833.png) 
   
> 19:39:47  李兴-有赞技术专家  
   
和绝大多数公司类似，都经历了 PHP->JAVA，从烟囱架构到SOA服务化架构  
   
> 19:40:57  李兴-有赞技术专家  
   
在服务化过程中需要分步骤一点一点进行，这里会被各种技术负责，遗留问题，业务压力的困扰  
   
> 19:41:35  李兴-有赞技术专家  
   
我们首先建立了收单支付，账务核心。之后逐步丰富  
   
> 19:41:50  李兴-有赞技术专家  
   
![2017-06-08 19:41:50](http://static.cocolian.cn/img/20170608_194150.png) 
   
> 19:42:09  李兴-有赞技术专家  
   
下面介绍一下有赞支付目前的架构  
   
> 19:42:25  李兴-有赞技术专家  
   
![2017-06-08 19:42:25](http://static.cocolian.cn/img/20170608_194225.png) 
   
> 19:43:16  李兴-有赞技术专家  
   
对于这里面的几个模块我这里介绍一下，可能和其他公司有些差异  
   
> 19:43:39  李兴-有赞技术专家  
   
业务平台 ：收单业务，卡券业务等  
   
> 19:44:39  李兴-有赞技术专家  
   
开放平台：负责对外输出支付能力开放。输出方式目前有：API，H5，SDK。里面包含开放网关和收银台功能。收银台中包含支付列表获取、支付决策等  
   
> 19:45:20  李兴-有赞技术专家  
   
资产交换：资产流水创建，资产指令编排，资产状态一致性保证，状态回调等  
   
> 19:45:57  李兴-有赞技术专家  
   
支付工具：包含营销类、资产类等，银行卡是一种特殊的支付工具，通过调用渠道进行处理  
   
> 19:46:24  李兴-有赞技术专家  
   
管理平台：商户管理、客户管理、商户交易记录、产品套餐、认证等。  
   
> 19:46:40  李兴-有赞技术专家  
   
对账：内部对账、渠道对账等  
   
> 19:47:10  李兴-有赞技术专家  
   
其他模块应该都比较类似，这里就不一一展开了  
   
> 19:47:49  李兴-有赞技术专家  
   
下面介绍一下有赞支付的整体技术架构  
   
> 19:47:56  李兴-有赞技术专家  
   
![2017-06-08 19:47:56](http://static.cocolian.cn/img/20170608_194756.png) 
   
> 19:49:40  李兴-有赞技术专家  
   
其中rds-proxy是基于cobar进行开发的数据库中间件。rpc框架使用业务较为通用的dubbo，注册中心服务发现最开始使用的是zk，现在逐步切换到etcd  
   
> 19:50:34  李兴-有赞技术专家  
   
Zanphp是有赞自己开发的开源的PHP框架  
   
> 19:52:59  李兴-有赞技术专家  
   
Nova协议有赞自己基于开源框架二次开发的框架，解决PHP->JAVA之间的rpc通信问题  
   
> 19:53:21  李兴-有赞技术专家  
   
![2017-06-08 19:53:21](http://static.cocolian.cn/img/20170608_195321.png) 
   
> 19:53:50  李兴-有赞技术专家  
   
第一个需要介绍的是统一业务上下文  
   
> 19:55:48  李兴-有赞技术专家  
   
先说下背景：SOA化系统职责划分明确，也会导致服务粒度较细，长久发展之后会各自发展出一套自己的业务协议，服务调用逐层转化，系统之后整体串接性较差，维护困难等  
   
> 19:55:56  李兴-有赞技术专家  
   
![2017-06-08 19:55:56](http://static.cocolian.cn/img/20170608_195556.png) 
   
> 19:56:56  李兴-有赞技术专家  
   
我们经过一些归纳梳理，设计了符合有赞业务发展的一个统一业务上下文语言——"四码一号"  
   
> 19:57:29  李兴-有赞技术专家  
   
四码一号是一串20位的数字  
   
> 19:57:58  李兴-有赞技术专家  
   
产品码：定义了一个具体的产品标志  
   
> 19:58:28  李兴-有赞技术专家  
   
比如有赞微商城多人拼团产品，可以定义一个产品码  
   
> 19:59:21  李兴-有赞技术专家  
   
业务模式码：该产品下的业务模式，比如担保交易，即时到账等。  
   
> 20:00:03  李兴-有赞技术专家  
   
业务动作码。体现了具体的资产调度模式。比如：支付、退款、充值、提现等  
   
> 20:00:56  李兴-有赞技术专家  
   
支付通道码：标识一个具体的渠道api，比如：微信公众号支付、储蓄卡支付等  
   
> 20:02:22  李兴-有赞技术专家  
   
渠道号：标识一种支付api的多种实现方式。比如线下pos刷卡，可能接入不能的公司。每个公司的标识是渠道号  
   
> 20:02:59  李兴-有赞技术专家  
   
当然随着日后的业务复杂我们也可以在此基础上进行扩展  
   
> 20:03:28  李兴-有赞技术专家  
   
但是这是平台一个共有的协议语言  
   
> 20:04:11  李兴-有赞技术专家  
   
每个平台根据自己的需求设置自己的规则与四码一号的关系即可  
   
> 20:04:22  李兴-有赞技术专家  
   
![2017-06-08 20:04:22](http://static.cocolian.cn/img/20170608_200422.png) 
   
> 20:05:54  李兴-有赞技术专家  
   
我们实现了两种分布式事务模式来保障状态的最终一致性，原理类似阿里的TCC方式，采用二阶段原理。一阶段投票，二阶段提交。  
   
> 20:06:35  李兴-有赞技术专家  
   
但是这里隐藏着一个潜在的问题——事务悬挂，下面简单介绍一下：  
   
> 20:06:46  李兴-有赞技术专家  
   
![2017-06-08 20:06:46](http://static.cocolian.cn/img/20170608_200646.png) 
   
> 20:08:26  李兴-有赞技术专家  
   
当第一个阶段发起之后，事务的管理者长时间没能接收到结果，变会认为交易失败，发起回滚。事务参与者接收到事务回滚请求，并且回滚成功  
   
> 20:09:59  李兴-有赞技术专家  
   
此时，事务的参与者接收到了第一个阶段的请求。好吧，我处理好了，等你提交。可惜没人会来提交了，因为对于事务的管理者而言该事务已经完成了。  
   
> 20:10:33  李兴-有赞技术专家  
   
如何解决？哈哈，这里先不介绍了[呲牙]，方法比较多  
   
> 20:11:49  李兴-有赞技术专家  
   
在调用三方进行支付的时候经常会遇到三方回调不及时，我们和三方状态同步不及时的问题，这个问题我们是这样处理的  
   
> 20:11:58  李兴-有赞技术专家  
   
![2017-06-08 20:11:58](http://static.cocolian.cn/img/20170608_201158.png) 
   
> 20:14:30  李兴-有赞技术专家  
   
资产调度中心，在支付的过程中会把没有拿到支付状态的单据流水落到一个补偿模块中。补偿模块会5s钟触发一次查询同步支付状态。当同步到一定次数发展用户仍然没有支付成功的情况，会对该笔流水进行降级处理，通过延时中心延时重试查询，直到交易关闭  
   
> 20:15:52  李兴-有赞技术专家  
   
如何利用优先的服务器资源达到快速的任务补偿（支付同步结果要求：4个9的支付流水需要在5s内同步支付状态）  
   
> 20:16:10  李兴-有赞技术专家  
   
采用了一个分布式调度方案  
   
> 20:16:13  李兴-有赞技术专家  
   
![2017-06-08 20:16:13](http://static.cocolian.cn/img/20170608_201613.png) 
   
> 20:18:41  李兴-有赞技术专家  
   
1.首先对任务进行一次分解。比如我要补偿10分钟之内没有支付成功的单据。可能这个期间的单据数量很多，一次捞取处理比较困难。我们可以把他分成十份，每份捞取1分钟的数据，进行任务分解。每份的捞取使用消息或者rpc调用的方式进行，达到缓冲和负载均衡的效果  
   
> 20:19:55  李兴-有赞技术专家  
   
2.对于上面每个小费解捞取的任务再进一步分解执行，同理使用消息或者rpc调用方式进行负载均衡，充分利用现有的服务器资源  
   
> 20:21:00  李兴-有赞技术专家  
   
恩，支付模块就介绍到这里了，还有一些我们还在设计开方阶段，例如水平拆分这里暂时就不介绍了  
   
> 20:21:16  李兴-有赞技术专家  
   
![2017-06-08 20:21:16](http://static.cocolian.cn/img/20170608_202116.png) 
   
> 20:21:51  李兴-有赞技术专家  
   
下面打个小广告，有赞一直在招人呀[呲牙]  
   
> 20:21:55  李兴-有赞技术专家  
   
![2017-06-08 20:21:55](http://static.cocolian.cn/img/20170608_202155.png) 
   
> 20:22:02  紫紫-随手记支付产品经理  
   
好棒??  
   
> 20:22:12  李兴-有赞技术专家  
   
今天的分享就到这里了，谢谢大家  
   
> 20:22:16  华-南京亚软-IT总监  
   
谢谢，李兴分享  
   
> 20:22:19  张嘉杰  
   
以结果为导向～ [强]  
   
> 20:22:28  Alive-借贷宝-PL  
   
以结果为导向～ [强]  
   
> 20:22:31  华-南京亚软-IT总监  
   
支付工具：包含营销类、资产类等，银行卡是一种特殊的支付工具，通过调用渠道进行处理  ？ 这里资产怎么做为支付工具呢？  
   
> 20:22:32  甘建新-快捷通支付架构师  
   
[强]  
   
> 20:22:33  扫地僧  
   
感谢分享！  
   
> 20:22:35  杨大兴央金所的资深产品经理  
   
谢谢分享！??  
   
> 20:23:02  光光-Ping++PL  
   
[强]  
   
> 20:23:07  陈儒-微众文化-技术总监  
   
[鼓掌][鼓掌][鼓掌]  
   
> 20:23:19  蘑菇街_陈宗  
   
感谢分享  
   
> 20:23:28  蘑菇街_陈宗  
   
有一个问题哈 资产交换 是否是常规意义上的 统一支付 ？  
   
> 20:24:00  少帅-快捷通支付产品  
   
感谢分享！  
   
> 20:24:04  韩财光  
   
你挖了好多坑 打算什么时候回填[坏笑]  
   
> 20:24:24  Leo  
   
感谢分享！  
   
> 20:25:33  韩财光  
   
@李杰辉-快捷通-产品?同学恭喜你是今天手气最佳的获得者  
   
> 20:25:36  李兴-有赞技术专家  
   
资产交换可以理解成统一支付，这样定义更为恰当，他包含所有交易类型指令的编排和处理  
   
> 20:26:00  李兴-有赞技术专家  
   
资产类支付工具目前主要是 余额  
   
> 20:26:34  李伟锋  
   
余额不该是负债类吗[呲牙]  
   
> 20:26:39  蘑菇街_陈宗  
   
收单业务、资产交换 以及 渠道之间的交互逻辑 方便举个例子吗  
   
> 20:27:57  freewolf-天津金融资产交易所技术  
   
感谢 分享[鼓掌]  
   
> 20:28:19  李兴-有赞技术专家  
   
哦，这个资产的意思不是指的复试记账中的资产与负责。泛指资金流相关  
   
> 20:28:43  李伟锋  
   
当遇到信贷类支付方式、或者资产类理财产品 去做支付，  这个“资产交换”  可能就需要另外一个资产中心了  
   
> 20:29:29  李兴-有赞技术专家  
   
可能不需要，只要在账务上区分 "借记账务"和"贷记账务"就可以了  
   
> 20:29:49  李伟锋  
   
恩恩  
   
> 20:32:36  李兴-有赞技术专家  
   
1.收单->资产交换->组装支付指令->调用渠道->渠道路由->调用三方api  2.三方回调->渠道->资产交换  3.如果状态没有回调，触发补偿：资产调度->渠道  如果是组合支付就比较复杂了  
   
> 20:33:19  李兴-有赞技术专家  
   
@铁手_蘑菇街_技术_杭州  
   
> 20:33:37  蘑菇街_陈宗  
   
恩恩，多谢  
   
> 20:35:44  蘑菇街_陈宗  
   
再问一个问题哈  支付过程中，重复支付这种异常情况如何处理？  
   
> 20:36:18  余铭  
   
感谢分享  
   
> 20:36:32  李兴-有赞技术专家  
   
重复支付进行支付撤回或者退款  
   
> 20:37:26  李兴-有赞技术专家  
   
重复支付问题目前看来只能尽可能的减少概率，聚合支付场景很难杜绝  
   
> 20:37:39  蘑菇街_陈宗  
   
只在资产交换层面上 进行撤回和退款吧  
   
> 20:37:52  李兴-有赞技术专家  
   
恩，是的  
   
> 20:38:32  蘑菇街_陈宗  
   
感谢分享  
   
> 20:38:36  蘑菇街_陈宗  
   
[坏笑]  
   
> 20:38:55  仙贝-中汇支付 技术主管  
   
感谢分享[强]  
   
> 20:39:13  李玉福  
   
有赞买的支付牌照吗？  
   
> 20:39:51  李兴-有赞技术专家  
   
这个不归我管呢[偷笑]  
   
> 20:39:52  Jacky-Bluepay支付部门技术PL  
   
[强]  
   
> 20:40:08  李玉福  
   
现在支付系统有做混合支付吗？[呲牙]  
   
> 20:40:24  Roger丙-翼支付  
   
ppt模板好炫。。  
   
> 20:40:27  李玉福  
   
比如银行卡支付100+余额100  
   
> 20:40:55  李兴-有赞技术专家  
   
混合支付目前还没上线，会支持  
   
> 20:41:49  武义-农行软开工程师  
   
感谢分享  
   
> 20:42:39  余铭  
   
微信支付和支付宝比重哪个大？  
   
> 20:43:08  李伟锋  
   
[强]  
   
> 20:43:12  李玉福  
   
感谢分享  
   
> 20:43:17  李玉福  
   
再请教个问题。  
   
> 20:43:20  李玉福  
   
业务模式码：该产品下的业务模式，比如担保交易，即时到账等。  
   
> 20:43:48  李兴-有赞技术专家  
   
差不多呢，微信稍微多些  
   
> 20:45:03  漫天飞雪  
   
通道码和渠道号有主子关系吗？  
   
> 20:45:09  李玉福  
   
即时到账的这种场景，有直接到资金账户的场景吗？这种对风控要求很高，有什么方法吗？  
   
> 20:46:15  李兴-有赞技术专家  
   
比较好的方法是做准实时对账了。也可以在提现上控制商户  
   
> 20:47:51  李兴-有赞技术专家  
   
通道码和渠道号没有主子关系  
   
> 20:48:22  漫天飞雪  
   
渠道号不能推算出通道码，是这个意思吗？  
   
> 20:49:10  落雪飞花-农信互联-开发经理  
   
感谢分享，方便详细说一下事物悬挂是怎么实现的吗  
   
> 20:49:25  李兴-有赞技术专家  
   
渠道号不能推算出通道码。因为一个渠道号可能包含多个通道码  
   
> 20:49:44  李兴-有赞技术专家  
   
一个通道码也会对应多个渠道号  
   
> 20:49:49  漫天飞雪  
   
好的，谢谢分享  
   
> 20:52:48  韩财光  
   
四码一号在你们微服务间传递 应该再加上业务数据一起吧  
   
> 20:53:10  李兴-有赞技术专家  
   
@亨利-农信互联-开发经理-北京   通过一个幂等性表可以解决，也可以通过其他方式，比如延时空回滚等  
   
> 20:53:14  李兴-有赞技术专家  
   
![2017-06-08 20:53:14](http://static.cocolian.cn/img/20170608_205314.png) 
   
> 20:54:12  李兴-有赞技术专家  
   
@韩财光-东软(前)-开发-广州 是的，和业务数据一起  
   
> 20:54:47  韩财光  
   
事务悬挂那里第二段漏了 其他 两字吧  
   
> 20:55:50  落雪飞花-农信互联-开发经理  
   
谢谢，我再想想  
   
> 20:56:41  李兴-有赞技术专家  
   
@韩财光-东软(前)-开发-广州 具体指的哪里？[发呆]  
   
> 20:58:24  Charle-跨境通-清结算PM  
   
感谢分享  
   
> 20:58:25  惊鸿-付钱拉PM  
   
资产交换是个行业术语还是？  
   
> 20:58:46  李兴-有赞技术专家  
   
不是行业术语  
   
> 20:59:04  惊鸿-付钱拉PM  
   
贵司特色？  
   
> 20:59:29  韩财光  
   
超时后发回滚的只是其中一个参与者吗 应该全部发出回滚指令吧 这段我理解不清 有时间再细说了  
   
> 21:00:12  李兴-有赞技术专家  
   
杭州公司好像用的比较多，其他不太了解，和阿里有关[偷笑]  
   
> 21:01:17  李兴-有赞技术专家  
   
不是，只要有一个失败，所有的参与者都需要回滚，这里为了简化只画了一个参与者  
   
> 21:01:22  韩财光  
   
nodejs那部分是什么功能 网关作用？ 业务分发负载均衡？  
   
> 21:01:45  李兴-有赞技术专家  
   
目前只是前端展示  
   
> 21:01:57  韩财光  
   
事务以后细说  
   
> 21:02:09  李兴-有赞技术专家  
   
恩，好的  
   
> 21:03:05  韩财光  
   
我没问题了 你吃饭了吧  
   
> 21:03:26  李兴-有赞技术专家  
   
吃过了[呲牙]  
   
> 21:04:55  韩财光  
   
ppt模板漂亮[呲牙]  
   
> 21:05:41  左晨  
   
[强]特别棒  
   
> 21:05:50  落雪飞花-农信互联-开发经理  
   
第一阶段的参与者，在没有收到commit或者rollback之前，会一直和数据库保持链接吗  
   
> 21:06:18  落雪飞花-农信互联-开发经理  
   
有没有相关的资料给推荐一下  
   
> 21:06:43  李兴-有赞技术专家  
   
不会，处理成功本地事务已经提交了  
   
> 21:06:48  阚建国_工行支付架构师  
   
[强]  
   
> 21:08:33  李兴-有赞技术专家  
   
@亨利-农信互联-开发经理-北京  搜索TCC分布式事务，事务型消息有很多资料  
   
> 21:08:40  李兴-有赞技术专家  
   
http://kaimingwan.com/post/fen-bu-shi/fen-bu-shi-shi-wu-de-dian-xing-chu-li-fang-shi-2pc-tcc-yi-bu-que-bao-he-zui-da-nu-li-xing  
   
> 21:09:12  落雪飞花-农信互联-开发经理  
   
非常感谢……[强]  
   
> 21:09:27  漫天飞雪  
   
转账有四码一号吗？ 如何处理的  
   
> 21:11:16  李兴-有赞技术专家  
   
根据自己的业务场景来定就好了。转账也是可以有的，有些码可以复用支付的。转账某种意义上讲也是一种支付  
   
> 21:15:25  漫天飞雪  
   
ok，感谢  
   
> 21:16:18  陈小学学-迅联智付-架构师  
   
@李兴-有赞-研发?注册中心为什么要从zk修改为etcd呢？[呲牙]  
   
> 21:21:25  李兴-有赞技术专家  
   
维护起来比较方便，公司有这方面的专家，掌控力比较强。 编程和扩展稍微好些 好像算法也有一些优化（选举）  感觉主要原因还是哪个掌控力更强，比如我们消息用nsq。  
   
> 22:24:24  华-南京亚软-IT总监  
   
快五百人了  
   
> 22:42:48  FLD-卡说技术总监  
   
@李兴-有赞-研发?支付过程中如果系统挂了，都做了哪些异常处理？  
   
> 23:08:58  david-橙子支付-技术总监  
   
@李兴-有赞-研发?你们的事务管理器是自己研发的？性能上比补偿式事务更有优点？  
   
> 23:42:39  李兴-有赞技术专家  
   
如果预支付已经完成，那就落了补偿表，系统恢复自动收敛。支付成功回调回来发送事物性消息进行入账。只要回调成功，消息就会确保被处理，如果回调过程挂了依靠补偿自动收敛 @正清-卡说-TD-苏州?  
   
> 23:45:17  李兴-有赞技术专家  
   
@david~圈存~广州?是自己研发的，两个应用场景不同，不是替代品。补偿适用于单支付工具场景，简单实用，tcc分布式事物处理组合支付场景，依靠补偿处理有些复杂。  
   
