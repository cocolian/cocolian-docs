---
layout:     source 
title:      "2017-05-06-WeChat"
date:       2017-05-06 12:00:00
author:     "PaymentGroup"
tag:		  [chat]
header-img: "img/post-bg-wechat.jpg"
---
> 07:49:27  ??桂明 ??  
   
[呲牙]  
   
> 07:49:33  ??桂明 ??  
   
这么多人啦  
   
> 07:49:43  钟文帅-移付宝科技-产品经理  
   
早啊  
   
> 08:01:13  李小-交通银行商户运营 支付PM  
   
各位老师好！  
   
> 08:05:03  降峰-百度金融  
   
大家好  
   
> 08:06:28  潘儒刚-连连支付PM  
   
大家好  
   
> 08:08:09  胡圣 支付产品经理 猪八戒网  
   
听过降峰老师的网课，很用心，点赞  
   
> 08:08:50  秦红胜-CTO-共致开源-  
   
请教一下各位支付平台双活都这么做的？  
   
> 08:12:22  冷暖自知-风控 裕福支付 北京  
   
大家早啊  
   
> 08:13:05  吴锦涛 和创金服  
   
早  
   
> 08:20:26  王杰瑜-支付产品经理-中金汇通  
   
[太阳]  
   
> 08:28:21  降峰-百度金融  
   
@Emerson-猪八戒-重庆?哇 谢谢  
   
> 08:38:54  atom-汇付-产品-上海  
   
早  
   
> 08:42:49  李奔-富友-支付PM  
   
早  
   
> 09:17:20  徐玮 理房通支付开发经理  
   
[太阳]  
   
> 09:17:53  ??桂明 ??  
   
@徐玮–理房通-北京?你好  
   
> 09:18:17  徐玮 理房通支付开发经理  
   
你好  
   
> 09:18:29  ??桂明 ??  
   
[呲牙][呲牙]  
   
> 09:39:16  李奔-富友-支付PM  
   
@老熊-爱奇艺-北京?辛苦熊哥了 这么多人拉进来  
   
> 09:47:27  yuesheng.yin  
   
  
   
> 09:59:32  钟文帅-移付宝科技-产品经理  
   
[机智]  
   
> 10:45:04  李征烈-钱通支付PM  
   
请教下，大家app收银台一般放在交易系统还是支付网关（支付系统），还是单独放？  
   
> 11:07:02  秦红胜-CTO-共致开源-  
   
没人讨论问题啊  
   
> 11:07:24  胡圣 支付产品经理 猪八戒网  
   
我们是单独，建议与交易系统做分隔。是否放在支付网关视情况而定。  
   
> 11:10:47  秦红胜-CTO-共致开源-  
   
支付网关采用异步架构还是同步架构？  
   
> 11:12:12  蘑菇街_陈宗  
   
异步较多 同步性能跟不上  
   
> 11:12:48  秦红胜-CTO-共致开源-  
   
异步架构中消息队列一般用啥？  
   
> 11:18:31  王晗  
   
看公司选型吧，activemq，rocketmq的都有  
   
> 11:19:04  秦红胜-CTO-共致开源-  
   
kafka行吗  
   
> 11:19:30  降峰-百度金融  
   
我们是分开的。收银台属于基础组 上层建筑。和账务 通道网关 结算 是分开的。  
   
> 11:19:45  蘑菇街_陈宗  
   
蘑菇街自研了一套mq   
   
> 11:19:57  秦红胜-CTO-共致开源-  
   
牛  
   
> 11:20:06  ??桂明 ??  
   
[强][强][强]  
   
> 11:20:39  降峰-百度金融  
   
![2017-05-06 11:20:39](http://static.cocolian.cn/img/20170506_112039.png) 
   
> 11:20:47  降峰-百度金融  
   
这是 我们的基础架构设计。  
   
> 11:21:03  降峰-百度金融  
   
这个我有分享过。  
   
> 11:21:59  蘑菇街_陈宗  
   
收银台作为独立的应用对外提供服务    
   
> 11:22:44  蘑菇街_陈宗  
   
支付订单和收银台的交互时序是怎么样的呢@降峰 百度金融pm 北京?  
   
> 11:27:00  王晗  
   
kafka一般还是作为日志传输用，主要是能容忍消息可能会丢失  
   
> 11:28:24  秦红胜-CTO-共致开源-  
   
多谢  
   
> 11:29:37  秦红胜-CTO-共致开源-  
   
不知道rocketmq新版本是否还需要app处理重复消费的问题？  
   
> 11:32:46  蘑菇街_陈宗  
   
app在接受消息通知的时候 都需要做幂等控制吧？mq最少通知一次和只通知一次，在实现上有较大的区别 。  
   
> 11:33:33  秦红胜-CTO-共致开源-  
   
是的，我们用过rocketmq之前的版本，是需要自己做幂等控制的  
   
> 11:34:17  降峰-百度金融  
   
你们都是偏技术的问题。我是前端pm。  
   
> 11:34:23  降峰-百度金融  
   
学习ing  
   
> 11:35:07  秦红胜-CTO-共致开源-  
   
有谁做过支付平台的同城双活和异地多活吗？  
   
> 11:35:30  蘑菇街_陈宗  
   
我的理解：支付系统有操作行为的接口都需要有幂等保证[呲牙]  
   
> 11:35:38  朱雄新-广发支付组  
   
这个话题好！@秦红胜?  
   
> 11:36:18  朱雄新-广发支付组  
   
我们这边正要做同城灾备和双活  
   
> 11:36:34  朱雄新-广发支付组  
   
我也还惆怅~  
   
> 11:36:57  秦红胜-CTO-共致开源-  
   
[握手]  
   
> 11:37:16  王晗  
   
同学习  
   
> 11:37:28  张叶-付费通-支付PM  
   
[强]  
   
> 11:41:00  朱雄新-广发支付组  
   
坐等大神分享~  
   
> 11:41:30  秦红胜-CTO-共致开源-  
   
有没有阿里或者淘宝的大神出来分享一下双活、多活的架构？  
   
> 11:43:31  阿杜  
   
我们有做同城双活……  
   
> 11:45:10  秦红胜-CTO-共致开源-  
   
阿里“三活”数据中心实践经验  
   
> 11:46:08  秦红胜-CTO-共致开源-  
   
你们同城双活的架构是啥样子的？  
   
> 11:47:19  阿杜  
   
深圳两个中心，交易通过消息中间件切了部分流量发往两个中心  
   
> 11:48:29  秦红胜-CTO-共致开源-  
   
数据复制是在数据库层做的还是存储层做的？  
   
> 11:50:04  阿杜  
   
我们数据库本身就是腾讯的tdsql分布式数据库，数据库直接保证这个  
   
> 11:50:28  秦红胜-CTO-共致开源-  
   
tdsql支持跨两个数据中心？  
   
> 11:55:53  人保金服乔阳  
   
这是我一直没搞懂的  
   
> 11:56:42  蘑菇街_陈宗  
   
这偏基础平台搭建了   
   
> 12:01:24  人保金服乔阳  
   
大公司才需要考虑  
   
> 12:28:43  阿杜  
   
![2017-05-06 12:28:43](http://static.cocolian.cn/img/20170506_122843.png) 
   
> 12:30:00  阿杜  
   
![2017-05-06 12:30:00](http://static.cocolian.cn/img/20170506_123000.png) 
   
> 12:30:26  阿杜  
   
set即数据库服务单位  
   
> 12:31:01  阿杜  
   
一个set单个节点，1主2备  
   
> 13:20:08  李征烈-钱通支付PM  
   
谢谢各位大神  
   
> 13:27:48  秦红胜-CTO-共致开源-  
   
同谢  
   
> 13:46:28  Schenchan-有赞  
   
@Kent? 欢迎 [奸笑]  
   
> 13:48:16  陈琳 中移动PM  
   
请问一下各位同仁，大家现在在对接接入网联了吗  
   
> 13:51:11  陈孟军-鄞州银行-开发PL  
   
同问 这个后续银行方的接入计划各位同仁了解吗  
   
> 13:54:25  阿杜  
   
网联系统四大行都没接入呢……首批联调时间是6.30……  
   
> 13:55:05  陈琳 中移动PM  
   
[发呆]最近那边催着我们公司6月底完成接入  
   
> 13:56:06  陈琳 中移动PM  
   
那其实现在网联平台上没接入几家银行咯  
   
> 13:56:22  朱雄新-广发支付组  
   
嗯  
   
> 13:56:55  陈琳 中移动PM  
   
支付宝和财付通是不是已经完成了对接，但是还没有切量过去  
   
> 13:57:37  朱雄新-广发支付组  
   
财付通接了，支付宝好像还没没接  
   
> 13:58:00  朱雄新-广发支付组  
   
即使介入，刚开始也是只切1%交易过去  
   
> 14:04:24  降峰-百度金融  
   
百度接了 还没投产  
   
> 14:15:38  在路上-杉德支付架构  
   
有哪位同仁能分享一些清分，对账，报表的架构思路吗？  
   
> 15:40:11  我  
   
这个话题有点大，得分头说  
   
> 15:47:50  秦红胜-CTO-共致开源-  
   
分几块大家讨论下  
   
> 15:49:28  在路上-杉德支付架构  
   
对账分散在各个地方，有点头大，多方勾对麻烦的很  
   
> 16:34:29  秦红胜-CTO-共致开源-  
   
现在是啥架构？  
   
> 17:16:18  我  
   
三大块对账，内部，渠道，业务方  
   
> 17:16:24  我  
   
都不一样处理  
   
> 17:22:18  路杨 嘉联支付产品  
   
微信支付商户平台中看不到订单中的商品详情列表，只有每个订单总金额，财务想每一种商品单独对账，大家有遇到过类似需求的吗？  
   
> 17:37:47  王晗  
   
赞需求  
   
> 17:48:00  车睿??  
   
可以加备注字段  
   
> 17:48:58  车睿??  
   
微信商户后台，只有商户订单号是可以和自己的交易系统记录中的商户订单号匹配的  
   
> 17:50:15  路杨 嘉联支付产品  
   
一个订单只有一个对应的名称字段，通过商品名称字段自己定义下详情？其实商品详情微信是拿到了，我怀疑是还没时间做商品种类的对账单。创建微信支付订单时有传给微信订单里包含哪几种商品各是几个  
   
> 17:53:57  车睿??  
   
嗯，目前微信是没有在商户后台导出的记录中加这些的，所以只能自己来记。。  
   
> 17:54:35  路杨 嘉联支付产品  
   
[捂脸]  
   
> 18:07:08  王晗  
   
正统做法应该还是渠道对账和内部对账来保证的，渠道方面只关注金额状态正确  
   
> 18:11:41  朱雄新-广发支付组  
   
三方对账  
   
> 18:13:50  朱雄新-广发支付组  
   
（1）支付流水和通道流水对，以通道为准同步状态。 （2）支付记账流水和核心流水对，以核心记账流水为准。 （3）三方流水记入应收应付流水表对，检查单边账记录。  
   
> 18:14:29  朱雄新-广发支付组  
   
我们银行内的可能会和支付机构的有些差别哈~[微笑]  
   
> 18:14:59  李丹-风控经理-双乾支付  
   
[强]  
   
> 18:15:45  郑丽娟-通联-产品经理  
   
好专业哦[强][强]  
   
> 18:16:55  车睿??  
   
嗯，是的，外部对账对流水，内部对账对细节  
   
> 18:16:57  朱雄新-广发支付组  
   
还有就是核对每个通道每日的待清算科目余额变动是否与实际发生额一致。  
   
> 18:17:20  秦红胜-CTO-共致开源-  
   
我们准备采用微服务重构一下支付平台，问一下模块怎么划分比较合理？  
   
> 18:17:29  车睿??  
   
这是账面和实际的核对  
   
> 18:17:42  胡圣 支付产品经理 猪八戒网  
   
问题太大了@秦红胜?  
   
> 18:18:03  黄菲  
   
@阿杜-微众银行-深圳?接上午问题 两个机房的交易通过消息中间件来分流 那中间件本身不还是单点吗？  
   
> 19:38:29  我  
   
主流消息系统都有高可用的方案。  
   
> 19:39:44  秦红胜-CTO-共致开源-  
   
他想知道的是怎么保证消息系统在两个数据中心双活？  
   
> 20:14:40  阿杜  
   
这个消息系统问了下说是高可用的，但怎么实现高可用的得找人再了解下。@黄菲-富友-上海?  
   
> 20:15:48  老樊-滴滴技术专家  
   
@阿杜-微众银行-深圳?,多活需要物理的虚拟路由支持吧？  
   
> 20:37:23  黄菲  
   
@秦红胜?对的  
   
> 20:42:34  徐春好  
   
【网联与支付】互联网支付系统整体架构详解  
   
> 21:02:30  蘑菇街_陈宗  
   
这原著是谁  
   
> 21:03:14  彭睿-奇虎360金融支付PM  
   
群主是原著啊  
   
> 21:08:02  王晗  
   
投诉了  
   
> 21:16:26  蘑菇街_陈宗  
   
给力   
   
> 21:16:35  蘑菇街_陈宗  
   
盗窃可耻  
   
> 21:20:44  徐春好  
   
转个文章挖出个盗链[捂脸]  
   
> 21:21:33  蘑菇街_陈宗  
   
[捂脸][捂脸][捂脸]  
   
> 21:27:42  陈琳 中移动PM  
   
[偷笑][偷笑][偷笑]  
   
> 21:39:30  彭睿-奇虎360金融支付PM  
   
一文看懂互联网支付系统整体架构  
   
> 21:39:54  彭睿-奇虎360金融支付PM  
   
这篇文章怎么了  
   
> 21:40:03  彭睿-奇虎360金融支付PM  
   
今天好多公众号转  
   
> 21:40:22  彭睿-奇虎360金融支付PM  
   
不是写很早了么  
   
> 21:41:05  陈琳 中移动PM  
   
这个也没署老熊的名  
   
> 21:43:13  彭睿-奇虎360金融支付PM  
   
是  
   
