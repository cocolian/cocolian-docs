---
layout:     source 
title:      "2017-07-06-WeChat"
date:       2017-07-06 12:00:00
author:     "PaymentGroup"
tag:		  [chat]
header-img: "img/post-bg-wechat.jpg"
---
> 00:15:36  Aaron-携程金融支付PL  
   
[强][强][强]  
   
> 00:19:16  刘洪明-便利蜂支付  
   
[强][强][强]  
   
> 08:33:43  WLX-支付通项目主管  
   
[强][强]  
   
> 08:35:05  叶林松-微众银行高级产品经理  
   
[强][强]  
   
> 08:36:51  刘佳明-微店  
   
[强][强]  
   
> 08:36:52  阚建国_工行支付架构师  
   
[强][强]  
   
> 08:46:12  常露-通联支付-跨境支付产品  
   
原来支付宝07年就开始境外收单。而跨境外汇试点是13年才有 跨境人民币是14年[捂脸]  
   
> 08:46:43  横烟秋-支付宝PM  
   
是的  
   
> 08:47:38  龚晓冬-银商账户-产品-上海  
   
好像工行当时是很早就开始国际化业务了  
   
> 08:48:17  常露-通联支付-跨境支付产品  
   
那是银行呀 第三方支付拿到资质才能做跨境支付  
   
> 08:48:20  龚晓冬-银商账户-产品-上海  
   
国内银行对于跨境业务也都很早开始筹划了  
   
> 08:48:40  龚晓冬-银商账户-产品-上海  
   
当时第三方支付和银行的关系比较暧昧的  
   
> 08:49:18  龚晓冬-银商账户-产品-上海  
   
通联也不是通过中国银行在做吗？  
   
> 08:50:39  常露-通联支付-跨境支付产品  
   
恩 有的@龚晓冬-银商账户-产品-上海?  
   
> 09:28:44  等锋来  
   
满满都是干活  
   
> 09:54:58  沈一点-恒生电子-工程师  
   
大神们。昨天的作业  
   
> 09:54:59  沈一点-恒生电子-工程师  
   
人民币: RMB 169.00 美元: $ 24.81 美元对人民币报价汇率：6.8124 收费费率：3%（和商户约定的合同费率）  充值： 借： 待清算充值款项-***银行-***业务充值待清算 169.00 (日终跑批汇总记账)   贷：个人账户存款（公司账户存款） 169.00(会员充值时实时单笔记账,增加账户余额)  1、生成购汇文件之前：我在莎莎网使用支付宝付款，支付宝系统根据报价汇率换算成人民币报价逐步进行账务处理 人民币报价＝交易外币金额*报价汇率=24.81*6.8124=169.00 账务处理： 借：个人账户存款（公司账户存款） RMB169.00   贷：代理业务资金-购汇-购汇过渡户 RMB169.00  生成购汇文件时单边借记购汇过渡户，贷方在系统日终跑批时汇总记账  2、生成购汇文件时，系统按预算购汇金额从购汇过渡户扣除： 预算购汇金额＝[正常交易商品外币报价*（1-收费费率）-退款商品外币报价]*报价汇率=[24.81*（1-0.03）-0]*6.8124=163.95 借：代理业务资金-购汇-购汇过渡户 RMB163.95   贷：待清算购汇款项-XX银行-X行购汇待清算（日终跑批汇总记账）RMB163.95   实际结（购）汇汇率: 6.8100(汇兑收益) 实际结（购）汇汇率: 6.8200(汇兑损失)  3、购汇成功，将购汇文件回导对账后，某某宝收费系统逐笔进行收费（某某宝以人民币计收入），  收收佣金＝正常交易商品外币报价*收费费率＊购汇汇率=24.81*0.03*6.8100=5.07 借：代理业务资金-购汇-购汇过渡户 RMB5.07   贷：公司账户存款（账务收费某某宝账户）RMB5.07  收收佣金＝正常交易商品外币报价*收费费率＊购汇汇率=24.81*0.03*6.8200=5.08 借：代理业务资金-购汇-购汇过渡户 RMB5.08   贷：公司账户存款（账务收费某某宝账户）RMB5.08   4、购汇发生汇兑损益的处理：收益转至“汇兑损益备用金户”，损失从“汇兑损益备用金户”补回。（计算结果为正时为收益，否则为损失）  汇兑损益＝[正常交易商品外币报价-退款商品外币报价]*（报价汇率－购汇汇率）= 24.81 * ( 6.8124 - 6.8100 ) = 0.06  汇兑损益＝[正常交易商品外币报价-退款商品外币报价]*（报价汇率－购汇汇率）= 24.81 * ( 6.8124 - 6.8200 ) = -0.19  汇兑收益的账务处理(本次体验产生收益)： 借：代理业务资金-购汇-购汇过渡户 RMB0.06   贷：自有资金账户存款－专项备用金－专项备用金 RMB0.06  若汇兑损失的账务处理如下： 借：自有资金账户存款－专项备用金－专项备用金 RMB0.19   贷：代理业务资金-购汇-购汇过渡户 RMB0.19   境内银行通过 环球银行电信协会SWIFT 电汇 $24.07 境外商户美元账户  
   
> 09:58:53  杨继培  
   
[强]  
   
> 10:00:35  李伟锋  
   
内容太丰富，手机上难看啊哈哈  
   
> 10:02:47  我  
   
欢迎大美女 @Angela-Airbnb-EM-SF ， 嘀嗒嘀嗒 公众号的owner， Airbnb支付的技术经理。   
   
> 10:02:53  李伟锋  
   
秋  购汇、结汇汇率方面银行的报价应该不是实时的吧，怎么来预防资损的  
   
> 10:03:17  韩倩～  
   
[鼓掌][鼓掌]欢迎  
   
> 10:03:30  我  
   
每个工程师都应该了解的：聊聊幂等  
   
> 10:03:31  张小凡-支付产品经理-驴妈妈旅游  
   
[发呆] 欢迎欢迎  
   
> 10:03:32  Peter-找钢网-PM  
   
[玫瑰][鼓掌][鼓掌]  
   
> 10:03:45  杨继培  
   
欢迎 ，欢迎，  
   
> 10:03:54  朱赟9900  
   
谢谢~  
   
> 10:03:56  刘伟-猪八戒-高级PM  
   
欢迎，欢迎  
   
> 10:04:08  扣子-锐融天下  
   
欢迎、欢迎  
   
> 10:04:10  龚晓冬-银商账户-产品-上海  
   
@李伟锋-蘑菇街金融-杭州 这个需要进行汇兑的头寸管理，或者购买远期期权  
   
> 10:04:15  横烟秋-支付宝PM  
   
你没有看到账户结构的用意吗  
   
> 10:04:17  紫紫-随手记支付产品经理  
   
昨天晚上的课程，有木有整理哈。如果没有我中午整理，昨天晚上都没来得及听  
   
> 10:04:21  沈一点-恒生电子-工程师  
   
热烈欢迎  
   
> 10:04:26  thq  
   
欢迎??  
   
> 10:04:30  紫紫-随手记支付产品经理  
   
[捂脸]不好意思，秋秋  
   
> 10:04:33  王涵  
   
欢迎、欢迎[鼓掌]  
   
> 10:04:45  蔡云龙 开联通支付  
   
欢迎  
   
> 10:04:46  李伟锋  
   
账户结构？  
   
> 10:04:53  横烟秋-支付宝PM  
   
不能说预防汇兑损益  
   
> 10:04:57  朱黎明 海尔快捷通   
   
欢迎  
   
> 10:05:01  李?德灿  
   
欢迎??  
   
> 10:05:02  李伟锋  
   
翻回去找找  
   
> 10:05:03  横烟秋-支付宝PM  
   
有一个汇兑损益的账户  
   
> 10:05:06  吕耀辉-维金-PM  
   
欢迎[鼓掌]  
   
> 10:05:11  龚晓冬-银商账户-产品-上海  
   
@李伟锋-蘑菇街金融-杭州 是确保损益核算准确，这个是账户结构的目的  
   
> 10:05:14  沈一点-恒生电子-工程师  
   
就是有个对冲的过程？  
   
> 10:05:45  横烟秋-支付宝PM  
   
当发生汇率风险的时候，亏损资金从损益帐户出   
   
> 10:06:27  龚晓冬-银商账户-产品-上海  
   
嗯，损益账户也是自有资金账户，也是符合会计记账的规则  
   
> 10:06:38  李伟锋  
   
汇兑损益账户我理解是用来垫资  
   
> 10:06:39  横烟秋-支付宝PM  
   
是的  
   
> 10:06:59  横烟秋-支付宝PM  
   
你需要预先充值一笔  
   
> 10:07:08  龚晓冬-银商账户-产品-上海  
   
@李伟锋-蘑菇街金融-杭州 不是垫资，而是真实的资金损失  
   
> 10:07:24  李伟锋  
   
恩 是的，  
   
> 10:07:26  Ben-PPTV境外产品负责人  
   
有亏也有赚  
   
> 10:07:32  横烟秋-支付宝PM  
   
对的  
   
> 10:07:36  龚晓冬-银商账户-产品-上海  
   
因为账务记账是实时发生的，汇率是实时变动的  
   
> 10:07:44  Ben-PPTV境外产品负责人  
   
用一个账户记录就好了  
   
> 10:07:45  李伟锋  
   
我的意思是  购汇 从银行拿到的汇率可能是前天的，可能新的汇率已经出来了 只不过支付宝拿不到  
   
> 10:07:49  张泽雄-民生金服 项目总监  
   
一般报价比行市高  
   
> 10:07:53  横烟秋-支付宝PM  
   
随实际汇率波动  
   
> 10:07:59  李伟锋  
   
银行会实时给同步汇率吗  
   
> 10:08:03  横烟秋-支付宝PM  
   
但是系统里面会有一个校验  
   
> 10:08:15  龚晓冬-银商账户-产品-上海  
   
@李伟锋-蘑菇街金融-杭州 和银行挂牌汇率联动的，这个是系统设计需要考虑的  
   
> 10:08:18  横烟秋-支付宝PM  
   
如果汇率波动较大 就会预警  
   
> 10:08:24  FLD-卡说技术总监  
   
nbnb，大美女安姐都来了，[鼓掌][鼓掌]  
   
> 10:08:40  龚晓冬-银商账户-产品-上海  
   
嗯，汇率波动较大会暂停业务  
   
> 10:08:59  Ben-PPTV境外产品负责人  
   
银行的汇率都是实时的，你什么时候找他汇兑，他按什么价格给你做  
   
> 10:09:05  Ben-PPTV境外产品负责人  
   
报价是你和用户的事  
   
> 10:09:39  横烟秋-支付宝PM  
   
所以有报价汇率 和购汇汇率  
   
> 10:10:11  龚晓冬-银商账户-产品-上海  
   
嗯，是的，一直在波动的，直到支付成功那一刻  
   
> 10:10:13  横烟秋-支付宝PM  
   
购汇汇率是清算时候的牌价  
   
> 10:10:21  李伟锋  
   
和银行挂牌汇率联动？我还以为是支付宝定时去获取汇率  
   
> 10:10:23  sunshine-苏宁金融  
   
明明可以靠颜值，却非要撸代码  
   
> 10:10:46  横烟秋-支付宝PM  
   
以前是定时获取的  
   
> 10:10:49  Ben-PPTV境外产品负责人  
   
肯定是定时获取的  
   
> 10:11:05  Ben-PPTV境外产品负责人  
   
现在不是了？  
   
> 10:11:13  横烟秋-支付宝PM  
   
现在是不是我不了解了  
   
> 10:11:14  李伟锋  
   
那定时获取  就避免不了给用户的报价高了 低了  
   
> 10:11:38  龚晓冬-银商账户-产品-上海  
   
@李伟锋-蘑菇街金融-杭州 你仔细再看看，秋秋老师的日结购汇的会计分录  
   
> 10:11:40  横烟秋-支付宝PM  
   
连连的兄弟你们应该更清楚  
   
> 10:11:41  横烟秋-支付宝PM  
   
哈哈  
   
> 10:11:47  李伟锋  
   
谁有昨晚的总结的文档 ，内容太多了 不好翻呀 哈哈  
   
> 10:12:09  李伟锋  
   
@龚晓冬-银商账户-产品-上海  讷讷 要学习下  
   
> 10:12:17  张泽雄-民生金服 项目总监  
   
账户只能核算亏多少，解决不了亏损的问题  
   
> 10:12:41  横烟秋-支付宝PM  
   
汇兑损益很正常啊  
   
> 10:12:48  龚晓冬-银商账户-产品-上海  
   
嗯，秋球老师这块重点敲黑板了，购汇这块有单边记账的，所以要搞清楚几个时间点  
   
> 10:12:52  Ben-PPTV境外产品负责人  
   
实时的，你也避免不了给用户的报价高了低了，你自己去银行做一个购结汇就知道了  
   
> 10:12:56  张泽雄-民生金服 项目总监  
   
这个要看亏多少 了  
   
> 10:13:01  横烟秋-支付宝PM  
   
为什么一定要解决亏损  
   
> 10:13:18  张泽雄-民生金服 项目总监  
   
公司赔钱阿  
   
> 10:13:19  龚晓冬-银商账户-产品-上海  
   
因为他们考虑的是盈利，而不是系统设计。。  
   
> 10:13:29  Ben-PPTV境外产品负责人  
   
怎么叫亏呢，还有可能赚呢[偷笑]  
   
> 10:13:31  李伟锋  
   
我意思是说  能否尽量用最准确的报价来 哈哈  
   
> 10:13:41  横烟秋-支付宝PM  
   
是的啊  
   
> 10:13:43  张小凡-支付产品经理-驴妈妈旅游  
   
在爬楼看 秋秋信息量太大了。。。  
   
> 10:13:47  龚晓冬-银商账户-产品-上海  
   
@李伟锋-蘑菇街金融-杭州 这个自己去和银行谈吧~  
   
> 10:13:55  李伟锋  
   
赚就不说了 亏尽量减少嘛  
   
> 10:13:56  张泽雄-民生金服 项目总监  
   
赚了是正常阿  
   
> 10:14:00  横烟秋-支付宝PM  
   
一般都是赚  
   
> 10:14:28  张泽雄-民生金服 项目总监  
   
系统设计要避免亏损风险，很正常  
   
> 10:14:45  龚晓冬-银商账户-产品-上海  
   
那是风险部门考虑的事情  
   
> 10:15:01  龚晓冬-银商账户-产品-上海  
   
计划财务也应该有相应制度流程  
   
> 10:15:05  张泽雄-民生金服 项目总监  
   
那是老板提出来的  
   
> 10:15:33  张泽雄-民生金服 项目总监  
   
赔钱赔的是老板的，又不是财务的  
   
> 10:15:35  Ben-PPTV境外产品负责人  
   
如果要完全避免汇兑损益这个问题，需要别的解决办法  
   
> 10:15:58  龚晓冬-银商账户-产品-上海  
   
嗯，一般是财务通过金融衍生产品对冲汇兑损益  
   
> 10:16:04  Ben-PPTV境外产品负责人  
   
不是在系统设计层面解决的  
   
> 10:16:35  张泽雄-民生金服 项目总监  
   
对冲那是另一回事了  
   
> 10:16:43  李伟锋  
   
求昨晚的整理文档  
   
> 10:16:47  横烟秋-支付宝PM  
   
有严格的直连任务时间的  
   
> 10:16:49  龚晓冬-银商账户-产品-上海  
   
如果有兴趣可以看一下金融衍生品齐全那块的材料，有特别说明减少汇兑损益的  
   
> 10:16:59  Ben-PPTV境外产品负责人  
   
昨晚讲了什么课题  
   
> 10:17:07  横烟秋-支付宝PM  
   
直连方案有3种  
   
> 10:17:16  横烟秋-支付宝PM  
   
非直连方案也有3种  
   
> 10:17:39  龚晓冬-银商账户-产品-上海  
   
还有非直连方案啊。。  
   
> 10:18:24  横烟秋-支付宝PM  
   
直连都出问题的预案  
   
> 10:18:45  张泽雄-民生金服 项目总监  
   
对冲和系统没有关系，李伟峰的意思是纯只有收单系统的情况下，如何在系统设计上减少汇率波动带来的亏损风险  
   
> 10:19:21  龚晓冬-银商账户-产品-上海  
   
那真没有办法减少。。。。银行报价多少是多少  
   
> 10:19:24  横烟秋-支付宝PM  
   
恩 我就喜欢一个问题引出大家的风暴  
   
> 10:19:25  横烟秋-支付宝PM  
   
哈哈  
   
> 10:19:49  Ben-PPTV境外产品负责人  
   
系统层面那就简单了，尽量缩短你给用户承诺的时间和你做汇兑的时间  
   
> 10:20:07  张泽雄-民生金服 项目总监  
   
不是阿，上面说的有个波动区间，不也是一个办法吗？  
   
> 10:20:24  龚晓冬-银商账户-产品-上海  
   
但是财务记账就很复杂了  
   
> 10:20:27  Ben-PPTV境外产品负责人  
   
敞口风险说白了就是时间风险  
   
> 10:20:36  横烟秋-支付宝PM  
   
汇率文件以前是每天10:05到18:05 每小时启动一次  
   
> 10:20:43  Ben-PPTV境外产品负责人  
   
波动区间啥意思。。。  
   
> 10:21:13  龚晓冬-银商账户-产品-上海  
   
@产品 连连支付 杭州 有的银行会在挂牌汇率上进行在自己调节  
   
> 10:21:15  张泽雄-民生金服 项目总监  
   
汇率波动大小  
   
> 10:21:18  横烟秋-支付宝PM  
   
系统设计里面是有波动区间值的  
   
> 10:21:22  朱雄新-广发支付组  
   
@老熊-爱奇艺-技术经理-北京?@Angela-Airbnb-EM-SF?幂等说得很清楚，我们在做交易堵重和交易续作，都用到了文章里说的，谢谢！  
   
> 10:21:31  横烟秋-支付宝PM  
   
汇率波动预警  
   
> 10:21:40  张泽雄-民生金服 项目总监  
   
这确实是个办法阿  
   
> 10:21:55  朱赟9900  
   
谢谢~  
   
> 10:22:00  龚晓冬-银商账户-产品-上海  
   
嗯，那个是一般是风控系统会判定，这个顶多也是个预警。。。  
   
> 10:23:04  张泽雄-民生金服 项目总监  
   
是的，人民币跳水了，系统报警，人工干预，这都是措施阿  
   
> 10:23:05  Ben-PPTV境外产品负责人  
   
一般用不太到，因为你和银行是在定期拿汇率的，在这个时间周期内，不太会碰到区间边界。前提是区间不能影响正常业务进行。  
   
> 10:23:38  龚晓冬-银商账户-产品-上海  
   
@秋秋-产品-上海 不过好像阿里应该有汇率预测系统吧，推送后续一段时间的汇率波动  
   
> 10:23:55  张泽雄-民生金服 项目总监  
   
汇率没法预测  
   
> 10:24:05  袁军-架构师-快捷通  
   
发出来 [疑问]  
   
> 10:24:06  袁军-架构师-快捷通  
   
![2017-07-06 10:24:06](http://static.cocolian.cn/img/20170706_102406.png) 
   
> 10:24:26  少帅-快捷通支付产品  
   
[强]  
   
> 10:24:30  龚晓冬-银商账户-产品-上海  
   
有的，当时我在银行，银行有预测系统的。。。  
   
> 10:24:40  横烟秋-支付宝PM  
   
我之前在做清算的时候 都先看看实时汇率怎么样的  
   
> 10:24:50  张泽雄-民生金服 项目总监  
   
如果汇率可以预测的话，炒外汇早赚翻了  
   
> 10:24:52  横烟秋-支付宝PM  
   
然后再清算  
   
> 10:24:58  横烟秋-支付宝PM  
   
一个本办法  
   
> 10:25:26  李伟锋  
   
信息多了 是不是可以玩外币[偷笑]  
   
> 10:25:29  横烟秋-支付宝PM  
   
就盯着系统里面的汇率在一个什么区间  
   
> 10:25:31  龚晓冬-银商账户-产品-上海  
   
嗯，不过也确实挺有效的~  
   
> 10:26:02  横烟秋-支付宝PM  
   
试算一下什么值 收益最大  
   
> 10:26:08  横烟秋-支付宝PM  
   
然后清算  
   
> 10:26:18  张泽雄-民生金服 项目总监  
   
这个我理解为在一定的波动范围内做业务，波动过大，就业务熔断了  
   
> 10:26:59  横烟秋-支付宝PM  
   
其实就是系统加人工经验判断  
   
> 10:27:10  张泽雄-民生金服 项目总监  
   
资金量大，在合适的报价汇兑，很合算的  
   
> 10:27:30  横烟秋-支付宝PM  
   
要引入模型也未免不可啊  
   
> 10:27:32  龚晓冬-银商账户-产品-上海  
   
嗯，秋秋老师其实这个做法是外汇交易员的做法  
   
> 10:27:40  Ben-PPTV境外产品负责人  
   
其实是两码事，一个是业务，一个是清算  
   
> 10:27:49  张泽雄-民生金服 项目总监  
   
哈哈，我觉得公司应该引入外汇高手  
   
> 10:27:57  横烟秋-支付宝PM  
   
不需要呢  
   
> 10:28:02  龚晓冬-银商账户-产品-上海  
   
我当时在银行是使用了多种预测模型辅助外汇交易员进行购汇  
   
> 10:28:19  横烟秋-支付宝PM  
   
又不是专门做换汇业务  
   
> 10:28:27  Ben-PPTV境外产品负责人  
   
专门去做外汇就是路走歪了  
   
> 10:28:34  龚晓冬-银商账户-产品-上海  
   
嗯，是的。确实意义不大。。。反正总要清算。。。  
   
> 10:28:35  横烟秋-支付宝PM  
   
对的  
   
> 10:28:40  Ben-PPTV境外产品负责人  
   
正道是开发双向的业务  
   
> 10:28:45  横烟秋-支付宝PM  
   
连连兄弟讲的对  
   
> 10:28:55  李伟锋  
   
外汇高手 工行是不是强硬些  
   
> 10:29:01  Ben-PPTV境外产品负责人  
   
对敲起来美滋滋  
   
> 10:29:26  张泽雄-民生金服 项目总监  
   
外汇高手很少，风险也比较大，比较靠谱的就是对冲  
   
> 10:29:27  横烟秋-支付宝PM  
   
对冲嘛  
   
> 10:29:44  Ben-PPTV境外产品负责人  
   
因为外汇变动都是一个大环境长期过程  
   
> 10:29:46  龚晓冬-银商账户-产品-上海  
   
对冲做得好能发家  
   
> 10:29:52  张泽雄-民生金服 项目总监  
   
有些对冲有隔夜利息  
   
> 10:30:05  大冷-银联国际支付产品  
   
清结算这点量对外汇市场来说太小了，这点钱炒外汇工资都不出来  
   
> 10:30:06  横烟秋-支付宝PM  
   
下着就好多创业公司在做这个业务  
   
> 10:30:32  Ben-PPTV境外产品负责人  
   
只有单向业务，业务每天发生，你需要每天清算，如果长期是在下行趋势  
   
> 10:30:54  Ben-PPTV境外产品负责人  
   
那就是一直亏，每天看汇率也没多大意义  
   
> 10:32:52  张泽雄-民生金服 项目总监  
   
哈哈，遇到脱欧似的黑天鹅事件，就亏惨了，所以对冲还是很有必要的  
   
> 13:17:01  万黎-恒丰银行-支付产品PM  
   
@秋秋-产品-上海?支付宝在跨境收单这块佣金是百二还是百三？  
   
> 13:20:03  程琳-杉德支付-PM  
   
@豆角茄子-产品经理-卡友支付?恭喜小主获得昨晚的手气最佳，稍后联系你分享事宜~  
   
> 13:20:12  程琳-杉德支付-PM  
   
![2017-07-06 13:20:12](http://static.cocolian.cn/img/20170706_132012.png) 
   
> 13:20:38  万黎-恒丰银行-支付产品PM  
   
从实际情况来看，主流币种跟人民币之间的汇率波动应该不可能超过佣金金额的  
   
> 13:21:13  豆角茄子-卡友支付-PM  
   
[OK]  
   
> 13:21:21  万黎-恒丰银行-支付产品PM  
   
何况长远来看汇率波动损益是一个平衡值  
   
> 13:26:10  万黎-恒丰银行-支付产品PM  
   
所以某某宝汇率损益这块问题应该不大，能这么理解吗？@秋秋-产品-上海?  
   
> 13:50:05  Tim-深圳百灵鸟-架构  
   
大家做充值卡的时候，卡号的生成规则是怎样的？如何保证卡号不重复  
   
> 13:58:29  Ben富友PM  
   
最后一位校验位，前面得按顺序加1  
   
> 14:00:33  田浩沛-银生宝电子支付公司技术总  
   
参考身份证的校验方法  
   
> 14:01:04  田浩沛-银生宝电子支付公司技术总  
   
不过量大的话，专门要做分布式ID机制，有时候是性能响应不过来，导致卡号重复  
   
> 14:01:26  田浩沛-银生宝电子支付公司技术总  
   
规则只能保证业务上不重复，这个是比较初级的办法  
   
> 14:02:37  Tim-深圳百灵鸟-架构  
   
恩  
   
> 14:03:43  武伟会-国家电网新能源-PM  
   
系统要有个卡数据生成管理啊，每次生成制卡数据，卡号都是被统一管理起来的。  
   
> 14:04:56  Tim-深圳百灵鸟-架构  
   
但是这样数据可能就特别多，  
   
> 14:05:35  KentZhu  
   
![2017-07-06 14:05:35](http://static.cocolian.cn/img/20170706_140535.png) 
   
> 14:05:42  KentZhu  
   
有人知道滴滴顺风车的这个认证是什么吗？  
   
> 14:10:56  淡风林-中移动杭州研发中心PM  
   
卡号加年份、地市、生产商、业务号识别，其他位随机生成，系统提前一天生成不重复的一批卡号  
   
> 14:11:19  淡风林-中移动杭州研发中心PM  
   
用累加的话会被人家猜出规律  
   
> 14:13:00  zhengfangxing  
   
几位卡号加年份时间地点  最后是加密机随机校验码  
   
> 14:18:36  叶林松-微众银行高级产品经理  
   
@KentZhu 微信支付的用户都是实名过的，通过微信支付认证的意思就是滴滴顺风车有这个用户实名信息啊  
   
> 14:19:31  叶林松-微众银行高级产品经理  
   
代表并不是一个实体追踪不到的用户  
   
> 14:20:13  KentZhu  
   
似乎不完全是这样  
   
> 14:25:05  叶林松-微众银行高级产品经理  
   
因为普通平台做用户的实名认证，一方面代价大，另一方面用户的体验繁琐。所以直接和腾讯合作，通过微信支付认证实名。可双向简便的获取并认证用户的实名信息  
   
> 14:27:58  KentZhu  
   
https://pay.weixin.qq.com/wiki/doc/api/tools/mch_pay.php?chapter=14_1  是这个接口  
   
> 14:28:07  KentZhu  
   
针对已实名认证的用户，微信支付可提供校验真实姓名一致性的可选功能。  
   
> 17:20:17  龚晓冬-银商账户-产品-上海  
   
账务系统-复式记账法总结 - 知乎专栏  
   
> 17:36:07  我  
   
@龚晓冬-银商账户-产品-上海  这是你的知乎账号吗？  
   
> 17:37:51  龚晓冬-银商账户-产品-上海  
   
之前笔记收藏的，不是我的知乎号啦  
   
> 17:41:20  dio  
   
哥们你上次的积分分享  我看了一下  好像没有说如果积分堆积 如何解决的问题  
   
> 17:46:49  大冷-银联国际支付产品  
   
解决积分堆积不是商务问题吗，不是产品问题吧  
   
> 17:48:31  dio  
   
这个是个整体问题   因为积分会堆积   堆积会让负债扩大   扩大会有风险    
   
> 17:49:05  Ben富友PM  
   
建立积分消费通道，定期通知用户消费积分  
   
> 17:49:06  龚晓冬-银商账户-产品-上海  
   
这个不是产品的问题，你有多少资金玩多大  
   
> 17:49:18  龚晓冬-银商账户-产品-上海  
   
每天限制积分发放数量  
   
> 17:49:28  Ben富友PM  
   
这个是业务问题，跟产品无关  
   
> 17:49:35  龚晓冬-银商账户-产品-上海  
   
个人每日获取积分数量  
   
> 17:50:33  Ben富友PM  
   
积分获取规则也属于业务问题  
   
> 17:56:18  dio  
   
现在都分不开啦   做的时候就要考虑到这个     
   
> 17:56:55  龚晓冬-银商账户-产品-上海  
   
这个本质不变，不过是你自己做业务规则而已  
   
> 18:02:30  dio  
   
这个应该是设计的时候就该想到问题吧     我的意思是整体的积分消耗   比如你系统累计发出了3亿个积分   结果因为某些特殊原因   突然在短期内所有用户将积分消耗殆尽   这怎么办   做不好公司会倒的  
   
> 18:04:43  Ben富友PM  
   
没钱就关闭交易呗  
   
> 18:04:54  Ben富友PM  
   
商品下架  
   
> 18:06:35  dio  
   
那朋友这么说 就是要一个积分体系的风控？  
   
> 18:08:23  Ben富友PM  
   
可有可无  
   
> 18:08:29  大冷-银联国际支付产品  
   
其实这个问题就像共享单车退押金，余额宝大量提现一样，个人感觉不是产品问题。量小是运营问题，如果量大，那是公关问题了。  
   
> 18:09:13  Ben富友PM  
   
没错  
   
> 18:15:05  Fiona-支付结算产品经理-优酷  
   
请教一下 快捷支付 和 银联无卡支付 这两种业务 有啥不一样么 为啥支付宝接北京银行快捷支付就可以 中金接北京银行就只能开银联无卡支付？  
   
> 18:19:41  李子枞-齐商银行 电子银行部   
   
银联无卡支付的定位是做一个类似支付宝和财付通的快捷支付聚合平台，这样银行可以从收单侧推银联体系的快捷支付业务  
   
> 18:21:10  大冷-银联国际支付产品  
   
银联无卡和支付宝快捷走的银行渠道可能不一样  
   
> 18:21:44  龚晓冬-银商账户-产品-上海  
   
不是的  
   
> 18:21:56  龚晓冬-银商账户-产品-上海  
   
无卡就是每次都需要输入卡信息  
   
> 18:22:14  龚晓冬-银商账户-产品-上海  
   
是银联支付网关  
   
> 18:22:23  Tim-魔线科技-产品总监  
   
无卡支付这个概念是怎么来的？  
   
> 18:22:33  Tim-魔线科技-产品总监  
   
快捷支付不是无卡支付么  
   
> 18:22:35  Tim-魔线科技-产品总监  
   
无卡  
   
> 18:22:44  大冷-银联国际支付产品  
   
其实不用  
   
> 18:22:53  龚晓冬-银商账户-产品-上海  
   
而快捷是绑定卡支付， 类似支付宝  
   
> 18:23:04  Tim-魔线科技-产品总监  
   
@龚晓冬-银商账户-产品-上海 你说的那个是银联在线  
   
> 18:23:26  龚晓冬-银商账户-产品-上海  
   
嗯。官方叫法无卡  
   
> 18:23:32  Wall-E 爱贝云计费产品主管  
   
无卡是类似认证支付？  
   
> 18:23:42  龚晓冬-银商账户-产品-上海  
   
只要卡信息就可支付  
   
> 18:24:05  龚晓冬-银商账户-产品-上海  
   
而且每次验证，不留存的  
   
> 18:24:11  Wall-E 爱贝云计费产品主管  
   
不签约是吧  
   
> 18:24:16  龚晓冬-银商账户-产品-上海  
   
对  
   
> 18:24:34  龚晓冬-银商账户-产品-上海  
   
银联后续有个新产品叫做无卡快捷  
   
> 18:24:48  龚晓冬-银商账户-产品-上海  
   
有兴趣的可以关注下  
   
> 18:25:11  龚晓冬-银商账户-产品-上海  
   
原来的快捷支付叫做无跳转支付  
   
> 18:25:17  Wall-E 爱贝云计费产品主管  
   
无卡和快捷认证要素都是一样吧  
   
> 18:25:25  龚晓冬-银商账户-产品-上海  
   
在open.unionpay.com都有介绍  
   
> 18:25:31  龚晓冬-银商账户-产品-上海  
   
@瓦力-爱贝-北京?一样  
   
> 18:25:35  Wall-E 爱贝云计费产品主管  
   
好的关注下  
   
> 18:25:46  大冷-银联国际支付产品  
   
狭义的无卡支付就是银联网关无卡产品，广义的无卡其实是无卡渠道的交易，银联包装了很多无卡渠道的产品  
   
> 18:26:05  龚晓冬-银商账户-产品-上海  
   
嗯，对的  
   
> 18:26:12  Wall-E 爱贝云计费产品主管  
   
那无卡和 快捷从产品逻辑上为啥是分开两个的呢，为啥要一个签约一个不签约呢  
   
> 18:27:21  龚晓冬-银商账户-产品-上海  
   
时代发展的产物  
   
> 18:27:34  龚晓冬-银商账户-产品-上海  
   
原先的无卡脱胎无网银  
   
> 18:27:53  龚晓冬-银商账户-产品-上海  
   
所以无卡渠道往往支持银行多于快捷  
   
> 18:29:12  Wall-E 爱贝云计费产品主管  
   
soga  
   
> 18:31:42  Fiona-支付结算产品经理-优酷  
   
那验卡的这个流程 理论上讲 接无卡还是接快捷 完全取决于提供验卡服务的第三方？  
   
> 18:40:33  Wall-E 爱贝云计费产品主管  
   
取决于您想不想一次绑定吧，一次绑定的话就接快捷的，不用每次输入四要素  
   
> 18:40:46  张泽雄-民生金服 项目总监  
   
无卡的范围很大，二维码也可以是无卡，属于认证支付，快捷属于协议类，认证只在签约时  
   
> 18:42:28  张泽雄-民生金服 项目总监  
   
快捷算是无卡中的协议类。  
   
> 18:43:20  张泽雄-民生金服 项目总监  
   
群里有51信用卡的朋友吗？  
   
> 18:43:59  thq  
   
有啊  
   
> 18:44:04  紫紫-随手记支付产品经理  
   
有一个  
   
> 18:44:33  黄波-招行信用卡-USTCS09  
   
抓住一个51的[呲牙]   
   
> 18:44:52  thq  
   
[难过]我没套现  
   
> 18:45:00  thq  
   
不要抓我  
   
> 18:45:14  Alive-借贷宝-PL  
   
  
   
> 18:45:27  李钦珑-深圳优讯-PM  
   
[尴尬][尴尬]  
   
> 18:46:08  龚晓冬-银商账户-产品-上海  
   
[擦汗]  
   
> 18:46:26  51信用卡支付清算产品  
   
其实有两个，新人入群，大家多指教[呲牙]  
   
> 18:46:58  张泽雄-民生金服 项目总监  
   
单聊，咨询点事，我加你  
   
> 18:46:59  dio  
   
套现会被抓？  
   
> 18:49:57  Alive-借贷宝-PL  
   
我之前也是51信用卡的  
   
> 18:50:53  黄波-招行信用卡-USTCS09  
   
51人气这么旺 我以前用51薅过羊毛 几块几块的还款金  
   
> 18:52:22  Alive-借贷宝-PL  
   
666  
   
> 18:56:15  田浩沛-银生宝电子支付公司技术总  
   
套现？  
   
> 19:04:21  程琳-杉德支付-PM  
   
今天请到一位银行的朋友 @支付er-农行-技术-北京?  童鞋给大家做分享。主题是“快捷双活架构”，开始时间为19:30；欢迎欢迎[鼓掌][鼓掌][鼓掌]！（注： 1.嘉宾分享期间其他人不要发言打断嘉宾分享。2.分享完成后请大家积极补充和提问；3.烦请领取红包签到，谢谢！）  
   
> 19:04:41  龚晓冬-银商账户-产品-上海  
   
[强][强]  
   
> 19:05:04  程琳-杉德支付-PM  
   
微信红包  
   
> 19:05:31  build-去哪儿-QA  
   
[强]  
   
> 19:05:44  文奇  
   
双活 [强]  
   
> 19:05:48  许静洋-同程金服产品  
   
[强]  
   
> 19:06:17  封国辉-广发银行-系统设计  
   
[强][强]  
   
> 19:06:18  freewolf-天津金融资产交易所技术  
   
双活 [强]  
   
> 19:06:24  周红仁-去哪儿支付  
   
[强]  
   
> 19:06:36  邱显-融数金服-支付风控  
   
[强]  
   
> 19:06:53  肖勇  
   
[强]  
   
> 19:07:09  张泽雄-民生金服 项目总监  
   
[强]  
   
> 19:07:26  落雪飞花-农信互联-开发经理  
   
[强]  
   
> 19:08:06  武伟会-国家电网新能源-PM  
   
[强]  
   
> 19:08:53  superjj-微众银行PM  
   
[强]  
   
> 19:09:00  都沙沙-点融网-支付PM  
   
赞  
   
> 19:09:15  萌小喵-爱贝计费高级PM  
   
[玫瑰]  
   
> 19:09:29  程文东-拉卡拉PL  
   
[鼓掌]  
   
> 19:10:16  徐萍 途牛产品总监  
   
[玫瑰]  
   
> 19:11:02  李伟锋  
   
双活[强]  
   
> 19:11:04  张嘉杰  
   
[强]  
   
> 19:11:07  Alive-借贷宝-PL  
   
  
   
> 19:11:14  楷，事务开发，腾讯，深圳  
   
[强]  
   
> 19:11:15  紫紫-随手记支付产品经理  
   
[强][强][强]  
   
> 19:11:36  刘杰-联通支付架构总监  
   
发个广告，有想从回二线武汉的同学吗，我们这里缺一个支付清结算方面的项目经理或者技术经理。过来带二代支付，同城等项目。有意私聊。  
   
> 19:11:43  上海块钱业务分析师  
   
[强]  
   
> 19:12:32  王qz-玖富支付  
   
赞  
   
> 19:15:23  吕剑辉-杉德-PL  
   
[强]  
   
> 19:17:21  花生-新网银行PM  
   
@众邦银行--刘杰 红包开路效果更棒[奸笑]  
   
> 19:18:55  刘杰-联通支付架构总监  
   
微信红包  
   
> 19:19:57  程恩惠  
   
赞  
   
> 19:20:19  我  
   
@众邦银行--刘杰  大家开玩笑了， 招聘需求群里说一句话就行了。这里主要是技术交流群，非招聘群。   
   
> 19:20:40  刘杰-联通支付架构总监  
   
应该的[胜利]  
   
> 19:20:48  我  
   
晚上马上有分享了，不喧宾夺主了。   
   
> 19:24:04  沈一点-恒生电子-工程师  
   
同城还有市场啊？  
   
> 19:24:44  沈一点-恒生电子-工程师  
   
二代上线后 应该不怎么多了b  
   
> 19:25:06  杨大兴央金所的资深产品经理  
   
期待今晚的分享  
   
> 19:25:28  xiaOv-兴业银行  
   
人行要求的吧  
   
> 19:26:30  横烟秋-支付宝PM  
   
[强]  
   
> 19:26:37  Alive-借贷宝-PL  
   
请开始你的表演  @支付er-农行-技术-北京  
   
> 19:26:44  Alive-借贷宝-PL  
   
  
   
> 19:27:14  人生几何-农行软开 快捷支付开发  
   
Ok  
   
> 19:27:27  人生几何-农行软开 快捷支付开发  
   
大家好，今天我想跟大家分享的是主要是银行的快捷架构，银行快捷业务，差错，对账的流程。 前面有很多大牛，讲的很好，我也把我仅有的点干货跟大家分享下。希望对大家有所启发  
   
> 19:27:41  人生几何-农行软开 快捷支付开发  
   
dbsuperman:  
   
> 19:27:48  人生几何-农行软开 快捷支付开发  
   
由于现在单位管理的原因，我不能拿原图出来，图都是我重新简化的，原创，而且讲解主要是讲原理，不影响大家理解。先放上pdf,后面也会放截图。  
   
> 19:27:59  人生几何-农行软开 快捷支付开发  
   
![2017-07-06 19:27:59](http://static.cocolian.cn/img/20170706_192759.png) 
   
> 19:28:24  人生几何-农行软开 快捷支付开发  
   
随着pc机器，云计算的发展，银行业也开始把大量非关键性计算，大量历史数据，下移到开放平台，如明细查询，历史查询，报表，等非关键实时性的功能下移到开放端，形成了这样一个大外围小核心的架构。快捷支付也服从于这一架构，关键的账务，转账处理在主机上，开放上做签名验签，校验，记流水，出对账单等功能。  
   
> 19:28:41  人生几何-农行软开 快捷支付开发  
   
![2017-07-06 19:28:41](http://static.cocolian.cn/img/20170706_192841.png) 
   
> 19:29:04  人生几何-农行软开 快捷支付开发  
   
下面先说几项关键技术，帮非技术的人理解原理，最后说一下双活架构是怎么实现的。  
   
> 19:29:30  人生几何-农行软开 快捷支付开发  
   
![2017-07-06 19:29:30](http://static.cocolian.cn/img/20170706_192930.png) 
   
> 19:29:56  人生几何-农行软开 快捷支付开发  
   
主库在运行时会不断产生redo log，这些日志会通过可靠网络传送到备库进行重做。这其实也是灾备的原理，主机的灾备，也是同样的原理。但是主库与备库如果相隔千里，形成异地灾备，主备之间就会存在一个时间差数据变化量，这个变化量就要采用联机补偿机制。  
   
> 19:30:37  人生几何-农行软开 快捷支付开发  
   
![2017-07-06 19:30:37](http://static.cocolian.cn/img/20170706_193037.png) 
   
> 19:31:08  人生几何-农行软开 快捷支付开发  
   
跟PC集群一样，数据库也进行了集群化的处理  
   
> 19:31:20  人生几何-农行软开 快捷支付开发  
   
![2017-07-06 19:31:20](http://static.cocolian.cn/img/20170706_193120.png) 
   
> 19:32:10  人生几何-农行软开 快捷支付开发  
   
快捷业务的特点就是数据量流水大，高并发。分库分表是必然的选择  
   
> 19:32:29  人生几何-农行软开 快捷支付开发  
   
![2017-07-06 19:32:29](http://static.cocolian.cn/img/20170706_193229.png) 
   
> 19:33:08  人生几何-农行软开 快捷支付开发  
   
这就是快捷的一个双活架构图，我先说明一下数据的请求处理流程  
   
> 19:33:17  人生几何-农行软开 快捷支付开发  
   
1.用户访第三方支付机构做支付。  
   
> 19:33:26  人生几何-农行软开 快捷支付开发  
   
2第三方支付机构把请求通过专线 按比例发给主中心和备中心。  
   
> 19:33:37  朱黎明 海尔快捷通   
   
[强]  
   
> 19:33:39  人生几何-农行软开 快捷支付开发  
   
图中，标为2的专线。  
   
> 19:33:55  人生几何-农行软开 快捷支付开发  
   
3.F5负载均衡跟据报文中的卡号按预先的规则，分别将报文发到主备中心的服务器上。  
   
> 19:34:28  人生几何-农行软开 快捷支付开发  
   
在这里，存在 主中心与备中心 转发的情况  
   
> 19:34:39  人生几何-农行软开 快捷支付开发  
   
4.服务器处理完成后原路返回。  
   
> 19:36:00  人生几何-农行软开 快捷支付开发  
   
回到开头说的，关键技术，分库分表，我们跟据卡号规则，分了100张表分布在四个RAC里面，服务器跟据我们预定的规则根据卡号，访问不同的RAC  
   
> 19:36:25  人生几何-农行软开 快捷支付开发  
   
再说一下，双活灾备的情况  
   
> 19:36:33  人生几何-农行软开 快捷支付开发  
   
举一个列子，如果主中心1库挂了，就可以启用备中心的库红1，F5将请求发往灾备中心，其它RAC同理。  
   
> 19:37:04  人生几何-农行软开 快捷支付开发  
   
![2017-07-06 19:37:04](http://static.cocolian.cn/img/20170706_193704.png) 
   
> 19:37:25  人生几何-农行软开 快捷支付开发  
   
结合这张图就能更清楚的理解双活的架构用意。 主中心有1，2，3库（黑字体），同城有相对应的备库（蓝字体），备主心也有相对应的跨中心备库（红字体），主库和备库之间都是通过ADG技术进行备份，主库可读写，备库只读。  
   
> 19:37:47  人生几何-农行软开 快捷支付开发  
   
我们在备库出每天跑对账单  
   
> 19:38:02  人生几何-农行软开 快捷支付开发  
   
从这个图中，我们可以看到双保险的机制，同城备库，防止主数据库挂掉，跨中心备品库，能防止地震等特大灾害。这张图也体现了两地三中心灾备的思路了。实际上我们只实现了两地两中心，同中心备库是在一个中心里（物理地点）。  
   
> 19:38:29  人生几何-农行软开 快捷支付开发  
   
![2017-07-06 19:38:29](http://static.cocolian.cn/img/20170706_193829.png) 
   
> 19:39:10  人生几何-农行软开 快捷支付开发  
   
以前有人讲过，差错处理的过程，我这里就跟大家讲讲，为什么 差错会产生  
   
> 19:39:20  人生几何-农行软开 快捷支付开发  
   
咱们又回到最初的大外围小核心的架构上，快捷支付把大量的计算工作放在开放上，如鉴权，记流水，计算手绪费等，到主机上只做两件事，卡转账，记账。  
   
> 19:39:34  人生几何-农行软开 快捷支付开发  
   
由于在高并发的情况下，主机处理不过来或是响应变慢，指定时间内无回应，为了提高响应效率，利用柔性事务的原则，开放端首先返回成功状态给第三方支付机构，开放端记一个交易状态不确定。随后由开放端去主机上查证交易结果状成。主机端要是成功，无问题； 主机端要是失败，开放端返回成功，则形成了差错。这就需要线下由银行内营人员手工处理。  
   
> 19:40:05  人生几何-农行软开 快捷支付开发  
   
这就是差错产生的根本原因  
   
> 19:40:57  人生几何-农行软开 快捷支付开发  
   
![2017-07-06 19:40:57](http://static.cocolian.cn/img/20170706_194057.png) 
   
> 19:41:17  人生几何-农行软开 快捷支付开发  
   
在X银行，快捷支付不存在他行的卡，而一般第三方支付机都在X银行开设了备付金账户。快捷支付的实质，就是将客户的钱转到第三方支付机构的备付金账户。因此白天客户支付，将客户的钱转入一个过渡的内部中间户头，日终结束后，再根据白天主机记账结果，将钱从中间户头打入支付机构备付金账户。这就是资金清算的处理，比较简单。  
   
> 19:41:41  人生几何-农行软开 快捷支付开发  
   
至于对账，银行只出对账单不对账，由第三方支付机构，根据银行出的对账单与划入的资金，与第三方机构自身的流水进行勾兑。如果发生问题，银行配合第三方支付机构进行排查。  
   
> 19:41:56  人生几何-农行软开 快捷支付开发  
   
![2017-07-06 19:41:56](http://static.cocolian.cn/img/20170706_194156.png) 
   
> 19:43:00  人生几何-农行软开 快捷支付开发  
   
在银行这里看，快捷90%的业务量都在，支付宝与财付通，而且出于利润来说，银行欢迎双十一，不喜欢红包雨  
   
> 19:43:26  人生几何-农行软开 快捷支付开发  
   
![2017-07-06 19:43:26](http://static.cocolian.cn/img/20170706_194326.png) 
   
> 19:43:57  李钦珑-深圳优讯-PM  
   
谢谢。  
   
> 19:44:10  人生几何-农行软开 快捷支付开发  
   
今天的分享就是这么多，不知道我讲明白没有，偏技术。  
   
> 19:44:25  横烟秋-支付宝PM  
   
非常精彩[握手]  
   
> 19:44:26  mfb-中科软支付产品负责人  
   
[强][强]  
   
> 19:44:34  程超  
   
@支付er-农行-技术-北京?威武  
   
> 19:44:49  龚晓冬-银商账户-产品-上海  
   
讲的真好[强][强]  
   
> 19:45:02  李钦珑-深圳优讯-PM  
   
@支付er-农行-技术-北京 冒昧问下，你们做到9kTPS整个集群数量大概多少？  
   
> 19:45:06  程文东-拉卡拉PL  
   
谢谢分享  
   
> 19:45:15  吴浩  
   
谢谢分享  
   
> 19:45:28  邱显-融数金服-支付风控  
   
谢谢分享  
   
> 19:45:31  都沙沙-点融网-支付PM  
   
谢谢分享  
   
> 19:46:09  萌小喵-爱贝计费高级PM  
   
谢谢分享  
   
> 19:46:18  朱黎明 海尔快捷通   
   
主备之间的数据同步是什么技术处理的?  
   
> 19:46:25  lisp 财付通结算财务  
   
银行快捷收费都是按交易金额算的么？不是按交易笔数？  
   
> 19:46:33  WillYang-嘉联支付-架构师  
   
谢谢分享  
   
> 19:46:57  Peter-找钢网-PM  
   
谢谢分享[玫瑰][强]  
   
> 19:47:11  周红仁-去哪儿支付  
   
谢谢分享  
   
> 19:47:21  人生几何-农行软开 快捷支付开发  
   
你们做到9kTPS整个集群数量大概多少？  答：主中心３０台，备中心３０台，共６０台  
   
> 19:47:34  zhengfangxing  
   
[强]  
   
> 19:47:39  朱黎明 海尔快捷通   
   
备中心也处理请求  
   
> 19:47:47  人生几何-农行软开 快捷支付开发  
   
银行快捷收费都是按交易金额算的么？不是按交易笔数？　答：打包按总金额收  
   
> 19:47:55  朱黎明 海尔快捷通   
   
数据双向同步?  
   
> 19:48:12  在路上-杉德支付架构  
   
谢谢分享  
   
> 19:48:27  人生几何-农行软开 快捷支付开发  
   
主备之间的数据同步是什么技术处理的?　答：oracle ADG 百度吧  
   
> 19:48:33  黄波-招行信用卡-USTCS09  
   
是双十一tps最高吗[呲牙]  
   
> 19:49:07  lisp 财付通结算财务  
   
一般是春节吧，小额红包来的应该最猛  
   
> 19:49:20  人生几何-农行软开 快捷支付开发  
   
春节  
   
> 19:49:30  人生几何-农行软开 快捷支付开发  
   
比较不爽，过年。。。  
   
> 19:50:26  黄波-招行信用卡-USTCS09  
   
最高多少tps 为啥要设计到9k这么高 比峰值翻倍？  
   
> 19:50:59  朱黎明 海尔快捷通   
   
备中心也处理用户请求 数据双向同步?  
   
> 19:52:02  人生几何-农行软开 快捷支付开发  
   
最高多少tps 为啥要设计到9k这么高 比峰值翻倍？答：不是设计成那么高，是业务要求，和阿里压测的时候，到了1.2W  
   
> 19:52:31  Alive-借贷宝-PL  
   
你们做到9kTPS整个集群数量大概多少？ 单台的QPS大概是多少  
   
> 19:52:33  sunshine-苏宁金融  
   
那个分发用到什么算法吗，取模吗  
   
> 19:52:34  黄波-招行信用卡-USTCS09  
   
[呲牙][强]  
   
> 19:53:28  人生几何-农行软开 快捷支付开发  
   
备中心也处理用户请求 数据双向同步? 答：单向，你仔细看我的图，备中心4号库是主库  
   
> 19:53:50  朱黎明 海尔快捷通   
   
喔喔  
   
> 19:54:55  人生几何-农行软开 快捷支付开发  
   
你们做到9kTPS整个集群数量大概多少？ 单台的QPS大概是多少 答：60台，每台300联接数  
   
> 19:55:17  上海块钱业务分析师  
   
备中心是仅仅备份数据比他对账单，还是也要处理支付请求？  
   
> 19:55:56  人生几何-农行软开 快捷支付开发  
   
那个分发用到什么算法吗，取模吗 答：这个算法我就不细说了，有卡号了分表就很容易了  
   
> 19:56:26  人生几何-农行软开 快捷支付开发  
   
备中心是仅仅备份数据比他对账单，还是也要处理支付请求？　答：备中心设有一个主库，分１／４的业务  
   
> 19:57:14  上海块钱业务分析师  
   
明白了多谢  
   
> 19:58:52  胡晓蕾中旅银行 项目总监  
   
其实主备都部署在农行数据中心是吧？  
   
> 19:58:54  徐萍 途牛产品总监  
   
记录的数据就是流水数据和订单数据在银行侧有交易凭证数据吗  
   
> 19:59:53  胡晓蕾中旅银行 项目总监  
   
分库分表用的是什么技术和框架？  
   
> 20:00:05  人生几何-农行软开 快捷支付开发  
   
不明白，什么要叫交易凭证数据？  
   
> 20:00:35  人生几何-农行软开 快捷支付开发  
   
分库分表用的是什么技术和框架？　答：自主设计开发  
   
> 20:00:45  朱黎明 海尔快捷通   
   
明白了谢谢分享[玫瑰][强]  
   
> 20:01:13  人生几何-农行软开 快捷支付开发  
   
原理我已经讲了，开发实现就有方向了  
   
> 20:01:44  胡晓蕾中旅银行 项目总监  
   
分库分表实现了2阶段提交吗？  
   
> 20:01:50  mfb-中科软支付产品负责人  
   
“自主设计研发”里面一定有很多故事[可怜]  
   
> 20:02:13  李钦珑-深圳优讯-PM  
   
应该有很多故事吧  
   
> 20:02:21  人生几何-农行软开 快捷支付开发  
   
懂行。。  
   
> 20:02:22  人生几何-农行软开 快捷支付开发  
   
哈哈  
   
> 20:02:53  李钦珑-深圳优讯-PM  
   
架构、优化、性能、部署、运维，估计每一个环节都有故事。。。  
   
> 20:03:42  朱黎明 海尔快捷通   
   
你可以分享一下[坏笑]  
   
> 20:04:05  mfb-中科软支付产品负责人  
   
我们这里有酒，说出你的故事  
   
> 20:04:23  胡晓蕾中旅银行 项目总监  
   
农行改过阿里cobar client   
   
> 20:04:34  胡晓蕾中旅银行 项目总监  
   
但是没有解决二阶段提交问题  
   
> 20:04:38  肖勇  
   
这个故事一定是最精彩的，[呲牙]  
   
> 20:04:47  胡晓蕾中旅银行 项目总监  
   
当然这是13年的事情  
   
> 20:04:55  胡晓蕾中旅银行 项目总监  
   
不知道现在如何  
   
> 20:06:02  胡晓蕾中旅银行 项目总监  
   
四套oracle 集群，软硬件成本不低啊  
   
> 20:06:50  人生几何-农行软开 快捷支付开发  
   
现在日均 400亿  
   
> 20:06:55  人生几何-农行软开 快捷支付开发  
   
你说能收多少钱  
   
> 20:07:43  人生几何-农行软开 快捷支付开发  
   
大家没有问题，我就闪了。。  
   
> 20:07:56  韩财光  
   
请教个问题 不管怎么备份复制 主中心宕机的瞬间 一定有一部分数据来不及完全同步到副中心 不知道对于这部分差异数据怎么识别和处理的？ 不只是简单的把请求转发到副中心吧？  
   
> 20:08:01  人生几何-农行软开 快捷支付开发  
   
希望给大家启发。。  
   
> 20:08:17  MX农行  
   
再仔细看看  
   
> 20:08:54  MX农行  
   
谢谢分享  
   
> 20:09:33  yuxiang-招行杭州分行技术主管  
   
[强][强]  
   
> 20:09:51  胡晓蕾中旅银行 项目总监  
   
@韩财光-东软(前)-开发-广州?看adg 配置，如果配置成最高级同步模式，理论上不会丢失数据。  
   
> 20:15:22  韩财光  
   
@一博-中旅-项目总监-北京?假设两地延时有100ms 在高峰期这100ms期间会有多少数据被更新 理论上不可能完全一致  
   
> 20:15:39  人生几何-农行软开 快捷支付开发  
   
请教个问题 不管怎么备份复制 主中心宕机的瞬间 一定有一部分数据来不及完全同步到副中心 不知道对于这部分差异数据怎么识别和处理的？ 不只是简单的把请求转发到副中心吧？答：这个问题问的非常好，主机那边，有个技术叫联机补偿，就是会录几分钟的请求报文，切换时先放缺失的报文，再接收请正常计求，一般这个差很小。。  
   
> 20:16:29  胡晓蕾中旅银行 项目总监  
   
如果延时很长，这种情况性能会很差。根本无法commit 成功，会回滚，交易失败。  
   
> 20:20:09  韩财光  
   
主中心在任何时候都预先保留几分钟的请求数据 切换时在备中心放最后这几分钟的请求 相当于在被中心重复执行一遍 这个意思？  
   
> 20:21:45  人生几何-农行软开 快捷支付开发  
   
是的，原理是这样的，我没具体实施过，  
   
> 20:22:30  人生几何-农行软开 快捷支付开发  
   
不会重复执行  
   
> 20:22:44  人生几何-农行软开 快捷支付开发  
   
只执行缺失的  
   
> 20:25:05  韩财光  
   
是的 对照备中心的最近更新时间 当然不能重复执行 要做到完美难度应该很大  
   
> 20:27:34  韩财光  
   
假设并发一万 延时100ms 那也会有至少上千个请求会产生差异  
   
> 20:40:04  少帅-快捷通支付产品  
   
谢谢分享  
   
> 20:44:43  yinch-滴滴金融-研发  
   
感谢分享  
   
> 20:50:28  黄文浩-天音通信-产品-北京  
   
金石系统 | 多中心高可用的交易系统  
   
> 20:51:44  李钦珑-深圳优讯-PM  
   
[强]  
   
> 20:52:14  uniker  
   
感谢分享  
   
> 20:52:17  黄文浩-天音通信-产品-北京  
   
这个问题技术分享过  记不清了   大家自己看文章找灵感吧  
   
> 20:52:18  黄文浩-天音通信-产品-北京  
   
![2017-07-06 20:52:18](http://static.cocolian.cn/img/20170706_205218.png) 
   
> 20:55:31  韩财光  
   
@文浩-京东-产品?这里有分享过吗？ 我一直关注 没注意到 另外京东这个方案有时间介绍点细节吗？ 文章写的有些泛泛[呲牙]  
   
> 20:58:48  黄文浩-天音通信-产品-北京  
   
这文章我也就能理解个2,3成  
   
> 21:07:40  韩财光  
   
几个人半年时间 应该是使用市面上的东西搞的吧 自己开发的话充分测试时间不够 个人见解  
   
> 22:07:25  大状-上海迅联数据司  
   
谁知道现在芯片卡交易的签购单，芯片卡信息要打哪些信息？  
   
> 22:08:06  大状-上海迅联数据司  
   
除了AID和arqc之外的其他信息要打印到签购单上么  
   
> 22:15:33  蔡云龙 开联通支付  
   
谢谢分享  
   
