---
layout:     source 
title:      "2017-05-25-WeChat"
date:       2017-05-25 12:00:00
author:     "PaymentGroup"
tag:		  [chat]
header-img: "img/post-bg-wechat.jpg"
---
> 00:33:55  李伟锋  
   
@索马里-连连支付-分控-杭州   支付宝三级也是通过各种渠道认证，五个及以上合法安全的外部渠道、或面签对客户身份基本信息进行多重交叉验证  
   
> 00:33:56  李伟锋  
   
![2017-05-25 00:33:56](http://static.cocolian.cn/img/20170525_003356.png) 
   
> 08:02:47  龚正-滴滴-支付金融  
   
![2017-05-25 08:02:47](http://static.cocolian.cn/img/20170525_080247.png) 
   
> 08:08:53  韩财光  
   
今日分享预告 主讲嘉宾:@雪鹰-快捷通-架构?  主题内容:渠道管理和渠道接入  
   
> 08:09:16  潘儒刚-连连支付PM  
   
[强]  
   
> 08:10:49  我  
   
[强]，昨天晚上还没签到同学还请帮忙爬个楼，点击下签到红包签个到，以便同学们安排工作，谢谢，??  
   
> 08:11:11  我  
   
还有三个签到的名额。  
   
> 08:11:45  韩财光  
   
签到方式调整: 确定以抢红包作为唯一的签到方式(取消打[OK]方式) 手气最好的同学需要在下周同一时间做分享. 已做过分享的同学可以不用抢. 抢不到或者迟到的同学不要以其他方式签到了(包括打[OK])  
   
> 08:13:03  sunshine-苏宁金融  
   
在哪里抢  
   
> 08:15:49  我  
   
![2017-05-25 08:15:49](http://static.cocolian.cn/img/20170525_081549.png) 
   
> 08:15:53  我  
   
往上爬楼，在昨天这个位置上。   
   
> 08:17:14  杨继军-联想电商平台架构师  
   
已爬  
   
> 08:18:00  潘儒刚-连连支付PM  
   
红包没有了  
   
> 08:19:05  我  
   
谢谢大家。签到红包已经处理完了。   
   
> 08:19:08  韩财光  
   
![2017-05-25 08:19:08](http://static.cocolian.cn/img/20170525_081908.png) 
   
> 08:20:32  韩财光  
   
祝贺sinory同学拔得头筹[微笑]  
   
> 08:20:37  我  
   
感谢大家支持，昨天手气最佳是@sinory ，有赞的专家。   
   
> 08:21:38  李兴-有赞技术专家  
   
[奸笑]  
   
> 08:21:52  盆栽是个杀手-有赞-清结算  
   
恭喜@李兴-有赞-研发?  
   
> 08:22:09  潘儒刚-连连支付PM  
   
恭喜  
   
> 08:22:30  我  
   
这可不仅仅是众望所归啊， [呲牙]  
   
> 08:22:36  文奇  
   
恭喜  
   
> 08:22:48  韩财光  
   
@李兴-有赞-研发?下周三 不见不散[呲牙]  
   
> 08:23:06  李兴-有赞技术专家  
   
人生第一次运气这么好  
   
> 08:23:28  Conny??  
   
[偷笑]  
   
> 08:24:02  沈一点-恒生电子-工程师  
   
期待大神  
   
> 08:24:05  李兴-有赞技术专家  
   
@韩财光-东软(前)-开发-广州?好的  
   
> 08:24:22  李钦珑-深圳优讯-PM  
   
恭喜[鼓掌]  
   
> 08:26:02  韩财光  
   
@李兴-有赞-研发?点赞有赞[握手]  
   
> 08:30:30  吴浩  
   
期待  
   
> 08:39:57  Chess-技术总监 首付游   
   
请教个问题，一个商品库存只剩一个，怎么避免高并发的情况下同时有多个请求但只会有一个人买到这个商品？  
   
> 08:40:33  维森陌-拉莫帅-帅德-布耀布耀德  
   
商品锁单机制  
   
> 08:41:32  Chess-技术总监 首付游   
   
用什么锁？事务么？  
   
> 08:42:58  韩财光  
   
放共享内存  
   
> 08:48:48  张泽雄-民生金服 项目总监  
   
不应该是只有一个人能买到么？  
   
> 08:51:04  郭芬-中央结算公司  
   
对啊  
   
> 08:51:11  郭芬-中央结算公司  
   
不就应该一个人买到么  
   
> 08:53:12  维森陌-拉莫帅-帅德-布耀布耀德  
   
应对秒杀场景，在下单的是后锁单扣库存  
   
> 08:53:29  维森陌-拉莫帅-帅德-布耀布耀德  
   
不能以支付成功后扣库存  
   
> 08:53:55  维森陌-拉莫帅-帅德-布耀布耀德  
   
业务逻辑是这样，技术层面[撇嘴][撇嘴][撇嘴]  
   
> 08:56:05  吴浩  
   
防超卖了  
   
> 08:57:22  张泽雄-民生金服 项目总监  
   
这个方案还是比较多的，放在数据库中就用锁机制，防止库存为负，放在内存中用FIFO也是可以的，队列空了，就秒杀结束了  
   
> 09:00:41  袁军-架构师-快捷通  
   
数据库的话，带条件 库存数-1>0  ？  
   
> 09:00:52  Chess-技术总监 首付游   
   
是应该只有一个人能买到  
   
> 09:01:20  张泽雄-民生金服 项目总监  
   
库存和账户原理上是类似的，保证余额不能为负就可以  
   
> 09:02:25  张泽雄-民生金服 项目总监  
   
带条件那个是乐观锁了  
   
> 09:02:55  袁军-架构师-快捷通  
   
还是有不一样的，账户的保持前后记录余额一致性，库存不用吧  
   
> 09:03:49  张泽雄-民生金服 项目总监  
   
那个是记账要求，不是余额要求了  
   
> 09:03:55  袁军-架构师-快捷通  
   
库存只要不减到零以下就行了，没有余额变动明细这种东西。  
   
> 09:04:16  袁军-架构师-快捷通  
   
业务上不同，处理上也会不同的  
   
> 09:05:15  袁军-架构师-快捷通  
   
技术方案总是和业务相关的。[微笑]  
   
> 09:05:24  张泽雄-民生金服 项目总监  
   
这个也不一定，你去看看基础会计，其实库存也是一项账务处理  
   
> 09:07:51  袁军-架构师-快捷通  
   
这个是的，区别在于一般不去关注库存变动明细，一定要我也认为那就一样。  
   
> 09:11:02  杨继军-联想电商平台架构师  
   
这个要有几层限流，预估库存，根据库存数放行，一层层拦截流量，光靠数据库锁保证，肯定挂啦，增加验证码，延迟用户请求，很多  
   
> 09:13:43  杨继军-联想电商平台架构师  
   
利用redis 或者其他原子操作保证，  
   
> 09:18:17  椰子-杭州有云科技PM  
   
想请教一下使用支付产品的商户后台是如何设计对账系统的呢，因为现在一涉及到隔日退款，就会出现帐不平的现象  
   
> 09:18:57  邹成凯-联通支付  
   
退款也要对账  
   
> 09:19:33  杨继军-联想电商平台架构师  
   
支付系统的对账处理与设计  
   
> 09:29:45  袁军-架构师-快捷通  
   
高并发场景下的高可用，希望有大神多多分享下[微笑]  
   
> 09:38:49  韩财光  
   
@架构师-联想-杨-北京?验证码防机器人 共享内存做01初步过滤 数据库事务做最后保护  
   
> 09:45:23  杨继军-联想电商平台架构师  
   
嗯，数据库可以当做最终一致性保证，秒杀服务要根据秒杀规则提前load 活动库存或者活动库存主动推送，做第一层保证，这样大部分流量都拦截住了，到了下单环节再用库存微服务自己的的原子操作卡，多重保证，  
   
> 09:49:28  韩财光  
   
容忍度高控制好的话 合并事务操作可以大幅减轻数据库压力  
   
> 09:51:45  张泽雄-民生金服 项目总监  
   
你说的这个属于渠道对账，理论上说，渠道应给的不仅是交易对账单，也就是流水，还有结算对账单，也就是结算资金，有的是分开发的，有的是合并发的，对账的目的主要是为了最终的钱一致。 所以，支付公司对账都是按通道也就是金融机构进行分别对账，这里面要确认一是哪些交易参与对账，只有参与对账的交易对不上，才需要进入差错，隔日退款账不平的原因是因为如果当日的可以走撤销，隔日了交易已经清算了。所以对于退款的对账，要与渠道确认，此笔账应记在哪期中对。  
   
> 09:52:49  张泽雄-民生金服 项目总监  
   
@徐椰慧（椰子）-有云科技-杭州   
   
> 09:54:34  张泽雄-民生金服 项目总监  
   
我这边的流程不是交易记录直接参与对账，而是会先走定时清分，与通道对账的交易都是已经清分完的。  
   
> 09:54:41  杨继军-联想电商平台架构师  
   
@韩财光-东软(前)-开发-广州? 这个分享下  
   
> 09:55:50  椰子-杭州有云科技PM  
   
退款的对账   分今日和隔日   这个在设计的时候有点头疼  
   
> 09:56:24  张泽雄-民生金服 项目总监  
   
今日的叫撤销就分开了  
   
> 09:56:40  张泽雄-民生金服 项目总监  
   
隔日才叫退货  
   
> 10:03:56  椰子-杭州有云科技PM  
   
嗯嗯  
   
> 10:06:45  韩财光  
   
@架构师-联想-杨-北京?只是个想法 还没经过实践考验 类似批量处理 合并以减少数据库的操作 比如只改内存 然后定期与数据库同步 或者写日志后台触发存储过程合并更新 还涉及到数据库的结构特性等条件约束 比如update比insert的成本要高的多 怎么规避或替代 都只是些想法  
   
> 10:08:20  田家宾-有赞-java开发  
   
写内存  万一宕机了   数据会不会就都没了  
   
> 10:09:34  李行-途牛支付中心研发总监  
   
@张泽雄-民生金服-研发-北京?当日的全额退款才能走撤销吧，部分退也能走撤销接口？  
   
> 10:10:33  韩财光  
   
是啊 内存不可靠 但概率有多大 说到底还是看你容忍度  
   
> 10:11:11  张泽雄-民生金服 项目总监  
   
撤销一般都是全额，  
   
> 10:12:20  田家宾-有赞-java开发  
   
做支付  一次这样的事故就差不多了   。。。  
   
> 10:14:17  韩财光  
   
当然敏感数据肯定不能采用可靠性差的方式 数据和数据不一样 表与表也不一样   
   
> 10:20:14  张泽雄-民生金服 项目总监  
   
@李行-途牛-南京   退款与撤销是交易名称层面的东西，你也可以换个叫法，叫清算前退货和清算后退货，清算前退了，结算时就不会有这笔交易了，清算后退的，当日结算款里还是会有这笔交易款的。  
   
> 10:33:06  stranger-同城旅游支付PL  
   
![2017-05-25 10:33:06](http://static.cocolian.cn/img/20170525_103306.png) 
   
> 10:33:25  stranger-同城旅游支付PL  
   
这里买的银联前置系统和收单机构的前置系统分别指的是什么？  
   
> 10:33:39  stranger-同城旅游支付PL  
   
有没有人指点下  
   
> 10:44:33  韩财光  
   
一个是银联的 一个是你的 是有这个区别吗 要不就是他的图画得不清楚:)   
   
> 10:48:26  Jack-捷信消费金融技术主管  
   
@韩财光-东软(前)-开发-广州  写内存不如直接写日志文件  
   
> 10:49:40  韩财光  
   
支付系统比较特殊 即使是电商这种 一个系统里真正敏感的数据有多少? 就那么一点点吧 像现在常见的开发习惯 比如java用的spring带的那种事务控制 程序员为了图方便 清一色的update* find* 这样会导致改昵称和改余额一样重 这样肯定不好吧?  
   
> 10:50:17  韩财光  
   
是啊是啊 或者多种方式结合 看具体情况看数据看条件  
   
> 10:55:28  韩财光  
   
最终看矛盾在哪 以及有多大 本来资源紧张 不同的需求针对性采用不同的方案 不是几个开源框架凑一起就完事了:) 这不是主流思路 当个参考吧:)  
   
> 11:17:49  一wan白水-pingpong跨境金融PM  
   
网贷整改大限倒计时：五大重点进度挨个数，有的正在忙转型  
   
> 11:42:37  邹成凯-联通支付  
   
第十一条　支付机构应根据客户身份对同一客户在本机构开立的所有支付账户进行关联管理，并按照下列要求对个人支付账户进行分类管理：[一]对于以非面对面方式通过至少一个合法安全的外部渠道进行身份基本信息验证，且为首次在本机构开立支付账户的个人客户，支付机构可以为其开立Ⅰ类支付账户，账户余额仅可用于消费和转账，余额付款交易自账户开立起累计不超过1000元[包括支付账户向客户本人同名银行账户转账]；[二]对于支付机构自主或委托合作机构以面对面方式核实身份的个人客户，或以非面对面方式通过至少三个合法安全的外部渠道进行身份基本信息多重交叉验证的个人客户，支付机构可以为其开立Ⅱ类支付账户，账户余额仅可用于消费和转账，其所有支付账户的余额付款交易年累计不超过10万元[不包括支付账户向客户本人同名银行账户转账]；[三]对于支付机构自主或委托合作机构以面对面方式核实身份的个人客户，或以非面对面方式通过至少五个合法安全的外部渠道进行身份基本信息多重交叉验证的个人客户，支付机构可以为其开立Ⅲ类支付账户，账户余额可以用于消费、转账以及购买投资理财等金融类产品，其所有支付账户的余额付款交易年累计不超过20万元[不包括支付账户向客户本人同名银行账户转账]。客户身份基本信息外部验证渠道包括但不限于政府部门数据库、商业银行信息系统、商业化数据库等。其中，通过商业银行验证个人客户身份基本信息的，应为Ⅰ类银行账户或信用卡。  
   
> 11:42:52  邹成凯-联通支付  
   
昨晚说到的央行发的文  
   
> 11:43:06  邹成凯-联通支付  
   
这个官方  [呲牙]  
   
> 12:12:30  freewolf-天津金融资产交易所技术  
   
现在所有条文 都不是很明确  
   
> 12:12:57  freewolf-天津金融资产交易所技术  
   
首先 什么叫网贷  
   
> 12:13:08  freewolf-天津金融资产交易所技术  
   
这个完全不明确   
   
> 12:13:30  freewolf-天津金融资产交易所技术  
   
p2p一定是网贷 其他互金算不算  
   
> 13:43:14  我  
   
20170523交流记录和专题  
   
> 13:43:52  Peter-找钢网-PM  
   
[强][玫瑰]  
   
> 13:44:00  我  
   
感谢@u're   
   
> 13:49:14  Wall-E 爱贝云计费产品主管  
   
感谢整理  
   
> 13:50:48  路杨 嘉联支付产品  
   
感谢整理[强]  
   
> 13:52:39  韩倩～  
   
感谢整理  
   
> 13:55:15  张小凡-支付产品经理-驴妈妈旅游  
   
51人品宝那个写的很好，一直在用，谢谢分享。  
   
> 13:55:54  潘儒刚-连连支付PM  
   
感谢整理  
   
> 13:56:08  冷暖自知-风控 裕福支付 北京  
   
感谢整理  
   
> 13:56:33  Yang  
   
谢谢整理  
   
> 13:59:43  亡目丁-币港湾PM  
   
感谢  
   
> 14:03:20  闪闪-联通支付产品经理  
   
[强]  
   
> 14:03:54  王燕强-房天下-支付网关PL  
   
辛苦啦  
   
> 14:04:08  冷暖自知-风控 裕福支付 北京  
   
我想问大家下，D0和T0这样资金结算的是不是属于代付  
   
> 14:04:15  闪闪-联通支付产品经理  
   
对每晚做专题分享的同学是不是也可以开个赞赏功能？[呲牙]  
   
> 14:07:04  我  
   
现在IOS关闭打赏后， 打赏不高。   
   
> 14:07:25  我  
   
现在打赏用来支持签到红包了。   
   
> 14:08:30  啵??板糖-产品专员 途牛  
   
各位大神，求助个问题，信用卡算逾期利息的时候，是当天一开始就将当天的罚息算好入账的嘛？  
   
> 14:09:30  冷暖自知-风控 裕福支付 北京  
   
正常的资金清算模式是T1模式：客户消费后，收单机构(银行或第三方支付公司)将交易信息传输给清算机构(中国目前仅银联一家)，清算机构再将信息传输给持卡人的发卡机构，发卡机构根据交易信息将持卡人账户中的资金扣除，并将资金转到清算机构，资金便在清算机构沉淀一个晚上。等到第二个工作日的凌晨，清算机构将这笔资金转到收单机构所指定的账户，清算过程完成。因此，现在所有的T0、D0清算模式，均为机构垫付  
   
> 14:09:37  冷暖自知-风控 裕福支付 北京  
   
这段话对吗  
   
> 14:12:23  花生-新网银行PM  
   
资金不在清算机构沉淀  
   
> 14:14:42  superjj-微众银行PM  
   
@杜小妞-途牛-南京?只记不收  
   
> 14:14:48  freewolf-天津金融资产交易所技术  
   
[强] 老??辛苦  
   
> 14:17:09  黄朋英-易联支付PM  
   
应该给做主题分享的同学发随意红包，知识内容收费，群的讨论才能源源不绝  
   
> 14:18:21  闪闪-联通支付产品经理  
   
银联进行日结、清分、与各机构进行对账后，才发生资金转移吧  
   
> 14:21:42  花生-新网银行PM  
   
银联转接的标准交易及资金清算模式（T1模式）：  交易：客户消费，收单机构(如第三方支付公司)将交易信息传输给清算机构(中国目前仅银联一家)，清算机构再将信息传输给持卡人的发卡机构，发卡机构根据交易信息将持卡人账户中的资金扣除，支付成功信息从发卡行经由清算机构再传递给收单机构，交易达成。  结算：T+1日凌晨，清算机构通过央行二代清算系统，轧差结算，调拨发卡行和收单机构所在收单行在央行的备付金头寸，完成跨行结算；收单行再行内结算至收单机构备付金账户，收单机构最后与商户结算，结算达成。  
   
> 14:22:09  花生-新网银行PM  
   
以上如有谬误的地方，请大家指正  
   
> 14:23:41  啵??板糖-产品专员 途牛  
   
@JJ-webank-深圳 是指计算好，放入账务系统，但暂时不收取？不放在对客账单里？  
   
> 14:24:03  花生-新网银行PM  
   
@裕福 风控 郝文汇 这里有些特殊情况，如发卡行和收单行是同一家时，一般不经过银联；跨行才会走转接机构  
   
> 14:25:52  冷暖自知-风控 裕福支付 北京  
   
谢谢[OK]  
   
> 14:27:30  胡新松-银联  
   
[强]@花生-新网-产品 解读很到位  
   
> 14:27:40  dio  
   
你们账户冻结资金算不算入账户余额  
   
> 14:30:56  superjj-微众银行PM  
   
@杜小妞-途牛-南京 账单一般不是有一个宽限期的么~在宽限期内，只计算，放在账务系统的贷款利息计提  
   
> 14:32:37  亡目丁-币港湾PM  
   
应该是算入资产，不算入余额@小吴_产品-承泰-上海   
   
> 14:32:42  Danier  
   
[强]  
   
> 14:36:51  亡目丁-币港湾PM  
   
那一般宽限期内还款计提的滞纳金是生效还是不生效呢  
   
> 14:37:11  dio  
   
按照常规P2P虚拟账户类型的应该是不算入余额的   不过 我现在是企业之间大额交易    这个冻结资金是怕账户出现异常添加的一个资金状态   这个也不加入账户余额吗  
   
> 14:51:16  亡目丁-币港湾PM  
   
类似于保证金的意思？  
   
> 14:52:37  张泽雄-民生金服 项目总监  
   
![2017-05-25 14:52:37](http://static.cocolian.cn/img/20170525_145237.png) 
   
> 15:36:00  啵??板糖-产品专员 途牛  
   
@JJ-webank-深圳?谢谢  
   
> 15:59:21  我  
   
欢迎 @珞珈 ，来自恒生银行，负责支付和存管的。   
   
> 15:59:35  李丹-风控经理-双乾支付  
   
欢迎  
   
> 15:59:43  冷暖自知-风控 裕福支付 北京  
   
欢迎  
   
> 15:59:44  萌小喵-爱贝计费高级PM  
   
[玫瑰]欢迎~~  
   
> 16:00:04  钟文帅-移付宝科技-产品经理  
   
欢迎  
   
> 16:00:10  万黎-恒丰银行-支付产品PM  
   
同行兄弟姐妹们多交流  
   
> 16:03:40  Yang  
   
欢迎欢迎  
   
> 16:05:02  王晓东-分点点-技术总监  
   
欢迎  
   
> 16:05:20  Wall-E 爱贝云计费产品主管  
   
欢迎  
   
> 16:06:00  邹成凯-联通支付  
   
欢迎  
   
> 16:06:35  扫地僧  
   
欢迎 [鼓掌]  
   
> 16:06:54  名叫旺达的鱼  
   
欢迎  
   
> 16:08:17  李行-途牛支付中心研发总监  
   
欢迎  
   
> 16:09:51  Fiona-支付结算产品经理-优酷  
   
欢迎~~珞珈山的珞珈？  
   
> 16:09:57  徐萍 途牛产品总监  
   
欢迎  
   
> 16:11:08  李钦珑-深圳优讯-PM  
   
欢迎  
   
> 16:11:22  朱雄新-广发支付组  
   
@珞珈~恒丰银行~北京?之前有个同事叫边伟的去了你们那  
   
> 16:11:37  Leeyal  
   
欢迎[鼓掌]  
   
> 16:12:02  雷敏-深圳金融电子结算中心PM  
   
珞珈山来的吗？[鼓掌]  
   
> 16:21:21  白涛-建行厦门开发中心项目经理  
   
@珞珈~恒丰银行~北京?是武大的吗？校友啊  
   
> 16:22:05  sunshine-苏宁金融  
   
问京东的帅哥，浦发信用卡在绑卡支付的时候，短信是银行发的还是京东自己发的@Dz-京东-产品?  
   
> 16:22:06  雷敏-深圳金融电子结算中心PM  
   
校友+1呀[坏笑]  
   
> 16:23:13  白涛-建行厦门开发中心项目经理  
   
@雷敏-结算中心-产品?[握手]  
   
> 16:23:36  雷敏-深圳金融电子结算中心PM  
   
[握手][握手][握手]  
   
> 16:32:31  刘贞平-支付产品经理，捷易付  
   
这边谁有最新的卡bin 表，可以分享下吗  
   
> 17:05:17  劉皇叔  
   
支付公司 或银行   有没有可以查询一个银行卡的开户行 和 开户行联行号的 接口？  
   
> 17:06:12  李行-途牛支付中心研发总监  
   
开户行查询应该没有吧  
   
> 17:06:44  happycoral  
   
一般好像都是有一个联行号表   
   
> 17:07:12  劉皇叔  
   
因为我们有个场景是需要用户选 自己卡的 开户行。 但是我们的联行号表不全，很多银行选不出来  
   
> 17:07:32  韩倩～  
   
https://www.hebbank.com/corporbank/otherBankQueryWeb.do这个可以查  
   
> 17:07:58  劉皇叔  
   
卡号作为收款卡号，做代付的时候，一般代付接口都需要开户所在省市 或 联行号  
   
> 17:07:59  修-拉卡拉-产品-北京  
   
但是查不出一张卡的开户行。  
   
> 17:08:04  劉皇叔  
   
好，我试试看  
   
> 17:08:26  修-拉卡拉-产品-北京  
   
除了大小额，其他应该不需要吧。  
   
> 17:08:49  韩倩～  
   
好的 我也有联行号的表 但是也没那么全 逐步维护中 大概一万多家吧  
   
> 17:09:01  修-拉卡拉-产品-北京  
   
超网和银联代付都不需要联行号或者开户所在省市。  
   
> 17:09:25  劉皇叔  
   
我有13万条，都不全  
   
> 17:09:47  韩倩～  
   
对公的要联行号  
   
> 17:10:24  修-拉卡拉-产品-北京  
   
对公的也看走什么渠道。而且一般对公的客户，自己知道自己的联行号的。  
   
> 17:10:43  韩倩～  
   
看错了 我的表有14万多  
   
> 17:10:46  劉皇叔  
   
现在我接的支付公司代付就需要联行号 。  
   
> 17:11:34  韩倩～  
   
我们对公都需要，对私不用  
   
> 17:12:01  劉皇叔  
   
我接的支付公司， 对私的都要联行号呢。  
   
> 17:12:18  韩倩～  
   
额 。。这个不好维护  
   
> 17:13:57  劉皇叔  
   
我听说 联行号都是 人行有个 CNAPS 系统是 管理这联行号的，银行可以与之对接，一段时间同步一次  
   
> 17:15:37  亡目丁-币港湾PM  
   
目前据我所知，对私的联行号只要是总行的行号就行  
   
> 17:15:47  亡目丁-币港湾PM  
   
对公的就不清楚了  
   
> 17:17:21  劉皇叔  
   
不知道这数据可以从哪买么  
   
> 17:17:30  dio  
   
换渠道吧     
   
> 17:17:46  dio  
   
对私都需要联行号的  那估计是支付公司不太行  
   
> 17:18:41  劉皇叔  
   
是啊，这也是一条途径了  
   
> 17:43:26  张小凡-支付产品经理-驴妈妈旅游  
   
请教个问题 有没有查看银行发卡量的方法啊 不用实时的 滞后点的也行  
   
> 17:45:17  lisp 财付通结算财务  
   
联行号应该可以找银行要的  
   
> 17:48:09  owl  
   
据我所知只有大小额系统要省份地区联行号。超级网银银联都不需要这个字段  
   
> 17:49:32  王燕强-房天下-支付网关PL  
   
第三方机构应该都有联行号维护  
   
> 17:49:38  王燕强-房天下-支付网关PL  
   
我们也是从第三方拿到的  
   
> 17:50:10  王燕强-房天下-支付网关PL  
   
银联对公开户行名称，其实是变相的联行号  
   
> 17:50:19  王燕强-房天下-支付网关PL  
   
对公需要开会行名称  
   
> 17:50:20  lisp 财付通结算财务  
   
最好从银行拿，支付机构也是从银行拿的  
   
> 17:50:59  王燕强-房天下-支付网关PL  
   
银行会提供下载或者查询么  
   
> 17:51:20  lisp 财付通结算财务  
   
我记得中信可以直接下载  
   
> 17:51:21  王燕强-房天下-支付网关PL  
   
网上也有开放的平台可以查询  
   
> 17:51:25  王燕强-房天下-支付网关PL  
   
搞个爬虫爬一下  
   
> 17:52:05  王燕强-房天下-支付网关PL  
   
去中信看一下  
   
> 17:53:59  劉皇叔  
   
恩，我去看一下  
   
> 17:54:28  lisp 财付通结算财务  
   
大家怎么看央行说的大商户模式（二清）啊？ 这种B2B2C的模式会消失么？ 例如：京东非自营，美团  
   
> 17:55:09  花生-新网银行PM  
   
这两家都持牌了，合规合法  
   
> 17:55:38  fangfang-随行付清结算  
   
建行也可以直接下载  
   
> 17:56:21  潘儒刚-连连支付PM  
   
只要不涉及二清 应该都是合规的吧   
   
> 17:57:01  lisp 财付通结算财务  
   
我觉得不会啊。。。 京东有网银在线，但是微信支付如果直接结给京东，那京东再结给商户，就是大商户（二清） 如果微信支付结给网银在线，那又是支付机构备付金互转，违规。  
   
> 17:57:21  花生-新网银行PM  
   
二清特指没有支付结算资质的机构，进行资金支付结算  
   
> 17:57:56  花生-新网银行PM  
   
@涛-分期乐-产品-深圳 2号令规定支付机构间不能直连；but 间连就好了呀  
   
> 17:58:01  花生-新网银行PM  
   
改下交易结构而已  
   
> 17:58:13  lisp 财付通结算财务  
   
对，现在来看是唯一的路，间连  
   
> 17:58:29  lisp 财付通结算财务  
   
通过银行或是啥的  
   
> 17:59:02  盆栽是个杀手-有赞-清结算  
   
这个一般都是通过银行走微信渠道商模式吧？  
   
> 17:59:11  花生-新网银行PM  
   
现在辣么多第三方支付机构做聚合，都是这么玩的  
   
> 17:59:21  潘儒刚-连连支付PM  
   
二清还是存在的吧   
   
> 17:59:22  lisp 财付通结算财务  
   
但这样也只是京东和美团这样有钱的主能这么干  
   
> 17:59:29  张泽雄-民生金服 项目总监  
   
一种是通过银行，再一种就是通过用集团去签  
   
> 18:02:07  lisp 财付通结算财务  
   
如果通过银行间连的话，如果平台没有支付牌照，那就是把二清被罚风险转移给了银行  
   
> 18:02:31  lisp 财付通结算财务  
   
但本质上二清确实避免不了  
   
> 18:02:52  潘儒刚-连连支付PM  
   
这种是通过银行做资金结算么   
   
> 18:03:32  潘儒刚-连连支付PM  
   
银行可以做资金结算啊  
   
> 18:04:24  潘儒刚-连连支付PM  
   
可以将资金直结算给下面的商户   
   
> 18:04:32  潘儒刚-连连支付PM  
   
就不是二清了吧   
   
> 18:04:44  lisp 财付通结算财务  
   
但这个做不到啊...  
   
> 18:04:57  lisp 财付通结算财务  
   
京东不会把商户信息给银行的  
   
> 18:04:59  盆栽是个杀手-有赞-清结算  
   
为什么做不到？  
   
> 18:05:11  张泽雄-民生金服 项目总监  
   
银行可以给二级商户结算  
   
> 18:05:27  潘儒刚-连连支付PM  
   
京东的不了解 可能不会   
   
> 18:06:01  盆栽是个杀手-有赞-清结算  
   
京东现在业务跑起来，我猜应该是合规的吧？   
   
> 18:06:07  lisp 财付通结算财务  
   
如果京东愿意的话，他也就不需要给银行了，还不如直接给微信支付，至少还是同盟  
   
> 18:06:15  Tim-魔线科技-产品总监  
   
京东有牌照  
   
> 18:06:33  花生-新网银行PM  
   
多级商户分润系统，关键是系统支持  
   
> 18:06:46  花生-新网银行PM  
   
或者叫多级商户分账系统  
   
> 18:06:54  潘儒刚-连连支付PM  
   
其实就是提供给银行企业账号  用银行通道去代付    
   
> 18:07:07  潘儒刚-连连支付PM  
   
这个也没有什么信息吧   
   
> 18:07:10  lisp 财付通结算财务  
   
现在业务能跑，并不一定意味着合规  
   
> 18:07:21  lisp 财付通结算财务  
   
也许只是央行没想出好办法  
   
> 18:07:36  张长工-上海银行互金部-PM  
   
威富通和科蓝不就是干这个的么，然后上市了  
   
> 18:07:57  蘑菇街_陈宗  
   
京东去年旗下7个子公司被人举报二清问题  
   
> 18:08:08  花生-新网银行PM  
   
威富通是被上市公司收购，不是自己上市  
   
> 18:08:10  lisp 财付通结算财务  
   
蘑菇街也是一样  
   
> 18:08:30  潘儒刚-连连支付PM  
   
蘑菇街怎么做的呢  现在   
   
> 18:08:41  lisp 财付通结算财务  
   
都不算合规  
   
> 18:08:47  lisp 财付通结算财务  
   
都是二清  
   
> 18:08:48  花生-新网银行PM  
   
蘑菇街、二维火、有赞都因为涉嫌二清被央妈点名了  
   
> 18:08:50  潘儒刚-连连支付PM  
   
是由银行做资金计算么   
   
> 18:08:59  花生-新网银行PM  
   
然后，有赞买了块牌照。。。  
   
> 18:09:15  dio  
   
有赞有牌照？  
   
> 18:09:25  lisp 财付通结算财务  
   
京东没有做变动，你支付一下就知道了，钱是进京东  
   
> 18:09:42  lisp 财付通结算财务  
   
蘑菇街不知道改了没有，以前也是直接进蘑菇街的  
   
> 18:09:46  dio  
   
京东好像也没有牌照吧  
   
> 18:10:00  Tim-魔线科技-产品总监  
   
京东有牌照，但是还是走的原来那套？你的意思  
   
> 18:10:02  lisp 财付通结算财务  
   
京东本身没有，但是网银在线是京东的  
   
> 18:10:10  lisp 财付通结算财务  
   
对的  
   
> 18:10:30  盆栽是个杀手-有赞-清结算  
   
威富通是采购银行的清分服务，本质上还是银行做的清分吧？  
   
> 18:10:37  Tim-魔线科技-产品总监  
   
呵呵。  
   
> 18:10:39  lisp 财付通结算财务  
   
当然只是猜测，要看京东的同学确认了  
   
> 18:12:08  盆栽是个杀手-有赞-清结算  
   
@花生-新网-产品? 你们多级分润，会拆成多比收单吗？ 还是在结算的时候做分润的  
   
> 18:12:59  花生-新网银行PM  
   
一笔支付  
   
> 18:13:13  花生-新网银行PM  
   
多笔收单用户受不了  
   
> 18:14:21  盆栽是个杀手-有赞-清结算  
   
对用户是支付一笔，对系统来说呢？  
   
> 18:14:32  花生-新网银行PM  
   
商户账户实时的只是信息流，总额对了就行  
   
> 18:14:49  盆栽是个杀手-有赞-清结算  
   
如果结算的时候做，商户就看不见分润的信息了吧？  
   
> 18:15:02  花生-新网银行PM  
   
这个请电商同学回答吧[呲牙]  
   
> 18:15:39  龚正-滴滴-支付金融  
   
这个不一定  
   
> 18:15:48  龚正-滴滴-支付金融  
   
清算有实时有非实时  
   
> 18:15:57  龚正-滴滴-支付金融  
   
有的结算单信息在业务 有的在支付  
   
> 18:18:01  盆栽是个杀手-有赞-清结算  
   
有的结算单信息在业务 有的在支付-    这个怎么理解？  
   
> 18:18:41  龚正-滴滴-支付金融  
   
就是业务方自己算需要给商户结算多少钱  
   
> 18:18:45  龚正-滴滴-支付金融  
   
然后告诉支付  
   
> 18:19:21  龚正-滴滴-支付金融  
   
有的是支付做这个 然后通过账户划分  
   
> 18:20:08  胡新松-银联  
   
商户可以做分账系统  
   
> 18:20:37  胡新松-银联  
   
清算也可以支持商户多方分账　或者　多方分润  
   
> 18:21:17  龚正-滴滴-支付金融  
   
赞  
   
> 18:22:45  胡新松-银联  
   
Ｔ０结算需要机构垫资的  
   
> 18:22:51  胡新松-银联  
   
目前是Ｔ＋１  
   
> 18:23:29  盆栽是个杀手-有赞-清结算  
   
我还有个疑问，分润信息需要给商户展示吗？ 是在交易明细的唯独还是账务明细的纬度？  
   
> 18:23:56  胡新松-银联  
   
一般不用展示  
   
> 18:23:59  胡新松-银联  
   
商户自己知道的  
   
> 18:24:34  胡新松-银联  
   
分润的明细和汇总都可以体现  
   
> 18:24:46  万黎-恒丰银行-支付产品PM  
   
@白涛-建行-应用开发?老武大人[呲牙]  
   
> 18:26:06  盆栽是个杀手-有赞-清结算  
   
那你们是在账务纬度去展示分润的信息的？ @胡某人-银联打杂人员-上海?  
   
> 18:26:22  张泽雄-民生金服 项目总监  
   
给商户有手续费就行了，分润是给分润方看的  
   
> 18:26:28  白涛-建行厦门开发中心项目经理  
   
@珞珈~恒丰银行~北京?哈哈，还会比我更老？  
   
> 18:26:52  万黎-恒丰银行-支付产品PM  
   
@Michael-广发-主管-佛山?边伟是科技部架构的，，  
   
> 18:26:58  万黎-恒丰银行-支付产品PM  
   
我应该跟他开过会  
   
> 18:27:11  万黎-恒丰银行-支付产品PM  
   
@白涛-建行-应用开发?哈哈，你是在武汉还是北京  
   
> 18:29:36  白涛-建行厦门开发中心项目经理  
   
@珞珈~恒丰银行~北京?我在厦门  
   
> 18:40:50  dio  
   
我自从做支付后发现厦门的老铁特别多，这是什么情况  
   
> 18:41:28  万黎-恒丰银行-支付产品PM  
   
民生厦门分行牛逼啊  
   
> 18:44:17  dio  
   
民生厦门的渠道是很多人用，不过兴业才是福建发家的银行吧，兴业在厦门都有一栋大厦  
   
> 18:50:03  万黎-恒丰银行-支付产品PM  
   
我是说民生厦门支付做的牛逼  
   
> 18:51:19  joe-民生银行产品经理  
   
万博士[偷笑]  
   
> 18:51:20  花生-新网银行PM  
   
民生的聚合支付产品是厦门分行做的？  
   
> 18:51:48  万黎-恒丰银行-支付产品PM  
   
赵总  
   
> 18:52:27  joe-民生银行产品经理  
   
[握手][握手][握手]  
   
> 18:52:52  万黎-恒丰银行-支付产品PM  
   
缘分啦????  
   
> 18:53:45  joe-民生银行产品经理  
   
  
   
> 18:54:29  joe-民生银行产品经理  
   
多跟你交流 学习[呲牙]  
   
> 19:09:07  韩财光  
   
签到方式有变化 发一下群新规  
   
> 19:09:57  韩财光  
   
群新规公告: 本群的目标是营造一个免费开放共享多赢的交流环境. 本着公平起见同时也是为了维护交流的积极性和活跃度 管理员每周会随机移出2名平时活动少的 又不积极参加抢红包签到的潜水同学(两年内有过专题分享或者近期有计划分享的除外). 以便让其他申请者有机会加入 希望大家能理解.  签到方式调整: 确定以抢红包作为唯一的签到方式(取消打[OK]方式) 手气最好的同学初步定在下周同一时间做分享(具体时间可协商调整). 已做过分享的同学可以不用抢. 抢不到或者迟到的同学不要以其他方式签到了(包括打[OK])  
   
> 19:15:01  韩财光  
   
各位同学 今天请到@雪鹰-快捷通-架构?  同学给大家做分享. 大家欢迎.  
   
> 19:15:27  Leeyal  
   
[鼓掌][鼓掌]  
   
> 19:15:47  韩财光  
   
微信红包  
   
> 19:17:18  三先生-易联汇华-金融产品经理  
   
签到还是打[OK]吧，红包签到成本是不有点高  
   
> 19:17:50  等锋来  
   
[鼓掌]  
   
> 19:18:05  dio  
   
。。？民生聚合支付？长什么样子  
   
> 19:18:11  我  
   
打赏的收入来发红包。 另外还根据红包来抽签决定下次分享的嘉宾。   
   
> 19:18:44  落雪飞花-农信互联-开发经理  
   
[强]  
   
> 19:19:04  小冰 云先知 技术 杭州  
   
[强]  
   
> 19:19:42  李丹-风控经理-双乾支付  
   
[OK]  
   
> 19:19:57  Wall-E 爱贝云计费产品主管  
   
今天的主题是？  
   
> 19:20:18  萌小喵-爱贝计费高级PM  
   
@韩财光-东软(前)-开发-广州? 麻烦介绍一下主题  
   
> 19:21:23  我  
   
主题是渠道管理和渠道接入。   
   
> 19:23:29  三先生-易联汇华-金融产品经理  
   
[强][强][强]  
   
> 19:24:21  昕小姐-1号店产品  
   
[强]  
   
> 19:24:34  Wall-E 爱贝云计费产品主管  
   
静候  
   
> 19:25:00  Tim-深圳百灵鸟-架构  
   
[OK]  
   
> 19:25:39  (′???`)  
   
[OK]  
   
> 19:25:53  封国辉-广发银行-系统设计  
   
[OK]  
   
> 19:25:57  吕剑辉-杉德-PL  
   
[OK]  
   
> 19:26:06  华-南京亚软-IT总监  
   
[OK]  
   
> 19:26:10  祁超-网易支付Java开发  
   
[OK]  
   
> 19:26:11  三先生-易联汇华-金融产品经理  
   
[OK]  
   
> 19:26:12  方祜桔  
   
[OK]  
   
> 19:26:36  李丹-风控经理-双乾支付  
   
[OK]  
   
> 19:26:38  build-去哪儿-QA  
   
[OK]  
   
> 19:26:39  韩财光  
   
停止签到 请嘉宾准备分享. 嘉宾分享期间其他人不要发言打断. 分享完成后请大家积极补充和提问. @雪鹰-快捷通-架构?  
   
> 19:26:40  吴浩  
   
[OK]  
   
> 19:26:41  程文东-拉卡拉PL  
   
[OK]  
   
> 19:26:57  Wall-E 爱贝云计费产品主管  
   
[OK]  
   
> 19:28:28  袁军-架构师-快捷通  
   
好的，开始了啊~  
   
> 19:28:42  杨继军-联想电商平台架构师  
   
[OK]  
   
> 19:29:22  姚刚-阿里-PD  
   
[OK]  
   
> 19:29:45  袁军-架构师-快捷通  
   
大家好，我目前快捷通做支付系统架构，支付行业经验不是很长，快差不多3年，今天主要分享渠道管理及渠道接入方面的。  
   
> 19:30:39  袁军-架构师-快捷通  
   
支付渠道描述：支付渠道即资金转移的通道，也称为资金渠道、支付通道，与现实中“运输交通” 相似，先修建道路才能运输，先建设渠道才能支付。支付路由就类似交通导航，公路、航线一般有编号，渠道也会进行编号，支付收银台就类似于导航界面。交通导航与渠道路由影响因素也比较相似，但在算法实现上是有很大区别的。常见如下：   
   
> 19:31:25  袁军-架构师-快捷通  
   
![2017-05-25 19:31:25](http://static.cocolian.cn/img/20170525_193125.png) 
   
> 19:32:08  袁军-架构师-快捷通  
   
支付渠道性能：对于接入银行的渠道，很多都通过前置机与银行交互，一般银行都会限制请求并发数，如何控制并发是渠道路由系统需要重点关注的问题。另外专线接入周期长，且一般都使用硬证书。最好能以软证书+公网方式接入。同步返回结果的优于异步通知的。   
   
> 19:32:59  袁军-架构师-快捷通  
   
支付渠道掉单：由于与银行交互，会存在超时、异步通知不及时的情况，造成支付结果一直处理中，这种情况下需要系统自动去查询结果，隔日掉单的在T1日需再补单一次。补单策略固定周期，固定周期+延迟，灵活控制各个渠道查询接口的起止时间范围，如有些银行退款要T+1处理的。   
   
> 19:34:35  袁军-架构师-快捷通  
   
支付渠道降级：由于是与银行交互，会存在超时网络异常，或交易连续失败等异常情况，需要对渠道权重降级，交易正常后需恢复权重。例：动态权重初始0，且不大于0，超时或失败一笔交易权重-1，成功+1；动态权重低于-10发送邮件短信提醒。依据实际业务进行优化。    
   
> 19:35:24  袁军-架构师-快捷通  
   
以上是支付渠道相关的一些比较重要方面，接下来讲下渠道系统设计方面的。  
   
> 19:35:55  袁军-架构师-快捷通  
   
系统交互流程：  
   
> 19:35:56  袁军-架构师-快捷通  
   
![2017-05-25 19:35:56](http://static.cocolian.cn/img/20170525_193556.png) 
   
> 19:36:50  袁军-架构师-快捷通  
   
渠道路由：主要包括渠道配置，渠道路由，任务调度子系统等；统一接收所有与银行有关的请求，通过路由选择合适的支付渠道，与下游渠道应用交互。任务调度子系统主要出款、补单及其它批量处理的任务调度。  
   
> 19:37:37  袁军-架构师-快捷通  
   
渠道应用：按银行的支付业务划分，对应银行一个实际的支付通道，如同一个银行B2C、B2B、银企直连、快捷、代扣独立分开部署5个渠道应用。在渠道管理上多个虚拟的支付渠道对应一个渠道应用。  
   
> 19:37:47  willhu-财付通-风控  
   
n^_^  
   
> 19:38:03  袁军-架构师-快捷通  
   
银行前置机：使用硬证书的通道一般都要部署银行的前置机软件，通过前置机与银行交互。  
   
> 19:38:46  袁军-架构师-快捷通  
   
银行回调：公网统一接收所有银行回调的应用，主要基于网络安全考虑，渠道应用不能通过公网直接访问。  
   
> 19:39:48  袁军-架构师-快捷通  
   
实现同步请求，虚线异步通知  
   
> 19:40:30  袁军-架构师-快捷通  
   
渠道模型设计：  
   
> 19:40:31  袁军-架构师-快捷通  
   
![2017-05-25 19:40:31](http://static.cocolian.cn/img/20170525_194031.png) 
   
> 19:41:41  袁军-架构师-快捷通  
   
渠道分类：  
   
> 19:41:42  袁军-架构师-快捷通  
   
![2017-05-25 19:41:42](http://static.cocolian.cn/img/20170525_194142.png) 
   
> 19:42:34  袁军-架构师-快捷通  
   
渠道：一个渠道对应一个虚拟的支付通道，银行的一个实际支付通道可以虚拟成多个渠道，如B2C网银虚拟成借记、贷记、综合3个通道。一个渠道包含多个接口共同提供完整的支付服务，渠道可以设置维护期、特性、优先级权重。   
   
> 19:43:30  袁军-架构师-快捷通  
   
接口：一个渠道通常包含多个接口，组合起来才能提供完整的支付服务。不同的支付模式对应不同的接口，如快捷支付包括签约短信、签约确认、支付短信、支付确认、单笔退款、单笔查询、对账单下载、通用接口等。不同接口通常会有一些特殊扩展属性配置，如查询接口订单补单时间范围，退款接口转人工处理延迟时间，出款接口是否支持拆单等等。  
   
> 19:44:58  袁军-架构师-快捷通  
   
目标机构：目标机构即支付渠道可以支持的银行（中行、工行等）、第三方（微信、支付宝等），对于接入银联、主备付金跨行出款、第三方支付的渠道会有多个目标机构，如主备付金银行跨行出款可以支持多个银行，接入第三方快捷渠道也是同时支持多个银行。   
   
> 19:46:34  袁军-架构师-快捷通  
   
特性：渠道或接口都可以设置特性，特性来自交易中要素，特性标识渠道的特点，任何一个交易要素都可以配置成特性，有相等、大于、小于、包含、不包含等匹配规则，常见特性如终端类型、卡类型、商户ID、会员ID、对公对私、借贷、会员ID、交易订单号、当前时间、业务产品、支付产品、金额、目标机构等等。路由时特性可以达到绝对限制或放行的目的，如限制当前渠道不允许某个商户使用，限制该渠道必须发短信才能支付，限制只支持借记卡等一些临时性的限制。  
   
> 19:48:36  袁军-架构师-快捷通  
   
维护期：渠道或接口都可以设置维护期，可以指定到具体的目标机构银行，维护期间渠道或接口通常是无法提供服务的，路由时入款、退款、出款对维护期处理逻辑通常会不一样，入款或实时出款直接返回失败，其它退款、出款正常路由，维护时间结束后通过任务调度提交银行处理。出款也可以渠道全部维护期的订单暂停，通过定时任务尝试路由。   
   
> 19:50:31  袁军-架构师-快捷通  
   
限额限次：限额限次设置在接口上，可以指定到具体的目标机构银行，目标机构为空表示对该渠道所有目标机构银行设置相同限额。路由时过滤掉不满足限额的渠道，出款时也可用来拆单。  
   
> 19:52:15  袁军-架构师-快捷通  
   
优先级权重：渠道和接口都可以配置优先级权重，可以使用固定值或动态脚本（velocity，groovy等）,脚本参数为交易中要素信息，可以分类，如成本、稳定性、服务时间等。渠道、接口可多个配置计算得分累加，单个可负分，累计不小于零。优先级优于权重，多个优先级一样时，按权重分配，路由时先渠道后接口。优先级通过表达式计算获得，权重一般直接配置数值。   
   
> 19:53:14  袁军-架构师-快捷通  
   
优先级与权重计算示例：  
   
> 19:53:15  袁军-架构师-快捷通  
   
![2017-05-25 19:53:15](http://static.cocolian.cn/img/20170525_195315.png) 
   
> 19:54:35  袁军-架构师-快捷通  
   
渠道路由流程：  
   
> 19:54:36  袁军-架构师-快捷通  
   
![2017-05-25 19:54:36](http://static.cocolian.cn/img/20170525_195436.png) 
   
> 19:56:14  袁军-架构师-快捷通  
   
补单： 关于补单，通常会入款、出款、退款分开，可以按支付模式分别创建不同定时任务调度，更细粒度可以按银行实际支付渠道创建。如对于网银支付可采用如下策略： ??????? 固定周期补单（5分钟）蓝点 ??????? 固定周期+递进延迟补单（+次数*5分钟）红点 ??????? 订单范围默认（-10至-60分钟）接口支持动态调整  
   
> 19:56:26  袁军-架构师-快捷通  
   
![2017-05-25 19:56:26](http://static.cocolian.cn/img/20170525_195626.png) 
   
> 19:58:37  袁军-架构师-快捷通  
   
结果码：对于不同支付渠道，每一个银行返回的结果码一般都不一样，银行结果码也可能增加或减少，为灵活判断结果吗对应订单的状态，以及给用户返回友好的提示信息，需要对银行结果码进行转义。对于在交易过程中出现的新结果码，先挂起交易为“处理中”状态，插入数据库一条未转义的结果码记录，并同时邮件通知响应技术人员进行配置。   
   
> 20:00:13  袁军-架构师-快捷通  
   
余额预警：一般来说通过定时任务出款，都会先校验备付金余额是否足够，若余额不够提醒结算人员余额不够人工调拨资金，或触发系统自动调拨机制。同时系统缓存当前银行备付金余额，对于实时出款可进行一次判断过滤掉该银行的通道。  
   
> 20:01:15  袁军-架构师-快捷通  
   
订单号规则：订单号是提交银行交易的唯一标识，为通过订单号就能快速识别交易从哪个支付渠道发起，从设计上不同银行接口采用不同的订单号生成策略。通常策略：前缀（渠道编号）+日期段+序号，个别银行特殊要求，如必须全数字，前缀用数字即可。  
   
> 20:03:26  袁军-架构师-快捷通  
   
订单重发： 由于网络超时原因通常通过查询结果，有时银行会返回交易不存在，依赖银行查询结果的准确性，以及交易幂等性，可考虑重发交易，重发的交易不能改变订单号。  
   
> 20:05:05  袁军-架构师-快捷通  
   
好了，上就是今天分享内容，具体渠道方面没怎么讲了，欢迎提问~  
   
> 20:05:55  刘洪明-便利蜂支付  
   
[强]  
   
> 20:06:00  潘儒刚-连连支付PM  
   
[强] 很棒  
   
> 20:06:08  泽然  
   
[强]  
   
> 20:06:13  牙印儿-新浪支付产品经理  
   
[强]赞  
   
> 20:06:14  落雪飞花-农信互联-开发经理  
   
[强]  
   
> 20:06:26  张嘉杰  
   
[强]  
   
> 20:06:41  Richard-裕维金服技术负责  
   
[强]  
   
> 20:07:01  freewolf-天津金融资产交易所技术  
   
真好  
   
> 20:07:08  freewolf-天津金融资产交易所技术  
   
[强]  
   
> 20:07:15  方祜桔  
   
[强]  
   
> 20:07:16  韩财光  
   
多谢@雪鹰-快捷通-架构?的分享 大家积极补充和提问吧  
   
> 20:07:24  superjj-微众银行PM  
   
[强]  
   
> 20:07:34  路杨 嘉联支付产品  
   
学习了[强]赞  
   
> 20:08:02  王晓东-分点点-技术总监  
   
[强]  
   
> 20:08:03  李钦珑-深圳优讯-PM  
   
[强]每天学习的东西太多了  
   
> 20:08:11  Peter-找钢网-PM  
   
[强][强]  
   
> 20:08:28  刘洪明-便利蜂支付  
   
@雪鹰-快捷通-架构   渠道降级这块是全自动化完成嘛？  
   
> 20:09:09  李丹-风控经理-双乾支付  
   
好厉害  
   
> 20:09:33  李丹-风控经理-双乾支付  
   
满脸崇拜[抱拳][抱拳]  
   
> 20:09:46  落雪飞花-农信互联-开发经理  
   
什么  
   
> 20:09:52  袁军-架构师-快捷通  
   
渠道降级有做的，不过不是实时的  
   
> 20:10:14  在路上-杉德支付架构  
   
赞  
   
> 20:10:20  落雪飞花-农信互联-开发经理  
   
问个问题，上面提到的渠道成功权重+1,失败-1，这部分数据是放到什么地方的？通过什么机制通知渠道服务  
   
> 20:11:02  余铭  
   
赞  
   
> 20:11:09  刘洪明-便利蜂支付  
   
@雪鹰-快捷通-架构  谢谢[强]  
   
> 20:11:12  袁军-架构师-快捷通  
   
各个服务器内存计算，30秒同步一次远程缓存，看容忍度的。  
   
> 20:11:59  stranger-同城旅游支付PL  
   
![2017-05-25 20:11:59](http://static.cocolian.cn/img/20170525_201159.png) 
   
> 20:12:08  stranger-同城旅游支付PL  
   
红色区域这部分能详细说下么  
   
> 20:12:23  stranger-同城旅游支付PL  
   
这个是消费类产品的路由设计么  
   
> 20:13:52  大状-上海迅联数据司  
   
看着是资金划拨类的，不是消费类  
   
> 20:13:53  Peter-找钢网-PM  
   
@雪鹰-快捷通-架构?支付订单提交后，若是异步通知，一般依据什么机制，然后把失败结果返回给商户。  
   
> 20:13:59  吴浩  
   
赞  
   
> 20:15:25  袁军-架构师-快捷通  
   
@程小剑-同程-苏州  过滤超载实时的比较难弄，目前我们主要做了定时出款的，统计通道订单积压的情况  
   
> 20:15:41  袁军-架构师-快捷通  
   
红框那部分主要也是针对出款的  
   
> 20:16:27  袁军-架构师-快捷通  
   
一个通道订单太多了处理不过来，直接走其他通道。  
   
> 20:18:02  袁军-架构师-快捷通  
   
@雪鹰-快捷通-架构?支付订单提交后，若是异步通知，一般依据什么机制，然后把失败结果返回给商户。  一般通过异步消息驱动，使用消息中间件  
   
> 20:18:03  stranger-同城旅游支付PL  
   
那余额不足的是用在哪里的？  
   
> 20:18:44  袁军-架构师-快捷通  
   
@程小剑-同程-苏州   出款备付金余额不足的情况。  
   
> 20:19:56  袁军-架构师-快捷通  
   
@程小剑-同程-苏州 入款快捷、代扣余额不足次数过多的，直接在网关层就会拦截的。  
   
> 20:20:35  袁军-架构师-快捷通  
   
主要我们垫资的业务比较多，经常会余额不足要调拨资金。  
   
> 20:22:05  漫天飞雪  
   
有没有多渠道同时成功的，谁发起原路退回？  
   
> 20:23:00  Peter-找钢网-PM  
   
支付订单的有效期一般设置多长时间比较合理？  
   
> 20:23:15  袁军-架构师-快捷通  
   
@昊天-蘑菇街-技术-杭州  有没有多渠道同时成功的，能举具体例子么？  
   
> 20:24:23  袁军-架构师-快捷通  
   
@Peter-找钢网-PM-上海  看交易量吧，交易越大就会设置越短，交易一直中间状态不合适。我们现在7天。  
   
> 20:25:12  漫天飞雪  
   
比如一笔支付先用a渠道，超时了用b渠道，两个同时回调  
   
> 20:25:53  周红仁-去哪儿支付  
   
@雪鹰-快捷通-架构 对于某些渠道，当交易笔数或者交易总金额到达某一个阀值后，成本会有变化，对权重和优先级是有影响的，这部分你们怎样实时实现的？  
   
> 20:29:48  袁军-架构师-快捷通  
   
@昊天-蘑菇街-技术-杭州 你们是内部做了自动重路由吧，我们不这么做的，这种问题比较多。可以缓存下卡失败的通道，用户在发起从缓存过滤这个渠道。  
   
> 20:35:13  华-南京亚软-IT总监  
   
关于补单，如果商户收单状态不对，等着补单解决单据一致问题，但等五分钟或更多，是不是时间太长了。  
   
> 20:36:41  袁军-架构师-快捷通  
   
渠道手续费 阶梯计算，其实没必要实时去计算的，差不多到了人工调整下优先级就行了。一定要做的话，建议也单独计算。毕竟成本只是一个影响因素。  
   
> 20:37:56  袁军-架构师-快捷通  
   
@付享通_罗华_总监  补单交易多可以一个渠道一个任务调度，单独控制周期、延迟时间、起止时间等等  
   
> 20:39:03  华-南京亚软-IT总监  
   
最近遇到一个问题，由于通道通知延迟，补单无法进行，商户闹心  
   
> 20:39:28  吴浩  
   
@雪鹰-快捷通-架构?对于银行回调地址你们是每接一个都有一个回调地址还是统一走同一个回调地址的？  
   
> 20:40:52  袁军-架构师-快捷通  
   
@Mahone-小牛在线-开发-深圳   走公网的一个， 专线的一般点对点不一样的  
   
> 20:43:04  袁军-架构师-快捷通  
   
@付享通_罗华_总监   能详说下么。是补单查询一直没明确结果？还是补单时间太短，通道很晚才成功？    
   
> 20:43:24  袁军-架构师-快捷通  
   
而你们后面没有在查询了？  
   
> 20:44:48  华-南京亚软-IT总监  
   
补单的通知，通道过来延迟太长，有些单子延迟了五个小时，不过比例不大。  
   
> 20:45:02  华-南京亚软-IT总监  
   
您说的查询是商户主动，加平台自动？  
   
> 20:45:04  袁军-架构师-快捷通  
   
掉单率太高换通道吧~  
   
> 20:48:36  FLD-卡说技术总监  
   
对不同接口的各个特殊属性是怎么存储的？  
   
> 20:51:14  袁军-架构师-快捷通  
   
@正清-卡说-苏州  数据库中是一个属性一条记录， 加载到缓存直接转换为对象，渠道缓存本地+远程结合。  
   
> 20:51:51  袁军-架构师-快捷通  
   
在数据上也会做多级缓存  
   
> 20:54:15  吴浩  
   
走公网的，回调的时候对结果码转义那不是要一个个做判断，并且加一个银行改一次代码了？  
   
> 20:54:35  袁军-架构师-快捷通  
   
支付模式+借贷+终端类型，支付模式+借贷，支付模式。     
   
> 20:55:55  FLD-卡说技术总监  
   
特性的过滤是通过可配置化实现的吗？能讲点思路不？  
   
> 20:56:10  袁军-架构师-快捷通  
   
@Mahone-小牛在线-开发-深圳  后台统一地方配置的， 渠道、接口、结果码、子结果码、统一结果码，订单状态。  
   
> 20:58:49  袁军-架构师-快捷通  
   
@正清-卡说-苏州      
   
> 20:58:50  袁军-架构师-快捷通  
   
![2017-05-25 20:58:50](http://static.cocolian.cn/img/20170525_205850.png) 
   
> 20:59:33  袁军-架构师-快捷通  
   
基本偏向技术维护的~  
   
> 21:02:14  袁军-架构师-快捷通  
   
特性就是配置一些验证规则，交易是否满足这个渠道。  
   
> 21:03:16  FLD-卡说技术总监  
   
[强]学习了，多谢??  
   
> 21:11:21  韩财光  
   
![2017-05-25 21:11:21](http://static.cocolian.cn/img/20170525_211121.png) 
   
> 21:14:41  韩财光  
   
今天手气最佳的是小胖 但是小胖前面有过分享了 如果小胖近期无计划做分享 机会就留给Joshua吧  
   
> 21:16:48  韩财光  
   
@胡某人-银联打杂人员-上海?@李小胖-支付PM-深圳?  
   
> 21:18:24  胡新松-银联  
   
近期可能比较忙，实在抽不开时间@韩财光-东软(前)-开发-广州? 非常抱歉，后面打算和大家介绍下二三类账户，不知道大家是否有兴趣  
   
> 21:18:44  胡新松-银联  
   
没有兴趣的话，也可以换个话题  
   
> 21:21:18  韩财光  
   
@胡某人-银联打杂人员-上海?好的 内容你来定 时间按你的优先 我们商量着来  
   
> 21:22:04  胡新松-银联  
   
好的  
   
> 21:22:24  胡新松-银联  
   
暂定6月中旬吧。谢谢  
   
> 21:23:34  韩财光  
   
好的 我们联系你细说[握手]  
   
> 21:23:50  胡新松-银联  
   
[抱拳]  
   
> 21:24:00  张泽雄-民生金服 项目总监  
   
问个问题，对于商户订单处理，有没有用引擎方案或状态机方案的？  
   
> 21:27:16  李钦珑-深圳优讯-PM  
   
[色][色][色]又是我  
   
> 21:27:36  黄朋英-易联支付PM  
   
优先级一般分类有哪些，会不会写死的，如何做成配置化  
   
> 21:28:12  黄朋英-易联支付PM  
   
权重占比又如何确定，是要用模型去跑的？  
   
> 21:29:15  张泽雄-民生金服 项目总监  
   
通道选择，本身就要模型的  
   
> 21:30:09  袁军-架构师-快捷通  
   
@英—易联（前）—产品  可以脚本动态计算  
   
> 21:32:27  韩财光  
   
@李小胖-支付PM-深圳?下次还手气好的话讲多一次吧[微笑]  
   
> 21:33:51  李钦珑-深圳优讯-PM  
   
好好好  
   
> 21:34:45  韩财光  
   
[握手]  
   
> 21:36:00  黄朋英-易联支付PM  
   
[OK]  
   
> 21:36:11  黄朋英-易联支付PM  
   
分享很给力  
   
> 21:37:18  杨继军-联想电商平台架构师  
   
嗯，给力  
   
> 21:38:01  袁军-架构师-快捷通  
   
#if((($time>=2350 || $time<=0050) && $targetInst=='CMB') || (($time>=2030 || $time<=0300) && $targetInst=='PSBC')) 50#elseif($partnerId == '200002394692'|| $partnerId == '200002394691') 200#else 130#end权重主要用来分配流量的，多个通道都要分点量。。  
   
> 21:39:16  李钦珑-深圳优讯-PM  
   
边分享边学习[呲牙]每天学习的内容太多  
   
> 21:42:07  黄朋英-易联支付PM  
   
[强]  
   
> 21:42:33  韩财光  
   
是啊 分享就相当于把自己的想法广播出来 多人可以从中受到启发 也可以帮助校验 一享多赢模式  
   
> 21:45:36  junzhu  
   
[强]  
   
> 21:52:00  黄朋英-易联支付PM  
   
支付路由在很多公司都是机密资料  
   
> 21:52:20  黄朋英-易联支付PM  
   
搜得到的很少，题主还分享代码  
   
> 21:53:21  李钦珑-深圳优讯-PM  
   
应该不涉及机密吧，就那么几个要素，然后成本最优[呲牙]  
   
> 21:57:25  黄朋英-易联支付PM  
   
之前在和别人讨论的时候发现这块很少，后面了解到这个的主体思想是先过滤不能用的，再对能用的进行优先级排序，个人理解  
   
> 21:59:37  张泽雄-民生金服 项目总监  
   
大体上就是这么回事，还要看你成本优先还是性能优先  
   
> 22:13:53  袁军-架构师-快捷通  
   
@张泽雄-民生金服-研发-北京     
   
> 22:13:54  袁军-架构师-快捷通  
   
![2017-05-25 22:13:54](http://static.cocolian.cn/img/20170525_221354.png) 
   
> 22:17:13  张泽雄-民生金服 项目总监  
   
这个状态机你们是怎么做的？规刚引擎+流程引擎做的么？  
   
> 22:17:30  张泽雄-民生金服 项目总监  
   
规则引擎  
   
> 22:17:59  thq  
   
drools?  
   
> 22:18:57  张泽雄-民生金服 项目总监  
   
我在考虑微引擎，实在不行自己写一个  
   
> 22:25:01  袁军-架构师-快捷通  
   
类似流程引擎的，也是代码实现的`  
   
> 22:28:18  张泽雄-民生金服 项目总监  
   
嗯，代码写也比较简单，也就那有限的状态切换再加上行为调用  
   
> 22:31:26  张泽雄-民生金服 项目总监  
   
商户通知也是在这层消息驱动的吧？  
   
