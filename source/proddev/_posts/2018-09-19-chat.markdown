---
layout:     source 
title:      "2018-09-19-WeChat"
date:       2018-09-19 12:00:00
author:     龚晓冬-银联-产品-上海
lines:      105 
tag:       [chat]
---
> 07:40:42  右军  
   
支付系统是一个繁杂的系统，其中涉及了各种错综复杂的业务流程，以上只是简单介绍了支付系统我们能看见的一些问题和设计，还有后续的系统保障没有写出来，没写出来的才是关键部分，比如：支付系统监控（业务监控分类、渠道监控、商户监控、账户监控）文章只是引子， 架构不是静态的，而是动态演化的。只有能够不断应对环境变化的系统，才是有生命力的系统。所以即使你掌握了以上所有的业务细节，仍然需要演化式思维，在设计的同时，借助反馈和进化的力量推动架构的持续演进。  
   
> 07:40:45  右军  
   
[山哥谈支付系统
](http://mp.weixin.qq.com/s?__biz=MzIxMzEzMjM5NQ==&amp;amp;amp;mid=2651030233&amp;amp;amp;idx=1&amp;amp;amp;sn=c8c4f3b1c175b1a9178ff9ebc0e90f9f&amp;amp;amp;chksm=8c4c57ddbb3bdecb9795124d8acbba61ddb2fd7d3a053498ba8c44e1f9aa9466399e21bdbb1f&amp;amp;amp;mpshare=1&amp;amp;amp;scene=1&amp;amp;amp;srcid=0919spPSof3y9C9uYIzbg2Vs#rd)  
   
> 07:49:30  daniel-希望金融-PM  
   
[强][强]  
   
> 07:49:49  程昱_群管理  
   
[强]  
   
> 07:54:47  王晓东-笑脸金融-架构  
   
> 08:43:19  ark-雪球-开发  
   
![2018-09-19 08:43:19](http://static.cocolian.cn/img/20180919_084319.png) 
   
> 08:59:40  王呼-腾讯-开发  
   
[强]  
   
> 09:00:38  龚晓冬-银联-产品-上海  
   
每天进步一点点，一年下来可以如数家珍了  
   
> 09:30:56  孙军+产品  
   
是的，每天进步一点点。  
   
> 09:35:56  程昱_群管理  
   
网联下一步是不是要成为这个角色  
   
> 09:35:56  程昱_群管理  
   
[港村大翻身——「转数快FPS」横空出世，完胜“银联 支付宝”？
](http://mp.weixin.qq.com/s?__biz=MzU3MjI0NTM0NQ==&amp;amp;amp;mid=2247485299&amp;amp;amp;idx=1&amp;amp;amp;sn=20a9bef6938089f9c60221d1fb443951&amp;amp;amp;chksm=fcd2937dcba51a6b23bb5739ee8773992d04c20a111257acc99650915f7554e5b4618a8dd3c4&amp;amp;amp;mpshare=1&amp;amp;amp;scene=1&amp;amp;amp;srcid=0918JhMOhp45HdtqkCXkRhOz#rd)  
   
> 09:37:21  程昱_群管理  
   
![2018-09-19 09:37:21](http://static.cocolian.cn/img/20180919_093721.png) 
   
> 09:42:46  程琳Wa-支付pm-上海  
   
想请教一下，分账是不是一定是先对主交易记账（且跟通道端对账之后）后在分账，举例：买家a在电商平台下单付款100元，付款成功，并确认收货。卖家b开通了自动分账，则分账规则通过这笔付款订单一起上送过来的（分到b1 50元、b2 30元、b3 20元）。暂时不考虑手续费且是t1结算： 步骤1.账务系统先记 100元收款（t日）并进冻结余额里； 步骤2.负责对账的系统次日(d1)跟通道端对账成功； 步骤3.然后（t1）账务系统先对100元做解冻同时拆分三笔 50、30、20分别记到b1、b2、b3的可提现余额。目前是不是都是这么处理的？  
   
> 09:43:20  龚晓冬-银联-产品-上海  
   
为啥要做的那么复杂！！  
   
> 09:52:31  程琳Wa-支付pm-上海  
   
那要怎么做[冷汗]  
   
> 09:52:50  程琳Wa-支付pm-上海  
   
我最近看了其他家的，自己理解下来是这么搞的  
   
> 09:53:01  龚晓冬-银联-产品-上海  
   
为何要冻结  
   
> 09:53:17  龚晓冬-银联-产品-上海  
   
这么做的目的是啥？  
   
> 09:53:52  龚晓冬-银联-产品-上海  
   
手续费是不是最简单的分账？  
   
> 09:53:53  Frank_待业青年  
   
不用这么麻烦  
   
> 09:54:10  Frank_待业青年  
   
分账是清算过程，所以不用考虑资金层面的冻结  
   
> 09:54:11  龚晓冬-银联-产品-上海  
   
为啥不在清算系统里面做规则啊  
   
> 09:54:37  Frank_待业青年  
   
遇到要冻结的，都是在结算层面做资金实际划拨才需要的  
   
> 09:54:59  程琳Wa-支付pm-上海  
   
不用冻结，直接 记完100元后，跟通道对完账之后直接分？  
   
> 09:55:06  Frank_待业青年  
   
哈哈哈哈，冬冬好凶，你这个把妹子都吓跑了  
   
> 09:55:10  Frank_待业青年  
   
不是  
   
> 09:55:13  summer-网金-pm  
   
这个实时翻译很6呀  
   
> 09:55:13  程琳Wa-支付pm-上海  
   
没有没有  
   
> 09:55:22  Frank_待业青年  
   
对账是分账的前提  
   
> 09:55:51  Frank_待业青年  
   
你必须对账完毕才能进入分账环节，否则很难对差异帐进行平账  
   
> 09:56:01  程琳Wa-支付pm-上海  
   
是的  
   
> 09:56:08  龚晓冬-银联-产品-上海  
   
@Frank_待业青年?不是啊，我现在不说，以后被开发骂  
   
> 09:56:24  右军  
   
咚咚有态度  
   
> 09:56:30  程琳Wa-支付pm-上海  
   
那是不是把步骤1里面的冻结和步骤3里面的解冻直接拿掉，其他流程上可行吗？  
   
> 09:57:00  程琳Wa-支付pm-上海  
   
我不怕骂，就怕不知道怎么死的[呲牙]。脸皮已经练出来了  
   
> 09:57:09  龚晓冬-银联-产品-上海  
   
@程琳Wa-支付pm-上海?不是拿掉，而是你之前为啥认为要冻结  
   
> 09:57:20  龚晓冬-银联-产品-上海  
   
既然你提出了产品方案，要有你的理由  
   
> 09:58:04  龚晓冬-银联-产品-上海  
   
如果自己都说服不了自己，那么产品没有权威的  
   
> 09:58:07  程琳Wa-支付pm-上海  
   
怕如果是t0结算，钱被结算掉[冷汗]。是不是考虑的太多了  
   
> 09:58:58  龚晓冬-银联-产品-上海  
   
冻结是最傻的办法  
   
> 09:59:09  Frank_待业青年  
   
我直接说一下过程 1、进行交易对账，处理差异帐，暂时无法处理的进行挂账； 2、根据清算规则，对于已经对账完毕的交易进行清算； 3、生成结算凭证，分别记录结算款b1 50元、b2 30元、b3 20元，同时生成挂账单； 4、结算系统根据结算凭证打款；  
   
> 09:59:28  Frank_待业青年  
   
T0结算是另外一回事  
   
> 09:59:53  Frank_待业青年  
   
T0结算方案，你要当做一定会发生资损进行设计  
   
> 10:00:21  Frank_待业青年  
   
要求商户缴纳保证金或确保追缴方案  
   
> 10:02:23  Frank_待业青年  
   
@程琳Wa-支付pm-上海 我这个是单纯的结论，你倒是真的要多看看冬冬说的，满关键的  
   
> 10:07:26  程琳Wa-支付pm-上海  
   
「 Frank_待业青年: 我直接说一下过程 1、进行交易对账，处理差异帐，暂时无法处理的进行挂账； 2、根据清算规则，对于已经对账完毕的交易进行清算； 3、生成结算凭证，分别记录结算款b1 50元、b2 30元、b3 20元，同时生成挂账单； 4、结算系统根据结算凭证打款； 」 - - - - - - - - - - - - - - - 如果是发生退款，是退款资金归集到一个退款专户里，然后在从退款专户退到b，从b在退回到原付款人账户？  
   
> 10:08:12  程琳Wa-支付pm-上海  
   
龚老师，目前t1结算的业务，当天的待清算款不是先进冻结余额里吗？[呲牙]  
   
> 10:09:35  程琳Wa-支付pm-上海  
   
@Frank_待业青年 挂账单的作用是什么？如果结算系统根据结算凭证打款成功后，挂帐单就抵消掉了，否则就一直处于挂帐状态？  
   
> 10:10:29  汪根-杭州-金百仕支付-研发  
   
我觉得账务应该有 下单后账务记账到 商户待结算户，对账后结算到 实际商户  
   
> 11:49:39  Frank_待业青年  
   
退款的话，会生成退款单，清算的时候就会处理，会在结算凭证中体现，例如给商户T日交易订单100元，然后退款订单10元，你的结算凭证就是90元，但是要有明细说明入账多少，退款或支付多少  
   
> 11:51:27  Frank_待业青年  
   
挂帐单是放在那边告诉商户，有异常交易待处理，每天的挂帐单都是累积的，挂帐的异常订单处理之后，才会从挂帐单里移除  
   
> 11:51:50  Frank_待业青年  
   
@程琳Wa-支付pm-上海?  
   
> 11:56:16  程琳Wa-支付pm-上海  
   
那是有异常交易才会生成挂账单，非异常交易不生成挂账单，对吗？  
   
> 11:58:28  程琳Wa-支付pm-上海  
   
如果是结算后，支持退款吗？  
   
> 11:58:42  程琳Wa-支付pm-上海  
   
@Frank_待业青年?[呲牙]，问题比较多[抱拳][抱拳][抱拳]  
   
> 12:03:06  Frank_待业青年  
   
一般是一场订单先挂帐，然后看出账前能否处理完，处理完就按处理后的结果清算，进结算凭证，处理不完就进入挂帐单，告知商户有异常交易正在处理  
   
> 12:05:31  龚晓冬-银联-产品-上海  
   
@程琳Wa-支付pm-上海?之前我分享的清算那块再看下  
   
> 12:05:36  Frank_待业青年  
   
结算后支持退款，但是退款流程需要考虑好如何从商户处扣款，扣款失败如何处置对用户是先行退款，还是等待商户扣款成功再退款，或者让用户和商户自行处理  
   
> 12:05:41  龚晓冬-银联-产品-上海  
   
你的问题里面都有写  
   
> 12:06:03  Frank_待业青年  
   
冬冬，在哪里，我也要看[呲牙]  
   
> 12:08:30  龚晓冬-银联-产品-上海  
   
[20171002-清算主体设计及差异处理
](http://mp.weixin.qq.com/s?__biz=MzI4OTQ3MTI2NA==&amp;amp;amp;mid=2247483865&amp;amp;amp;idx=1&amp;amp;amp;sn=d83567fde2f39719827dbf20262a71b9&amp;amp;amp;chksm=ec2fef96db5866803b686c3fb91f10b5f17dd3a4f39980be43767520237c54e0fc5c25fd5deb&amp;amp;amp;mpshare=1&amp;amp;amp;scene=1&amp;amp;amp;srcid=0919V4azAPsiLzjW77CXZKUC#rd)  
   
> 12:08:39  龚晓冬-银联-产品-上海  
   
@Frank_待业青年  
   
> 12:09:59  Frank_待业青年  
   
> 12:17:55  龚晓冬-银联-产品-上海  
   
A商户待结算资金+手续费=收单交易金额=银联清算资金+银联手续费成本  
   
> 12:18:15  龚晓冬-银联-产品-上海  
   
我们把公式再复杂变化一下  
   
> 12:19:05  龚晓冬-银联-产品-上海  
   
A商户待结算资金+B商户待结算资金+支付宝手续费+微信手续费+银联手续费=收单交易金额=银联清算资金+银联手续费成本+支付宝成本+微信成本  
   
> 12:20:24  龚晓冬-银联-产品-上海  
   
@程琳Wa-支付pm-上海?做清算先把计算公式写出来，然后就知道怎么设计，最后考虑用什么方式实现，否则本末倒置，写出来的方案毫无头绪  
   
> 12:21:59  龚晓冬-银联-产品-上海  
   
（A商户待结算资金+B商户待结算资金）+（支付宝手续费+微信手续费+银联手续费）=（某电商）收单交易金额=（某商户号）银联清算资金+银联手续费成本+支付宝成本+微信成本  
   
> 12:22:55  龚晓冬-银联-产品-上海  
   
@程琳Wa-支付pm-上海?在这个公式上再演变试试看  
   
> 12:50:24  程琳Wa-支付pm-上海  
   
如果按我上面分账举例的话：b商户待结算资金+（支付宝手续费+微信手续费+银联手续费）=（b1商户待结算资金+b2商户待结算资金+b3商户待结算资金）+（支付宝手续费+微信手续费+银联手续费）=（某电商）收单交易金额=（某商户号）银联清算资金+银联手续费成本+支付宝成本+微信成本，这样理解对吧？[呲牙]@龚晓冬-银联-产品-上海  
   
> 12:51:18  龚晓冬-银联-产品-上海  
   
@程琳Wa-支付pm-上海?对的，然后手续费还要再细分  
   
> 12:51:28  龚晓冬-银联-产品-上海  
   
因为退款要退手续费的  
   
> 12:52:36  龚晓冬-银联-产品-上海  
   
b1手续费，b2手续费，b3手续费，然后退款之后轧差处理  
   
> 12:53:00  龚晓冬-银联-产品-上海  
   
是不是觉得这样思路清楚很多了？  
   
> 12:57:04  乔俊翔-支付开发-AYM-杭州  
   
[强][强][强]  
   
> 13:10:46  程琳Wa-支付pm-上海  
   
龚老师，我细化了一下付款的手续费和退款轧差的公式，应该没问题吧？  
   
> 13:10:50  程琳Wa-支付pm-上海  
   
![2018-09-19 13:10:50](http://static.cocolian.cn/img/20180919_131050.png) 
   
> 13:12:44  龚晓冬-银联-产品-上海  
   
@程琳Wa-支付pm-上海?嗯，差不多，再复杂一点，长短款呢？  
   
> 13:26:41  程琳Wa-支付pm-上海  
   
龚老师，长短款的公式，支付公司长款的截图中非日切原因的需要手工调减的，是否都是财务线下打款过去通道那边？  
   
> 13:26:45  程琳Wa-支付pm-上海  
   
![2018-09-19 13:26:45](http://static.cocolian.cn/img/20180919_132645.png) 
   
> 13:27:02  龚晓冬-银联-产品-上海  
   
不是的  
   
> 13:27:15  龚晓冬-银联-产品-上海  
   
你这么理解又错了  
   
> 13:27:48  程琳Wa-支付pm-上海  
   
[冷汗]请指正  
   
> 13:28:34  龚晓冬-银联-产品-上海  
   
去问一下你们做清算的同事测  
   
> 13:28:58  程琳Wa-支付pm-上海  
   
是理解反了吗？  
   
> 13:29:24  龚晓冬-银联-产品-上海  
   
理解不正确  
   
> 13:31:18  程琳Wa-支付pm-上海  
   
好，我去问下  
   
> 13:31:32  程琳Wa-支付pm-上海  
   
谢谢龚老师  
   
> 13:33:11  龚晓冬-银联-产品-上海  
   
碰到资金的问题都可以用这个思路，会计基础知识  
   
> 13:34:30  程琳Wa-支付pm-上海  
   
嗯嗯  
   
> 13:36:10  龚晓冬-银联-产品-上海  
   
再看看你原来的方案  
   
> 13:40:35  程琳Wa-支付pm-上海  
   
龚老师，长短款能说我那块儿错了吗[冷汗]，这边的技术还没混熟，问个问题找专家也要找好几个  
   
> 13:43:11  龚晓冬-银联-产品-上海  
   
长短款是对账过程中发生的，长短款的原因很多  
   
> 13:43:17  龚晓冬-银联-产品-上海  
   
不是简单地退钱就好了  
   
> 13:44:21  程琳Wa-支付pm-上海  
   
哦哦  
   
> 17:51:19  黄冈-敦煌网-北京  
   
有做过微信公众号、小程序设备指纹的大神吗？求分享[抱拳]  
   
> 17:53:01  风者  
   
微信公众号做过  
   
> 17:55:26  黄冈-敦煌网-北京  
   
一般会抓取哪些信息？IMEI？@风者   
   
> 17:57:46  风者  
   
你就说指纹吗？  
   
> 17:58:52  黄冈-敦煌网-北京  
   
不是，设备指纹可以理解成给访问设备生成的唯一id  
   
> 18:01:39  施李荣-平安壹账通-上海  
   
@黄冈-敦煌网-北京?有H5设备指纹，靠被动信息的  
   
> 18:03:01  风者  
   
@黄冈-敦煌网-北京 啥需求？  
   
> 18:03:03  降峰 百度金融pm 北京  
   
cuid imei lbs  
   
> 18:04:00  黄冈-敦煌网-北京  
   
@施李荣-平安壹账通-上海 被动的准确率怎么样啊  
   
> 18:04:09  黄冈-敦煌网-北京  
   
@风者 反欺诈  
   
