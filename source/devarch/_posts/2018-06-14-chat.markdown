---
layout:     source 
title:      "2018-06-14-WeChat"
date:       2018-06-14 12:00:00
author:     PaymentGroup
lines:      55 
tag:		  [chat]
---
> 09:41:15  Zero  
   
大神们，请教个问题，mysql的delete 语句有类似select中 force index的方法，强制使用索引么?我现在有一条delete 语句批量删除数据，where 语句使用了索引，但是mysql在执行时并未使用索引，在删除的时候锁全表了。  
   
> 09:47:52  沪上十三少  
   
还能物理删除的...  
   
> 10:29:59  hgwym  
   
还能物理删除的...  
   
> 10:31:58  monk  
   
mysql hint 索引，搜  
   
> 10:32:49  monk  
   
坑自己踩过才知道，  
   
> 10:40:59  bill在飞  
   
Mysql不是有个机制，如果需要创建大量的行锁，那么会直接锁表吗？  
   
> 10:41:42  hgwym  
   
关键是看你索引的区分度高不高  
   
> 10:41:56  hgwym  
   
不高就锁表了  
   
> 10:42:35  Zero  
   
不是很高，所以是锁表的。。  
   
> 10:56:49  Zero  
   
force index只有select 才能用，如果delete 没有类似的方法，只能试试拆分delete语句了。  
   
> 11:24:50  so what   
   
delete * from xxx where id in (select id from xxx where column=bb)  
   
> 11:24:53  so what   
   
这样可以吧  
   
> 11:27:56  曹伟  
   
华伟开始做数据分析了？  
   
> 11:37:30  so what   
   
不是  
   
> 13:08:18  郭芬  
   
谁能够分享一下，系统间接口设计的规范？什么时候使用ESB，什么时候使用MQ，什么时候使用报文叫魂，什么时候使用同步，什么时候使用异步，接口的异常处理该怎么处理  
   
> 13:12:49  郭芬  
   
探讨下也好哈  
   
> 13:13:23  孔晓光-丰瑞祥-技术  
   
三个字：看需求  
   
> 13:13:37  地平线-文思-产品  
   
@郭芬-中央结算-信贷条线负责人 你要改成美女头像，才会有人回答的。[呲牙]  
   
> 13:15:07  郭芬  
   
一定是需要看业务场景的，但是我们希望能够制定一个规范，这样碰到具体问题的时候能够去套。  
   
> 13:15:37  杨宽  
   
能mq就mq  
   
> 13:15:40  郭芬  
   
不然大型项目开发，十几家开发公司，无法统一协调。  
   
> 13:15:47  杨宽  
   
基本上mq等同于异步  
   
> 13:16:03  杨宽  
   
这个不能靠规范，靠开发和架构能力  
   
> 13:16:09  杨宽  
   
具体场景具体来  
   
> 13:16:18  郭芬  
   
但是开发人员良莠不齐啊  
   
> 13:16:44  郭芬  
   
比如说对于服务粒度怎么划分才合适？  
   
> 13:16:51  孔晓光-丰瑞祥-技术  
   
你要的是协同开发规范  
   
> 13:16:56  孔晓光-丰瑞祥-技术  
   
不能进入场景  
   
> 13:17:03  孔晓光-丰瑞祥-技术  
   
场景是核心企业或者组织方要定义的  
   
> 13:17:19  郭芬  
   
我们就是组织方啊  
   
> 13:19:09  郭芬  
   
希望在接口层面，出一个总体设计，指导后续各个并行开发的项目的详细设计。  
   
> 13:19:36  孔晓光-丰瑞祥-技术  
   
那就要有一个架构团队来规范。  
   
> 13:20:48  郭芬  
   
分包的时候，没有分这么个团队，各个基础平台都已经搭好了。  
   
> 13:21:16  郭芬  
   
所以我们作为一个总体设计中的一个专项来处理  
   
> 13:23:53  疯狂钻石  
   
你们没有架构师嘛  
   
> 13:23:55  孔晓光-丰瑞祥-技术  
   
数据字典、公共编码、错误码、设计规范这些是一整套的，所有外包要遵循这些规范来开发  
   
> 13:24:09  孔晓光-丰瑞祥-技术  
   
至少要有个PMO组织来搞吧，这么大项目  
   
> 13:24:26  孔晓光-丰瑞祥-技术  
   
不然大家用什么技术框架来解决你们业务问题，保证系统一致性  
   
> 13:26:25  郭芬  
   
我们有一个PMO，来制定项目计划、项目进度，不负责具体设计环境。人稀缺，之前只有一个专门的架构师，要负责各个基础平台的建设，所以在业务系统设计阶段，被抓来负责这部分工作。  
   
> 13:26:54  孔晓光-丰瑞祥-技术  
   
哦，那就让这个架构师要牵头负责了，PMO落实。  
   
> 13:27:55  郭芬  
   
对对  
   
> 13:58:28  李东岳  
   
@郭芬-中央结算-信贷条线负责人?说说我的理解。首先，esb叫企业服务总线，mq是消息中间件，两个概念。简单点说，esb是管理mq用的，通常我们的esb干的是路由的活，也包含一些格式转换，签名验签的，最著名的应该是ibm的message brocker，开源的有个mule  
   
> 14:03:39  李东岳  
   
mq我只用过ibm的，通常都是点对点的，如果路由结构简单，可以不用esb的。我理解，只要用到mq，基本上就异步了。http的调用还可能是同步的。不过，如果是不同应用间的调用，能异步就异步  
   
> 14:15:49  hgwym  
   
我觉的你这个规范一定要有专门的架构师来制定，而且必须是契合你们系统业务的，因为你上面说的那些技术栈的使用都是和业务，和你们的规划（系统承载度等）紧密相关的  
   
> 14:19:28  北京一张泽雄  
   
接口规范这个得看业务，一般业务接口用同步接口，如果业务处理时间较长，可以改用异步。  
   
> 14:22:20  wood  
   
当年网联采用同步和异步也讨论了好久  
   
> 14:22:38  wood  
   
最后还是采用了支付宝和财付通的成熟方案，按同步做  
   
> 14:22:59  Daniel Liu  
   
异步还要通知，很麻烦的  
   
> 14:23:14  wood  
   
是，异常情况多，比较复杂  
   
> 14:23:21  Daniel Liu  
   
同步的问题就是性能，害怕超时  
   
> 14:23:44  wood  
   
超时就自动断  
   
> 14:24:53  Daniel Liu  
   
现在主流方案是同步调用，异步通知  
   
> 14:31:07  北京一张泽雄  
   
有些场景，比如信息同步通知，这种方式用异步是最好的，采用MQ就很合理  
   
> 14:32:46  北京一张泽雄  
   
用同步方案，前期要做好性能测试，否则容易出问题  
   
> 20:43:14  syu  
   
服务是tomcat，使用了spring，怎么防止有人恶意添加jsp绕过安全校验，直接访问某个接口？  
   
