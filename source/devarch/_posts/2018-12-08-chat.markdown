---
layout:     source 
title:      "2018-12-08-WeChat"
date:       2018-12-08 12:00:00
author:     张磊-信美-研发
lines:      92 
tag:       [chat]
---
> 10:53:59  wood-通联-技术  
   
ofo真的流氓  
   
> 10:54:20  wood-通联-技术  
   
堪比某些p2p  
   
> 12:23:15  路杨-嘉联支付-深圳  
   
[独家丨ofo剧中人：曾经5个月花掉72亿采购费，如今不愿谢幕
](http://mp.weixin.qq.com/s?__biz=MjM5MzM5NjM0MA==&amp;amp;amp;mid=2649971203&amp;amp;amp;idx=1&amp;amp;amp;sn=5f154029652a9810f0a2eb0f67ef2ff4&amp;amp;amp;chksm=be90591889e7d00ed648d6746b5564a7626e91823b320c31b3f286278ac0fd472cfea51d4040&amp;amp;amp;mpshare=1&amp;amp;amp;scene=1&amp;amp;amp;srcid=1207Ekh40YFQQkGMbyiowUaE#rd)  
   
> 13:10:35  李秀刚-TRHUI-产品  
   
![2018-12-08 13:10:35](http://static.cocolian.cn/img/20181208_131035.png) 
   
> 13:10:58  李秀刚-TRHUI-产品  
   
ofo真的穷疯了  
   
> 13:11:12  李秀刚-TRHUI-产品  
   
![2018-12-08 13:11:12](http://static.cocolian.cn/img/20181208_131112.png) 
   
> 13:12:02  李秀刚-TRHUI-产品  
   
只坐了6分钟，3块钱  
   
> 13:12:17  深圳-产品-黄朋英  
   
折旧费??   
   
> 13:13:24  钟鸿敏-技术VP  
   
这不是作死么  
   
> 13:14:47  wood-通联-技术  
   
所以说流氓  
   
> 13:17:16  达达-长银五八-开发  
   
现在流行哈罗单车助力车  
   
> 13:21:42  连杰鑫-VP -Shangha  
   
ofo还是太年轻了，团队没经验，一手好牌打烂了。  
   
> 13:26:58  胡桥-资邦金服-账务核心业务架构  
   
是不是本来就是骗钱的  
   
> 13:32:57  韩国才-软通动力-java开发  
   
app都不维护了好像  
   
> 13:40:20  zz-工行-架构师  
   
@右军-蚂蚁金服-成都?您好，请问中台的资料还能再分享下吗？之前您分享那个已经删除了。谢谢。  
   
> 13:58:23  wood-通联-技术  
   
看书吧  
   
> 13:58:40  wood-通联-技术  
   
阿里有本书专门讲这个的  
   
> 13:59:23  wood-通联-技术  
   
企业IT架构转型之道：阿里巴巴中台战略思想与架构实战  
   
> 14:00:07  zz-工行-架构师  
   
收到，谢谢。@wood-通联-技术  
   
> 14:02:46  a( ￣??￣)a豪  
   
有没有银联业务的书  
   
> 14:02:54  a( ￣??￣)a豪  
   
或者有关于银联系统  
   
> 14:36:41  wood-通联-技术  
   
银联都是规范  
   
> 14:36:45  wood-通联-技术  
   
各种规范  
   
> 14:38:09  右军-蚂蚁金服-成都  
   
@zz-工行-架构?企业IT架构转型之道：阿里巴巴中台战略思想与架构实战  
   
> 14:39:47  振效+神州信息+支付  
   
我记得银联会提供官方的这些文档，如果要接的话，可以问一问银联官方的吧  
   
> 15:41:59  zz-工行-架构师  
   
@右军-蚂蚁金服-成都?收到，谢谢。  
   
> 19:31:08  Elva-支付产品经理-北京  
   
今天请到一位朋友，@张磊-信美-研发-北京?给大家做分享，主题是 “保险资金及凭证对账” 开始时间为【20:00】；欢迎欢迎[鼓掌][鼓掌][鼓掌]！（注： 1.嘉宾分享期间其他人不要发言打断嘉宾分享。2.分享完成后请大家积极补充和提问；3.烦请打“签到”，做签到，谢谢！)  
   
> 19:31:17  Elva-支付产品经理-北京  
   
欢迎??????  
   
> 19:31:21  Elva-支付产品经理-北京  
   
签到  
   
> 19:31:32  袁增辉-易联汇华-技术主管-北京  
   
签到  
   
> 19:31:36  崔鹏-gomepay-产品  
   
签到  
   
> 19:31:44  大圣-黄金钱包-开发  
   
签到  
   
> 19:31:44  追梦－拉卡拉－北京－技术经理  
   
签到  
   
> 19:32:57  j4念勾for-TAL-开发  
   
签到  
   
> 19:33:29  SP-ctcf-架构  
   
签到  
   
> 19:33:29  王高翔-Silot-SG  
   
签到  
   
> 19:33:48  李小胖-优讯-打杂  
   
签到  
   
> 19:38:28  李胜勇-永乐-G  
   
签到  
   
> 19:38:34  梁雷-联动优势-项目经理  
   
签到  
   
> 19:39:12  dreamup-平安-产品  
   
签到  
   
> 19:42:11  吕波-融投世界科技-技术总监-沈阳  
   
签到  
   
> 19:42:39  mouse-xn-开发-深圳  
   
签到  
   
> 19:46:02  hgwym-传化支付-技术经理  
   
签到  
   
> 19:53:33  Seven~乾道~产品~北京  
   
签到  
   
> 19:56:02  聚合支付_程昱  
   
签到  
   
> 19:56:50  胡文刚_卓健_产品经理_杭州  
   
签到  
   
> 19:56:57  盛付通—侯哥  
   
签到  
   
> 19:57:17  武亚斌-投哪网-产品-深圳  
   
签到  
   
> 19:58:00  曾卓-长丰集团-架构师-长沙  
   
签到  
   
> 19:59:31  顾文烨-上海银行-产品-上海  
   
签到  
   
> 20:03:12  风兮-久誉-Java技术  
   
签到  
   
> 20:04:13  Elva-支付产品经理-北京  
   
请各位稍等一会 作者可能有事耽误了  这会还没联系上[尷尬][尷尬]  
   
> 20:11:12  Elva-支付产品经理-北京  
   
各位好 作者这边有点临时情况 分享时间改到20:30   
   
> 20:11:17  Elva-支付产品经理-北京  
   
> 20:14:05  王子硕-爱农支付-技术  
   
签到  
   
> 20:16:28  安全公司—-安全测试—屁亮  
   
签到  
   
> 20:17:25  Cc老曹-英之泰-技术  
   
签到  
   
> 20:24:02  郑宇贤-惠丰-支付产品-广州  
   
签到  
   
> 20:28:38  张震南-信雅达-互联网支付-杭州  
   
签到  
   
> 20:28:59  熊沁-维金-方案  
   
签到  
   
> 20:30:40  阿里产品-冯爽  
   
签到  
   
> 20:30:56  张磊-信美-研发  
   
大家好，下面我进行分享，今天的主题是“保险资金及凭证对账”  
   
> 20:32:22  张磊-信美-研发  
   
从以下三个方面进行简单介绍： 1、收付及记账流程 2、对账系统逻辑架构 3、对账链路  
   
> 20:33:03  张磊-信美-研发  
   
1、收付及记账流程 1）保险公司的收付款常见的场景有：保险业务（新契约、保全、理赔、续期等），费用业务（员工报销、对外费用结算等），保险公司的收付费业务一般并发量不会很大，但是金额可能会比较大。 2）收付费业务的发起端，我们可以统称为是业务系统。 3）一笔资金收付的数据处理流程如下： 第一步，资金支付接收交易请求，先进行有效性校验，通过后，进行支付分流并保存数据到数据库。 第二步，请求支付网关进行资金收付。 第三步，返回收付结果给业务系统。 第四步，调用会计引擎，生成财务明细。 第五步，会计引擎，生成汇总凭证，过账到总账系统（每天一次）。  
   
> 20:34:07  张磊-信美-研发  
   
2、对账系统逻辑架构  
   
> 20:34:59  张磊-信美-研发  
   
3、对账链路 3.1 对账链路 对账包含两部分，一部分是资金对账、一部分是凭证对账。 资金对账核对对象：保险公司的企业银行账户账单、支付机构的账单、资金支付系统内的明细数据。 凭证对账核对对象：资金支付的明细数据、会计引擎的财务明细数据、总账系统的凭证。  
   
> 20:35:31  张磊-信美-研发  
   
3.2 资金对账流程 第一步，资金流水与机构账单对账，一般有唯一的ID可以关联匹配。 第二步，与机构账单平账的部分，再和企业账单对账，如果和机构账未平，则不与企业账单对账。 3.3 资金对账模式 保险公司会接入多家支付机构，如通联、银联、支付宝等等。 不同的机构，入账到企业账户账单的方式可能会不同，大体分为如下几种： a）明细入账，每一笔交易流水在银行账单都有体现。 b）按批次汇总入账，每个交易批次包含多笔资金流水，按批次汇总入账单一笔。 c）按日汇总入账，一天内全部交易汇总一笔入账到银行账单。 3.4 凭证对账 核对对象是资金支付流水、会计引擎、总账系统。 这部分的核对关系比较明确，一般是根据主键进行金额、科目等关键字段的核对。 一个对账的复杂点在于，可能存在记错账的情况，记错账的时候，会由运维等发起冲销的操作，就会造成一个业务数据产生3个凭证的情况。 例如：一笔交易 +100元，金额计算错误，需要修改为120元。 原记录：A：+100元 冲销记录：B：-100元 冲销记录：C：+120元 这样的场景，如果冲销时间不在同一天，记账日期也不在同一天的话，那么ABC明细会产生3个凭证。 在对账时，需要将ABC三个凭证放在一起进行对账才能平账。  
   
> 20:37:24  张磊-信美-研发  
   
最后，每一个平账的对账结果，会显示出，一个SAP凭证会对应一笔或多笔资金流水，每一笔资金流水也会对应到一笔或多笔SAP凭证，以满足外审的查验。  
   
> 20:38:09  张磊-信美-研发  
   
我今天的分享是这么多，谢谢大家聆听，欢迎大家提问。  
   
> 20:51:03  j4念勾for-TAL-开发  
   
资金对账，是通过自己单进行核对吗？  
   
> 20:51:11  j4念勾for-TAL-开发  
   
资金单  
   
> 20:53:22  张磊-信美-研发  
   
资金对账核对三方：资金系统的交易流水，支付机构的对账单，资金出入账账户的银行对账单文件  
   
> 20:54:59  j4念勾for-TAL-开发  
   
资金的流水从交易来的吗？  
   
> 20:55:16  j4念勾for-TAL-开发  
   
资金的在途、已达你们都是怎么来处理的  
   
> 20:55:44  SP-ctcf-架构  
   
@张磊-信美-研发-北京?多大的数据量对账  
   
> 20:57:31  上海-上海中钢银联通-董路-技术  
   
对账发现问题，你们是人工处理吗？原始交易状态或金额怎么调整？  
   
> 20:59:27  张磊-信美-研发  
   
@j4念勾for-TAL-开发? 对账的数据抽取只核对已达账。每次对账抽取的是对账日及之前的未平账，所以未平的交易会每日滚动对账，直至对平，否则每天都会核对  
   
> 21:01:02    
   
> 21:01:14  张磊-信美-研发  
   
@j4念勾for-TAL-开发?未达账不在对账阶段发现，会在资金支付系统设置一些预警，比如超过2个小时未达的交易进行预警，人为联系机构确认等  
   
> 21:01:21  j4念勾for-TAL-开发  
   
@张磊-信美-研发-北京 已达是以银行的已达来处理是吧？  
   
> 21:04:37  张磊-信美-研发  
   
「csp-架构-深圳：@张磊-信美-研发-北京?多大的数据量对账」 - - - - - - - - - - - - - - - 目前生产数据量是万级，另外一个项目数据量比较大，上亿级，但是暂停了，没有上线。  
   
> 21:07:28  张磊-信美-研发  
   
「上海-上海中钢银联通-董路-技术：对账发现问题，你们是人工处理吗？原始交易状态或金额怎么调整？」 - - - - - - - - - - - - - - - 对账发现的问题，现在是人工介入分析，确认原因，如果是系统错误导致金额错误等问题，那么会进行冲账等操作，原始的交易一般不会改动。比如如果收钱收多了，会再手工退回给客户，那么同时也会记录汇款的SAP账  
   
> 21:11:28  张磊-信美-研发  
   
「j4念勾for-TAL-开发：@张磊-信美-研发-北京 已达是以银行的已达来处理是吧？」 - - - - - - - - - - - - - - - 我们是以资金系统的已达为准的，因为银行对账单里面的交易一定是已达的。 那么会抽取资金系统已达的数据与银行账单核对。 资金系统未达，而银行已达的情况，目前我们是通过预警的方式进行发现。一般是T+1对账成功，如果发生日切，那么滚动对账，T+2可以对平。  
   
> 21:20:57  j4念勾for-TAL-开发  
   
@张磊-信美-研发-北京 感谢[抱拳]  
   
> 21:23:35  上海-上海中钢银联通-董路-技术  
   
如果发现交易系统未成功，而银行已经成功，你们是怎么修改交易状态的？  
   
> 21:23:58  SP-ctcf-架构  
   
上亿的还是一条一条对？  
   
> 21:29:55  张磊-信美-研发  
   
「上海-上海中钢银联通-董路-技术：如果发现交易系统未成功，而银行已经成功，你们是怎么修改交易状态的？」 - - - - - - - - - - - - - - - 一般分为两种情况， 1、银行成功，但是支付机构未成功，保险公司未成功。 	发现问题后联系到支付机构确认交易情况，如是支付机构状态未更新，则由支付机构修复交易状态，修复后，对未达交易进行异常交易补偿处理，或者我们自动查询机构状态，或者支付机构推送状态。 2、银行成功、支付机构成功，保险公司未成功。 	一般通过交易补偿，查询支付机构的状态，更新保险公司的交易结果。  
   
> 21:33:48  张磊-信美-研发  
   
「csp-架构-深圳：上亿的还是一条一条对？」 - - - - - - - - - - - - - - - 我们的方案是通过阿里的ODPS大数据平台进行处理，一次比对一般是两张单表进行比对，结果会插入到另一张结果表。 因为ODPS是大数据平台，那么对单表数量没有限制。但是从方案角度来讲，会对已平账数据进行归档，也会通过表分区的方式划分开已平账和未平账。  
   
> 21:35:03  上海-上海中钢银联通-董路-技术  
   
专业[强]  
   
> 21:58:35  双乾支付韩伟  
   
专业[强]  
   
> 23:39:39  北京一张泽雄  
   
有认识36氪的朋友吗，求介绍，谢谢  
   
> 23:51:01  上海睿民-陈帅康-项目经理  
   
要谈什么  
   
