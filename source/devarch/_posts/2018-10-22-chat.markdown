---
layout:     source 
title:      "2018-10-22-WeChat"
date:       2018-10-22 12:00:00
author:     None
lines:      69 
tag:       [chat]
---
> 15:23:25  北京-中投科信-张冠杰  
   
各位老师，请教大家个问题，请问微信的h5支付和公众号支付的区别是什么？因为我了解h5支付是用在公众号内， 由网页发起的微信支付请求。但是现在的微信接口里面h5和公众号是不同的支付能力，所以想问一下具体的区别在哪里  
   
> 15:24:23  j4念勾for-TAL-开发  
   
H5使用的是非微信内置浏览器，公众号使用的是微信内置浏览器  
   
> 15:24:52  达达-长银五八-开发  
   
H5支付用在移动浏览器吧   
   
> 15:25:14  hgwym-传化支付-技术经理  
   
H5支付是通用的移动浏览器都可以  
   
> 15:25:22  hgwym-传化支付-技术经理  
   
公众号只能在微信  
   
> 15:26:37  北京-中投科信-张冠杰  
   
那是不是可以理解为：h5是可以用在包括微信和其他浏览器来进行支付的功能？  
   
> 15:26:49  Java-易付通-顺强  
   
H5可以使用微信内置浏览器吗？  
   
> 15:27:33  j4念勾for-TAL-开发  
   
h5不可以使用微信内置的浏览器  
   
> 15:29:10  北京-中投科信-张冠杰  
   
[抱拳]  
   
> 17:50:11  程琳Wa-杉德支付-产品-上海  
   
请教一个问题：在交易发生的时候，支持一笔订单实时入账到30个账户（即分账的功能），对交易核心和账务核心压力很大吗？  
   
> 17:51:20  田国伟 ～百胜软件～产品  
   
有没有谁对接过微信卡券？  
   
> 17:52:09  程琳Wa-杉德支付-产品-上海  
   
交易核心的开发说 加了分账功能后（当前入账到5个账户） 性能直接下降30%[冷汗]  
   
> 17:53:04  j4念勾for-TAL-开发  
   
为什么要实时？  
   
> 17:53:10  j4念勾for-TAL-开发  
   
准实时不可以吗？  
   
> 17:53:12  老熊-头条-技术  
   
评估下后是否可以异步分账。   
   
> 17:53:15  上海睿民-陈帅康-项目经理  
   
会有一定的影响，但如果是直接下降30%有点太夸张了，可以换种实现方式  
   
> 17:53:33  DON-通联-研发  
   
准实时就可以了  
   
> 17:53:49  j4念勾for-TAL-开发  
   
这还涉及了分布式事务，稍出点问题就是大事故，感觉业务设计不是很好  
   
> 17:53:59  程琳Wa-杉德支付-产品-上海  
   
「 j4念勾for-TAL-开发: 准实时不可以吗？ 」 - - - - - - - - - - - - - - - 准实时 是5分钟以内？  
   
> 17:54:38  j4念勾for-TAL-开发  
   
准实时得看你的系统处理能力了  
   
> 17:54:39  程琳Wa-杉德支付-产品-上海  
   
「 老熊-头条-技术: 评估下后是否可以异步分账。  」 - - - - - - - - - - - - - - - 异步分账，是指主交易先完成（拿到通道返回的支付结果），然后在分账？  
   
> 17:55:28  程琳Wa-杉德支付-产品-上海  
   
现在的问题就是 底层不放开 到30，业务系统就要加接口允许 多次分账，这样复杂性就落在业务系统里了  
   
> 17:55:39  老熊-头条-技术  
   
是的。   
   
> 17:56:38  DON-通联-研发  
   
主交易成功，异步再分出去就可以了  
   
> 17:57:22  j4念勾for-TAL-开发  
   
而且分账，你不设计一个对账吗？  
   
> 17:57:39  j4念勾for-TAL-开发  
   
风险会不会有点高  
   
> 17:57:42  程琳Wa-杉德支付-产品-上海  
   
我们目前就是异步入账的，只是就是 入账账户当前是5个，要放宽到30个。底层开发说影响性能，可能会有死锁的概率。（为啥会有死锁）  
   
> 17:58:05  程琳Wa-杉德支付-产品-上海  
   
「 j4念勾for-TAL-开发: 风险会不会有点高 」 - - - - - - - - - - - - - - - 你说业务系统允许多次调用单独的分账接口，风险比较高？  
   
> 17:58:35  程琳Wa-杉德支付-产品-上海  
   
「 j4念勾for-TAL-开发: 而且分账，你不设计一个对账吗？ 」 - - - - - - - - - - - - - - - 要对账的，商户跟支付公司对，业务系统跟核心系统对  
   
> 18:00:05  j4念勾for-TAL-开发  
   
资金风险  
   
> 18:01:04  钟鸿敏-技术VP  
   
对于系统原有的分布式来说都没区别，无论你是1个账户还是30个账户RPC都得这样调，唯一就是账户系统在一个事务里完成30笔记账而已，不应该对性能影响这么大，即便更新要用到物理锁  
   
> 18:03:35  钟鸿敏-技术VP  
   
如果你是每个账户更新都要调一次账户系统，那就是30次RPC调用了，这是设计问题了，因为你要的是实时，就不提异步方案了  
   
> 18:04:17  程琳Wa-杉德支付-产品-上海  
   
我是主交易完成之后，异步入账到30个账户的，不算实时，应该算准实时了。  
   
> 18:05:01  张海亮-中化-高级JAVA-北京  
   
记账和交易分开，加个准实时对账呢  
   
> 18:05:23  程琳Wa-杉德支付-产品-上海  
   
「 j4念勾for-TAL-开发: 资金风险 」 - - - - - - - - - - - - - - - 这个资金风险是指，原交易100块，分账调用分账接口多次，由于并发的问题会导致 分账金额合计超过100元？  
   
> 18:05:29  胡桥-资邦金服-账务核心业务架构  
   
记账为啥要和交易分开?@张海亮-中化-高级JAVA-北京  
   
> 18:05:46  j4念勾for-TAL-开发  
   
准实时对账，这个得三方支持吧，不然你哪儿来对账单？  
   
> 18:05:55  程琳Wa-杉德支付-产品-上海  
   
「 张海亮-中化-高级JAVA-北京: 记账和交易分开，加个准实时对账呢 」 - - - - - - - - - - - - - - - 准实时对账 是怎么操作的，现在不都是日终跑批的时候对账吗？  
   
> 18:05:57  j4念勾for-TAL-开发  
   
最多能做商户对，无法做平台对  
   
> 18:06:24  张海亮-中化-高级JAVA-北京  
   
交易量高的话，你这个分帐肯定有影响，应该影响也不小  
   
> 18:06:38  张海亮-中化-高级JAVA-北京  
   
但到不至于30%  
   
> 18:07:04  梁燕东-亿付数字-研发主管  
   
准实时核对  是针对内部分账的交易和这笔主单核对   和三方没关系吧  
   
> 18:07:11  张海亮-中化-高级JAVA-北京  
   
交易完了，mq给到记账服务  
   
> 18:07:19  张海亮-中化-高级JAVA-北京  
   
对内部交易  
   
> 18:07:34  张海亮-中化-高级JAVA-北京  
   
对分帐  
   
> 18:07:42  钟鸿敏-技术VP  
   
分账接口如果不支持批量分账那本身设计上就有性能问题了  
   
> 18:07:58  张海亮-中化-高级JAVA-北京  
   
底层给不到30，你就抽象个记账服务  
   
> 18:08:32  张海亮-中化-高级JAVA-北京  
   
交易和记账服务用用有序的mq  
   
> 18:08:55  程琳Wa-杉德支付-产品-上海  
   
「 张海亮-中化-高级JAVA-北京: 底层给不到30，你就抽象个记账服务 」 - - - - - - - - - - - - - - - 自己拆分成6次，每次送5个入账账户？  
   
> 18:09:01  张海亮-中化-高级JAVA-北京  
   
看用户账户实时接收度了  
   
> 18:09:22  张海亮-中化-高级JAVA-北京  
   
嗯  
   
> 18:09:50  张海亮-中化-高级JAVA-北京  
   
比如一笔交易，用户多久看到账户余额更新  
   
> 18:09:53  张海亮-中化-高级JAVA-北京  
   
它能接受  
   
> 18:10:49  程琳Wa-杉德支付-产品-上海  
   
一般2分钟以内 问题不大  
   
> 18:12:02  张海亮-中化-高级JAVA-北京  
   
不行的话，分账在做到账户异步的粒度，  
   
> 18:12:30  张海亮-中化-高级JAVA-北京  
   
柔性事务  
   
> 18:12:45  张海亮-中化-高级JAVA-北京  
   
这些我自己的理解啊[微笑]  
   
> 18:12:52  张海亮-中化-高级JAVA-北京  
   
不晓得行不行  
   
> 18:36:00  程琳Wa-杉德支付-产品-上海  
   
[呲牙][呲牙][呲牙]看有经验的大神的意见了  
   
> 18:37:11  程琳Wa-杉德支付-产品-上海  
   
@j4念勾for-TAL-开发?@张海亮-中化-高级JAVA-北京?@钟鸿敏-CF-技术VP-深圳?谢谢三位??????  
   
> 18:40:40  张海亮-中化-高级JAVA-北京  
   
无非就是不影响交易性能，不影响记账性能，主要问题怎么保证准确性，交易量不大的话，怎么样都行。[抱拳]，共同进步  
   
> 19:31:02  右军-蚂蚁金服-成都  
   
[希冀和梦想：“IT民工”的朋友圈 | 1024程序员节豪华福利
](http://mp.weixin.qq.com/s?__biz=MzIxMzEzMjM5NQ==&amp;amp;amp;mid=2651030385&amp;amp;amp;idx=1&amp;amp;amp;sn=bbf847ad1fa3867a1349c7d1a2a57a6e&amp;amp;amp;chksm=8c4c5675bb3bdf63ffa89286bdd48f0ce091d41cfa4b95d2b16bb739a936f65c749b8e483788&amp;amp;amp;mpshare=1&amp;amp;amp;scene=1&amp;amp;amp;srcid=1022w4uL9f4z26Ro7hyhWKBm#rd)  
   
> 19:33:03  程琳Wa-杉德支付-产品-上海  
   
其实比较想知道，其他家的做法是：方案一、入账账户放开到30。方案二、提供单独分账接口一笔订单允许多次分账（业务系统需要控制多次分账金额之和=主订单金额）。那种做法比较常见[呲牙]  
   
> 19:37:45  张天辉-饿了么-产品-上海  
   
这个分账钱是先到公司账户上再分出去吗，还是可以做到不经过公司账户  
   
> 20:47:00  程琳Wa-杉德支付-产品-上海  
   
分账解决的核心问题就是不过公司账户（平台）直接去上游（供应商）账户  
   
> 20:48:40  j4念勾for-TAL-开发  
   
你这个分账是多个商品合并支付，然后钱收到一个总收款账户，然后从总收款账户分出去？  
   
> 20:52:07  程琳Wa-杉德支付-产品-上海  
   
这是一种场景  
   
> 20:56:33  Elin-Hls-产品经理-广州  
   
多个商品是在支付前就拆单？  
   
> 22:19:07  上海-上海中钢银联通-董路-技术  
   
[新个税重大利好！有独生子女证的恭喜了！不知道这些的要吃大亏！
](http://mp.weixin.qq.com/s?__biz=MzIxODE3MjI5NQ==&amp;amp;amp;mid=2652010427&amp;amp;amp;idx=1&amp;amp;amp;sn=37df0d7a3ebaa5fb785afcfecb4cd6ac&amp;amp;amp;chksm=8c084953bb7fc04503f0d0f69f0463266eea0f2f9b9a610fa12fca096bdcf382f9dda4756472&amp;amp;amp;mpshare=1&amp;amp;amp;scene=1&amp;amp;amp;srcid=1022JZb3oZuBnmRSoSVqA6kY#rd)  
   
