---
layout:     source 
title:      "2018-08-05-WeChat"
date:       2018-08-05 12:00:00
author:     上海-上海中钢银联通-董路-技术
lines:      155 
tag:       [chat]
---
> 11:43:25  老熊-头条-支付PL  
   
目前群里只有20个名额了，近期还会对群做一次清理。 请新入群的同学、未安排分享的同学，尽快完成分享登记。 谢谢大家。   
   
> 11:43:28  老熊-头条-支付PL  
   
http://wiki.cocolian.cn/pages/viewpage.action?pageId=4292754    
   
> 12:59:45  无缺-杭州-后端  
   
@老熊-头条-支付PL?可以分享其他不，比如idea的使用[捂脸]  
   
> 13:00:35  java-文思海辉  
   
@老熊-头条-支付PL?可以分享其他的么 比如汽车后市场产品方面  
   
> 13:02:06  王成龙-新浪跨境支付-研发  
   
支付相关技术能分享下也是挺好的[可怜]  
   
> 13:06:11  拉卡拉-市场-老孙  
   
@王成龙-新浪跨境支付-研发?现在港股打新是不是能走你们开户  
   
> 13:07:56  梁子龙-维恩贝特-开发  
   
@王成龙-新浪跨境支付-研发? 大牛，分享下SWIFT吧  
   
> 13:08:12  王成龙-新浪跨境支付-研发  
   
@拉卡拉-市场-老孙 这个我还真的不太清楚，刚入职两周  
   
> 13:08:47  王成龙-新浪跨境支付-研发  
   
自己还在了解业务呢[呲牙]  
   
> 13:10:32  王成龙-新浪跨境支付-研发  
   
@梁子龙-维恩贝特-开发 我还等着别人给我讲解呢[流汗]  
   
> 13:10:33  梁子龙-维恩贝特-开发  
   
 工作顺利   
   
> 13:12:00  王成龙-新浪跨境支付-研发  
   
因为新浪今年刚拿到牌照，还是个小项目组，有些地方还在摸索  
   
> 13:12:36  大圣-黄金钱包-开发  
   
新浪不是之前就有支付牌照了么？  
   
> 13:13:24  王成龙-新浪跨境支付-研发  
   
跨境业务的好像没有  
   
> 13:13:38  王成龙-新浪跨境支付-研发  
   
具体我还不是特别清楚  
   
> 13:15:06  拉卡拉-市场-老孙  
   
跨境现在跟洗钱基本划等号  
   
> 13:15:08  拉卡拉-市场-老孙  
   
哎  
   
> 13:20:05  老熊-头条-支付PL  
   
@无缺-数心-开发 @java-文思海辉  可以的。  
   
> 13:22:08  无缺-杭州-后端  
   
我有做好的ppt  
   
> 13:22:21  无缺-杭州-后端  
   
那下次发群里  
   
> 13:23:45  老熊-头条-支付PL  
   
[OK]，记得预约个日期。   
   
> 13:24:18  无缺-杭州-后端  
   
好的  
   
> 16:54:17  丁丁-群管理  
   
今天请到一位嘉宾，@上海-上海中钢银联通-董路-技术  给大家做分享，主题是 “多订单混合支付支付系统搭建” 开始时间为【19:30】；欢迎欢迎[鼓掌][鼓掌][鼓掌]！（注： 1.嘉宾分享期间其他人不要发言打断嘉宾分享。2.分享完成后请大家积极补充和提问；3.烦请打“签到”，做签到，谢谢！)  
   
> 16:54:30  丁丁-群管理  
   
欢迎欢迎[鼓掌][鼓掌][鼓掌]  
   
> 16:54:53  帅慧-数据-产品  
   
签到  
   
> 16:55:03  micheal 简米 开发  
   
签到  
   
> 16:55:04  风兮-Java技术-上海  
   
签到  
   
> 16:55:15  果立橙-supernova-dataer  
   
签到  
   
> 16:55:23  李秀刚-TRHUI-鼓励师  
   
多订单混合支付？是什么场景下？  
   
> 16:55:54  李秀刚-TRHUI-鼓励师  
   
现在在淘宝上买东西都还不能把多个卖家的钱一次性支付，是要解决这个问题的吗  
   
> 16:56:14  mouse-xn-开发-深圳  
   
签到  
   
> 17:00:16  黎明-金投-项目-杭州  
   
签到  
   
> 17:05:18  张震南-信雅达-互联网支付-杭州  
   
签到  
   
> 17:05:48  秦红胜-共致开源-架构师  
   
签到  
   
> 17:07:09  弋碎-国美-产品  
   
签到  
   
> 17:07:15  李凯-潇湘支付-产品-长沙  
   
签到  
   
> 17:07:29  曾卓-长丰集团-架构师-长沙  
   
签到  
   
> 17:07:45  永明-云账户-开发-北京  
   
签到  
   
> 17:08:31  班纳睿-RRD-Java开发-北京  
   
签到  
   
> 17:08:51  梁考拉-博时-资金清算-北京  
   
签到  
   
> 17:10:46  帅慧-数据-产品  
   
京东上自营的产品和第三方商家的商品可以一起支付吧  
   
> 17:10:49  陈才林-产品-时代科技-广州  
   
签到  
   
> 17:10:52  Adun-爱云-研发-南京  
   
签到  
   
> 17:10:59  吕波-融投世界科技-技术总监-沈阳  
   
签到  
   
> 17:11:08  dreamup-平安-产品  
   
签到  
   
> 17:11:12  拉卡拉-市场-老孙  
   
合并支付空中分账没啥问题啊  
   
> 17:11:40  帅慧-数据-产品  
   
空中分账～  
   
> 17:11:50  帅慧-数据-产品  
   
名词解释一下  
   
> 17:13:17  拉卡拉-市场-老孙  
   
就说根据不同订单号清分啊  
   
> 17:14:39  Jerry-BOCS-BDM-昆明  
   
签到  
   
> 17:15:51  李胜勇-永乐-G-北京  
   
签到  
   
> 17:20:25  胡倩颖-渠道-北京  
   
签到  
   
> 17:22:18  浅橙现金卡-支付中心-施富宇  
   
签到  
   
> 17:22:52  刘侨-易贷-北京  
   
签到  
   
> 17:23:00  追梦-区块链-北京-技术经理  
   
签到  
   
> 17:23:28  夜月沉星-gtxy-产品-福州  
   
签到  
   
> 17:25:42  梁子龙-维恩贝特-开发  
   
签到  
   
> 17:26:15  申彬彬-随行付-PM-北京  
   
签到  
   
> 17:26:45  中金支付～开发～翔远  
   
签到  
   
> 17:26:57  周晓波-拉卡拉-产品  
   
签到  
   
> 17:29:00  杨杰-康城投资-开发-上海  
   
签到  
   
> 17:30:46  王晓强-绿地金控-技术-上海  
   
签到  
   
> 17:33:09  邓杰-移联-Java-深圳  
   
签到  
   
> 17:37:00  张文-58-技术-北京  
   
签到  
   
> 17:37:11  Jeffrey－Pingpong金融－架构师－  
   
签到  
   
> 17:39:31  张冀～众信～需要通道～福建  
   
签到  
   
> 17:41:23  张冀～众信～需要通道～福建  
   
群里哪位兄弟有金融产品支付通道的 正规项目 瑞达期货合作商 帮忙介绍也行 红包答谢  
   
> 17:41:40  武亚斌-投哪网-产品-深圳  
   
签到  
   
> 17:43:55  张岩-华恒科技-商务-吉林  
   
签到  
   
> 17:44:32  王亚洲  
   
要不来我公司，百万庄园，咱们吃一顿  
   
> 17:44:35  王亚洲  
   
[奸笑]  
   
> 17:45:10  成都-千山  
   
签到  
   
> 17:45:51  雪飞-万年草-产品-北京  
   
签到  
   
> 17:47:24  王成龙-新浪跨境支付-研发  
   
签到  
   
> 17:51:29  浦东车神 — 网联  
   
签到  
   
> 17:53:21  嘉斐-平安-产品  
   
签到  
   
> 17:53:40  XZ-中金-产品  
   
签到  
   
> 17:53:56  hgwym-传化支付-技术经理  
   
签到  
   
> 17:57:54  屁亮—安全审计  
   
签到  
   
> 17:58:32  涂智明-科蓝-开发-北京  
   
签到  
   
> 18:00:13  李秀刚-TRHUI-鼓励师  
   
签到  
   
> 18:01:53  许佳伟-产品/市场-深圳  
   
签到  
   
> 18:02:29  梁文辉-中科软-需求-北京  
   
签到  
   
> 18:03:58  通联支付-产品-符音-深圳  
   
签到  
   
> 18:04:31  袁增辉-易联汇华-技术-北京  
   
签到  
   
> 18:05:05  老汪-阿尔法-鼓励师-江苏  
   
@王亚洲?北京的那个百万庄园？  
   
> 18:05:06  李昂然—工商银行—产品  
   
签到  
   
> 18:05:17  王亮-收银家-研发  
   
签到  
   
> 18:05:41  网商-技术-北京  
   
签到  
   
> 18:06:45  王亚洲  
   
@老王-阿尔法-鼓励师-湖南?发错了，请忽略[憨笑]  
   
> 18:07:57  老汪-阿尔法-鼓励师-江苏  
   
好吧，我刚毕业时，想进百万庄园来着  
   
> 18:08:23  地平线-文思-产品  
   
百万庄园？有人请吃饭啊？  
   
> 18:08:58  文刚_卓健_产品_杭州  
   
签到  
   
> 18:13:19  卢章-联逸科技-创始人-北京  
   
签到  
   
> 18:14:42  张杨-航天电子-研发  
   
签到  
   
> 18:14:54  地平线-文思-产品  
   
签到  
   
> 18:16:43  dexter-xib-研发  
   
签到  
   
> 18:28:03  宝玉-握手国际-产品-大望路  
   
签到  
   
> 18:29:40  杨万新 技术 浙江触角  
   
签到  
   
> 18:36:42  林庆荣-顺信服-技术-广州  
   
签到  
   
> 18:44:46  博小白-reapal-研发-北京  
   
签到  
   
> 18:48:44  蔡郑豪-统统付-开发  
   
签到  
   
> 18:49:16  Phx  
   
签到  
   
> 18:50:10  郑增远—WIND—攻城狮—上海  
   
签到  
   
> 18:53:49  十年砍柴-元年-产品-上海  
   
签到  
   
> 18:58:10  雪鹰-海尔·快捷通-架构  
   
合并交易+担保交易+组合支付+分账+可重复支付+可部分撤销...  
   
> 19:03:02  smartwave-开科支付-成都  
   
签到  
   
> 19:15:30  csp-架构-深圳  
   
签到  
   
> 19:16:11  拉卡拉-市场-老孙  
   
签到  
   
> 19:17:31  大圣-黄金钱包-开发  
   
签到  
   
> 19:17:50  黄福祥-ETC车宝-鼓励师-广州  
   
签到  
   
> 19:21:58  王宁-杉德-开发  
   
签到  
   
> 19:28:37  陈健-HFB-CTO-北京  
   
签到  
   
> 19:30:51  林安迪-商务-电商分账宝  
   
签到  
   
> 19:35:29  泽西-趋恒-架构师  
   
签到  
   
> 19:39:45  上海-上海中钢银联通-董路-技术  
   
我现在开始吧  
   
> 19:40:00  帅慧-数据-产品  
   
准备好了~~  
   
> 19:40:04  帅慧-数据-产品  
   
[呲牙]  
   
> 19:40:08  上海-上海中钢银联通-董路-技术  
   
不好意思，我这个分享可能会比较简单，大家不要见笑。  
   
> 19:40:23  上海-上海中钢银联通-董路-技术  
   
大概写了份word文档，我慢慢贴出来  
   
> 19:40:31  上海-上海中钢银联通-董路-技术  
   
后面有问题，可以直接问  
   
> 19:41:06  上海-上海中钢银联通-董路-技术  
   
好了现在正是开始：  
   
> 19:41:11  上海-上海中钢银联通-董路-技术  
   
假设一种情况，你现在进入了一家创业公司，需要搭建一套电商支付系统，产品经理没有到位。没有需求，现在只有一个要求，满足任何情况下的支付系统的搭建。怎么做？ &amp;#160;刚开始的时候，依据之前的经验，你可能会画出类似下面的E-R图：  
   
> 19:41:36  上海-上海中钢银联通-董路-技术  
   
![2018-08-05 19:41:36](http://static.cocolian.cn/img/201808/20180805_194136.png) 
   
> 19:42:02  上海-上海中钢银联通-董路-技术  
   
这种情况很简单，支持一个订单全流程下去，每个商户订单号只能使用一次。一笔支付订单支持多次退款，每个退款单号也是唯一的。当然这只是交易流水方面的关联关系，还有支付通道和商户路由，状态变化及交易流程，这一段网上好多人有过分享，不再赘述。  
   
> 19:42:32  上海-上海中钢银联通-董路-技术  
   
产品经理没有到位，几位技术人员分析过后没有问题，就开始动工写代码了。大概半个月之后代码写完，测试基本OK。开始和订单系统进行联调测试，订单系统那边提出要求，每个商户订单号只能使用一次，不能接受。现实情况是，用户先下订单，然后可以合并多个订单去支付。后来又多问了一句，用户能不能用多种方式支付？没人回答，产品没到位，技术经理不敢做主，那我们只能按照多种支付方式来设计。现在问题来了，在现有情况下，如何调整？  
   
> 19:43:28  上海-上海中钢银联通-董路-技术  
   
![2018-08-05 19:43:28](http://static.cocolian.cn/img/201808/20180805_194328.png) 
   
> 19:44:24  上海-上海中钢银联通-董路-技术  
   
经过最后讨论，大致的ER图应该是这个样子：  
   
> 19:44:34  上海-上海中钢银联通-董路-技术  
   
先说收单，订单系统提交过来的多个订单先入“合并订单明细表”，合并生成唯一交易号记录在“交易总表”中，如果可以付多次，那么需要一个详细的“支付交易明细表”这样整个流程就能串通下来。退款的时候很简单，订单系统那边要求一个订单本次一共退款金额，剩下的支付系统去计算。如上图所示，具体逻辑就是按照先进先出原则，计算出需要退款的流水（入商户退款明细表），然后向第三方通道发起退款（入通道退款明细表）请求即可。  
   
> 19:47:00  上海-上海中钢银联通-董路-技术  
   
好了，我这次分享暂时先到这里，有问题大家随时提问，谢谢！  
   
> 19:48:45  老汪-阿尔法-鼓励师-江苏  
   
[强]  
   
> 19:49:37  老熊-头条-支付PL  
   
[鼓掌][鼓掌]  
   
> 19:49:52  李小胖-优讯-打杂  
   
[鼓掌]  
   
> 19:49:59  拉卡拉-市场-老孙  
   
你那退货怎么完成部分退货？支付公司支持部分退货？  
   
> 19:50:02  帅慧-数据-产品  
   
第二张的er图没看清楚哇  
   
> 19:50:36  上海-上海中钢银联通-董路-技术  
   
查看原图呢  
   
> 19:50:50  上海-上海中钢银联通-董路-技术  
   
支持的  
   
> 19:51:05  上海-上海中钢银联通-董路-技术  
   
其实就是红星美凯龙  
   
> 19:51:43  上海-上海中钢银联通-董路-技术  
   
有些产品不退全款  
   
> 19:51:49  上海-上海中钢银联通-董路-技术  
   
只能部分退款  
   
> 19:52:51  上海-上海中钢银联通-董路-技术  
   
还有一个情况，就是线上，线下都有付款情况，如果线下已经退了，线上就不能退全款  
   
> 19:53:04  上海-上海中钢银联通-董路-技术  
   
当时考虑的比较复杂  
   
> 19:56:06  帅慧-数据-产品  
   
查看原图也看不清楚呢  
   
> 19:56:26  上海-上海中钢银联通-董路-技术  
   
等等  
   
> 19:56:32  上海-上海中钢银联通-董路-技术  
   
我找找  
   
> 19:57:10  老汪-阿尔法-鼓励师-江苏  
   
发的时候，注意选择发原图  
   
> 19:57:41  上海-上海中钢银联通-董路-技术  
   
![2018-08-05 19:57:41](http://static.cocolian.cn/img/201808/20180805_195741.png) 
   
> 19:57:57  上海-上海中钢银联通-董路-技术  
   
现在呢  
   
> 19:58:07  上海-上海中钢银联通-董路-技术  
   
刚才那个是截的图  
   
> 19:58:20  上海-上海中钢银联通-董路-技术  
   
电脑上看着听清楚  
   
> 19:58:24  上海-上海中钢银联通-董路-技术  
   
挺  
   
> 20:00:56  帅慧-数据-产品  
   
现在这个很清楚了  
   
> 20:00:58  帅慧-数据-产品  
   
谢谢哈  
   
> 20:02:51  李小胖-优讯-打杂  
   
请问一下，这是一个商户多单的模式，是吧  
   
> 20:03:15  上海-上海中钢银联通-董路-技术  
   
对  
   
> 20:03:21  上海-上海中钢银联通-董路-技术  
   
多订单  
   
> 20:03:28  李小胖-优讯-打杂  
   
明白了，3q  
   
> 23:04:37  鱼筱雨–来米发–研发部  
   
@上海-上海中钢银联通-董路-技术?[强][强][强]  
   
