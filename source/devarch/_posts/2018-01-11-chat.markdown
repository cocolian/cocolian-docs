---
layout:     source 
title:      "2018-01-11-WeChat"
date:       2018-01-11 12:00:00
author:     PaymentGroup
lines:      276 
tag:		  [chat]
---
> 07:42:32  李雄峰  
   
20180107-几种身份认证方法及其应用【内含福利】  
   
> 07:44:44  李雄峰  
   
求转发，招聘不易。[握手]??  
   
> 07:46:06  45度向上倾斜  
   
已转  
   
> 07:49:05  杜雷-乐天-技术  
   
转了  
   
> 07:49:09  杜雷-乐天-技术  
   
![2018-01-11 07:49:09](http://static.cocolian.cn/img/201801/20180111_074909.png) 
   
> 07:49:44  杜雷-乐天-技术  
   
老熊这影响力[强]  
   
> 07:51:57  刘小龙  
   
已转  
   
> 07:55:21  夏志强~快付通~技术经理  
   
已转  
   
> 08:17:00  胡桥-资邦金服-账务核心业务架构  
   
老熊这影响力[强]  
   
> 08:20:23  杜雷-乐天-技术  
   
问个事，国内的信用卡公司支持0元的authorization么？  
   
> 08:21:32  杜雷-乐天-技术  
   
就是在用户登陆信用卡的时候，检测一下用户信用卡的有效性  
   
> 08:23:17  李伦  
   
绑一下快捷就能验证卡的信息了  
   
> 08:23:43  张起坤  
   
有这种情况  
   
> 08:24:03  胡桥-资邦金服-账务核心业务架构  
   
5要素验证？  
   
> 08:24:07  胡桥-资邦金服-账务核心业务架构  
   
@杜雷-乐天-技术  
   
> 08:24:18  张起坤  
   
我们的授权交易里，就有很多非用户发起的0元交易  
   
> 08:24:35  杜雷-乐天-技术  
   
不是五要素，就是验证信用卡的有效性  
   
> 08:25:33  张起坤  
   
有卡组织发起的，有ATM发起的等  
   
> 08:26:01  杜雷-乐天-技术  
   
国外很多信用卡公司都支持0元授权，目的就是给商户用来验证用户信用卡的有效性  
   
> 08:26:04  张起坤  
   
我们是平安信用卡  
   
> 08:26:31  杜雷-乐天-技术  
   
》》我们的授权交易里，就有很多非用户发起的0元交易 那说明可以做  
   
> 08:27:05  张起坤  
   
是的，但是好像用户不能发起，而且此类交易好像都不用验密的。。。  
   
> 08:27:56  杜雷-乐天-技术  
   
嗯，我们也都是商户平台发起的，就是普通的授权请求，但是是0元  
   
> 08:29:04  张起坤  
   
是的主要用于验证这个卡是否正常可用  
   
> 08:29:06  杜雷-乐天-技术  
   
我们很多商户为了提高交易成功率，就用卡号和有效期限做授权  
   
> 08:29:48  北京一张泽雄  
   
国内好像至少1分吧，这在支付里叫签约支付一体化  
   
> 08:30:30  胡桥-资邦金服-账务核心业务架构  
   
打款验证？  
   
> 08:31:39  北京一张泽雄  
   
对，我们以前因为这么做还被客户投诉了  
   
> 08:31:56  张起坤  
   
上周我们分析授权交易的时候，就有非常多的金额为0的交易  
   
> 08:32:09  杜雷-乐天-技术  
   
这个客户也是够细心的了  
   
> 08:32:21  杜雷-乐天-技术  
   
我们有时也做1元的授权，之后不做capture  
   
> 08:32:31  北京一张泽雄  
   
可能每家银行限额不一样  
   
> 08:32:40  杜雷-乐天-技术  
   
1个多月后，自动就被取消了  
   
> 08:32:59  杜雷-乐天-技术  
   
1日元准确点  
   
> 08:33:10  杜雷-乐天-技术  
   
但是，能做0元的，都做0元  
   
> 08:33:42  北京一张泽雄  
   
对，原理是一样的，一日元相当于国内1分钱  
   
> 08:33:43  杜雷-乐天-技术  
   
刚才一个同事问我，中国发卡银行支不支持  
   
> 08:33:51  杜雷-乐天-技术  
   
嗯嗯  
   
> 08:34:28  北京一张泽雄  
   
1分肯定支持，0的话可能部分支持  
   
> 08:35:34  北京一张泽雄  
   
因为签权接口已经被包装成商品了，调用一次3毛钱  
   
> 08:38:33  杜雷-乐天-技术  
   
好吧，我应该和我们信用卡公司提议下一页做一个这个产品  
   
> 08:38:50  杜雷-乐天-技术  
   
提议下做一个这个产品  
   
> 08:44:05  北京一张泽雄  
   
相比于调用签权接口一次几毛钱的成本，一体化支付1分钱的成本要低很多  
   
> 08:46:34  夏志强~快付通~技术经理  
   
我这打款认证，都是商户给用户卡里打钱  
   
> 08:53:32  杜雷-乐天-技术  
   
信用卡不能收款  
   
> 08:54:42  北京一张泽雄  
   
可以  
   
> 08:55:22  北京一张泽雄  
   
信用卡还款功能  
   
> 08:56:11  夏志强~快付通~技术经理  
   
不能收的话，就不能还款了  
   
> 08:56:27  夏志强~快付通~技术经理  
   
或者做信用卡6要素验证也可以  
   
> 08:59:37  王志华_待业_金融系统建设  
   
@夏志强~快付通~技术经理?六要素是啥？  
   
> 09:00:25  杜雷-乐天-技术  
   
日本这边是不可以的，还款走的是银行  
   
> 09:01:14  杜雷-乐天-技术  
   
在日本，信用卡公司和银行可以分开的  
   
> 09:03:35  夏志强~快付通~技术经理  
   
卡号，证件号码，持卡人姓名，银行预留手机号，cvv2，有效期  
   
> 09:04:03  夏志强~快付通~技术经理  
   
@王志华_青海银行_研发?  
   
> 09:04:36  王志华_待业_金融系统建设  
   
好的，谢谢，刚才看错了，以为是借记卡  
   
> 09:05:00  夏志强~快付通~技术经理  
   
[呲牙]  
   
> 09:06:40  杜雷-乐天-技术  
   
我们这边一般就2要素卡号，有效期，有的再加一个cvv2  
   
> 09:07:15  北京一张泽雄  
   
这个和信用体系有关  
   
> 09:08:02  杜雷-乐天-技术  
   
国内信用卡可以信用卡收款，这个银行提供接口是么  
   
> 10:17:10  夏志强~快付通~技术经理  
   
大家清洁算平台一般采用什么架构  
   
> 10:17:25  夏志强~快付通~技术经理  
   
数据量超千万的情况下  
   
> 11:10:23  a  
   
涉及账务金额变动的操作，是应用来分布式加锁还是DB悲观锁呢，这两个都有些问题缺点。请教下各位，你们生产是如何实现的呢？  
   
> 11:42:09  Ryan Cao  
   
并发量？  
   
> 11:42:35  Ryan Cao  
   
并发量不高的话，悲观锁不会出错。  
   
> 11:44:19  钟鸿敏  
   
悲观所，行锁没想象中那么挫，热点账户用缓冲记账  
   
> 11:46:22  钟鸿敏  
   
乐观锁是自己给自己挖坑，并发不高，乐观锁作用不大，并发一高，乐观锁又会造成上层业务频繁报错，何必呢？得不偿失  
   
> 11:46:36  Ryan Cao  
   
并发高，系统本身是分布式系统，能接受最终一致。可以用消息队列+补偿逻辑来做。  
   
> 11:47:23  Ryan Cao  
   
不能接受最终一致的话，就要设计n-phase 提交的分布式锁了。  
   
> 11:47:58  a  
   
我个人趋向于悲观锁，强制where后的更新字段索引，是不会锁表的，在这场景，强一致性是优先考虑，悲观锁也会降低太多性能的。  
   
> 11:47:59  senvon  
   
考虑到入账过程中的断电等特殊情况,使用悲观锁吧,乐观锁需要额外的逻辑处理入账时候的锁失败  
   
> 11:49:14  夏志强~快付通~技术经理  
   
那种热点收付的呢  
   
> 11:49:16  a  
   
在这场景，强一致性是优先考虑，悲观锁也不会降低太多性能的。  
   
> 11:49:21  钟鸿敏  
   
分布式锁也是坑，并发高真的都不知道怎么死的，如果是微服务，分布式锁本身就是一个瓶jin  
   
> 11:49:25  夏志强~快付通~技术经理  
   
热点收可以延迟入账  
   
> 11:49:42  senvon  
   
一般数据库单表更新的性能,在HDD硬盘上,差不多是250/s左右,在SSD硬盘上,可以达到600/s  
   
> 11:50:28  钟鸿敏  
   
涉及账户的更改，悲观锁大部分是行锁，大部分不会出现互斥的情况，如果有，更多的是业务结构设计不合理  
   
> 11:51:30  senvon  
   
按照oracle的说明,where中存在唯一索引的字段,数据库会使用行锁,不存在,会使用表锁  
   
> 11:52:17  秋水-厚本金融-产品经理  
   
账户还是需要强一致性的，那是钱鸭  
   
> 11:52:21  秋水-厚本金融-产品经理  
   
钱呀  
   
> 11:54:36  senvon  
   
等到入账请求的并发超过上述的数字的时候,单台数据库的性能就会到达瓶颈,一定要对账户进行分库分表,在这种情况下,没有人帮你保证强一致......而数据库本身提供的XA机制,过于垃圾,一般会使用XA的原理,引入分布式事务平台,通过平台来保证最终一致性  
   
> 11:55:44  a  
   
我这边流量不大，上家公司的大促流量也不足阿里双11的千分之一。 从理论上来讲，高并发下的悲观锁回导致DB各项指标飙升，DB成了瓶颈，分布式锁又是不得不考虑的事情。  
   
> 11:56:27  senvon  
   
不要把所有的表都放一个数据库上面  
   
> 11:56:35  senvon  
   
先做垂直分表  
   
> 11:56:46  a  
   
对的，到了那个流量，早就分库分表了。  
   
> 11:56:48  senvon  
   
后做读写分离  
   
> 11:57:22  senvon  
   
这2点可以满足目前除了BAT几个大的互联网公司之外的90%以上的需求  
   
> 11:57:26  钟鸿敏  
   
行锁真有你们想的那么悲观么？至于分布式锁，[捂脸]谁用谁知道  
   
> 11:57:36  bill在飞  
   
行锁多了也会自动转table look,行锁也耗内存  
   
> 11:57:56  杨浩  
   
是的  
   
> 11:58:11  a  
   
不怕行锁，怕不合格的开发同事，他的应用锁了你的表。  
   
> 11:58:31  钟鸿敏  
   
那是设计的不合理，这个不能做为架构的理由  
   
> 11:58:39  a  
   
这个是我生产碰到的真实案例。  
   
> 11:58:52  bill在飞  
   
对对对  最常见的，把不是必须的长事务拉长  
   
> 11:59:10  bill在飞  
   
拉死的是整个系统  
   
> 11:59:21  钟鸿敏  
   
你为了防止不合格的同事改变本来简单的架构，这样的做法合式么？  
   
> 12:00:29  bill在飞  
   
用了分布式锁复杂度上来了，没有好的监控手段，也会变得不可控  
   
> 12:00:42  a  
   
架构上，我觉得非超高流量场合，采用DB悲观锁应该是应付的来的。我赞同你的DB锁方案。  
   
> 12:02:02  北京一张泽雄  
   
行锁就可以了，再有其它问题就是设计问题了  
   
> 12:02:20  钟鸿敏  
   
现在微服务架构比较普遍，分布式锁基本是宣布死刑了，我在支付宝时，用的XTS，对业务入侵还是挺大的，不是纯意义上的分布式锁  
   
> 12:02:36  a  
   
我只是说下生产真实故障，很多时候方案没有问题，开发同事是不可控的。      
   
> 12:03:05  a  
   
你们做架构设计的时候，会考虑下这种情况吗？  
   
> 12:03:14  北京一张泽雄  
   
对数据库管理，一定是专表专用  
   
> 12:03:19  钟鸿敏  
   
要这样说的话，不可控的事多了去了，你架构得过来么？  
   
> 12:04:05  钟鸿敏  
   
你的架构得考虑多少不合理的事，会把你拉入牛角尖的  
   
> 12:04:18  a  
   
比较纠结，取舍太多。  
   
> 12:04:38  a  
   
@钟鸿敏-点融-技术总监 是的，要有优先级重要程度  
   
> 12:04:58  钟鸿敏  
   
大道至简，这是我做架构时的原则  
   
> 12:04:59  北京一张泽雄  
   
很多时候，架构解决不了的问题是规范的事  
   
> 12:05:08  钟鸿敏  
   
对  
   
> 12:09:11  张百音  
   
请教大家个问题 用户待收益 待还款 需要用开立账户吗？  还是计算的时候用还款计划表直接sum就行了？  
   
> 12:11:49  钟鸿敏  
   
额外搞个冗余字段表就够了，账户粒度太细也是自己给自己挖坑  
   
> 12:12:08  senvon  
   
@张学鸿-前宜信-研发 要看产品需求,这个待收要不要被纳入财务报表,但是就算是需要,也不会在用户层面建立待收的账户,一般是在产品层面  
   
> 12:12:21  钟鸿敏  
   
账户一般要挂钩科目的  
   
> 12:14:26  北京一张泽雄  
   
用台账就搞定了  
   
> 12:14:30  张百音  
   
我们这还没有科目概念呢  
   
> 12:15:33  张百音  
   
能不能这样 待收 待付其实都不是真钱 从账户系统里面移出去  
   
> 12:16:43  张百音  
   
待收益 和 已收益 只查业务表就行了  
   
> 12:16:44  秋水-厚本金融-产品经理  
   
放个收支项目就行  
   
> 12:16:51  秋水-厚本金融-产品经理  
   
或者叫资金项目  
   
> 12:17:40  张百音  
   
@李大神 详细解释下白？  
   
> 12:18:30  钟鸿敏  
   
一般不纳入账户体系，查业务表就可以，但为了不每次都重复计算，提高性能，我们的做法是用冗余字段来存结果  
   
> 12:18:47  钟鸿敏  
   
每次业务操作同步更新结果  
   
> 12:19:33  夏志强~快付通~技术经理  
   
对于担保户这种，又有收，又有付的，用for update，性能不高，还有没有其他好的处理方法  
   
> 12:19:53  钟鸿敏  
   
@夏志强~快付通~技术经理 缓冲计账  
   
> 12:20:09  夏志强~快付通~技术经理  
   
付的，怎么缓冲  
   
> 12:20:21  夏志强~快付通~技术经理  
   
需要检查钱够不够  
   
> 12:20:25  张百音  
   
@钟鸿敏-点融-技术总监 这种倒是行 但是感觉怪怪的  
   
> 12:21:06  钟鸿敏  
   
一般担保户都是热点账户，付也一样，担保户属商户合作账户，一般是允许有负的  
   
> 12:21:47  夏志强~快付通~技术经理  
   
不允许垫资[捂脸]  
   
> 12:21:55  北京一张泽雄  
   
担保账户可以按借，贷分两个账户  
   
> 12:22:07  张百音  
   
@钟鸿敏-点融-技术总监 你们账户系统也得记下增加减少的流水吧 还是只有这一个字段  如果不一致怎么办？  
   
> 12:22:11  北京一张泽雄  
   
收付分开  
   
> 12:22:21  钟鸿敏  
   
一般情况，付多是基于退款，退款有上层逻辑控制  
   
> 12:22:42  孔晓光-丰瑞祥-技术  
   
收支两条线设计就可以了  
   
> 12:23:00  张百音  
   
@北京一张泽雄 记台账的意思是不是记下流水账 等统计的时候sum一下就行了  
   
> 12:23:13  钟鸿敏  
   
有支付才有退款，你的担保户除了支付和退款，还能有什么业务场景？  
   
> 12:23:51  钟鸿敏  
   
这些都属于业务结构的设计  
   
> 12:23:58  北京一张泽雄  
   
@张学鸿-前宜信-研发?是的  
   
> 12:24:10  张百音  
   
ok  
   
> 12:24:52  钟鸿敏  
   
@shawn孔-待业-VP 收支两条钱解决不了问题  
   
> 12:25:26  钟鸿敏  
   
收支两线的本意不是为了解决这种问题  
   
> 12:25:48  北京一张泽雄  
   
对于收，可以缓冲记账  
   
> 12:26:01  夏志强~快付通~技术经理  
   
退款有可能是前几天的交易，但是会占用当天的收  
   
> 12:26:18  孔晓光-丰瑞祥-技术  
   
场景分开，就好解决  
   
> 12:26:32  夏志强~快付通~技术经理  
   
目前我这有收付的商户，是分开了，收付两个账户  
   
> 12:26:46  北京一张泽雄  
   
定时收转付  
   
> 12:26:47  夏志强~快付通~技术经理  
   
平台担保户只有一个  
   
> 12:27:13  张百音  
   
@夏志强~快付通~技术经理 可以将账户拆分哈 拆分多个子账户  每次记账的时候取不同的子账号去记账   
   
> 12:27:14  夏志强~快付通~技术经理  
   
他下面的二级商户多  
   
> 12:28:25  夏志强~快付通~技术经理  
   
这种也是有个问题，有可能收到A1子账户，付款从A2出  
   
> 12:28:33  夏志强~快付通~技术经理  
   
后来不够付  
   
> 12:29:25  张百音  
   
付款走单独的子账号白  
   
> 12:29:45  张百音  
   
定时将其他子账户的钱平移过去  
   
> 12:30:14  夏志强~快付通~技术经理  
   
目前热点收，我们是延迟记账，收付账户是拆成两个账户（付款时要求商户线下打款）  
   
> 12:31:20  北京一张泽雄  
   
D0业务时就会发现分开的好处了  
   
> 12:31:46  夏志强~快付通~技术经理  
   
我们d0是一个账户  
   
> 12:31:55  夏志强~快付通~技术经理  
   
好在并发不高，还能处理  
   
> 12:32:04  夏志强~快付通~技术经理  
   
每个商户一个  
   
> 12:40:09  北京一张泽雄  
   
收款业务是先收款后记账，可以缓冲，付款业务是先记账后付款，一般不缓冲 所以建议收付分开，  
   
> 12:43:24  召  
   
有公司实现了账户表分库分表么?  
   
> 12:43:52  A祁子  
   
有人公司用go做后台么  
   
> 12:44:08  Ryan Cao  
   
为什么是先记账呢？付款付出去还有银行回单。  
   
> 12:44:16  钟鸿敏  
   
@夏志强~快付通~技术经理?平台担保户不是你们自己的吗  
   
> 12:45:19  钟鸿敏  
   
@北京一张泽雄?那付款帐号的钱哪里来，要先放进去吗  
   
> 12:45:59  北京一张泽雄  
   
@曹祺-Airwallex上海-技术VP? 财务的不垫款原则  
   
> 12:47:30  夏志强~快付通~技术经理  
   
付款的，我这是商户线下打钱，  
   
> 12:48:16  夏志强~快付通~技术经理  
   
@北京一张泽雄?我们现在的做法，就是你上面说的那种处理方式  
   
> 12:48:23  北京一张泽雄  
   
@钟鸿敏-点融-技术总监?收款账户定时转付款账户  
   
> 12:50:16  夏志强~快付通~技术经理  
   
我这没有转到付款账户的，收款是t+1结算给商户，付款是商户线下打钱，在代付出去。这两个账户是分开的  
   
> 12:50:26  胡桥-资邦金服-账务核心业务架构  
   
你们在聊收支分离？  
   
> 12:50:45  夏志强~快付通~技术经理  
   
热点账户  
   
> 12:52:30  胡桥-资邦金服-账务核心业务架构  
   
吹个牛逼[坏笑]   一般 收款例如（备付金），在做充值的时候，最终的资金都是提现在备付金，一般宽入紧出，入款的时候 可以 缓冲记账  
   
> 12:52:49  雪鹰  
   
收支分离不是解决性能问题吧。 用一个账户，收用缓冲记账就解决了啊。 收支分离是方便统计的。  
   
> 12:53:56  胡桥-资邦金服-账务核心业务架构  
   
稍等，我画个图  
   
> 12:54:13  北京一张泽雄  
   
核算是以账户为核心，对于账户的记账原则是第一位的，缓冲是在坚持原则的前提下的技术技巧  
   
> 12:55:19  北京一张泽雄  
   
收付业务的风险等级不一样  
   
> 12:56:57  钟鸿敏  
   
严出宽进  
   
> 12:57:08  北京一张泽雄  
   
是的  
   
> 12:57:15  Ryan Cao  
   
退款是线下商户去打款的话，账为什么要记在你这里呢？你只是转交这个了退款请求而已吧？  
   
> 12:57:22  胡桥-资邦金服-账务核心业务架构  
   
![2018-01-11 12:57:22](http://static.cocolian.cn/img/201801/20180111_125722.png) 
   
> 12:57:25  雪鹰  
   
会计核算一般是科目为核心吧。账户只是载体~   商户可以选择~ 一个账户，还是分离的。  
   
> 12:57:55  钟鸿敏  
   
解决方案可以有多种  
   
> 12:57:58  北京一张泽雄  
   
科目是纬度  
   
> 12:58:10  胡桥-资邦金服-账务核心业务架构  
   
嗯嗯，怎么实用怎么来[坏笑]  
   
> 12:58:32  钟鸿敏  
   
分离也好，单个也好，能解决问题就好，根据业务实际要求来  
   
> 12:59:01  北京一张泽雄  
   
是有很多方案，我说的是在做方安时要考虑的风险点  
   
> 13:00:03  夏志强~快付通~技术经理  
   
退款不属于代付范畴  
   
> 13:00:59  胡桥-资邦金服-账务核心业务架构  
   
退款有原路返回（这个要渠道支持），还有一种叫充退（渠道不支持原路，平台先垫一笔）  
   
> 13:01:11  雪鹰  
   
退款也有走代付的啊，比如代扣你能原路退？  自动直接转代付。  
   
> 13:01:14  北京一张泽雄  
   
像钟总这样的高手，怎么做都行 @钟鸿敏-点融-技术总监  但很多公司的低手，写的代码让人心惊肉跳的，在方案上采用分离方式，风险更低一些  
   
> 13:01:25  钟鸿敏  
   
收缓冲，付不缓冲，如果是一个账户，就会有付的时候钱不够，如果收支分离，就必须实时监控出款账户保证有钱  
   
> 13:01:36  北京一张泽雄  
   
是的  
   
> 13:02:15  钟鸿敏  
   
我们当时为了不影响正常业务进行，都是允许中间账户为负的  
   
> 13:03:08  钟鸿敏  
   
或者一家大商户，因为有合作关系，这类账户也是可以有一定额度为负的  
   
> 13:03:14  秋水-厚本金融-产品经理  
   
允许负数是保障业务执行的最大杀器  
   
> 13:03:42  北京一张泽雄  
   
会计上一般不允许账户出现负值  
   
> 13:04:15  钟鸿敏  
   
这还不到会计上，日切前会一把结算掉的  
   
> 13:04:20  胡桥-资邦金服-账务核心业务架构  
   
透支嘛  
   
> 13:04:28  秋水-厚本金融-产品经理  
   
账户已经是交易财务了  
   
> 13:04:38  秋水-厚本金融-产品经理  
   
俗称业务财务  
   
> 13:04:55  雪鹰  
   
好像国外有些银行ATM取款都不是强一致性的，可负数的。  
   
> 13:05:15  北京一张泽雄  
   
负值是有一定的风险的  
   
> 13:05:16  胡桥-资邦金服-账务核心业务架构  
   
哈哈，一看就有经验，如果是实时会计的话，透支是不行的，日冲过账来核算账务  
   
> 13:05:17  夏志强~快付通~技术经理  
   
退款变代付只是业务上的处理（主要是看渠道是否支持），  
   
> 13:05:18  胡桥-资邦金服-账务核心业务架构  
   
其实也可以的  
   
> 13:05:25  钟鸿敏  
   
正常的业务是有进才有出的，理论上不会出现钱不够的，只是因为时间差，在那一刻看起来是透支的  
   
> 13:05:39  Json  
   
这很正常哇 透支呗 4成的利率 还有罚款  
   
> 13:06:26  北京一张泽雄  
   
来来来，给我透支10个亿，哈哈  
   
> 13:07:34  秋水-厚本金融-产品经理  
   
单笔允许负数，而一个时间段保持一致  
   
> 13:08:09  北京一张泽雄  
   
会计上的负数，一般用中间科目填齐  
   
> 13:08:15  Json  
   
西太平洋银行就干过一次。。。无限透支 结果被一亚洲女娃透了小一千万  
   
> 13:08:16  秋水-厚本金融-产品经理  
   
否则由于异常情况会导致支付率降低的  
   
> 13:08:55  钟鸿敏  
   
不会有负，那是借贷方向来决定的  
   
> 13:09:06  钟鸿敏  
   
@秋水-待业-产品 对的  
   
> 13:09:30  钟鸿敏  
   
这里有几个做过大促的，做过大促的理解会更深一点  
   
> 13:09:53  雪鹰  
   
AMT透支这种都会有限制额度的，无非是系统可用性 与 风险的权衡。 比如后端账务系统访问有问题，你到底允不允许取款呢，比如允许200以内可取，对用户来说体验好。但可能资损风险。  
   
> 13:09:54  钟鸿敏  
   
应该说感受更深一点  
   
> 13:12:40  钟鸿敏  
   
我印象最深的就是，一次大促，商户因为红包户余额不足，没来得及补账，所有交易全部失败，对于有GMV考核的，负责人是要拉去祭天的  
   
> 13:13:32  沪上十三少  
   
热点账户问题，有一点大家都没提[偷笑]这点可以解决大部分场景  
   
> 13:13:47  钟鸿敏  
   
那年的KPI基本就准备回家吃土了  
   
> 13:13:48  沪上十三少  
   
我们乐观锁用的好好的[偷笑]  
   
> 13:14:14  钟鸿敏  
   
热点账户最上面讨论过一轮了。。。  
   
> 13:14:39  沪上十三少  
   
热点账户最难搞的是减的账户，什么充值退款那都不是事，本身业务就不复杂  
   
> 13:14:49  沪上十三少  
   
退款有多高并发。。。  
   
> 13:15:02  沪上十三少  
   
P2P场景的支出账户那才是头痛  
   
> 13:15:38  钟鸿敏  
   
标的到期还款  
   
> 13:16:11  沪上十三少  
   
有一点要注意，支出业务要异步(最重要的一方面资金安全控制)。。。大部分热点账户问题解决  
   
> 13:16:24  沪上十三少  
   
还款不要求实效  
   
> 13:16:25  秋水-厚本金融-产品经理  
   
p2p都存管了，你还放款！  
   
> 13:16:28  沪上十三少  
   
慢慢搞  
   
> 13:17:05  秋水-厚本金融-产品经理  
   
还款找到债务户冻结，跑批的时候扣款  
   
> 13:17:15  沪上十三少  
   
你去银行app提现。。。你看看银行是不是异步的  
   
> 13:17:19  张百音  
   
@秋水-待业-产品 换个照片吧 小图感觉好老 点开看还成  
   
> 13:17:31  沪上十三少  
   
哪里的热点账户  
   
> 13:17:38  钟鸿敏  
   
方法很多，反正从业这么多年，基本上金融业务系统上该踩的坑基本都采过了  
   
> 13:17:39  秋水-厚本金融-产品经理  
   
不会吧  
   
> 13:17:44  秋水-厚本金融-产品经理  
   
怎么看起来老了  
   
> 13:17:55  张百音  
   
![2018-01-11 13:17:55](http://static.cocolian.cn/img/201801/20180111_131755.png) 
   
> 13:18:02  张百音  
   
你自己看看  
   
> 13:18:15  北京一张泽雄  
   
这行我是越做胆越小。。。  
   
> 13:18:23  秋水-厚本金融-产品经理  
   
晕  
   
> 13:18:41  沪上十三少  
   
做的久了就胆小[偷笑]资损两个字，天天挂在眼前  
   
> 13:19:18  沪上十三少  
   
支持业务异步这种方式，看起来简单，新手绝对想不到  
   
> 13:19:23  沪上十三少  
   
支出  
   
> 13:19:29  钟鸿敏  
   
金融行业做了10年+，其中7年+在做支付。。。  
   
> 13:19:43  北京一张泽雄  
   
关键是决策是你决策的，执行不到位就完了，所以决策要打出余量  
   
> 13:20:09  钟鸿敏  
   
资损，监管。。。各种累，都是头上一把刀  
   
> 13:20:39  沪上十三少  
   
哈哈，是的P2P行业2018那拍照合规是头等大事  
   
> 13:20:43  钟鸿敏  
   
各种整改  
   
> 13:20:44  沪上十三少  
   
监管  
   
> 13:23:59  钟鸿敏  
   
我经历过两次支付系统从0到1，一次在支付宝国际支付，一次在海尔  
   
> 13:26:37  沪上十三少  
   
钟总，当年在支付宝搞快捷支付的那批人可认识？  
   
> 13:27:17  钟鸿敏  
   
从支付扩散到互联网金融和供应链金融，越做胆越小，越做压力越大  
   
> 13:27:59  钟鸿敏  
   
猥琐发育  
   
> 13:28:10  钟鸿敏  
   
不认识，我在国际支付  
   
> 13:28:14  孔晓光-丰瑞祥-技术  
   
NO浪  
   
> 13:31:26  钟鸿敏  
   
一个技术人，在一个行业做深了，会感觉业务产品技术的角色模糊了  
   
> 13:31:45  钟鸿敏  
   
还能兼半个法务  
   
> 13:33:08  杜雷-乐天-技术  
   
还得兼安全  
   
> 13:34:13  杜雷-乐天-技术  
   
支付的技术人都是全能[悠闲]  
   
> 13:35:12  钟鸿敏  
   
给你一个牌照，就能撑起一个支付公司的感觉  
   
> 13:42:05  韩财光-东软(前)-开发-广州  
   
牛  
   
> 14:09:52  芦苇  
   
问一下,有公司项目使用spring cloud的微服务架构吗,这种架构的分布式事务是怎么解决的?  
   
> 14:17:18  程超  
   
使用spring cloud和分布式事务没有直接关系吧，你用dubbo也是一样  
   
> 14:20:07  杨宽  
   
没有任何关系  
   
> 14:20:15  杨宽  
   
超超自信点  
   
> 14:21:35  芦苇  
   
那分布式事务一般是怎么解决的?  
   
> 14:22:05  LXS  
   
MQ  
   
> 14:23:24  芦苇  
   
tcc的有公司在用吗,atomokis的有公司在用吗?  
   
> 14:24:21  余海伟  
   
分布式事务是个头疼的话题 事务会影响性能  
   
> 14:24:59  刘小龙  
   
atomokis，等分布式事务性能不好，一般写代码能避免去避免，避免不了，可以使用消息，达到最终一致性即可  
   
> 14:25:22  刘小龙  
   
回滚接口  
   
> 14:26:15  余海伟  
   
大部分还是靠补偿来的吧 都是最终一致性事务  
   
> 14:26:46  忘忧草  
   
要强一致都是预留冻结+确认模型  
   
> 14:27:05  忘忧草  
   
长期不确认的，需要下游回查上游  
   
> 14:28:07  程超  
   
几种方案，消息补偿，tcc，二次三次提交，不过用最终一致的非常多  
   
> 14:30:33  钟鸿敏  
   
分布式确实不推荐用  
   
> 14:31:05  钟鸿敏  
   
本身的开销就是很大的瓶颈问题  
   
> 14:31:46  余海伟  
   
现在分布式锁 还推荐用吗  
   
> 14:33:08  钟鸿敏  
   
反正微服务下基本没用了，幂等性+异步补偿  
   
