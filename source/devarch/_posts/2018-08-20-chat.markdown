---
layout:     source 
title:      "2018-08-20-WeChat"
date:       2018-08-20 12:00:00
author:     PaymentGroup
lines:      153 
tag:       [chat]
---
> 09:01:04  中金支付～开发～翔远  
   
群里有没有做市民卡的同学？  
   
> 09:34:42  蒋招司-产品-杭州  
   
@中金支付～开发～翔远  我们公司是做市民卡的，不过我是负责互联网支付  
   
> 09:35:06  夏斌-优赋-技术经理-北京  
   
[得意]  
   
> 09:35:49  振效+神码+北京  
   
什么新闻  
   
> 09:38:44  老汪-阿尔法-鼓励师-江苏  
   
广东的吗？  
   
> 09:53:04  【信融集团】·王瑞  
   
中汇重复到账 搞死我们这边了 一堆投诉  
   
> 09:53:38  李秀刚-TRHUI-鼓励师  
   
重复到账是什么原因造成的？  
   
> 09:53:39  乐天-麦子金服-打杂-上海  
   
多打钱了还投诉？  
   
> 09:54:00  乐天-麦子金服-打杂-上海  
   
初看是技术原因  
   
> 09:54:04  杨宽-比特大陆-区块链理疗师-bj  
   
有些人不敢多少钱  
   
> 09:54:06  【信融集团】·王瑞  
   
冻结商户账号   
   
> 09:54:07  乐天-麦子金服-打杂-上海  
   
未知状态当失败  
   
> 09:54:11  tonny-csii-pl-北京  
   
听说是网络延迟，判定订单失败，然后重新发起  
   
> 09:54:38  乐天-麦子金服-打杂-上海  
   
低级问题  
   
> 09:54:47  【信融集团】·王瑞  
   
尼玛 市场份额又被人家抢了   
   
> 09:54:59  乐天-麦子金服-打杂-上海  
   
中汇支付都没听过  
   
> 09:55:01  tonny-csii-pl-北京  
   
听说发生了好几次  
   
> 09:55:07  乐天-麦子金服-打杂-上海  
   
还以为是中金支付[偷笑]  
   
> 09:55:18  顾文烨—上海银行—产品—上海  
   
中汇是天津的支付公司  
   
> 09:55:19  tonny-csii-pl-北京  
   
[捂脸][捂脸][捂脸]  
   
> 09:55:27  上海睿民-陈帅康-项目经理  
   
5月份发生过一次  
   
> 09:55:45  上海睿民-陈帅康-项目经理  
   
这次总计多汇出了3个亿  
   
> 09:55:56  Codefor-YMT-TechLead-BJ  
   
现在貌似还没有明确的结论  
   
> 09:55:57  Alex ?? 深圳普尔瀚达@产品  
   
收到@凤凰牌老熊-群管理  
   
> 09:55:59  李秀刚-TRHUI-鼓励师  
   
重复发起是不是应该手工操作会安全点  
   
> 09:56:22  双乾支付-技术总监-韩伟  
   
正常都是人工再出  
   
> 09:57:17  双乾支付-技术总监-韩伟  
   
而且中汇出的是去年12月30日的结算款，所以有问题，公告要么是撒谎了  
   
> 09:58:24  姜桥-摩拜单车-技术  
   
[支付渠道参数如何设计成路由化配置？](http://mp.weixin.qq.com/s?__biz=MzU3NDY4NzQwNQ==&amp;amp;amp;mid=2247483700&amp;amp;amp;idx=1&amp;amp;amp;sn=1f8dee1ba7b8232579dd77099e539861&amp;amp;amp;chksm=fd2fd0f6ca5859e0ca524067a1220307b3d23aae67a99527ba46c05aa6f0aaa1c05087f7f7a1&amp;amp;amp;mpshare=1&amp;amp;amp;scene=1&amp;amp;amp;srcid=0819VkM5GT5BngSniUe0zFcy#rd)  
   
> 09:58:34  浅橙现金卡-支付中心-施富宇  
   
如果曝光的信息是真实的话，中汇的官方说明和给商户侧的短信通知是有矛盾的  
   
> 09:58:35  李秀刚-TRHUI-鼓励师  
   
结算款都压了大半年了  
   
> 10:00:07  【信融集团】·王瑞  
   
中汇的产品 我们不敢做了  
   
> 10:00:34  顾文烨—上海银行—产品—上海  
   
不知道有没有用D0  
   
> 10:00:57  顾文烨—上海银行—产品—上海  
   
万一是银行垫资 这家银行也郁闷了  
   
> 10:00:59  李秀刚-TRHUI-鼓励师  
   
@【信融集团】&amp;#183;王瑞 你们是做什么的  
   
> 10:02:36  【信融集团】·王瑞  
   
搞他们的POS机   
   
> 10:04:21  曾卓-长丰集团-架构师-长沙  
   
网络延迟，判定订单失败，然后重新发起，还重复 这是流程逻辑设计的问题  
   
> 10:04:45  DON-通联-研发  
   
现在100%缴存，估计他们现在头寸很紧张  
   
> 10:04:55  双乾支付-技术总监-韩伟  
   
网络延迟，这样的判断肯定不会错，这是个托词  
   
> 10:05:04  tonny-csii-pl-北京  
   
这开发和设计人员估计有责任了  
   
> 10:05:20  双乾支付-技术总监-韩伟  
   
因为网络延迟，应该经常会发生的  
   
> 10:05:36  北京一张泽雄  
   
CTO要挂了  
   
> 10:05:41  双乾支付-技术总监-韩伟  
   
而且哪怕网络延迟，也不会动到去年的结算款  
   
> 10:06:52  【信融集团】·王瑞  
   
资金压力肯定很大   
   
> 10:06:58  【信融集团】·王瑞  
   
只有牌照值钱了  
   
> 10:16:43  地平线-文思-产品  
   
筹钱收购牌照  
   
> 10:16:55  顺强-易付-开发-北京  
   
重出款，能把一个公司直接搞死  
   
> 10:17:23  顺强-易付-开发-北京  
   
技术的锅  
   
> 10:18:58  双乾支付-技术总监-韩伟  
   
最近几天我整理下，可能导致重复出款的点，做一次分享给大家  
   
> 10:19:08  双乾支付-技术总监-韩伟  
   
大家互相学习和指正我的做法吧  
   
> 10:19:26  浅橙现金卡-支付中心-施富宇  
   
[强][强]期待  
   
> 10:19:27  通联支付-产品-符音-深圳  
   
[鼓掌]  
   
> 10:19:28  永明-云账户-开发-北京  
   
好的课题  
   
> 10:19:30  中金支付～开发～翔远  
   
期待  
   
> 10:19:31  鹏-淘车-产品-北京  
   
[鼓掌]  
   
> 10:19:49  徐凌云-JD-架构师  
   
恩  
   
> 10:20:01  永明-云账户-开发-北京  
   
作为打杂者，涨知识了  
   
> 10:20:46  振效+神码+北京  
   
追踪热点，做出反思，也是极好的  
   
> 10:21:37  中金支付～开发～翔远  
   
@蒋招司-产品-杭州  
   
> 10:21:42  中金支付～开发～翔远  
   
没法加您啊  
   
> 10:22:09  永明-云账户-开发-北京  
   
我也不是那么了解，只是半解啊。熊哥  
   
> 10:22:32  永明-云账户-开发-北京  
   
打杂的  
   
> 10:22:43  张戈-联动优势-DD  
   
http://www.mpaypass.com.cn/news/201808/20090806.html  
   
> 10:22:56  张戈-联动优势-DD  
   
中汇可能要垮  
   
> 10:23:37  【信融集团】·王瑞  
   
很久都在传了   
   
> 10:24:17  永明-云账户-开发-北京  
   
我下面，总结下。看看够不够一次讲的东西  
   
> 10:24:40  永明-云账户-开发-北京  
   
见笑了  
   
> 10:26:12  张戈-联动优势-DD  
   
一个研发坑了一个牌照，经常的。  
   
> 10:27:33  顾文烨—上海银行—产品—上海  
   
中汇几年前互联网支付牌照就被收了  
   
> 10:27:41  顾文烨—上海银行—产品—上海  
   
看来收单牌照也危险  
   
> 10:27:54  911-北京-产品  
   
线下收单才是中汇主要业务  
   
> 10:28:09  911-北京-产品  
   
危险7年了。问题不大  
   
> 10:28:40  风兮-Java技术-上海  
   
@双乾支付-技术总监-韩伟  
   
> 10:29:20  上海-上海中钢银联通-董路-技术  
   
看这篇文章，不像是技术人员的问题，手工结算的风险  
   
> 10:29:24  双乾支付-技术总监-韩伟  
   
一个研发坑了一个牌照，经常的。----其实这像@北京一张泽雄 张总说的那样，是一个公司的问题  
   
> 10:29:38  双乾支付-技术总监-韩伟  
   
跟研发本身有关系，但不是仅有这一个关系  
   
> 10:30:07  浅橙现金卡-支付中心-施富宇  
   
这很明显是一套流程的问题了，不单单是系统流程问题  
   
> 10:30:58  双乾支付-技术总监-韩伟  
   
只能说要么产品设计没有考虑周全，要么一个问题，所有的环节都突破了，但很难  
   
> 10:33:43  小孙-58-研发  
   
请假大家一个问题，月流水比较大，达到千万单级别，如何做对账呢？  
   
> 10:35:19  小孙-58-研发  
   
好吧，我们现在的模式是下载微信对账单，然后上传到平台对账  
   
> 10:35:40  姜桥-摩拜单车-技术  
   
@小孙-58-研发 我现在做的对账日订单200完左右，大概时间1小时  
   
> 10:35:48  姜桥-摩拜单车-技术  
   
万  
   
> 10:35:58  姜桥-摩拜单车-技术  
   
可以交流下  
   
> 10:36:01  小孙-58-研发  
   
多跑几个进程的话，需要对excel做分片处理吗  
   
> 10:36:10  小孙-58-研发  
   
好  
   
> 10:36:21  小孙-58-研发  
   
加了您了  
   
> 10:36:37  姜桥-摩拜单车-技术  
   
传统的方案，高级的就是用Spark streaming  
   
> 10:37:43  乐天-麦子金服-打杂-上海  
   
用java8就搞掂了  
   
> 10:37:49  乐天-麦子金服-打杂-上海  
   
原理是类似  
   
> 10:37:54  乐天-麦子金服-打杂-上海  
   
mapreduce  
   
> 10:37:58  小孙-58-研发  
   
有没有比较简单的方式  
   
> 10:38:18  小孙-58-研发  
   
fork join么  
   
> 10:38:22  小孙-58-研发  
   
哦  
   
> 10:38:57  乐天-麦子金服-打杂-上海  
   
。。。  
   
> 10:39:11  乐天-麦子金服-打杂-上海  
   
java8本身底层就对多核进行了很好的优化  
   
> 10:39:21  乐天-麦子金服-打杂-上海  
   
不用你手动fork  
   
> 10:39:23  小孙-58-研发  
   
是用java8的Stream api么  
   
> 10:39:31  乐天-麦子金服-打杂-上海  
   
java8 并行流  
   
> 10:39:34  姜桥-摩拜单车-技术  
   
我现在用的线程池  
   
> 10:39:36  乐天-麦子金服-打杂-上海  
   
是的  
   
> 10:39:55  姜桥-摩拜单车-技术  
   
我之前尝试过java8并行流，并不是很适合对账的场景  
   
> 10:40:00  小孙-58-研发  
   
这样单进程内存开的多大啊  
   
> 10:40:13  乐天-麦子金服-打杂-上海  
   
原因呢？  
   
> 10:40:58  DON-通联-研发  
   
客户端对接应该注意的事项： 1、支付请求非幂等的接口，要注意http的retry 2、公网中用到cdn的，无论是http的4开头还是5开头，都不能置为交易失败，应该认为是不确定交易 3、交易请求没有响应的，一定要发起查询，确认交易状态 4、交易发起时间和查询时间一定要保持足够的时间间隔  
   
> 10:41:17  DON-通联-研发  
   
个人的一点点建议  
   
> 10:41:46  姜桥-摩拜单车-技术  
   
![2018-08-20 10:41:46](http://static.cocolian.cn/img/201808/20180820_104146.png) 
   
> 10:42:43  姜桥-摩拜单车-技术  
   
分页获取数据，分组后开线程处理就好了，java5的，java8的并行流不好控制  
   
> 10:43:36  姜桥-摩拜单车-技术  
   
我现在是每次分页取5W，1000条数据一个线程  
   
> 10:44:42  姜桥-摩拜单车-技术  
   
「 小孙-58-研发: 多跑几个进程的话，需要对excel做分片处理吗 」 - - - - - - - - - - - - - - - 对excel做分片，很难处理吧，最好做格式转换后直接load入库，然后在进行分分页处理  
   
> 10:45:49  北京一张泽雄  
   
思路就是MR，技术实现上多种多样  
   
> 10:46:16  姜桥-摩拜单车-技术  
   
对，这种方式单机速度还行，只是需要内存大点  
   
> 10:46:51  小孙-58-研发  
   
@Joe姜 感谢大神提供的思路  
   
> 10:47:05  姜桥-摩拜单车-技术  
   
如果配合分布式任务调度框架，不同任务多机并行，应该大部分都能满足  
   
> 10:47:29  姜桥-摩拜单车-技术  
   
数据量超级大的，只能通过Hive，开发Spark代码搞了  
   
> 10:48:17  小孙-58-研发  
   
做格式转换的话，是手工转么？  
   
> 10:48:43  姜桥-摩拜单车-技术  
   
写代码  
   
> 10:49:04  tonny-csii-pl-北京  
   
spring batch可以的  
   
> 10:49:45  姜桥-摩拜单车-技术  
   
制定一个标准的模版，按照模版转换生成新的账单文件，然后把标准模版账单直接load到mysql  
   
> 10:50:10  姜桥-摩拜单车-技术  
   
spring batch也可以，差不多，之前用过，但是感觉不太好用  
   
> 10:56:49  小孙-58-研发  
   
我们这边现在做的比较简单  
   
> 10:57:16  小孙-58-研发  
   
孙总不敢当[捂脸]  
   
> 10:57:58  小孙-58-研发  
   
等我把对账优化了再来分享下  
   
> 10:58:12  小孙-58-研发  
   
都是参考群里大神的建议  
   
> 10:58:23  姜桥-摩拜单车-技术  
   
[强]  
   
> 10:58:33  地平线-文思-产品  
   
[鼓掌]  
   
> 10:58:41  宋炽-斗牛金服-PM-北京  
   
② 如果借款人（采取等额本息还款方式）提前进行当期还款，当期不能进行转让，退标后退回用户投资金额。为什么债权转让中，要有这么一个规则呢？  
   
> 10:58:51  宋炽-斗牛金服-PM-北京  
   
求大神解答  
   
> 11:02:55  Codefor-YMT-TechLead-BJ  
   
拿Python跑作业对账，百万级都用不到MR，直接set，map就搞定了。5分钟以内搞定[捂脸]  
   
> 11:04:03  Codefor-YMT-TechLead-BJ  
   
不要读mysql一条一条的取，批量取，或者直接导成文件处理，速度会快很多  
   
> 11:05:20  上海-上海中钢银联通-董路-技术  
   
前面有人分享过了 如果数据在mysql中 不如用full join直接对账  
   
> 12:48:41  DouWei-贝络-PA-北京  
   
做replica，从RO库读  
   
> 13:03:25  蓝蝶-优络-技术-深圳  
   
@上海-上海中钢银联通-董路-技术?请教下full join怎么对？  
   
> 13:20:16  姜桥-摩拜单车-技术  
   
两张中间表 A中间表存账单数据 B中间表存支付平台订单数据，以订单号为关联进行full join 如果A表中有数据，B表中也有数据并且金额一致则认为对平，如果A表中有，B表中没有，则是长款，反之B表中有A表没有就是短款了  
   
> 13:20:36  姜桥-摩拜单车-技术  
   
@蓝蝶-优络-技术-深圳  
   
> 13:21:35  姜桥-摩拜单车-技术  
   
在查询的时候账单字段，和平台订单字段分别按照不同的字段展开，同一条数据进行左右对比  
   
> 13:46:11  上海-上海中钢银联通-董路-技术  
   
不光是长短款，还有状态对比  
   
> 13:47:19  姜桥-摩拜单车-技术  
   
是的  
   
> 13:47:44  姜桥-摩拜单车-技术  
   
我们目前只对成功的订单，所以就没有考虑状态  
   
> 13:54:36  张学鸿-北京-研发-民金所  
   
@Joe姜 桥哥  需要改下昵称   
   
> 13:54:56  姜桥-摩拜单车-技术  
   
噢噢，好的  
   
> 18:53:37  蓝蝶-优络-技术-深圳  
   
@姜桥-摩拜单车-技术?感谢桥哥的解答[强]  
   
> 20:47:30  上海睿民-陈帅康-项目经理  
   
请教个问题，实时交易监控有没有什么好的实现方案？  
   
> 20:47:54  wood-通联-技术  
   
spark  
   
> 20:48:40  wood-通联-技术  
   
进行交易统计等功能  
   
> 20:51:51  顶顶猫-银行-pm  
   
我们用过grafana+spark+influxdb的方案  
   
> 20:52:34  顶顶猫-银行-pm  
   
做的日志分析  
   
> 20:53:07  上海睿民-陈帅康-项目经理  
   
研究一下看看  
   
> 20:54:57  顶顶猫-银行-pm  
   
都是开源项目，实现起来事比较快的。但influxdb集群是收费的。单数据库节点，我们只在tps500左右的系统上跑过。  
   
> 21:33:51  张岩-华恒科技-商务-吉林  
   
微信h5银行不能进件了，还有什么办法么？  
   
> 21:37:54  林安迪-商务-电商分账宝  
   
@张岩-华恒科技-商务-吉林?不能，走网联后也没有h5了  
   
> 21:39:07  林安迪-商务-电商分账宝  
   
未来开不开还不知道，暂时原有的先跑着，断直连后全部停了，剩下官方申请的  
   
> 21:43:13  张岩-华恒科技-商务-吉林  
   
哦  
   
> 22:26:56  地平线-文思-产品  
   
grafana+spark+influxdb的方案，不用influxdb的话有什么替代方案呢？  
   
> 22:39:42  Jason finzsoft 打架 澳新  
   
Graphite Elasticsearch CloudWatch InfluxDB OpenTSDB Prometheus MySQL Postgres Microsoft SQL Server (MSSQL)  
   
> 22:39:56  Jason finzsoft 打架 澳新  
   
这是所有grafana支持的数据源  
   
> 22:56:31  地平线-文思-产品  
   
[强]  
   
