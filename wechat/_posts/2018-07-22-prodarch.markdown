---  
layout:     post   
title:      "20180722-分账账务处理"  
date:       2018-07-22 12:00:00  
author:     "支付产品架构群"  
tag:		[publish] 
description:  "今天主要跟大家分享下分账交易的账务处理部分。因为交易规模不大，系统建设比较简单，希望跟大家学习一下更好的处理方式。"
--- 


大家好！今天主要跟大家分享下分账交易的账务处理部分。因为交易规模不大，系统建设比较简单，希望跟大家学习一下更好的处理方式。另外字打的慢，请见谅。

## 一、分账交易简介

我们这里说的分账交易是指一笔交易对应多个收款方。商户根据预先设定好的收入分配规则，通过接口将订单金额和分账信息提交，支付系统将用户的交易金额，按商户指令分配给参与交易的各方。

分账的场景有很多，比如分销商直接用买方的交易资金去向供货商采购。一家企业对应多个网点或门店，资金先过企业总账户再到企业分账户。还有一些平台类的商户，一般是提供账户托管服务。平台方会收取服务费、信息费等，其余交易资金会结算到平台方下的商户等等。至于商户类型和不同权限的开通会放在商户进件和商户审核环节，这里先不提。

## 二、分账交易记账

我们系统里分账必须满足：

1. 商户开通分账权限，并开通结算过渡户；  
2. 分账账户必须是我方系统内已实名认证的用户，且一笔交易最多支持5个分账账户。  
3. 分账模式必须指定扣取手续费的账户，分账金额=订单金额，手续费另外记账。  
4. 商户需要设置结算周期，系统会根据结算周期进行分账。  


那么分账交易在我们系统里如何记账呢？比如付款方用某银行快捷通道支付了100元，两个收款方各分50元。记账逻辑是这样的，付款方先在系统内完成了一笔充值交易，信息流是付款方银行账户的钱到了付款方支付系统的账户内。记账如下：  
借方：充值待清算款-渠道 100元  
贷方：消费网关过渡户 100元

紧接着，付款方充值到支付系统内的钱用于了消费，信息流是付款方支付账户里的钱到了主收款方支付账户里。记账如下：  
借方：消费网关过渡户 100元  
贷方：结算过渡户-主收款方 100元 

同时，需要从主收款方指定的账户里扣除手续费，比如手续费是1元，记账如下：  
借方：手续费专用户-主收款方 1元  
贷方：支付系统收入账户-手续费 1元

以上记账都是在交易完成后实时记账。分账是在结算时（商户设置的结算周期）记账。记账如下：  
借方：结算过渡户-主收款方 100元  
贷方：结算账户-主收款方 50元  
贷方：余额账户-分账商户 50元

这里主收款方参与了分账，很多情况下主收款方是不参与分账的，尤其是平台类的商户。参与分账主收款方的资金可以直接结算到其银行账户，其他分账方需要自己提现。

## 三、分账交易退款

下面说一下分账交易的退款，结算前的交易退款，可以原路退回，进行一次反记账。如果已经结算的分账交易。退款金额从主收款方的结算账户里扣，由主收款方跟分账方线下转账。这块还在优化。

我这边设计账户的时候主要考虑交易的各方记账，包括针对不同账户设置风控属性。因为财务人员对账的时候只对总账，所以会将账户归类到不同的科目下进行对账。系统也会对不同纬度进行试算平衡。具体账户设计这块有很多同仁都分享过，这里就不在献丑了。

---

## Q&A

**Q1：手续费反交易也冲回去吗？**

是的

**Q2请问下，分享里边的分录过程里边的账户（比如过渡户）都是支付机构系统里边的户对吧？我看你说的都是信息流的过程**

A1：过渡户都是内部账户

Q2：我表达的不好。这些户是三方系统这一侧还是银行侧？

A1：我说的账户都是支付公司的账户，用于记账。讲的是信息流记账过程

Q2：主收款方和分账商户的在银行侧的结算户是什么户呢？可以是普通的借记卡么？

A1:其实很多支付系统结算都是有对公和对私的。对私才有借记卡

A2：只要是结算账户即可，对私一般需要一类户:

A1：是的，2、3类的一般取款有限额吧

Q2:听您的意思，这个是看来这个看银行和平台的要求开对公还是对私的结算账户了。那这个账户需要开在平台备付金所在的银行？还是开在哪家银行无所谓的

A1：除非是一些走代付通道的结算会要求你开某个特定银行的账户吧，一般没要求的

Q2：
[参与分账主收款方的资金可以直接结算到其银行账户，其他分账方需要自己提现]--------是日终清结算的时候，直接资金代付到主收款方，然后其它分账账户需要自己提现触发代付通道？能说一下这么设计的目的么？

A1：日切会做清算，不做结算，除非垫资的

分账的时候我们只知道交易里分账方的支付账户不知道结算账户

Q:2： 所以我的理解是，最后你们分账到三方侧的支付账户，支付账户一一对应到银行侧结算户，这样可以进行后续的资金代付到结算账户。所以你们也不需要关心结算账户，因为已经配置好了，关心支付账户的就好了。

A1：支付账户跟银行账户没有一一对应这么一说。支付账户记账都只针对信息流的。

资金流你就理解是用户银行账户的钱到了三方备付金里，然后里面瞎转悠了一圈又从备付金里到了商户的银行账户里

Q2：  嗯嗯，get了，我把它想复杂了，谢谢周详的回答[呲牙]

**Q3：  多方如何勾兑账务？**

A1：不同方可以查看订单详情，里面有分账明细，分账不单独生成交易流水，即订单中心中无对应的流水，分账账务流水可以和消费订单关联；

**Q4:分账规则是预先设置好的吗？每个商户各不相同？**

A1:有接口的，通过接口上送分账金额和分账信息

**Q5:请教一下，反记账是红冲？还是蓝补**

A1：蓝补，记多笔:

Q5：各方之间如何对账？

A1：给主收款方会出对账单，而且只是交易对账，里面包含订单信息和分账明细。

分账账户为商户的包含订单信息和分账到其账户的明细

是会员的话，不提供对账单，但可以通过收支明细进行资金对账，收支明细至少包含以下信息：入账日期、金额、消费流水号等

Q5：运营过程中对账和清算过程中有遇到和优化过哪些问题可以分享吗？主要还是明细对账吧？

A1：是的。主要是明细对账，清算过程优化一直在进行呀[呲牙]，退款不智能，然后分账方有的要求D0无法满足。

手续费账户没指定的时候，计算起来也是麻烦呀

**Q6刚才记手续费那块，100元已经扣除了1块手续费，那剩下分账的钱应该只剩99才对，这样理解对不？**

以上记账都是在交易完成后实时记账。分账是在结算时（商户设置的结算周期）记账。记账如下：  
借方：结算过渡户-主收款方 100元  
贷方：结算账户-主收款方 50元  
贷方：余额账户-分账商户 50元:

A1： 不对，手续费单独记账的，分账分的交易金额

Q6：那手续费的1块钱从哪里出？

A1： 分账商户接入时会单独开手续费账户

Q6：手续费户是预先存好指定金额的吗？分账时候再从里面扣减？

A1：手续费是实时扣的，扣失败不进行分账，也可以指定结算账户为手续费扣款账户

A2：意思手续费扣成功，在完成后续交易。

**Q7请教一下各位大佬**  
目前我们的结清流程是，按照结清的算法合并用户的剩余还款计划，用户通过主动触发代扣进行结清。  
问题是因为银行的限额，结清的时候进行代扣需要拆单，可能出现只扣到一部分的情况。这种情况如果用冲抵的话正常的还款计划和结清的还款计划算法不一样；不冲抵的话那只能告诉用户无法结清。  
请问各位有没有做过这块的问题支持一下。

A1：按借据的还款计划扣，应收与实收就对上了，不过成本就高了。

A2：支付宝的网商贷是按借款计划来的，一个头对应多个行（分期），一个头下可以提前还款但是不能打包还款。如果你走分拆与合并要复杂些。

Q7：那一个头可以提前还款，理论上提前还款的算法一般跟正常还款算法不一样。\@A2 按照您的意思是提前还款要单独拆分出来做？

A2：提前还款还是针对还款头下面的所有行，提前还款金额不得超过还款头的金额。如果还款小于还款头金额，应该在行下面有拆分。
自动还款计划貌似是出账单进行扣款的

个人理解，只要是不跨还款头/行的拆分，在同一个还款头下面进行还款还是容易实现，就是一个针对之前的行匹配就行了

Q7：了解
