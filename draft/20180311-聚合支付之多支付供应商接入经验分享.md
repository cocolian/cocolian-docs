# 一、分享主题：清结算模块设计
> 大家好，我叫胡凯，也可以称呼我Kevin，今天和大家分享的是关于对接支付供应商的一些经验，烦请大家能够多多指教，谢谢

公司有三条产品线，分别为产品线A、产品线B和产品线C，其中产品线A和产品线B的产品形态都包括PC端Web、手机端H5、APP和微站，产品线C的产品形态包括PC端Web和手机端H5。<br>

在产品初期，仅接入了网银支付，而网银支付存在如下问题：
- 1、用户体验较差，对浏览器的兼容也比较差； 
- 2、网银支持H5的银行较少，对手机端的支持较差； 
- 3、微信内嵌浏览器不支持网银，在微站中无法进行支付； 

基于如上问题，导致支付失败率高达60%-70%。为了降低支付失败率，同时提高用户体验，开始对接第三方支付/聚合支付的快捷支付、认证支付和扫码支付，经过一个多月的对接，接入了5家支付供应商的快捷支付和扫码支付，同时优化了支付流程，使支付失败率降低到了10%-15%。<br>

支付失败率降低了，但因为行业性质，导致对接的供应商变动比较频繁，需要不断开发对接新的支付供应商（目前已对接近40家支付供应商），而公司的三个产品，因开发语言和系统框架的不一致，导致支付模块的代码不能复用，均需要独立开发对接支付供应商，至此，在人力和时间上给公司带来了极大的成本增加。<br>

为了在支付功能的开发上降低人力成本和时间成本，同时提高支付通道的对接效率，规划了支付中间件，产品规划的思维导图如下：<br>
![20180311_202321](http://wechat.lixf.cn/img/20180311_202321.png)

支付中间件将成为公司所有产品线对接支付供应商的唯一接口，为公司所有产品线提供公共的支付标准接口。<br>

支付中间件包括7个模块，分别为:
_ 产品管理
- 签约公司
- 支付类型
- 支付供应商
- 支付通道
- 代付模板
- 交易流水

1. 产品管理模块主要是管理公司的各个产品线，类似于支付供应商的商户管理，为每个产品线生成唯一的产品编号。
2. 签约公司模块主要是管理用于签约支付供应商的公司列表，主要是为每个公司生成唯一的公司编号，并维护公司名称、公司简称及备案域名等信息。
3. 支付类型模块主要是管理各种支付方式，不仅仅局限于网银支付、快捷支付、扫码支付等，而是会根据不同支付方式的特点自定义支付类型，以便更好的管理和维护支付通道。
4. 支付供应商模块主要是管理外部支付供应商，包括第三方支付、聚合支付及境外支付等，同时会涉及到每个支付供应商所签约的商户及支付通道支持银行的管理。支付供应商与签约公司构成支付商户，支付商户与支付类型构成支付通道。
5. 支付通道模块主要管理支付中间件所有的支付通道，维护支付通道的基本信息。
6. 代付模板主要是管理批量代付模板及代付接口，为客户提现提供支持。
7. 交易流水主要是管理支付中间件的所有支付与代付明细，为财务对账提供支持。

如上是我今天分享的内容，实际工作中的总结，烦请大家多指教，谢谢