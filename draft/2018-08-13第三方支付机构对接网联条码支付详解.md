各位老师、同学好，今天我为大家分享的内容是银联、网联条码支付接口接入； 

### 1.接入背景   
首先是各大支付公司为配合人行规定的630断直连的规定，其次也是因为微信、支付宝的支付能力所占据的庞大的国内以及海外支付场景和市场以及现在用户的支付习惯需要进行接入； 

### 2.银联、网联条码支付包含的支付能力  
**微信**：主扫、被扫、app、小程序、公众号；   **支付宝**：主扫、被扫、服务窗；（目前支付宝不予开放） 

### 3.微信和支付宝各支付能力的使用场景  
（1）**（微信/支付宝）主扫**：++主扫功能目前可适用于线上支付和线下支付两种场景++，线上场景：如美团、大众点评、京东、美丽说等各大消费以及电商平台等Pc端和移动端；线下场景：如711、全食、家乐福等各大商超便利店；  
（2）**被扫**：微信被扫主要适用于商超面对面收银的支付场景；  
（3）**公众号**：++微信公众号支付提供线上和线下两种支付场景++：线上场景：如京东、每日优鲜、美团等具备微信公众号的平台，用户都可以直接在微信种打开其微信公众号，并完成商品的选购和支付；线下场景：如每日优鲜、友宝以及便利蜂等线下无人零售贩卖机，用户可以通过扫描贩卖机上的静态二维码，进入到商家公众号页面，完成商品的选购和支付；  
（4）**app**:微信APP支付适用于一切APP支付场景，只要该商户开发的APP接入微信支付，用户就可以使用微信支付完成交易；目前微信的APP支付支持安卓和ios两种模式；  
(5)**小程序**：如麦当劳、游戏开发商等一切开发小程序的平台，用户都可以在微信的小程序中完成商品的选购和支付；  
(6)**服务窗**：同公众号；  

### 4.微信商户进件：  
目前在商户通过银联/网联向微信进行进件时，是有三种不同的进件模式：   
**(1)特殊费率商户**（公立学校/医院）此类商户在微信审核成功之后，还需要登陆到进件商户的所在渠道的微信渠道公众平台中上传相关资质再次通过微信审核后才可进行交易。 
进件流程： 
- 登陆微信商户平台进入“特约商户管理”界面；  
- 进入“特约商户管理”界面后找到需要进行认证的商户，点击“认证”进入认证界面；  
- 进入认证界面时，系统会提示认证分为两部：1.填写申请资料；2.验证对公账户打款金额；点击“填写申请资料”进入到申请资料填写界面；  
- 在进入到申请资料填写页面中，需要上传商户的“营业执照图片”填写“门店地址”选择“开户银行”“开户银行城市”“开户支行”“银行账号”后点击“下一步”即可完成上传的操作。在页面下方会有选填项“补充材料”上传，操作人员可根据情况而定是否需要上传资料；   
- 在完成资料上传后，系统会提示：“已成功提交认证申请”，后续微信会对认证商户的对公账户中进行打款，打款金额随机，操作人员需回填微信打款的金额后，才可完成商户的认证；  

**(2)app商户**   app类型商户的进件流程较为繁琐，首先商户需要通过“商户通道信息维护”功能完成进件并审核成功之后，操作人员需要登陆到“渠道商户平台”和“服务商平台”中分别进行打款认证和资上传才可完成最终进件。进件详情如下：  
1. 在商户通过“商户通道信息维护”功能完成进件并审核成功之后，操作人员首先需要登陆到【渠道商户平台】中的【特约商户管理】功能中，找到需要认证的商户，并点击“认证”，后续微信会对认证商户的商户中进行打款，打款金额随机，操作人员需回填微信打款的金额后，才可完成商户的认证； 
2. 在【渠道商户平台】中的商户完成并通过微信的认证之后，操作人员需要登陆到【服务商平台】中的【特约商户授权产品】功能找到需要开通app支付的商户后，点击列表页中的“申请”按键，进行商户申请app界面； 在进入申请app页面之后，操作人员需上传“法人执照”、“营业执照”“组织机构代码证照片”等信息。在完成上传之后，等待微信审核结果，审核通过即可开展app支付交易。 
3. 其他：除以上两种需要二次进件的商户之外，其他商户在进件之后，微信回复成功后，即可正常开始交易，但公众号支付类型的商户还需要到“微信服务商平台”中配置公众号授权目录，在完成配置之后，商户才可正常发起交易。配置的步骤为：    
- 在进入服务商平台中，操作人员需进入【服务商功能】后点击【特约商户管理】来查看需要完成授权目录配置的商户；   
- 在查找到需要配置授权目录的商户之后，点击【设置】进入到商户设置页面进行授权目录的配置；   
- 在进入配置页面中，找到【公众号支付—支付相关域名】填写【JS API支付授权目录】后点击【保存】完成配置即可；  

### 5.微信支付交易流程：  
目前银联和网联封装的微信条码支付产品中，会有两个交易接口：刷卡支付和统一下单支付，刷卡支付只有微信被扫的能力，统一下单包括了微信的：主扫、app、公众号和小程序；其中，刷卡支付的流程为：  
![image](http://static.cocolian.cn/img/20180813_183021.png)  
统一下单的交易流程为：  
![image](http://static.cocolian.cn/img/20180813_183022.png)  
以上为我今天的分享的内容，由于我的支付经验较浅，所以分享的内容略有局限性，还请大家多多包含，后续我会通过不断的学习来丰富自身的知识，届时再为大家分享更有意义、更有深度的内容，欢迎指正！

## Q&A

Q:密钥这一块你们怎么管理的？这个密钥是证书管理么？  
A:网联对加密有明确要求的，具体可以查看网联颁发的文档。  
Q:直接接入和通过网联银联接入，接入流程有什么样的区别？  
A:银联和网联的接入流程目前来看没有什么区别，都是一样的，可以简单理解成银联网联在中间做了个通道其它没啥差别。  
Q:不是可以这么理解你们接了银联网联同时也接了微信支付宝？  
A:您可以理解为，网联银联接了微信支付宝，我们接了网联和银联。  


