# 主题分享
各位好，我今天分享的主题是：单用途预付卡的后台设计。
## 1 单用途预付卡介绍
预付卡，使用上跟现金差不多，可以用来兑付商品和服务，单用途和多用途预付卡的区别是单用途预付卡只能在发卡企业或同一品牌连锁商业企业兑付商品和服务；生活上大家最早接触的单用途预付卡应该是街边电话亭使用的电话卡，目前最常见的就是各种各样的超市卡。

## 2 预付卡的商业性 
### 2.1 发卡企业
1. 沉淀资金：根据《单用途商业预付卡管理办法》，不同规则下有20%至50%预收资金会放放到存管账户，其余预收资金可以用来企业主营业务；
2. 品牌推广：一般年底或过节大家会买各种各样的礼品卡送人，礼品卡的流动实际上也是品牌的传递，可以为平台拉来新用户和留住用户。 
### 2.2 购卡方
1. 企业：预付卡的大部分售卖都是年底企业给自己的员工发福利，一是员工希望在消费上有选择多样性，二是大客户购买都会给予一定的折扣；
2. 个人：对于消费者来说，购卡是有一定折扣的且能获得其他VIP的服务。 
### 2.3 购买预付卡发票
增值税普通发票 
### 2.4 数据
了解到的数据是正常卖一年大概2个亿，百分之90还是年底企业采购。跟企业合作售卖，17年差不多卖了10个亿。

## 3 预付卡后台模块简述 
### 3.1 入库管理（财务操作）
**大致流程**：造卡->制卡->验卡->入库（屯货的一个地方）；
1. 财务在后台进行造卡；
2. 将造好的卡数据发给制造商制造实体卡；
3. 制造商制卡后交付财务，财务抽样验收后即入库完成。  
入库完成后也叫基础库存，引入基础库存的概念是预付卡销售渠道，例如线上/线下。为了保持产品结构通用性及方便管理，电子卡也需要进行入库。

**主要字段**：入库批次/卡面额/卡数量/未出库/已锁定/卡类型/卡种类/卡号范围/入库时间/批次状态
1. 入库批次：记录一批卡入库信息的id，出库时若选择定制卡，需输入入库批次。（因预付卡的购买企业可能有定制卡的需求，定制卡logo，定制卡面额，例如999。如果出库的是常规卡，100/500/1000等金额，则按入库批次，卡号顺序进行出库；
2. 卡类型：对于电商来说，不同产品的利润是不一样的。所以有卡类型的概念，区别是可购买的产品范围不同，例如携程的任我行可购买全品类，任我游无法购买机票；
3. 卡面额：因单张记名卡限额5000元，单张不记名卡/虚拟卡限额1000元，所以此处的金额上限只能为5000元；
4. 未出库：记录该批次卡还未出库的数量；
5. 已锁定：处于出库过程中的卡，例如线上销售设置了虚拟库存，需将此部分卡锁定，防止用户购卡后无库存的情况。

### 3.2 出库管理（财务操作）
对已经入库的卡进行售卖，相当于电商的订单，基本流程：
1. 记录出库卡信息：面值/数量/购买公司/合同等；
2. 销售人信息；
3. 销售信息：例如折扣，返点

**主要字段**：出库批次/出库状态/卡数量/卡面额/销售人员/销售时间/购买人员/应付金额/实付金额等；
1. 出库批次：记录该订单的出库批次号；
2. 卡数量/卡面额/卡类型/卡号范围：一个批次号中可出库多种类型及金额的卡。如果是定制卡需输入入库批次；
3. 购买人：购买记名卡的，或一次性购买1万元（含）以上不记名卡的，需留下购买人或者企业的信息，实际操作中，都留下就好 
4. 有效期：规定记名卡不得设有效期；不记名卡有效期不得少于3年。实际操作中为了避免其他安全隐患，卡出库后只能在3年内绑定，绑定后三年内有效。过期的可提供延期服务； 
5. 线下销售，由财务人工操作；线上销售，相关销售信息也会记录在出库管理中；

### 3.3 卡管理
- 对**售出的预付卡进行查询**：例如购买人/面值/绑定记录/消费记录等；
- 对**售出的礼品卡进行操作**：例如延期/冻结/重置密码/作废/回收 
  - **主要字段**：卡号/面值/卡类型/卡种类/首次激活时间/有效期/已使用金额/未使用金额 
    1. 首次激活时间：使用礼品卡前需绑定，第一次绑定即激活；
- **使用记录**：包含消费记录，及绑定/解绑/重置密码等记录

主要就是以上三部分，预付卡线上售卖及营销的部分就不展开讲了，这样的设计也有很多不足的地方。  
**例如一**：售卖需要基于基础库存，如果财务没有及时制卡，我又想卖怎么办？临时解决办法：
- 电子卡库存是可以设置无限大的；
- 实体卡的常规面额一般都会备足，对于量大的线上交易会做限制，安排通过线下采购；
- 极端情况下，可以让财务在礼品卡未制作完成时，先更改状态入库。 

**例如二**：线上购买预付卡时，无法让用户自由定制金额，例如随便输入1388

## 4 组合支付 
**问题**：当电商钱包中有多个账户时（例如余额/奖金/礼品卡），又不让用户一起支付，投诉会比较多。
**解决方案**：
- 方案一：订单中心作为计算方，计算「订单应收=实收（支付渠道1，支付渠道2…）+满减+支付立减+优惠券等」时再做订单跳转，用户每次发起支付时，收银台去调订单接口，查询用户还需付多少钱，每次支付完成后通知订单。
- 体验上，收银台自动帮用户勾选钱包支付，按优先级进行扣款：奖金-余额-礼品卡。 
- 方案二：订单转给支付需付多少钱，收银台统计用户付款金额是否等于应付金额，等于时再返回订单支付成功。

个人比较倾向于第一种方案，订单侧汇总全部资金数据，方便做收入/利润等统计

**组合支付退款**：计算好应退金额后，先退真实资金。支付渠道-礼品卡-余额-奖金；  
例如：我购买了2000的卡，1000块用的奖金支付，1000用的支付宝。当花掉500时再来退款，假设无损退：①退支付宝1000，②退奖金500；

## 5 安全 
### 5.1 常见问题
随便搜索下礼品卡盗刷，会有各种各样的新闻。同程/携程等友商都遇到过问题如下：  
1. 用户投诉，我的礼品卡根本没有使用，怎么钱没了，有可能是联合欺诈，自己将礼品卡给别人使用了，来投诉； 
2. 最常见的刷单行为，黑产在平台购买礼品卡，再将支付二维码让刷单的人支付，支付后立马购买门票等不记名旅游产品专卖。此问题导致同程PC端无法用微信二维码购买礼品卡。（微信二维码最短也要半小时才能刷新一次，易被截图使用）；

### 5.2 解决措施
针对这些问题，采取了以下几个安全措施： 
1. 预付卡使用前：使用前需绑定，设置每天绑定错误上限，绑定后用户端不可解绑 ；
2. 预付卡支付：支付时根据风险程度调用支付密码/短信验证码； 
3. 实体预付卡若是线上购买，收到货后，需app点击确认收货才能完成预付卡出库；

附：[单用途预付卡管理条例](https://baike.baidu.com/item/%E5%8D%95%E7%94%A8%E9%80%94%E5%95%86%E4%B8%9A%E9%A2%84%E4%BB%98%E5%8D%A1%E7%AE%A1%E7%90%86%E5%8A%9E%E6%B3%95/18014039)

---

# Q&A
**Q:** 预付费卡可以用来购买金融产品么？市场上有类似操作么？比如理财什么的。   
**A:** 不可以，①单用途卡不得用于或变相用于提取现金，不得具备除兑付商品和服务以外的功能。②单用途预付卡只能在发卡企业或同一品牌连锁商业企业兑付商品和服务。  

**Q:** 预付费卡的充值方式是用户用银行卡充，你用预付费卡购买的理财，收益怎么给呀，之前讨论中说法规也明确规定不能买？  
**A:** 做法是这样的，你先充值到互联网账户，这里可以理财什么的，等消费的时候，再划到预付费卡里，再消费，再结算；但是这个是非常违规的。  
**Q1:** 单用途预付费卡需要备案吗？  
**A1:** 需要备案的，而且各个地区貌似不一样；  

**Q:** 请教个问题，分享中提到：不同规则下有20%至50%预收资金会放放到存管账户，这个存管账户实在有预付费牌照的支付公司？  
**A:** 放在合作银行的，实际操作中放了多少又是另回事了，支付公司一般都会有预付卡的业务，有预付卡牌照是说自己可以发卡；   
**Q1:** 单用途预付费卡银行和支付公司都可以做资金存管吧 ？  
**A1:** 支付公司不可以，在支付公司做就是支付账户了，不属于单用途预付卡了，但确实有很多企业做账户的，不做单用途预付卡了；  
**Q2:** 多用途预付费卡账户和支付账户区别在哪儿？  
**A2:** 多用途预付费卡，需要有预付卡牌照的支付公司才能发，单用途卡不需要，与支付账户的主要区别是：是否有实体卡片，支付账户是没有实体卡的；其实从电商角度看，礼品卡账户和余额账户一样，是个虚拟账户，礼品卡也有电子的，也有“充值”的概念；但是从产品角度上，每张卡都有不同的卡面，不同的有效期，所以也会有两种形式。


 