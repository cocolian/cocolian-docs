---
layout:     essay
title:      "网联业务-协议支付"
date:       2018-05-05 12:00:00
author:     "shamphone"
chapter:	"1"
status:		"hidden"
---

## 一、定义

协议支付指客户需要先进行身份认证及签约，然后再根据签约协议进行支付，银行需要校验协议信息。和现有的快捷支付类似。 
网联的协议支付业务与现有市场的快捷支付业务相比主要增加了银行端解约的功能。 
快捷支付业务来源于阿里公司在2007年推出的支付宝卡通业务。通过支付宝或者银行网银建立支付宝账户和银行卡号之间的绑定关系，客户可以通过支付宝或者银行内系统互相查询余额，互相转账。 2012年支付宝推出了快捷支付，逐步停用了卡通的功能； 快捷支付后期，快捷支付的解约支付也不再通知给银行系统；银行本身也没有发起解约的功能，所以银行系统中保留的签约信息不是完全正确的。 
网联建立后，根据人行发文要求，快捷支付业务的协议信息支付机构必须和银行保持一致，并且可以从银行发起解约交易。  

网联业务中，协议支付的解约分为支付机构发起和银行发起。  
支付机构发起的解约申请是指支付机构根据客户委托，向银行提交解除指定银行账户支付协议的申请。银行收到解约申请后，应校验协议信息，校验通过的将相关协议状态置为已解约，同时向平台返回解约成功回执。对校验未通过的请求，银行应给予失败应答并向平台返回失败原因码。     
银行发起的解约为解约通知，即向支付机构强制解约；银行发起的渠道包括：手机银行、个人网银等。   
网联协议支付业务除了解约功能外，其他和现有的快捷支付业务是一样的。

## 二、签约

签约包含身份认证流程和签约流程两部分。 

用户发起签约申请，先有支付机构通过报文向网联发起身份认证申请，网联受理并通过报文向签约行转发身份认证申请，由签约行完成身份认证处理并向用户发送身份验证授权信息(一般为短信验证码)，用户填写身份验证授权信息，再由支付机构通过报文向网联发起签约申请，网联受理并通过报文向签约行转发签约申请，由签约行完成签约处理。

在网联提供的签约类接口中包含了姓名，身份证号，银行卡号，预留手机号，银行卡对应的银行机构编码(比如银行卡为农行卡时候农行的编码)，银行卡账户类型(个人银行借记账户，个人银行贷记账户，个人银行准贷记账户)，签约人证件类型(一般都是身份证证件类型，还有其他比如驾驶证，军官证这些，但是很少用)，交易类别(身份认证还是签约)，交易流水号(每一次调用接口都应有唯一的流水号，主要为了方便以后通过流水号进行查询)，交易日期，还有支付机构标识(比如支付宝有唯一的标识)，还有签约人在支付机构开设的支付账户编号(比如你在支付宝开通会员后，设置的会员号为20171129113345)；其中四要素(姓名，身份证号，银行卡号，预留手机号)需要用户提供，其他参数都可以由支付机构自己提供。

调用网联接口后，网联会返回结果，返回结果除了返回调用接口传给网联的原信息，还会返回一个重要参数，签约协议号；签约的根本目的就是为了获得这个签约协议号，当一张银行卡签约后获得签约协议号，以后进行支付时候，就可以凭借该协议号直接支付，不需要再次通过四要素去做交易。

简单来说，用户提交四要素换回了签约协议号，四要素经过支付机构，网联，签约行传递后，签约行会返回签约协议号到支付机构，以后支付时，支付机构就可以直接拿着这个签约协议号去做支付。也就是 签约号 = （银行卡号 ， 支付机构 ，身份证号）


